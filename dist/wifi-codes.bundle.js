/*! For license information please see wifi-codes.bundle.js.LICENSE.txt */
(()=>{var e,t,n={56:(e,t,n)=>{"use strict";var r=n(467),i=n(461);(0,i.KO)("firebase","9.23.0","app");var s=n(405),o=n(908),a=n(743),c=n(125);const u="firebasestorage.googleapis.com",l="storageBucket";class h extends a.g{constructor(e,t,n=0){super(p(e),`Firebase Storage: ${t} (${p(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,h.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return p(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var d,f;function p(e){return"storage/"+e}function m(){return new h(d.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function g(e){return new h(d.INVALID_ARGUMENT,e)}function y(){return new h(d.APP_DELETED,"The Firebase app was deleted.")}function v(e,t){return new h(d.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function w(e){throw new h(d.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(d||(d={}));class b{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=b.makeFromUrl(e,t)}catch(t){return new b(e,"")}if(""===n.path)return n;throw r=e,new h(d.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)",i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${t===u?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<a.length;t++){const r=a[t],i=r.regex.exec(e);if(i){const e=i[r.indices.bucket];let t=i[r.indices.path];t||(t=""),n=new b(e,t),r.postModify(n);break}}if(null==n)throw function(e){return new h(d.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class I{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function E(e){return"string"==typeof e||e instanceof String}function T(e){return _()&&e instanceof Blob}function _(){return"undefined"!=typeof Blob&&!(0,a.Ll)()}function C(e,t,n,r){if(r<t)throw g(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw g(`Invalid value for '${e}'. Expected ${n} or less.`)}function x(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function S(e){const t=encodeURIComponent;let n="?";for(const r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n=n.slice(0,-1),n}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(f||(f={}));class k{constructor(e,t,n,r,i,s,o,a,c,u,l,h=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=l,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());void 0!==e?n(e):n()}catch(e){r(e)}else if(null!==i){const e=m();e.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else t.canceled?r(this.appDelete_?y():new h(d.CANCELED,"User canceled the upload/download.")):r(new h(d.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?e(0,new A(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,o=!1,a=0;function c(){return 2===a}let u=!1;function l(...e){u||(u=!0,t.apply(null,e))}function h(t){i=setTimeout((()=>{i=null,e(f,c())}),t)}function d(){s&&clearTimeout(s)}function f(e,...t){if(u)return void d();if(e)return d(),void l.call(null,e,...t);if(c()||o)return d(),void l.call(null,e,...t);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),h(n)}let p=!1;function m(e){p||(p=!0,d(),u||(null!==i?(e||(a=2),clearTimeout(i),h(0)):e||(a=1)))}return h(0),s=setTimeout((()=>{o=!0,m(!0)}),n),m}(((e,t)=>{if(t)return void e(!1,new A(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===f.NO_ERROR,i=n.getStatus();if(!t||function(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}(i,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===f.ABORT;return void e(!1,new A(!1,null,t))}const s=-1!==this.successCodes_.indexOf(i);e(!0,new A(s,n))}))}),e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class A{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function D(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function N(...e){const t=D();if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(_())return new Blob(e);throw new h(d.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}const P="base64",L="base64url",R="data_url";class O{constructor(e,t){this.data=e,this.contentType=t||null}}function M(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<=127?t.push(r):r<=2047?t.push(192|r>>6,128|63&r):55296==(64512&r)?n<e.length-1&&56320==(64512&e.charCodeAt(n+1))?(r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):t.push(239,191,189):56320==(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function F(e,t){switch(e){case P:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw v(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case L:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r)throw v(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=function(e){if("undefined"==typeof atob)throw new h(d.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw v(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);return r}class B{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw v(R,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;var r,i;null!=n&&(this.base64=(i=";base64",(r=n).length>=7&&r.substring(r.length-7)===i),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class U{constructor(e,t){let n=0,r="";T(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(T(this.data_)){const s=(n=this.data_,r=e,i=t,n.webkitSlice?n.webkitSlice(r,i):n.mozSlice?n.mozSlice(r,i):n.slice?n.slice(r,i):null);return null===s?null:new U(s)}var n,r,i;{const n=new Uint8Array(this.data_.buffer,e,t-e);return new U(n,!0)}}static getBlob(...e){if(_()){const t=e.map((e=>e instanceof U?e.data_:e));return new U(N.apply(null,t))}{const t=e.map((e=>E(e)?function(e,t){switch(e){case"raw":return new O(M(t));case P:case L:return new O(F(e,t));case R:return new O(function(e){const t=new B(e);return t.base64?F(P,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw v(R,"Malformed data URL.")}return M(t)}(t.rest)}(t),new B(t).contentType)}throw m()}("raw",e).data:e.data_));let n=0;t.forEach((e=>{n+=e.byteLength}));const r=new Uint8Array(n);let i=0;return t.forEach((e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]})),new U(r,!0)}}uploadData(){return this.data_}}function V(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(n=t)||Array.isArray(n)?null:t;var n}function j(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function q(e,t){return t}class z{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||q}}let G=null;function $(){if(G)return G;const e=[];e.push(new z("bucket")),e.push(new z("generation")),e.push(new z("metageneration")),e.push(new z("name","fullPath",!0));const t=new z("name");t.xform=function(e,t){return function(e){return!E(e)||e.length<2?e:j(e)}(t)},e.push(t);const n=new z("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new z("timeCreated")),e.push(new z("updated")),e.push(new z("md5Hash",null,!0)),e.push(new z("cacheControl",null,!0)),e.push(new z("contentDisposition",null,!0)),e.push(new z("contentEncoding",null,!0)),e.push(new z("contentLanguage",null,!0)),e.push(new z("contentType",null,!0)),e.push(new z("metadata","customMetadata",!0)),G=e,G}function K(e,t,n){const r=V(t);return null===r?null:function(e,t,n){const r={type:"file"},i=n.length;for(let e=0;e<i;e++){const i=n[e];r[i.local]=i.xform(r,t[i.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,i=new b(n,r);return t._makeStorageReference(i)}})}(r,e),r}(e,r,n)}class H{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function W(e){if(!e)throw m()}function Q(e){return function(t,n){let r;var i,s;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new h(d.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new h(d.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(s=e.bucket,r=new h(d.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,r=new h(d.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):r=n,r.status=t.getStatus(),r.serverResponse=n.serverResponse,r}}function X(e){const t=Q(e);return function(n,r){let i=t(n,r);var s;return 404===n.getStatus()&&(s=e.path,i=new h(d.OBJECT_NOT_FOUND,"Object '"+s+"' does not exist.")),i.serverResponse=r.serverResponse,i}}function J(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const c=function(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return t&&t.type()||"application/octet-stream"}(0,t)),r}(t,r,i),u="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+function(e,t){const n={},r=t.length;for(let i=0;i<r;i++){const r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",l="\r\n--"+a+"--",f=U.getBlob(u,r,l);if(null===f)throw new h(d.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.");const p={name:c.fullPath},m=x(s,e.host,e._protocol),g=e.maxUploadRetryTime,y=new H(m,"POST",function(e,t){return function(n,r){const i=K(e,r,t);return W(null!==i),i}}(e,n),g);return y.urlParams=p,y.headers=o,y.body=f.uploadData(),y.errorHandler=Q(t),y}class Y{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=f.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=f.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=f.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,n,r){if(this.sent_)throw w("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const e in r)r.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,r[e].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw w("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw w("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw w("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw w("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class Z extends Y{initXhr(){this.xhr_.responseType="text"}}function ee(){return new Z}class te{constructor(e,t){this._service=e,this._location=t instanceof b?t:b.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new te(e,t)}get root(){const e=new b(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return j(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new b(this._location.bucket,e);return new te(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new h(d.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function ne(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=x(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,s=new H(r,"GET",function(e,t){return function(n,r){const i=K(e,r,t);return W(null!==i),function(e,t,n,r){const i=V(t);if(null===i)return null;if(!E(i.downloadTokens))return null;const s=i.downloadTokens;if(0===s.length)return null;const o=encodeURIComponent;return s.split(",").map((t=>{const i=e.bucket,s=e.fullPath;return x("/b/"+o(i)+"/o/"+o(s),n,r)+S({alt:"media",token:t})}))[0]}(i,r,e.host,e._protocol)}}(e,n),i);return s.errorHandler=X(t),s}(e.storage,e._location,$());return e.storage.makeRequestWithTokens(t,ee).then((e=>{if(null===e)throw new h(d.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e}))}function re(e,t){if(e instanceof se){const n=e;if(null==n._bucket)throw new h(d.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+l+"' property when initializing the app?");const r=new te(n,n._bucket);return null!=t?re(r,t):r}return void 0!==t?function(e,t){const n=function(e,t){const n=t.split("/").filter((e=>e.length>0)).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),r=new b(e._location.bucket,n);return new te(e.storage,r)}(e,t):e}function ie(e,t){const n=null==t?void 0:t[l];return null==n?null:b.makeFromBucketSpec(n,e)}class se{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=u,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?b.makeFromBucketSpec(r,this._host):ie(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=b.makeFromBucketSpec(this._url,e):this._bucket=ie(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){C("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){C("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new te(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new I(y());{const s=function(e,t,n,r,i,s,o=!0){const a=S(e.urlParams),c=e.url+a,u=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(u,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(u,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(u,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(u,r),new k(c,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,o)}(e,this._appId,n,r,t,this._firebaseVersion,i);return this._requests.add(s),s.getPromise().then((()=>this._requests.delete(s)),(()=>this._requests.delete(s))),s}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const oe="@firebase/storage",ae="0.11.2",ce="storage";function ue(e,t,n){return function(e,t,n){e._throwIfRoot("uploadBytes");const r=J(e.storage,e._location,$(),new U(t,!0),n);return e.storage.makeRequestWithTokens(r,ee).then((t=>({metadata:t,ref:e})))}(e=(0,a.Ku)(e),t,n)}function le(e){return ne(e=(0,a.Ku)(e))}function he(e,t){return function(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof se)return new te(e,t);throw g("To use ref(service, url), the first argument must be a Storage instance.")}return re(e,t)}(e=(0,a.Ku)(e),t)}(0,i.om)(new c.uA(ce,(function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return new se(n,r,s,t,i.MF)}),"PUBLIC").setMultipleInstances(!0)),(0,i.KO)(oe,ae,""),(0,i.KO)(oe,ae,"esm2017");var de=n(424);let fe,pe;const me=new WeakMap,ge=new WeakMap,ye=new WeakMap,ve=new WeakMap,we=new WeakMap;let be={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return ge.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ye.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ee(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Ie(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(pe||(pe=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(Te(this),e),Ee(me.get(this))}:function(...e){return Ee(t.apply(Te(this),e))}:function(e,...n){const r=t.call(Te(this),e,...n);return ye.set(r,e.sort?e.sort():[e]),Ee(r)}:(e instanceof IDBTransaction&&function(e){if(ge.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));ge.set(e,t)}(e),n=e,(fe||(fe=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,be):e);var t,n}function Ee(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(Ee(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&me.set(t,e)})).catch((()=>{})),we.set(t,e),t}(e);if(ve.has(e))return ve.get(e);const t=Ie(e);return t!==e&&(ve.set(e,t),we.set(t,e)),t}const Te=e=>we.get(e),_e=["get","getKey","getAll","getAllKeys","count"],Ce=["put","add","delete","clear"],xe=new Map;function Se(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(xe.get(t))return xe.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=Ce.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!_e.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return xe.set(t,s),s}var ke;ke=be,be={...ke,get:(e,t,n)=>Se(e,t)||ke.get(e,t,n),has:(e,t)=>!!Se(e,t)||ke.has(e,t)};const Ae="@firebase/installations",De="0.6.4",Ne=`w:${De}`,Pe="FIS_v2",Le=new a.FA("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Re(e){return e instanceof a.g&&e.code.includes("request-failed")}function Oe({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function Me(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function Fe(e,t){const n=(await t.json()).error;return Le.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Be({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function Ue(e){const t=await e();return t.status>=500&&t.status<600?e():t}function Ve(e){return new Promise((t=>{setTimeout(t,e)}))}const je=/^[cdef][\w-]{21}$/;function qe(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return je.test(t)?t:""}catch(e){return""}}function ze(e){return`${e.appName}!${e.appId}`}const Ge=new Map;function $e(e,t){const n=ze(e);Ke(n,t),function(e,t){const n=(!He&&"BroadcastChannel"in self&&(He=new BroadcastChannel("[Firebase] FID Change"),He.onmessage=e=>{Ke(e.data.key,e.data.fid)}),He);n&&n.postMessage({key:e,fid:t}),0===Ge.size&&He&&(He.close(),He=null)}(n,t)}function Ke(e,t){const n=Ge.get(e);if(n)for(const e of n)e(t)}let He=null;const We="firebase-installations-store";let Qe=null;function Xe(){return Qe||(Qe=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=Ee(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(Ee(o.result),e.oldVersion,e.newVersion,Ee(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),a}("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(We)}})),Qe}async function Je(e,t){const n=ze(e),r=(await Xe()).transaction(We,"readwrite"),i=r.objectStore(We),s=await i.get(n);return await i.put(t,n),await r.done,s&&s.fid===t.fid||$e(e,t.fid),t}async function Ye(e){const t=ze(e),n=(await Xe()).transaction(We,"readwrite");await n.objectStore(We).delete(t),await n.done}async function Ze(e,t){const n=ze(e),r=(await Xe()).transaction(We,"readwrite"),i=r.objectStore(We),s=await i.get(n),o=t(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,!o||s&&s.fid===o.fid||$e(e,o.fid),o}async function et(e){let t;const n=await Ze(e.appConfig,(n=>{const r=function(e){return rt(e||{fid:qe(),registrationStatus:0})}(n),i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(Le.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=Oe(e),i=Be(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={fid:n,authVersion:Pe,appId:e.appId,sdkVersion:Ne},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await Ue((()=>fetch(r,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:Me(e.authToken)}}throw await Fe("Create Installation",c)}(e,t);return Je(e.appConfig,n)}catch(n){throw Re(n)&&409===n.customData.serverCode?await Ye(e.appConfig):await Je(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:tt(e)}:{installationEntry:t}}(e,r);return t=i.registrationPromise,i.installationEntry}));return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function tt(e){let t=await nt(e.appConfig);for(;1===t.registrationStatus;)await Ve(100),t=await nt(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await et(e);return n||t}return t}function nt(e){return Ze(e,(e=>{if(!e)throw Le.create("installation-not-found");return rt(e)}))}function rt(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function it({appConfig:e,heartbeatServiceProvider:t},n){const r=function(e,{fid:t}){return`${Oe(e)}/${t}/authTokens:generate`}(e,n),i=function(e,{refreshToken:t}){const n=Be(e);return n.append("Authorization",function(e){return`${Pe} ${e}`}(t)),n}(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={installation:{sdkVersion:Ne,appId:e.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await Ue((()=>fetch(r,a)));if(c.ok)return Me(await c.json());throw await Fe("Generate Auth Token",c)}async function st(e,t=!1){let n;const r=await Ze(e.appConfig,(r=>{if(!at(r))throw Le.create("not-registered");const i=r.authToken;if(!t&&(2===(s=i).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(s)))return r;var s;if(1===i.requestStatus)return n=async function(e,t){let n=await ot(e.appConfig);for(;1===n.authToken.requestStatus;)await Ve(100),n=await ot(e.appConfig);const r=n.authToken;return 0===r.requestStatus?st(e,t):r}(e,t),r;{if(!navigator.onLine)throw Le.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(r);return n=async function(e,t){try{const n=await it(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await Je(e.appConfig,r),n}catch(n){if(!Re(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await Je(e.appConfig,n)}else await Ye(e.appConfig);throw n}}(e,t),t}}));return n?await n:r.authToken}function ot(e){return Ze(e,(e=>{if(!at(e))throw Le.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function at(e){return void 0!==e&&2===e.registrationStatus}function ct(e){return Le.create("missing-app-config-values",{valueName:e})}const ut="installations";(0,i.om)(new c.uA(ut,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw ct("App Configuration");if(!e.name)throw ct("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw ct(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:(0,i.j6)(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),(0,i.om)(new c.uA("installations-internal",(e=>{const t=e.getProvider("app").getImmediate(),n=(0,i.j6)(t,ut).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:r}=await et(t);return r?r.catch(console.error):st(t).catch(console.error),n.fid}(n),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await et(e);t&&await t}(n),(await st(n,t)).token}(n,e)}}),"PRIVATE")),(0,i.KO)(Ae,De),(0,i.KO)(Ae,De,"esm2017");const lt="analytics",ht="https://www.googletagmanager.com/gtag/js",dt=new de.Vy("@firebase/analytics"),ft=new a.FA("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function pt(e){if(!e.startsWith(ht)){const t=ft.create("invalid-gtag-resource",{gtagURL:e});return dt.warn(t.message),""}return e}function mt(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}const gt=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function yt(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function vt(e,t=gt,n){const{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw ft.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw ft.create("no-api-key")}const o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new bt;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),wt({appId:r,apiKey:i,measurementId:s},o,a,t)}async function wt(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=gt){var s;const{appId:o,measurementId:c}=e;try{await function(e,t){return new Promise(((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener((()=>{clearTimeout(s),r(ft.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(r,t)}catch(e){if(c)return dt.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:c};throw e}try{const t=await async function(e){var t;const{appId:n,apiKey:r}=e,i={method:"GET",headers:yt(r)},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(s,i);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw ft.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return i.deleteThrottleMetadata(o),t}catch(t){const u=t;if(!function(e){if(!(e instanceof a.g&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(u)){if(i.deleteThrottleMetadata(o),c)return dt.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null==u?void 0:u.message}]`),{appId:o,measurementId:c};throw t}const l=503===Number(null===(s=null==u?void 0:u.customData)||void 0===s?void 0:s.httpStatus)?(0,a.p9)(n,i.intervalMillis,30):(0,a.p9)(n,i.intervalMillis),h={throttleEndTimeMillis:Date.now()+l,backoffCount:n+1};return i.setThrottleMetadata(o,h),dt.debug(`Calling attemptFetch again in ${l} millis`),wt(e,h,r,i)}}class bt{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let It,Et;async function Tt(e,t,n,r,i,s,o){var c;const u=vt(e);u.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&dt.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>dt.error(e))),t.push(u);const l=async function(){if(!(0,a.zW)())return dt.warn(ft.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await(0,a.eX)()}catch(e){return dt.warn(ft.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?r.getId():void 0)),[h,d]=await Promise.all([u,l]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(ht)&&n.src.includes(e))return n;return null})(s)||function(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",t)),n}(0,{createScriptURL:pt}),r=document.createElement("script"),i=`${ht}?l=${e}&id=${t}`;r.src=n?null==n?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}(s,h.measurementId),Et&&(i("consent","default",Et),Et=void 0),i("js",new Date);const f=null!==(c=null==o?void 0:o.config)&&void 0!==c?c:{};return f.origin="firebase",f.update=!0,null!=d&&(f.firebase_id=d),i("config",h.measurementId,f),It&&(i("set",It),It=void 0),h.measurementId}class _t{constructor(e){this.app=e}_delete(){return delete Ct[this.app.options.appId],Promise.resolve()}}let Ct={},xt=[];const St={};let kt,At,Dt="dataLayer",Nt=!1;function Pt(e,t,n){!function(){const e=[];if((0,a.sr)()&&e.push("This is a browser extension environment."),(0,a.dM)()||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=ft.create("invalid-analytics-context",{errorInfo:t});dt.warn(n.message)}}();const r=e.options.appId;if(!r)throw ft.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw ft.create("no-api-key");dt.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Ct[r])throw ft.create("already-exists",{id:r});if(!Nt){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(Dt);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,i){let s=function(...e){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=function(e,t,n,r){return async function(i,...s){try{if("event"===i){const[r,i]=s;await async function(e,t,n,r,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const r=await mt(n);for(const n of e){const e=r.find((e=>e.measurementId===n)),i=e&&t[e.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",r,i||{})}catch(e){dt.error(e)}}(e,t,n,r,i)}else if("config"===i){const[i,o]=s;await async function(e,t,n,r,i,s){const o=r[i];try{if(o)await t[o];else{const e=(await mt(n)).find((e=>e.measurementId===i));e&&await t[e.appId]}}catch(e){dt.error(e)}e("config",i,s)}(e,t,n,r,i,o)}else if("consent"===i){const[t]=s;e("consent","update",t)}else if("get"===i){const[t,n,r]=s;e("get",t,n,r)}else if("set"===i){const[t]=s;e("set",t)}else e(i,...s)}catch(e){dt.error(e)}}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(Ct,xt,St,Dt,"gtag");At=e,kt=t,Nt=!0}return Ct[r]=Tt(e,xt,St,t,kt,Dt,n),new _t(e)}const Lt="@firebase/analytics",Rt="0.10.0";(0,i.om)(new c.uA(lt,((e,{options:t})=>Pt(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),(0,i.om)(new c.uA("analytics-internal",(function(e){try{const t=e.getProvider(lt).getImmediate();return{logEvent:(e,n,r)=>function(e,t,n,r){e=(0,a.Ku)(e),async function(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=await t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}}(At,Ct[e.app.options.appId],t,n,r).catch((e=>dt.error(e)))}(t,e,n,r)}}catch(e){throw ft.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),(0,i.KO)(Lt,Rt),(0,i.KO)(Lt,Rt,"esm2017");var Ot=(0,i.Wp)({apiKey:"AIzaSyAzd4ZozdCWCy6bQK255uyVFdOrbsHoxfQ",authDomain:"fastnetlite.firebaseapp.com",projectId:"fastnetlite",storageBucket:"fastnetlite.firebasestorage.app",messagingSenderId:"539673548783",appId:"1:539673548783:web:a9f7da3299069f0abf081a",measurementId:"G-GSR54JNW8J"}),Mt=(0,s.aU)(Ot),Ft=(0,o.xI)(Ot),Bt=function(e=(0,i.Sx)(),t){e=(0,a.Ku)(e);const n=(0,i.j6)(e,ce).getImmediate({identifier:t}),r=(0,a.yU)("storage");return r&&function(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:i}=r;i&&(e._overrideAuthToken="string"==typeof i?i:(0,a.Fy)(i,e.app.options.projectId))}(e,t,n,r)}(n,...r),n}(Ot);!function(e=(0,i.Sx)()){e=(0,a.Ku)(e);const t=(0,i.j6)(e,lt);t.isInitialized()?t.getImmediate():function(e,t={}){const n=(0,i.j6)(e,lt);if(n.isInitialized()){const e=n.getImmediate();if((0,a.bD)(t,n.getOptions()))return e;throw ft.create("already-initialized")}n.initialize({options:t})}(e)}(Ot),(0,s.ol)(Mt).catch((function(e){"failed-precondition"===e.code?console.warn("La persistance des données ne peut pas être activée car plusieurs onglets sont ouverts"):"unimplemented"===e.code&&console.warn("Le navigateur ne prend pas en charge la persistance des données hors ligne")})),window.firebase={auth:function(){return{signInWithEmailAndPassword:function(e,t){return(0,o.x9)(Ft,e,t)},createUserWithEmailAndPassword:function(e,t){return(0,o.eJ)(Ft,e,t)},signOut:function(){return console.log("Déconnexion en cours..."),(0,o.CI)(Ft).then((function(){console.log("Déconnexion réussie"),window.location.href="index.html"})).catch((function(e){throw console.error("Erreur lors de la déconnexion:",e),e}))},onAuthStateChanged:function(e){return(0,o.hg)(Ft,(function(t){console.log("Changement d'état d'authentification:",t?t.email:"aucun utilisateur"),t&&(Ft.currentUser=t),e(t)}))},sendPasswordResetEmail:function(e){return(0,o.J1)(Ft,e)},get currentUser(){return Ft.currentUser}}},firestore:function(){return firebase.firestore.FieldValue||(firebase.firestore.FieldValue={serverTimestamp:function(){return(0,s.O5)()},delete:function(){return(0,s.CL)()}}),{collection:function(e){var t=(0,s.rJ)(Mt,e);return(0,r.A)((0,r.A)({doc:function(t){var n=(0,s.H9)(Mt,e,t);return{get:function(){return(0,s.x7)(n)},set:function(e){return(0,s.BN)(n,e)},update:function(e){return(0,s.BN)(n,e,{merge:!0})},delete:function(){return(0,s.kd)(n)},id:n.id,path:n.path,onSnapshot:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return onSnapshot(n,(function(t){e({exists:t.exists(),id:t.id,data:function(){return t.data()},ref:t.ref})}))}))}},add:function(e){return(0,s.gS)(t,e)},get:function(){return(0,s.GG)(t)},where:function(e,n,i){var o=(0,s.P)(t,(0,s._M)(e,n,i));return(0,r.A)((0,r.A)({get:function(){return(0,s.GG)(o)},onSnapshot:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return onSnapshot(o,(function(t){e({docs:t.docs.map((function(e){return{id:e.id,data:function(){return e.data()},ref:e.ref,exists:e.exists()}})),empty:t.empty,size:t.size})}))})),orderBy:function(e,t){var n=(0,s.P)(o,(0,s.My)(e,t||"asc"));return{get:function(){return(0,s.GG)(n)},limit:function(e){var t=(0,s.P)(n,(0,s.AB)(e));return{get:function(){return(0,s.GG)(t)},limit:function(e){var n=(0,s.P)(t,(0,s.AB)(e));return{get:function(){return(0,s.GG)(n)}}}}}}}},"orderBy",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=(0,s.P)(o,(0,s.My)(e,t));return{get:function(){return(0,s.GG)(n)},limit:function(e){var t=(0,s.P)(n,(0,s.AB)(e));return{get:function(){return(0,s.GG)(t)}}}}})),"limit",(function(e){var t=(0,s.P)(o,(0,s.AB)(e));return{get:function(){return(0,s.GG)(t)}}}))},orderBy:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",r=(0,s.P)(t,(0,s.My)(e,n));return{get:function(){return(0,s.GG)(r)},limit:function(e){var t=(0,s.P)(r,(0,s.AB)(e));return{get:function(){return(0,s.GG)(t)}}}}},limit:function(e){var n=(0,s.P)(t,(0,s.AB)(e));return{get:function(){return(0,s.GG)(n)}}}},"add",(function(e){return(0,s.gS)(t,e).then((function(e){return{id:e.id,path:e.path,get:function(){return(0,s.x7)(e)},set:function(t){return(0,s.BN)(e,t)},update:function(t){return(0,s.BN)(e,t,{merge:!0})},delete:function(){return(0,s.kd)(e)}}})).catch((function(e){throw console.error("Erreur lors de l'ajout du document:",e),e}))})),"get",(function(){return(0,s.GG)(t)}))},doc:function(e){var t=e.split("/"),n=t.slice(0,t.length-1).join("/"),r=t[t.length-1],i=(0,s.H9)(Mt,n,r);return{get:function(){return(0,s.x7)(i)},set:function(e){return(0,s.BN)(i,e)},update:function(e){return(0,s.BN)(i,e,{merge:!0})},delete:function(){return(0,s.kd)(i)},id:i.id,path:i.path}},FieldValue:{serverTimestamp:function(){return(0,s.O5)()},delete:function(){return(0,s.CL)()}},Timestamp:{fromDate:function(e){var t=new Date(e).getTime();return{seconds:Math.floor(t/1e3),nanoseconds:0}},now:function(){return(0,s.O5)()}}}},storage:function(){return{ref:function(e){var t=he(Bt,e);return{put:function(e){return ue(t,e)},getDownloadURL:function(){return le(t)},delete:function(){return e=t,function(e){e._throwIfRoot("deleteObject");const t=function(e,t){const n=x(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,i=new H(n,"DELETE",(function(e,t){}),r);return i.successCodes=[200,204],i.errorHandler=X(t),i}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,ee)}(e=(0,a.Ku)(e));var e}}}}}},window.db=Mt,window.auth=Ft,window.storage=Bt,window.firestore={collection:s.rJ,doc:s.H9,setDoc:s.BN,getDoc:s.x7,getDocs:s.GG,query:s.P,where:s._M,orderBy:s.My,limit:s.AB,startAfter:s.HM,serverTimestamp:s.O5},Ft.currentUser?console.log("Utilisateur déjà connecté:",Ft.currentUser.email):console.log("Aucun utilisateur connecté"),(0,o.hg)(Ft,(function(e){e?console.log("Utilisateur connecté:",e.email):console.log("Utilisateur déconnecté")})),window.firebase.firestore=Object.assign({},{collection:function(e){return(0,s.rJ)(Mt,e)},doc:function(e){return(0,s.H9)(Mt,e)},setDoc:function(e,t){return(0,s.BN)(e,t)},getDoc:function(e){return(0,s.x7)(e)},getDocs:function(e){return(0,s.GG)(e)},query:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s.P.apply(void 0,[e].concat(n))},where:function(e,t,n){return(0,s._M)(e,t,n)},orderBy:function(e,t){return(0,s.My)(e,t)},limit:function(e){return(0,s.AB)(e)},startAfter:function(e){return(0,s.HM)(e)},serverTimestamp:function(){return(0,s.O5)()},FieldValue:{serverTimestamp:function(){return(0,s.O5)()},delete:function(){return(0,s.CL)()}}}),window.storageRef=he,window.uploadBytes=ue,window.getDownloadURL=le,window.signInWithEmailAndPassword=o.x9,window.createUserWithEmailAndPassword=o.eJ,window.signOut=o.CI,window.onAuthStateChanged=o.hg,window.sendPasswordResetEmail=o.J1,window.checkAuth=function(){return new Promise((function(e){var t=(0,o.hg)(Ft,(function(n){t(),e(n)}))}))},console.log("Configuration Firebase chargée avec SDK moderne"),window.indexJsInitialized=window.indexJsInitialized||!1,document.addEventListener("DOMContentLoaded",(function(){window.indexJsInitialized?console.log("src/index.js déjà initialisé, initialisation ignorée"):(window.indexJsInitialized=!0,console.log("FastNetLite initialisé avec SDK Firebase moderne"))}))},125:(e,t,n)=>{"use strict";n.d(t,{h1:()=>a,uA:()=>i});var r=n(743);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const s="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=s){return this.instances.has(e)}getOptions(e=s){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===s?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=s){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},284:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,{A:()=>r})},327:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(284);function i(e,t){if("object"!=(0,r.A)(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(0,r.A)(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}},405:(e,t,n)=>{"use strict";n.d(t,{AB:()=>r.AB,BN:()=>r.BN,CL:()=>r.CL,GG:()=>r.GG,H9:()=>r.H9,HM:()=>r.HM,My:()=>r.My,O5:()=>r.O5,P:()=>r.P,_M:()=>r._M,aU:()=>r.aU,c4:()=>r.c4,gS:()=>r.gS,kd:()=>r.kd,mZ:()=>r.mZ,ol:()=>r.ol,rJ:()=>r.rJ,wP:()=>r.wP,x7:()=>r.x7});var r=n(790)},424:(e,t,n)=>{"use strict";n.d(t,{$b:()=>i,Vy:()=>u});const r=[];var i;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));const s={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},o=i.INFO,a={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},c=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=a[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class u{constructor(e){this.name=e,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...e),this._logHandler(this,i.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...e),this._logHandler(this,i.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,i.INFO,...e),this._logHandler(this,i.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,i.WARN,...e),this._logHandler(this,i.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,i.ERROR,...e),this._logHandler(this,i.ERROR,...e)}}},440:(e,t,n)=>{"use strict";n.d(t,{CI:()=>r.B,J1:()=>r.a3,eJ:()=>r.a8,hg:()=>r.x,x9:()=>r.a9,xI:()=>r.o});var r=n(509);n(743),n(461),n(424),n(125)},461:(e,t,n)=>{"use strict";n.d(t,{KO:()=>H,MF:()=>G,Sx:()=>K,Wp:()=>$,j6:()=>j,om:()=>V});var r=n(125),i=n(424),s=n(743),o=n(602);class a{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const c="@firebase/app",u="0.9.13",l=new i.Vy("@firebase/app"),h="@firebase/app-compat",d="@firebase/analytics-compat",f="@firebase/analytics",p="@firebase/app-check-compat",m="@firebase/app-check",g="@firebase/auth",y="@firebase/auth-compat",v="@firebase/database",w="@firebase/database-compat",b="@firebase/functions",I="@firebase/functions-compat",E="@firebase/installations",T="@firebase/installations-compat",_="@firebase/messaging",C="@firebase/messaging-compat",x="@firebase/performance",S="@firebase/performance-compat",k="@firebase/remote-config",A="@firebase/remote-config-compat",D="@firebase/storage",N="@firebase/storage-compat",P="@firebase/firestore",L="@firebase/firestore-compat",R="firebase",O="[DEFAULT]",M={[c]:"fire-core",[h]:"fire-core-compat",[f]:"fire-analytics",[d]:"fire-analytics-compat",[m]:"fire-app-check",[p]:"fire-app-check-compat",[g]:"fire-auth",[y]:"fire-auth-compat",[v]:"fire-rtdb",[w]:"fire-rtdb-compat",[b]:"fire-fn",[I]:"fire-fn-compat",[E]:"fire-iid",[T]:"fire-iid-compat",[_]:"fire-fcm",[C]:"fire-fcm-compat",[x]:"fire-perf",[S]:"fire-perf-compat",[k]:"fire-rc",[A]:"fire-rc-compat",[D]:"fire-gcs",[N]:"fire-gcs-compat",[P]:"fire-fst",[L]:"fire-fst-compat","fire-js":"fire-js",[R]:"fire-js-all"},F=new Map,B=new Map;function U(e,t){try{e.container.addComponent(t)}catch(n){l.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function V(e){const t=e.name;if(B.has(t))return l.debug(`There were multiple attempts to register component ${t}.`),!1;B.set(t,e);for(const t of F.values())U(t,e);return!0}function j(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const q=new s.FA("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class z{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.uA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw q.create("app-deleted",{appName:this._name})}}const G="9.23.0";function $(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const i=Object.assign({name:O,automaticDataCollectionEnabled:!1},t),o=i.name;if("string"!=typeof o||!o)throw q.create("bad-app-name",{appName:String(o)});if(n||(n=(0,s.T9)()),!n)throw q.create("no-options");const a=F.get(o);if(a){if((0,s.bD)(n,a.options)&&(0,s.bD)(i,a.config))return a;throw q.create("duplicate-app",{appName:o})}const c=new r.h1(o);for(const e of B.values())c.addComponent(e);const u=new z(n,i,c);return F.set(o,u),u}function K(e=O){const t=F.get(e);if(!t&&e===O&&(0,s.T9)())return $();if(!t)throw q.create("no-app",{appName:e});return t}function H(e,t,n){var i;let s=null!==(i=M[e])&&void 0!==i?i:e;n&&(s+=`-${n}`);const o=s.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=[`Unable to register library "${s}" with version "${t}":`];return o&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void l.warn(e.join(" "))}V(new r.uA(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}const W="firebase-heartbeat-store";let Q=null;function X(){return Q||(Q=(0,o.P2)("firebase-heartbeat-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(W)}}).catch((e=>{throw q.create("idb-open",{originalErrorMessage:e.message})}))),Q}async function J(e,t){try{const n=(await X()).transaction(W,"readwrite"),r=n.objectStore(W);await r.put(t,Y(e)),await n.done}catch(e){if(e instanceof s.g)l.warn(e.message);else{const t=q.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});l.warn(t.message)}}}function Y(e){return`${e.name}!${e.options.appId}`}class Z{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new te(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=ee();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=ee(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),ne(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),ne(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=(0,s.Uj)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function ee(){return(new Date).toISOString().substring(0,10)}class te{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,s.zW)()&&(0,s.eX)().then((()=>!0)).catch((()=>!1))}async read(){return await this._canUseIndexedDBPromise&&await async function(e){try{const t=await X();return await t.transaction(W).objectStore(W).get(Y(e))}catch(e){if(e instanceof s.g)l.warn(e.message);else{const t=q.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});l.warn(t.message)}}}(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return J(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return J(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function ne(e){return(0,s.Uj)(JSON.stringify({version:2,heartbeats:e})).length}V(new r.uA("platform-logger",(e=>new a(e)),"PRIVATE")),V(new r.uA("heartbeat",(e=>new Z(e)),"PRIVATE")),H(c,u,""),H(c,u,"esm2017"),H("fire-js","")},467:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(922);function i(e,t,n){return(t=(0,r.A)(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},500:(e,t,n)=>{"use strict";n.d(t,{r:()=>d,w:()=>p});const r=(e,t)=>t.some((t=>e instanceof t));let i,s;const o=new WeakMap,a=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap;let h={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return a.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function d(e){h=e(h)}function f(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(s||(s=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(m(this),e),p(o.get(this))}:function(...e){return p(t.apply(m(this),e))}:function(e,...n){const r=t.call(m(this),e,...n);return c.set(r,e.sort?e.sort():[e]),p(r)}:(e instanceof IDBTransaction&&function(e){if(a.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));a.set(e,t)}(e),r(e,i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,h):e);var t}function p(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(p(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&o.set(t,e)})).catch((()=>{})),l.set(t,e),t}(e);if(u.has(e))return u.get(e);const t=f(e);return t!==e&&(u.set(e,t),l.set(t,e)),t}const m=e=>l.get(e)},509:(e,t,n)=>{"use strict";n.d(t,{B:()=>$e,a3:()=>je,a8:()=>qe,a9:()=>ze,o:()=>Jt,x:()=>Ge});var r=n(743),i=n(461),s=n(635),o=n(424),a=n(125);const c=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},u=new r.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),l=new o.Vy("@firebase/auth");function h(e,...t){l.logLevel<=o.$b.ERROR&&l.error(`Auth (${i.MF}): ${e}`,...t)}function d(e,...t){throw p(e,...t)}function f(e,...t){return p(e,...t)}function p(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return u.create(e,...t)}function m(e,t,...n){if(!e)throw p(t,...n)}function g(e){const t="INTERNAL ASSERTION FAILED: "+e;throw h(t),new Error(t)}function y(e,t){e||g(t)}function v(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function w(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class b{constructor(e,t){this.shortDelay=e,this.longDelay=t,y(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,r.jZ)()||(0,r.lV)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===w()||"https:"===w()||(0,r.sr)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function I(e,t){y(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class E{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void g("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void g("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void g("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const T={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},_=new b(3e4,6e4);function C(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function x(e,t,n,i,s={}){return S(e,s,(async()=>{let s={},o={};i&&("GET"===t?o=i:s={body:JSON.stringify(i)});const a=(0,r.Am)(Object.assign({key:e.config.apiKey},o)).slice(1),c=await e._getAdditionalHeaders();return c["Content-Type"]="application/json",e.languageCode&&(c["X-Firebase-Locale"]=e.languageCode),E.fetch()(A(e,e.config.apiHost,n,a),Object.assign({method:t,headers:c,referrerPolicy:"no-referrer"},s))}))}async function S(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},T),t);try{const t=new D(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw N(e,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const t=s.ok?o.errorMessage:o.error.message,[n,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw N(e,"credential-already-in-use",o);if("EMAIL_EXISTS"===n)throw N(e,"email-already-in-use",o);if("USER_DISABLED"===n)throw N(e,"user-disabled",o);const u=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw function(e,t,n){const i=Object.assign(Object.assign({},c()),{[t]:n});return new r.FA("auth","Firebase",i).create(t,{appName:e.name})}(e,u,a);d(e,u)}}catch(t){if(t instanceof r.g)throw t;d(e,"network-request-failed",{message:String(t)})}}async function k(e,t,n,r,i={}){const s=await x(e,t,n,r,i);return"mfaPendingCredential"in s&&d(e,"multi-factor-auth-required",{_serverResponse:s}),s}function A(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?I(e.config,i):`${e.config.apiScheme}://${i}`}class D{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(f(this.auth,"network-request-failed"))),_.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function N(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=f(e,t,r);return i.customData._tokenResponse=n,i}function P(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function L(e){return 1e3*Number(e)}function R(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return h("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,r.u)(n);return e?JSON.parse(e):(h("Failed to decode base64 JWT payload"),null)}catch(e){return h("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function O(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof r.g&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class M{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class F{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=P(this.lastLoginAt),this.creationTime=P(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function B(e){var t;const n=e.auth,r=await e.getIdToken(),i=await O(e,async function(e,t){return x(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));m(null==i?void 0:i.users.length,n,"internal-error");const o=i.users[0];e._notifyReloadListener(o);const a=(null===(t=o.providerUserInfo)||void 0===t?void 0:t.length)?o.providerUserInfo.map((e=>{var{providerId:t}=e,n=(0,s.Tt)(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],c=(u=e.providerData,l=a,[...u.filter((e=>!l.some((t=>t.providerId===e.providerId)))),...l]);var u,l;const h=e.isAnonymous,d=!(e.email&&o.passwordHash||(null==c?void 0:c.length)),f=!!h&&d,p={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:c,metadata:new F(o.createdAt,o.lastLoginAt),isAnonymous:f};Object.assign(e,p)}class U{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){m(e.idToken,"internal-error"),m(void 0!==e.idToken,"internal-error"),m(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=R(e);return m(t,"internal-error"),m(void 0!==t.exp,"internal-error"),m(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return m(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:s}=await async function(e,t){const n=await S(e,{},(async()=>{const n=(0,r.Am)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:s}=e.config,o=A(e,i,"/v1/token",`key=${s}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",E.fetch()(o,{method:"POST",headers:a,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new U;return n&&(m("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(m("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(m("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new U,this.toJSON())}_performRefresh(){return g("not implemented")}}function V(e,t){m("string"==typeof e||void 0===e,"internal-error",{appName:t})}class j{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=(0,s.Tt)(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new M(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new F(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await O(this,this.stsTokenManager.getToken(this.auth,e));return m(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=(0,r.Ku)(e),i=await n.getIdToken(t),s=R(i);m(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o="object"==typeof s.firebase?s.firebase:void 0,a=null==o?void 0:o.sign_in_provider;return{claims:s,token:i,authTime:P(L(s.auth_time)),issuedAtTime:P(L(s.iat)),expirationTime:P(L(s.exp)),signInProvider:a||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,r.Ku)(e);await B(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(m(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new j(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){m(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await B(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await O(this,async function(e,t){return x(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,y=null!==(c=t.createdAt)&&void 0!==c?c:void 0,v=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:w,emailVerified:b,isAnonymous:I,providerData:E,stsTokenManager:T}=t;m(w&&T,e,"internal-error");const _=U.fromJSON(this.name,T);m("string"==typeof w,e,"internal-error"),V(l,e.name),V(h,e.name),m("boolean"==typeof b,e,"internal-error"),m("boolean"==typeof I,e,"internal-error"),V(d,e.name),V(f,e.name),V(p,e.name),V(g,e.name),V(y,e.name),V(v,e.name);const C=new j({uid:w,auth:e,email:h,emailVerified:b,displayName:l,isAnonymous:I,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:_,createdAt:y,lastLoginAt:v});return E&&Array.isArray(E)&&(C.providerData=E.map((e=>Object.assign({},e)))),g&&(C._redirectEventId=g),C}static async _fromIdTokenResponse(e,t,n=!1){const r=new U;r.updateFromServerResponse(t);const i=new j({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await B(i),i}}const q=new Map;function z(e){y(e instanceof Function,"Expected a class definition");let t=q.get(e);return t?(y(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,q.set(e,t),t)}class G{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}G.type="NONE";const $=G;function K(e,t,n){return`firebase:${e}:${t}:${n}`}class H{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=K(this.userKey,r.apiKey,i),this.fullPersistenceKey=K("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?j._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new H(z($),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||z($);const s=K(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=j._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new H(i,e,n)):new H(i,e,n)}}function W(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Y(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Q(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ee(t))return"Blackberry";if(te(t))return"Webos";if(X(t))return"Safari";if((t.includes("chrome/")||J(t))&&!t.includes("edge/"))return"Chrome";if(Z(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Q(e=(0,r.ZQ)()){return/firefox\//i.test(e)}function X(e=(0,r.ZQ)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function J(e=(0,r.ZQ)()){return/crios\//i.test(e)}function Y(e=(0,r.ZQ)()){return/iemobile/i.test(e)}function Z(e=(0,r.ZQ)()){return/android/i.test(e)}function ee(e=(0,r.ZQ)()){return/blackberry/i.test(e)}function te(e=(0,r.ZQ)()){return/webos/i.test(e)}function ne(e=(0,r.ZQ)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function re(e=(0,r.ZQ)()){return ne(e)||Z(e)||te(e)||ee(e)||/windows phone/i.test(e)||Y(e)}function ie(e,t=[]){let n;switch(e){case"Browser":n=W((0,r.ZQ)());break;case"Worker":n=`${W((0,r.ZQ)())}-${e}`;break;default:n=e}const s=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${i.MF}/${s}`}async function se(e,t){return x(e,"GET","/v2/recaptchaConfig",C(e,t))}function oe(e){return void 0!==e&&void 0!==e.enterprise}class ae{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some((e=>"EMAIL_PASSWORD_PROVIDER"===e.provider&&"OFF"!==e.enforcementState))}}function ce(e){return new Promise(((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=f("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)}))}function ue(e){return`__${e}${Math.floor(1e6*Math.random())}`}class le{constructor(e){this.type="recaptcha-enterprise",this.auth=pe(e)}async verify(e="verify",t=!1){function n(t,n,r){const i=window.grecaptcha;oe(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{se(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new ae(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&oe(window.grecaptcha))n(i,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));ce("https://www.google.com/recaptcha/enterprise.js?render="+i).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function he(e,t,n,r=!1){const i=new le(e);let s;try{s=await i.verify(n)}catch(e){s=await i.verify(n,!0)}const o=Object.assign({},t);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}class de{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class fe{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new me(this),this.idTokenSubscription=new me(this),this.beforeStateQueue=new de(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=u,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=z(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await H.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return m(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await B(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?(0,r.Ku)(e):null;return t&&m(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&m(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(z(e))}))}async initializeRecaptchaConfig(){const e=await se(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),t=new ae(e);null==this.tenantId?this._agentRecaptchaConfig=t:this._tenantRecaptchaConfigs[this.tenantId]=t,t.emailPasswordEnabled&&new le(this).verify()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new r.FA("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&z(e)||this._popupRedirectResolver;m(t,this,"argument-error"),this.redirectPersistenceManager=await H.create(this,[z(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return m(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return m(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ie(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){l.logLevel<=o.$b.WARN&&l.warn(`Auth (${i.MF}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function pe(e){return(0,r.Ku)(e)}class me{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,r.tD)((e=>this.observer=e))}get next(){return m(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function ge(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function ye(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class ve{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return g("not implemented")}_getIdTokenResponse(e){return g("not implemented")}_linkToIdToken(e,t){return g("not implemented")}_getReauthenticationResolver(e){return g("not implemented")}}async function we(e,t){return k(e,"POST","/v1/accounts:signInWithPassword",C(e,t))}async function be(e,t){return async function(e,t){return x(e,"POST","/v1/accounts:sendOobCode",C(e,t))}(e,t)}class Ie extends ve{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Ie(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Ie(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){var t;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null===(t=e._getRecaptchaConfig())||void 0===t?void 0:t.emailPasswordEnabled){const t=await he(e,n,"signInWithPassword");return we(e,t)}return we(e,n).catch((async t=>{if("auth/missing-recaptcha-token"===t.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const t=await he(e,n,"signInWithPassword");return we(e,t)}return Promise.reject(t)}));case"emailLink":return async function(e,t){return k(e,"POST","/v1/accounts:signInWithEmailLink",C(e,t))}(e,{email:this._email,oobCode:this._password});default:d(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return async function(e,t){return x(e,"POST","/v1/accounts:update",t)}(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return k(e,"POST","/v1/accounts:signInWithEmailLink",C(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:d(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Ee(e,t){return k(e,"POST","/v1/accounts:signInWithIdp",C(e,t))}class Te extends ve{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Te(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):d("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=(0,s.Tt)(t,["providerId","signInMethod"]);if(!n||!r)return null;const o=new Te(n,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){return Ee(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ee(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ee(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,r.Am)(t)}return e}}const _e={USER_NOT_FOUND:"user-not-found"};class Ce extends ve{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Ce({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Ce({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return k(e,"POST","/v1/accounts:signInWithPhoneNumber",C(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await k(e,"POST","/v1/accounts:signInWithPhoneNumber",C(e,t));if(n.temporaryProof)throw N(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return k(e,"POST","/v1/accounts:signInWithPhoneNumber",C(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),_e)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new Ce({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class xe{constructor(e){var t,n,i,s,o,a;const c=(0,r.I9)((0,r.hp)(e)),u=null!==(t=c.apiKey)&&void 0!==t?t:null,l=null!==(n=c.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=c.mode)&&void 0!==i?i:null);m(u&&l&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=l,this.continueUrl=null!==(s=c.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(o=c.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=c.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=(0,r.I9)((0,r.hp)(e)).link,n=t?(0,r.I9)((0,r.hp)(t)).deep_link_id:null,i=(0,r.I9)((0,r.hp)(e)).deep_link_id;return(i?(0,r.I9)((0,r.hp)(i)).link:null)||i||n||t||e}(e);try{return new xe(t)}catch(e){return null}}}class Se{constructor(){this.providerId=Se.PROVIDER_ID}static credential(e,t){return Ie._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=xe.parseLink(t);return m(n,"argument-error"),Ie._fromEmailAndCode(e,n.code,n.tenantId)}}Se.PROVIDER_ID="password",Se.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Se.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ke{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Ae extends ke{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class De extends Ae{constructor(){super("facebook.com")}static credential(e){return Te._fromParams({providerId:De.PROVIDER_ID,signInMethod:De.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return De.credentialFromTaggedObject(e)}static credentialFromError(e){return De.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return De.credential(e.oauthAccessToken)}catch(e){return null}}}De.FACEBOOK_SIGN_IN_METHOD="facebook.com",De.PROVIDER_ID="facebook.com";class Ne extends Ae{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Te._fromParams({providerId:Ne.PROVIDER_ID,signInMethod:Ne.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ne.credentialFromTaggedObject(e)}static credentialFromError(e){return Ne.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Ne.credential(t,n)}catch(e){return null}}}Ne.GOOGLE_SIGN_IN_METHOD="google.com",Ne.PROVIDER_ID="google.com";class Pe extends Ae{constructor(){super("github.com")}static credential(e){return Te._fromParams({providerId:Pe.PROVIDER_ID,signInMethod:Pe.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Pe.credentialFromTaggedObject(e)}static credentialFromError(e){return Pe.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Pe.credential(e.oauthAccessToken)}catch(e){return null}}}Pe.GITHUB_SIGN_IN_METHOD="github.com",Pe.PROVIDER_ID="github.com";class Le extends Ae{constructor(){super("twitter.com")}static credential(e,t){return Te._fromParams({providerId:Le.PROVIDER_ID,signInMethod:Le.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Le.credentialFromTaggedObject(e)}static credentialFromError(e){return Le.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Le.credential(t,n)}catch(e){return null}}}async function Re(e,t){return k(e,"POST","/v1/accounts:signUp",C(e,t))}Le.TWITTER_SIGN_IN_METHOD="twitter.com",Le.PROVIDER_ID="twitter.com";class Oe{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await j._fromIdTokenResponse(e,n,r),s=Me(n);return new Oe({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Me(n);return new Oe({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Me(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Fe extends r.g{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Fe.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Fe(e,t,n,r)}}function Be(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Fe._fromErrorAndOperation(e,n,t,r);throw n}))}async function Ue(e,t,n=!1){const r="signIn",i=await Be(e,r,t),s=await Oe._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}function Ve(e,t,n){var r;m((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),m(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(m(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(m(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function je(e,t,n){var r;const i=pe(e),s={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};if(null===(r=i._getRecaptchaConfig())||void 0===r?void 0:r.emailPasswordEnabled){const e=await he(i,s,"getOobCode",!0);n&&Ve(i,e,n),await be(i,e)}else n&&Ve(i,s,n),await be(i,s).catch((async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);{console.log("Password resets are protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the password reset flow.");const e=await he(i,s,"getOobCode",!0);n&&Ve(i,e,n),await be(i,e)}}))}async function qe(e,t,n){var r;const i=pe(e),s={returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"};let o;if(null===(r=i._getRecaptchaConfig())||void 0===r?void 0:r.emailPasswordEnabled){const e=await he(i,s,"signUpPassword");o=Re(i,e)}else o=Re(i,s).catch((async e=>{if("auth/missing-recaptcha-token"===e.code){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const e=await he(i,s,"signUpPassword");return Re(i,e)}return Promise.reject(e)}));const a=await o.catch((e=>Promise.reject(e))),c=await Oe._fromIdTokenResponse(i,"signIn",a);return await i._updateCurrentUser(c.user),c}function ze(e,t,n){return async function(e,t){return Ue(pe(e),t)}((0,r.Ku)(e),Se.credential(t,n))}function Ge(e,t,n,i){return(0,r.Ku)(e).onAuthStateChanged(t,n,i)}function $e(e){return(0,r.Ku)(e).signOut()}new WeakMap;const Ke="__sak";class He{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ke,"1"),this.storage.removeItem(Ke),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class We extends He{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=(0,r.ZQ)();return X(e)||ne(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=re(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);(0,r.lT)()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}We.type="LOCAL";const Qe=We;class Xe extends He{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Xe.type="SESSION";const Je=Xe;class Ye{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Ye(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Ze(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Ye.receivers=[];class et{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=Ze("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function tt(){return window}function nt(){return void 0!==tt().WorkerGlobalScope&&"function"==typeof tt().importScripts}const rt="firebaseLocalStorageDb",it="firebaseLocalStorage",st="fbase_key";class ot{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function at(e,t){return e.transaction([it],t?"readwrite":"readonly").objectStore(it)}function ct(){const e=indexedDB.open(rt,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(it,{keyPath:st})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(it)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(rt);return new ot(e).toPromise()}(),t(await ct()))}))}))}async function ut(e,t,n){const r=at(e,!0).put({[st]:t,value:n});return new ot(r).toPromise()}function lt(e,t){const n=at(e,!0).delete(t);return new ot(n).toPromise()}class ht{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await ct()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return nt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ye._getInstance(nt()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new et(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ct();return await ut(e,Ke,"1"),await lt(e,Ke),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>ut(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=at(e,!1).get(t),r=await new ot(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>lt(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=at(e,!1).getAll();return new ot(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}ht.type="LOCAL";const dt=ht;ue("rcb"),new b(3e4,6e4);class ft{constructor(e){this.providerId=ft.PROVIDER_ID,this.auth=pe(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var r;const i=await n.verify();try{let s;if(m("string"==typeof i,e,"argument-error"),m("recaptcha"===n.type,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){m("enroll"===t.type,e,"internal-error");const n=await function(e,t){return x(e,"POST","/v2/accounts/mfaEnrollment:start",C(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{m("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;m(n,e,"missing-multi-factor-info");const o=await function(e,t){return x(e,"POST","/v2/accounts/mfaSignIn:start",C(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return x(e,"POST","/v1/accounts:sendVerificationCode",C(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}(this.auth,e,(0,r.Ku)(t))}static credential(e,t){return Ce._fromVerification(e,t)}static credentialFromResult(e){const t=e;return ft.credentialFromTaggedObject(t)}static credentialFromError(e){return ft.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Ce._fromTokenResponse(t,n):null}}ft.PROVIDER_ID="phone",ft.PHONE_SIGN_IN_METHOD="phone";class pt extends ve{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ee(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ee(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ee(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function mt(e){return Ue(e.auth,new pt(e),e.bypassAuthState)}function gt(e){const{auth:t,user:n}=e;return m(n,t,"internal-error"),async function(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await O(e,Be(r,i,t,e),n);m(s.idToken,r,"internal-error");const o=R(s.idToken);m(o,r,"internal-error");const{sub:a}=o;return m(e.uid===a,r,"user-mismatch"),Oe._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&d(r,"user-mismatch"),e}}(n,new pt(e),e.bypassAuthState)}async function yt(e){const{auth:t,user:n}=e;return m(n,t,"internal-error"),async function(e,t,n=!1){const r=await O(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Oe._forOperation(e,"link",r)}(n,new pt(e),e.bypassAuthState)}class vt{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return mt;case"linkViaPopup":case"linkViaRedirect":return yt;case"reauthViaPopup":case"reauthViaRedirect":return gt;default:d(this.auth,"internal-error")}}resolve(e){y(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){y(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const wt=new b(2e3,1e4);class bt extends vt{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,bt.currentPopupAction&&bt.currentPopupAction.cancel(),bt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return m(e,this.auth,"internal-error"),e}async onExecution(){y(1===this.filter.length,"Popup operations only handle one event");const e=Ze();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(f(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(f(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,bt.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(f(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,wt.get())};e()}}bt.currentPopupAction=null;const It=new Map;class Et extends vt{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=It.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return K("pendingRedirect",e.config.apiKey,e.name)}(t),r=function(e){return z(e._redirectPersistence)}(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}It.set(this.auth._key(),e)}return this.bypassAuthState||It.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Tt(e,t){It.set(e._key(),t)}async function _t(e,t,n=!1){const r=pe(e),i=function(e,t){return t?z(t):(m(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(r,t),s=new Et(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class Ct{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return St(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!St(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(f(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(xt(e))}saveEventToCache(e){this.cachedEventUids.add(xt(e)),this.lastProcessedEventTime=Date.now()}}function xt(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function St({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const kt=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,At=/^https?/;function Dt(e){const t=v(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!At.test(n))return!1;if(kt.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Nt=new b(3e4,6e4);function Pt(){const e=tt().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let Lt=null;function Rt(e){return Lt=Lt||function(e){return new Promise(((t,n)=>{var r,i,s;function o(){Pt(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Pt(),n(f(e,"network-request-failed"))},timeout:Nt.get()})}if(null===(i=null===(r=tt().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=tt().gapi)||void 0===s?void 0:s.load)){const t=ue("iframefcb");return tt()[t]=()=>{gapi.load?o():n(f(e,"network-request-failed"))},ce(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw Lt=null,e}))}(e),Lt}const Ot=new b(5e3,15e3),Mt={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ft=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Bt(e){const t=e.config;m(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?I(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,s={apiKey:t.apiKey,appName:e.name,v:i.MF},o=Ft.get(e.config.apiHost);o&&(s.eid=o);const a=e._getFrameworks();return a.length&&(s.fw=a.join(",")),`${n}?${(0,r.Am)(s).slice(1)}`}const Ut={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Vt{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const jt=encodeURIComponent("fac");async function qt(e,t,n,s,o,a){m(e.config.authDomain,e,"auth-domain-config-required"),m(e.config.apiKey,e,"invalid-api-key");const c={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:i.MF,eventId:o};if(t instanceof ke){t.setDefaultLanguage(e.languageCode),c.providerId=t.providerId||"",(0,r.Im)(t.getCustomParameters())||(c.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))c[e]=t}if(t instanceof Ae){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(c.scopes=e.join(","))}e.tenantId&&(c.tid=e.tenantId);const u=c;for(const e of Object.keys(u))void 0===u[e]&&delete u[e];const l=await e._getAppCheckToken(),h=l?`#${jt}=${encodeURIComponent(l)}`:"";return`${function({config:e}){return e.emulator?I(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${(0,r.Am)(u).slice(1)}${h}`}const zt="webStorageSupport",Gt=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Je,this._completeRedirectFn=_t,this._overrideRedirectResult=Tt}async _openPopup(e,t,n,i){var s;return y(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()"),function(e,t,n,i=500,s=600){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let c="";const u=Object.assign(Object.assign({},Ut),{width:i.toString(),height:s.toString(),top:o,left:a}),l=(0,r.ZQ)().toLowerCase();n&&(c=J(l)?"_blank":n),Q(l)&&(t=t||"http://localhost",u.scrollbars="yes");const h=Object.entries(u).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=(0,r.ZQ)()){var t;return ne(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",c),new Vt(null);const d=window.open(t||"",c,h);m(d,e,"popup-blocked");try{d.focus()}catch(e){}return new Vt(d)}(e,await qt(e,t,n,v(),i),Ze())}async _openRedirect(e,t,n,r){return await this._originValidation(e),i=await qt(e,t,n,v(),r),tt().location.href=i,new Promise((()=>{}));var i}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(y(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await Rt(e),n=tt().gapi;return m(n,e,"internal-error"),t.open({where:document.body,url:Bt(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Mt,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=f(e,"network-request-failed"),s=tt().setTimeout((()=>{r(i)}),Ot.get());function o(){tt().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new Ct(e);return t.register("authEvent",(t=>(m(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(zt,{type:zt},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[zt];void 0!==i&&t(!!i),d(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return x(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(Dt(e))return}catch(e){}d(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return re()||X()||ne()}};var $t="@firebase/auth",Kt="0.23.2";class Ht{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){m(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Wt=(0,r.XA)("authIdTokenMaxAge")||300;let Qt=null;const Xt=e=>async t=>{const n=t&&await t.getIdTokenResult(),r=n&&((new Date).getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>Wt)return;const i=null==n?void 0:n.token;Qt!==i&&(Qt=i,await fetch(e,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function Jt(e=(0,i.Sx)()){const t=(0,i.j6)(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=(0,i.j6)(e,"auth");if(n.isInitialized()){const e=n.getImmediate(),i=n.getOptions();if((0,r.bD)(i,null!=t?t:{}))return e;d(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Gt,persistence:[dt,Qe,Je]}),s=(0,r.XA)("authTokenSyncURL");if(s){const e=Xt(s);!function(e,t,n){(0,r.Ku)(e).beforeAuthStateChanged(t,n)}(n,e,(()=>e(n.currentUser))),function(t){(0,r.Ku)(t).onIdTokenChanged((t=>e(t)),void 0,void 0)}(n)}const o=(0,r.Tj)("auth");return o&&function(e,t,n){const r=pe(e);m(r._canInitEmulator,r,"emulator-config-failed"),m(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=ge(t),{host:o,port:a}=function(e){const t=ge(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:ye(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:ye(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${o}`),n}var Yt;Yt="Browser",(0,i.om)(new a.uA("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;m(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:Yt,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ie(Yt)},c=new fe(n,r,i,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(z);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),(0,i.om)(new a.uA("auth-internal",(e=>(e=>new Ht(e))(pe(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,i.KO)($t,Kt,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Yt)),(0,i.KO)($t,Kt,"esm2017")},517:(e,t,n)=>{"use strict";n.d(t,{Ao:()=>fr,Bx:()=>mr,Jh:()=>gr,O4:()=>pr,VV:()=>Ir,ZS:()=>br,_L:()=>vr,fF:()=>dr,iO:()=>wr,jz:()=>Er,ro:()=>yr});var r,i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},s={},o=o||{},a=i||self;function c(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function u(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var l="closure_uid_"+(1e9*Math.random()>>>0),h=0;function d(e,t,n){return e.call.apply(e.bind,arguments)}function f(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function p(e,t,n){return(p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?d:f).apply(null,arguments)}function m(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function g(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function y(){this.s=this.s,this.o=this.o}y.prototype.s=!1,y.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,l)&&e[l]||(e[l]=++h))},y.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const v=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function w(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function b(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(c(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function I(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}I.prototype.h=function(){this.defaultPrevented=!0};var E=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{a.addEventListener("test",(()=>{}),t),a.removeEventListener("test",(()=>{}),t)}catch(e){}return e}();function T(e){return/^[\s\xa0]*$/.test(e)}function _(){var e=a.navigator;return e&&(e=e.userAgent)?e:""}function C(e){return-1!=_().indexOf(e)}function x(e){return x[" "](e),e}x[" "]=function(){};var S,k,A,D=C("Opera"),N=C("Trident")||C("MSIE"),P=C("Edge"),L=P||N,R=C("Gecko")&&!(-1!=_().toLowerCase().indexOf("webkit")&&!C("Edge"))&&!(C("Trident")||C("MSIE"))&&!C("Edge"),O=-1!=_().toLowerCase().indexOf("webkit")&&!C("Edge");function M(){var e=a.document;return e?e.documentMode:void 0}e:{var F="",B=(k=_(),R?/rv:([^\);]+)(\)|;)/.exec(k):P?/Edge\/([\d\.]+)/.exec(k):N?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(k):O?/WebKit\/(\S+)/.exec(k):D?/(?:Version)[ \/]?(\S+)/.exec(k):void 0);if(B&&(F=B?B[1]:""),N){var U=M();if(null!=U&&U>parseFloat(F)){S=String(U);break e}}S=F}a.document&&N?A=M()||parseInt(S,10)||void 0:A=void 0;var V=A;function j(e,t){if(I.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(R){e:{try{x(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:q[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&j.$.h.call(this)}}g(j,I);var q={2:"touch",3:"pen",4:"mouse"};j.prototype.h=function(){j.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var z="closure_listenable_"+(1e6*Math.random()|0),G=0;function $(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++G,this.fa=this.ia=!1}function K(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function H(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function W(e){const t={};for(const n in e)t[n]=e[n];return t}const Q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function X(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<Q.length;t++)n=Q[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function J(e){this.src=e,this.g={},this.h=0}function Y(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=v(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(K(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Z(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==r)return i}return-1}J.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Z(e,t,r,i);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new $(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var ee="closure_lm_"+(1e6*Math.random()|0),te={};function ne(e,t,n,r,i){if(r&&r.once)return ie(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)ne(e,t[s],n,r,i);return null}return n=he(n),e&&e[z]?e.O(t,n,u(r)?!!r.capture:!!r,i):re(e,t,n,!1,r,i)}function re(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=u(i)?!!i.capture:!!i,a=ue(e);if(a||(e[ee]=a=new J(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){const e=ce;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)E||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(ae(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function ie(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)ie(e,t[s],n,r,i);return null}return n=he(n),e&&e[z]?e.P(t,n,u(r)?!!r.capture:!!r,i):re(e,t,n,!0,r,i)}function se(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)se(e,t[s],n,r,i);else r=u(r)?!!r.capture:!!r,n=he(n),e&&e[z]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=Z(s=e.g[t],n,r,i))&&(K(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=ue(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Z(t,n,r,i)),(n=-1<e?t[e]:null)&&oe(n))}function oe(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[z])Y(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ae(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ue(t))?(Y(n,e),0==n.h&&(n.src=null,t[ee]=null)):K(e)}}}function ae(e){return e in te?te[e]:te[e]="on"+e}function ce(e,t){if(e.fa)e=!0;else{t=new j(t,this);var n=e.listener,r=e.la||e.src;e.ia&&oe(e),e=n.call(r,t)}return e}function ue(e){return(e=e[ee])instanceof J?e:null}var le="__closure_events_fn_"+(1e9*Math.random()>>>0);function he(e){return"function"==typeof e?e:(e[le]||(e[le]=function(t){return e.handleEvent(t)}),e[le])}function de(){y.call(this),this.i=new J(this),this.S=this,this.J=null}function fe(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new I(t,e);else if(t instanceof I)t.target=t.target||e;else{var i=t;X(t=new I(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=pe(o,r,!0,t)&&i}if(i=pe(o=t.g=e,r,!0,t)&&i,i=pe(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=pe(o=t.g=n[s],r,!1,t)&&i}function pe(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&Y(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}g(de,y),de.prototype[z]=!0,de.prototype.removeEventListener=function(e,t,n,r){se(this,e,t,n,r)},de.prototype.N=function(){if(de.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)K(n[r]);delete t.g[e],t.h--}}this.J=null},de.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},de.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var me=a.JSON.stringify;function ge(){var e=Te;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var ye=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new ve),(e=>e.reset()));class ve{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function we(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function be(e){a.setTimeout((()=>{throw e}),0)}let Ie,Ee=!1,Te=new class{constructor(){this.h=this.g=null}add(e,t){const n=ye.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},_e=()=>{const e=a.Promise.resolve(void 0);Ie=()=>{e.then(Ce)}};var Ce=()=>{for(var e;e=ge();){try{e.h.call(e.g)}catch(e){be(e)}var t=ye;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Ee=!1};function xe(e,t){de.call(this),this.h=e||1,this.g=t||a,this.j=p(this.qb,this),this.l=Date.now()}function Se(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function ke(e,t,n){if("function"==typeof e)n&&(e=p(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=p(e.handleEvent,e)}return 2147483647<Number(t)?-1:a.setTimeout(e,t||0)}function Ae(e){e.g=ke((()=>{e.g=null,e.i&&(e.i=!1,Ae(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}g(xe,de),(r=xe.prototype).ga=!1,r.T=null,r.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),fe(this,"tick"),this.ga&&(Se(this),this.start()))}},r.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.N=function(){xe.$.N.call(this),Se(this),delete this.g};class De extends y{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Ae(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ne(e){y.call(this),this.h=e,this.g={}}g(Ne,y);var Pe=[];function Le(e,t,n,r){Array.isArray(n)||(n&&(Pe[0]=n.toString()),n=Pe);for(var i=0;i<n.length;i++){var s=ne(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Re(e){H(e.g,(function(e,t){this.g.hasOwnProperty(t)&&oe(e)}),e),e.g={}}function Oe(){this.g=!0}function Me(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return me(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}Ne.prototype.N=function(){Ne.$.N.call(this),Re(this)},Ne.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Oe.prototype.Ea=function(){this.g=!1},Oe.prototype.info=function(){};var Fe={},Be=null;function Ue(){return Be=Be||new de}function Ve(e){I.call(this,Fe.Ta,e)}function je(e){const t=Ue();fe(t,new Ve(t))}function qe(e,t){I.call(this,Fe.STAT_EVENT,e),this.stat=t}function ze(e){const t=Ue();fe(t,new qe(t,e))}function Ge(e,t){I.call(this,Fe.Ua,e),this.size=t}function $e(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout((function(){e()}),t)}Fe.Ta="serverreachability",g(Ve,I),Fe.STAT_EVENT="statevent",g(qe,I),Fe.Ua="timingevent",g(Ge,I);var Ke={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},He={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function We(){}function Qe(e){return e.h||(e.h=e.i())}function Xe(){}We.prototype.h=null;var Je,Ye={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Ze(){I.call(this,"d")}function et(){I.call(this,"c")}function tt(){}function nt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new Ne(this),this.P=it,e=L?125:void 0,this.V=new xe(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new rt}function rt(){this.i=null,this.g="",this.h=!1}g(Ze,I),g(et,I),g(tt,We),tt.prototype.g=function(){return new XMLHttpRequest},tt.prototype.i=function(){return{}},Je=new tt;var it=45e3,st={},ot={};function at(e,t,n){e.L=1,e.v=xt(It(t)),e.s=n,e.S=!0,ct(e,null)}function ct(e,t){e.G=Date.now(),dt(e),e.A=It(e.v);var n=e.A,r=e.W;Array.isArray(r)||(r=[String(r)]),Ut(n.i,"t",r),e.C=0,n=e.l.J,e.h=new rt,e.g=Vn(e.l,n?t:null,!e.s),0<e.O&&(e.M=new De(p(e.Pa,e,e.g),e.O)),Le(e.U,e.g,"readystatechange",e.nb),t=e.I?W(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),je(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.W,e.s)}function ut(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.l.Ha}function lt(e,t,n){let r,i=!0;for(;!e.J&&e.C<n.length;){if(r=ht(e,n),r==ot){4==t&&(e.o=4,ze(14),i=!1),Me(e.j,e.m,null,"[Incomplete Response]");break}if(r==st){e.o=4,ze(15),Me(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}Me(e.j,e.m,r,null),yt(e,r)}ut(e)&&r!=ot&&r!=st&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,ze(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Pn(t),t.M=!0,ze(11))):(Me(e.j,e.m,n,"[Invalid Chunked Response]"),gt(e),mt(e))}function ht(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?ot:(n=Number(t.substring(n,r)),isNaN(n)?st:(r+=1)+n>t.length?ot:(t=t.slice(r,r+n),e.C=r+n,t))}function dt(e){e.Y=Date.now()+e.P,ft(e,e.P)}function ft(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=$e(p(e.lb,e),t)}function pt(e){e.B&&(a.clearTimeout(e.B),e.B=null)}function mt(e){0==e.l.H||e.J||On(e.l,e)}function gt(e){pt(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,Se(e.V),Re(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function yt(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||Kt(n.i,e)))if(!e.K&&Kt(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;Rn(n),_n(n)}Nn(n),ze(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=$e(p(n.ib,n),6e3));if(1>=$t(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else Fn(n,11)}else if((e.K||n.g==e)&&Rn(n),!T(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Ht(s,s.h),s.h=null))}if(r.F){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,Ct(r.I,r.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((r=n).wa=Un(r,r.J?r.pa:null,r.Y),o.K){Wt(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.B&&(pt(a),dt(a)),r.g=o}else Dn(r);0<n.j.length&&xn(n)}else"stop"!=u[0]&&"close"!=u[0]||Fn(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Fn(n,7):Tn(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}je()}catch(e){}}function vt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(c(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(c(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(c(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(r=nt.prototype).setTimeout=function(e){this.P=e},r.nb=function(e){e=e.target;const t=this.M;t&&3==yn(e)?t.l():this.Pa(e)},r.Pa=function(e){try{if(e==this.g)e:{const h=yn(this.g);var t=this.g.Ia();if(this.g.da(),!(3>h)&&(3!=h||L||this.g&&(this.h.h||this.g.ja()||vn(this.g)))){this.J||4!=h||7==t||je(),pt(this);var n=this.g.da();this.ca=n;t:if(ut(this)){var r=vn(this.g);e="";var i=r.length,s=4==yn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){gt(this),mt(this);var o="";break t}this.h.i=new a.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!T(c)){var l=c;break t}}l=null}if(!(n=l)){this.i=!1,this.o=3,ze(12),gt(this),mt(this);break e}Me(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,yt(this,n)}this.S?(lt(this,h,o),L&&this.i&&3==h&&(Le(this.U,this.V,"tick",this.mb),this.V.start())):(Me(this.j,this.m,o,null),yt(this,o)),4==h&&gt(this),this.i&&!this.J&&(4==h?On(this.l,this):(this.i=!1,dt(this)))}else(function(e){const t={};e=(e.g&&2<=yn(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(T(e[r]))continue;var n=we(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,ze(12)):(this.o=0,ze(13)),gt(this),mt(this)}}}catch(e){}},r.mb=function(){if(this.g){var e=yn(this.g),t=this.g.ja();this.C<t.length&&(pt(this),lt(this,e,t),this.i&&4!=e&&dt(this))}},r.cancel=function(){this.J=!0,gt(this)},r.lb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.L&&(je(),ze(17)),gt(this),this.o=2,mt(this)):ft(this,this.Y-e)};var wt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function bt(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof bt){this.h=e.h,Et(this,e.j),this.s=e.s,this.g=e.g,Tt(this,e.m),this.l=e.l;var t=e.i,n=new Ot;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),_t(this,n),this.o=e.o}else e&&(t=String(e).match(wt))?(this.h=!1,Et(this,t[1]||"",!0),this.s=St(t[2]||""),this.g=St(t[3]||"",!0),Tt(this,t[4]),this.l=St(t[5]||"",!0),_t(this,t[6]||"",!0),this.o=St(t[7]||"")):(this.h=!1,this.i=new Ot(null,this.h))}function It(e){return new bt(e)}function Et(e,t,n){e.j=n?St(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Tt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function _t(e,t,n){t instanceof Ot?(e.i=t,function(e,t){t&&!e.j&&(Mt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Ft(this,t),Ut(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=kt(t,Lt)),e.i=new Ot(t,e.h))}function Ct(e,t,n){e.i.set(t,n)}function xt(e){return Ct(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function St(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function kt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,At),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function At(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}bt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(kt(t,Dt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(kt(t,Dt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(kt(n,"/"==n.charAt(0)?Pt:Nt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",kt(n,Rt)),e.join("")};var Dt=/[#\/\?@]/g,Nt=/[#\?:]/g,Pt=/[#\?]/g,Lt=/[#\?@]/g,Rt=/#/g;function Ot(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Mt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Ft(e,t){Mt(e),t=Vt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Bt(e,t){return Mt(e),t=Vt(e,t),e.g.has(t)}function Ut(e,t,n){Ft(e,t),0<n.length&&(e.i=null,e.g.set(Vt(e,t),w(n)),e.h+=n.length)}function Vt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(r=Ot.prototype).add=function(e,t){Mt(this),this.i=null,e=Vt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},r.forEach=function(e,t){Mt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},r.ta=function(){Mt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},r.Z=function(e){Mt(this);let t=[];if("string"==typeof e)Bt(this,e)&&(t=t.concat(this.g.get(Vt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},r.set=function(e,t){return Mt(this),this.i=null,Bt(this,e=Vt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};var jt=class{constructor(e,t){this.g=e,this.map=t}};function qt(e){this.l=e||zt,e=a.PerformanceNavigationTiming?0<(e=a.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.g&&a.g.Ka&&a.g.Ka()&&a.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var zt=10;function Gt(e){return!!e.h||!!e.g&&e.g.size>=e.j}function $t(e){return e.h?1:e.g?e.g.size:0}function Kt(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Ht(e,t){e.g?e.g.add(t):e.h=t}function Wt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Qt(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return w(e.i)}qt.prototype.cancel=function(){if(this.i=Qt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var Xt=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function Jt(){this.g=new Xt}function Yt(e,t,n){const r=n||"";try{vt(e,(function(e,n){let i=e;u(e)&&(i=me(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Zt(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function en(e){this.l=e.fc||null,this.j=e.ob||!1}function tn(e,t){de.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=nn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}g(en,We),en.prototype.g=function(){return new tn(this.l,this.j)},en.prototype.i=function(e){return function(){return e}}({}),g(tn,de);var nn=0;function rn(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function sn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,on(e)}function on(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(r=tn.prototype).open=function(e,t){if(this.readyState!=nn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,on(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||a).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,sn(this)),this.readyState=nn},r.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,on(this)),this.g&&(this.readyState=3,on(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;rn(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},r.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?sn(this):on(this),3==this.readyState&&rn(this)}},r.Za=function(e){this.g&&(this.response=this.responseText=e,sn(this))},r.Ya=function(e){this.g&&(this.response=e,sn(this))},r.ka=function(){this.g&&sn(this)},r.setRequestHeader=function(e,t){this.v.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var an=a.JSON.parse;function cn(e){de.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=un,this.L=this.M=!1}g(cn,de);var un="",ln=/^https?$/i,hn=["POST","PUT"];function dn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,fn(e),mn(e)}function fn(e){e.F||(e.F=!0,fe(e,"complete"),fe(e,"error"))}function pn(e){if(e.h&&void 0!==o&&(!e.C[1]||4!=yn(e)||2!=e.da()))if(e.v&&4==yn(e))ke(e.La,0,e);else if(fe(e,"readystatechange"),4==yn(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===o){var i=String(e.I).match(wt)[1]||null;!i&&a.self&&a.self.location&&(i=a.self.location.protocol.slice(0,-1)),r=!ln.test(i?i.toLowerCase():"")}n=r}if(n)fe(e,"complete"),fe(e,"success");else{e.m=6;try{var s=2<yn(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",fn(e)}}finally{mn(e)}}}function mn(e,t){if(e.g){gn(e);const n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||fe(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function gn(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(a.clearTimeout(e.A),e.A=null)}function yn(e){return e.g?e.g.readyState:0}function vn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case un:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function wn(e){let t="";return H(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function bn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=wn(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Ct(e,t,n))}function In(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function En(e){this.Ga=0,this.j=[],this.l=new Oe,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=In("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=In("baseRetryDelayMs",5e3,e),this.hb=In("retryDelaySeedMs",1e4,e),this.eb=In("forwardChannelMaxRetries",2,e),this.xa=In("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new qt(e&&e.concurrentRequestLimit),this.Ja=new Jt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Tn(e){if(Cn(e),3==e.H){var t=e.W++,n=It(e.I);if(Ct(n,"SID",e.K),Ct(n,"RID",t),Ct(n,"TYPE","terminate"),kn(e,n),(t=new nt(e,e.l,t)).L=2,t.v=xt(It(n)),n=!1,a.navigator&&a.navigator.sendBeacon)try{n=a.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&a.Image&&((new Image).src=t.v,n=!0),n||(t.g=Vn(t.l,null),t.g.ha(t.v)),t.G=Date.now(),dt(t)}Bn(e)}function _n(e){e.g&&(Pn(e),e.g.cancel(),e.g=null)}function Cn(e){_n(e),e.u&&(a.clearTimeout(e.u),e.u=null),Rn(e),e.i.cancel(),e.m&&("number"==typeof e.m&&a.clearTimeout(e.m),e.m=null)}function xn(e){if(!Gt(e.i)&&!e.m){e.m=!0;var t=e.Na;Ie||_e(),Ee||(Ie(),Ee=!0),Te.add(t,e),e.C=0}}function Sn(e,t){var n;n=t?t.m:e.W++;const r=It(e.I);Ct(r,"SID",e.K),Ct(r,"RID",n),Ct(r,"AID",e.V),kn(e,r),e.o&&e.s&&bn(r,e.o,e.s),n=new nt(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=An(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),Ht(e.i,n),at(n,r,t)}function kn(e,t){e.na&&H(e.na,(function(e,n){Ct(t,n,e)})),e.h&&vt({},(function(e,n){Ct(t,n,e)}))}function An(e,t,n){n=Math.min(e.j.length,n);var r=e.h?p(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{Yt(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function Dn(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;Ie||_e(),Ee||(Ie(),Ee=!0),Te.add(t,e),e.A=0}}function Nn(e){return!(e.g||e.u||3<=e.A||(e.ba++,e.u=$e(p(e.Ma,e),Mn(e,e.A)),e.A++,0))}function Pn(e){null!=e.B&&(a.clearTimeout(e.B),e.B=null)}function Ln(e){e.g=new nt(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=It(e.wa);Ct(t,"RID","rpc"),Ct(t,"SID",e.K),Ct(t,"AID",e.V),Ct(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&Ct(t,"TO",e.qa),Ct(t,"TYPE","xmlhttp"),kn(e,t),e.o&&e.s&&bn(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=xt(It(t)),n.s=null,n.S=!0,ct(n,e)}function Rn(e){null!=e.v&&(a.clearTimeout(e.v),e.v=null)}function On(e,t){var n=null;if(e.g==t){Rn(e),Pn(e),e.g=null;var r=2}else{if(!Kt(e.i,t))return;n=t.F,Wt(e.i,t),r=1}if(0!=e.H)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.G;var i=e.C;fe(r=Ue(),new Ge(r,n)),xn(e)}else Dn(e);else if(3==(i=t.o)||0==i&&0<t.ca||!(1==r&&function(e,t){return!($t(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=$e(p(e.Na,e,t),Mn(e,e.C)),e.C++,0)))}(e,t)||2==r&&Nn(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:Fn(e,5);break;case 4:Fn(e,10);break;case 3:Fn(e,6);break;default:Fn(e,2)}}function Mn(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function Fn(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=p(e.pb,e);n||(n=new bt("//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||Et(n,"https"),xt(n)),function(e,t){const n=new Oe;if(a.Image){const r=new Image;r.onload=m(Zt,n,r,"TestLoadImage: loaded",!0,t),r.onerror=m(Zt,n,r,"TestLoadImage: error",!1,t),r.onabort=m(Zt,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=m(Zt,n,r,"TestLoadImage: timeout",!1,t),a.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else ze(2);e.H=0,e.h&&e.h.za(t),Bn(e),Cn(e)}function Bn(e){if(e.H=0,e.ma=[],e.h){const t=Qt(e.i);0==t.length&&0==e.j.length||(b(e.ma,t),b(e.ma,e.j),e.i.i.length=0,w(e.j),e.j.length=0),e.h.ya()}}function Un(e,t,n){var r=n instanceof bt?It(n):new bt(n);if(""!=r.g)t&&(r.g=t+"."+r.g),Tt(r,r.m);else{var i=a.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new bt(null);r&&Et(s,r),t&&(s.g=t),i&&Tt(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&Ct(r,n,t),Ct(r,"VER",e.ra),kn(e,r),r}function Vn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ha&&!e.va?new cn(new en({ob:!0})):new cn(e.va)).Oa(e.J),t}function jn(){}function qn(){if(N&&!(10<=Number(V)))throw Error("Environmental error: no available transport.")}function zn(e,t){de.call(this),this.g=new En(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!T(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!T(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Kn(this)}function Gn(e){Ze.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function $n(){et.call(this),this.status=1}function Kn(e){this.g=e}function Hn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Wn(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function Qn(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(r=cn.prototype).Oa=function(e){this.M=e},r.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Je.g(),this.C=this.u?Qe(this.u):Qe(Je),this.g.onreadystatechange=p(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void dn(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=a.FormData&&e instanceof a.FormData,!(0<=v(hn,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{gn(this),0<this.B&&((this.L=function(e){return N&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=p(this.ua,this)):this.A=ke(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){dn(this,e)}},r.ua=function(){void 0!==o&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,fe(this,"timeout"),this.abort(8))},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,fe(this,"complete"),fe(this,"abort"),mn(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),mn(this,!0)),cn.$.N.call(this)},r.La=function(){this.s||(this.G||this.v||this.l?pn(this):this.kb())},r.kb=function(){pn(this)},r.isActive=function(){return!!this.g},r.da=function(){try{return 2<yn(this)?this.g.status:-1}catch(e){return-1}},r.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},r.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),an(t)}},r.Ia=function(){return this.m},r.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=En.prototype).ra=8,r.H=1,r.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const i=new nt(this,this.l,e);let s=this.s;if(this.U&&(s?(s=W(s),X(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=An(this,i,t),Ct(n=It(this.I),"RID",e),Ct(n,"CVER",22),this.F&&Ct(n,"X-HTTP-Session-Id",this.F),kn(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(wn(s)))+"&"+t:this.o&&bn(n,this.o,s)),Ht(this.i,i),this.bb&&Ct(n,"TYPE","init"),this.P?(Ct(n,"$req",t),Ct(n,"SID","null"),i.aa=!0,at(i,n,null)):at(i,n,t),this.H=2}}else 3==this.H&&(e?Sn(this,e):0==this.j.length||Gt(this.i)||Sn(this))},r.Ma=function(){if(this.u=null,Ln(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=$e(p(this.jb,this),e)}},r.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,ze(10),_n(this),Ln(this))},r.ib=function(){null!=this.v&&(this.v=null,_n(this),Nn(this),ze(19))},r.pb=function(e){e?(this.l.info("Successfully pinged google.com"),ze(2)):(this.l.info("Failed to ping google.com"),ze(1))},r.isActive=function(){return!!this.h&&this.h.isActive(this)},(r=jn.prototype).Ba=function(){},r.Aa=function(){},r.za=function(){},r.ya=function(){},r.isActive=function(){return!0},r.Va=function(){},qn.prototype.g=function(e,t){return new zn(e,t)},g(zn,de),zn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;ze(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=Un(e,null,e.Y),xn(e)},zn.prototype.close=function(){Tn(this.g)},zn.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=me(e),e=n);t.j.push(new jt(t.fb++,e)),3==t.H&&xn(t)},zn.prototype.N=function(){this.g.h=null,delete this.j,Tn(this.g),delete this.g,zn.$.N.call(this)},g(Gn,Ze),g($n,et),g(Kn,jn),Kn.prototype.Ba=function(){fe(this.g,"a")},Kn.prototype.Aa=function(e){fe(this.g,new Gn(e))},Kn.prototype.za=function(e){fe(this.g,new $n)},Kn.prototype.ya=function(){fe(this.g,"b")},g(Hn,(function(){this.blockSize=-1})),Hn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Hn.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)Wn(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){Wn(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){Wn(this,r),i=0;break}}this.h=i,this.i+=t},Hn.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var Xn={};function Jn(e){return-128<=e&&128>e?function(e){var t=Xn;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new Qn([0|e],0>e?-1:0)}(e)}(e):new Qn([0|e],0>e?-1:0)}function Yn(e){if(isNaN(e)||!isFinite(e))return er;if(0>e)return sr(Yn(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=Zn;return new Qn(t,0)}var Zn=4294967296,er=Jn(0),tr=Jn(1),nr=Jn(16777216);function rr(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function ir(e){return-1==e.h}function sr(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new Qn(n,~e.h).add(tr)}function or(e,t){return e.add(sr(t))}function ar(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function cr(e,t){this.g=e,this.h=t}function ur(e,t){if(rr(t))throw Error("division by zero");if(rr(e))return new cr(er,er);if(ir(e))return t=ur(sr(e),t),new cr(sr(t.g),sr(t.h));if(ir(t))return t=ur(e,sr(t)),new cr(sr(t.g),t.h);if(30<e.g.length){if(ir(e)||ir(t))throw Error("slowDivide_ only works with positive integers.");for(var n=tr,r=t;0>=r.X(e);)n=lr(n),r=lr(r);var i=hr(n,1),s=hr(r,1);for(r=hr(r,2),n=hr(n,2);!rr(r);){var o=s.add(r);0>=o.X(e)&&(i=i.add(n),s=o),r=hr(r,1),n=hr(n,1)}return t=or(e,i.R(t)),new cr(i,t)}for(i=er;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=Yn(n)).R(t);ir(o)||0<o.X(e);)o=(s=Yn(n-=r)).R(t);rr(s)&&(s=tr),i=i.add(s),e=or(e,o)}return new cr(i,e)}function lr(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new Qn(n,e.h)}function hr(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new Qn(i,e.h)}(r=Qn.prototype).ea=function(){if(ir(this))return-sr(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:Zn+r)*t,t*=Zn}return e},r.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(rr(this))return"0";if(ir(this))return"-"+sr(this).toString(e);for(var t=Yn(Math.pow(e,6)),n=this,r="";;){var i=ur(n,t).g,s=((0<(n=or(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(rr(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},r.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},r.X=function(e){return ir(e=or(this,e))?-1:rr(e)?0:1},r.abs=function(){return ir(this)?sr(this):this},r.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new Qn(n,-2147483648&n[n.length-1]?-1:0)},r.R=function(e){if(rr(this)||rr(e))return er;if(ir(this))return ir(e)?sr(this).R(sr(e)):sr(sr(this).R(e));if(ir(e))return sr(this.R(sr(e)));if(0>this.X(nr)&&0>e.X(nr))return Yn(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=e.D(i)>>>16,c=65535&e.D(i);n[2*r+2*i]+=o*c,ar(n,2*r+2*i),n[2*r+2*i+1]+=s*c,ar(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,ar(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,ar(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new Qn(n,0)},r.gb=function(e){return ur(this,e).h},r.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new Qn(n,this.h&e.h)},r.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new Qn(n,this.h|e.h)},r.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new Qn(n,this.h^e.h)},qn.prototype.createWebChannel=qn.prototype.g,zn.prototype.send=zn.prototype.u,zn.prototype.open=zn.prototype.m,zn.prototype.close=zn.prototype.close,Ke.NO_ERROR=0,Ke.TIMEOUT=8,Ke.HTTP_ERROR=6,He.COMPLETE="complete",Xe.EventType=Ye,Ye.OPEN="a",Ye.CLOSE="b",Ye.ERROR="c",Ye.MESSAGE="d",de.prototype.listen=de.prototype.O,cn.prototype.listenOnce=cn.prototype.P,cn.prototype.getLastError=cn.prototype.Sa,cn.prototype.getLastErrorCode=cn.prototype.Ia,cn.prototype.getStatus=cn.prototype.da,cn.prototype.getResponseJson=cn.prototype.Wa,cn.prototype.getResponseText=cn.prototype.ja,cn.prototype.send=cn.prototype.ha,cn.prototype.setWithCredentials=cn.prototype.Oa,Hn.prototype.digest=Hn.prototype.l,Hn.prototype.reset=Hn.prototype.reset,Hn.prototype.update=Hn.prototype.j,Qn.prototype.add=Qn.prototype.add,Qn.prototype.multiply=Qn.prototype.R,Qn.prototype.modulo=Qn.prototype.gb,Qn.prototype.compare=Qn.prototype.X,Qn.prototype.toNumber=Qn.prototype.ea,Qn.prototype.toString=Qn.prototype.toString,Qn.prototype.getBits=Qn.prototype.D,Qn.fromNumber=Yn,Qn.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return sr(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=Yn(Math.pow(n,8)),i=er,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=Yn(Math.pow(n,o)),i=i.R(o).add(Yn(a))):i=(i=i.R(r)).add(Yn(a))}return i};var dr=s.createWebChannelTransport=function(){return new qn},fr=s.getStatEventTarget=function(){return Ue()},pr=s.ErrorCode=Ke,mr=s.EventType=He,gr=s.Event=Fe,yr=s.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},vr=s.FetchXmlHttpFactory=en,wr=s.WebChannel=Xe,br=s.XhrIo=cn,Ir=s.Md5=Hn,Er=s.Integer=Qn},580:(e,t,n)=>{"use strict";n.d(t,{activateLicense:()=>d,needsLicenseActivation:()=>p});var r=n(467),i=n(848),s=n(756),o=n.n(s),a=n(405);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e){return h.apply(this,arguments)}function h(){return(h=(0,i.A)(o().mark((function e(t){var n,r,i,s,c,l,h,d,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=(0,a.aU)(),r=(0,a.H9)(n,"users",t,"subscription","current"),e.next=5,(0,a.x7)(r);case 5:if((i=e.sent).exists()){e.next=8;break}return e.abrupt("return",null);case 8:if((s=i.data()).licenseKeyId){e.next=11;break}return e.abrupt("return",null);case 11:return c=(0,a.H9)(n,"licenses",s.licenseKeyId),e.next=14,(0,a.x7)(c);case 14:if((l=e.sent).exists()){e.next=17;break}return e.abrupt("return",null);case 17:if(h=l.data(),d=new Date,f=h.expirationDate.toDate(),!(d>f)){e.next=26;break}return e.next=23,(0,a.mZ)(c,{status:"expired"});case 23:return e.next=25,(0,a.mZ)(r,{status:"expired",updatedAt:(0,a.O5)()});case 25:return e.abrupt("return",u(u({},h),{},{status:"expired",isActive:!1}));case 26:return e.abrupt("return",u(u({},h),{},{isActive:!0}));case 29:return e.prev=29,e.t0=e.catch(0),console.error("Erreur lors de la vérification de la licence:",e.t0),e.abrupt("return",null);case 33:case"end":return e.stop()}}),e,null,[[0,29]])})))).apply(this,arguments)}function d(e,t){return f.apply(this,arguments)}function f(){return(f=(0,i.A)(o().mark((function e(t,n){var r,i,s,c,l,h,d,f,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=(0,a.aU)(),i=(0,a.rJ)(r,"licenses"),s=(0,a.P)(i,(0,a._M)("licenseKey","==",n)),e.next=6,(0,a.GG)(s);case 6:if(!(c=e.sent).empty){e.next=9;break}return e.abrupt("return",{success:!1,message:"Clé de licence invalide."});case 9:if(l=c.docs[0],"available"===(h=l.data()).status){e.next=13;break}return e.abrupt("return",{success:!1,message:"Cette licence est déjà utilisée ou a expiré."});case 13:return d=new Date,(f=new Date(d)).setDate(d.getDate()+h.duration),e.next=18,(0,a.mZ)((0,a.H9)(r,"licenses",l.id),{status:"activated",userId:t,activationDate:d,expirationDate:f,updatedAt:(0,a.O5)()});case 18:return p=(0,a.H9)(r,"users",t,"subscription","current"),e.next=21,(0,a.BN)(p,{licenseKeyId:l.id,status:"active",activationDate:d,expirationDate:f,plan:h.plan,updatedAt:(0,a.O5)()});case 21:return e.abrupt("return",{success:!0,message:"Licence activée avec succès!",licenseData:u(u({},h),{},{activationDate:d,expirationDate:f,status:"activated"})});case 24:return e.prev=24,e.t0=e.catch(0),console.error("Erreur lors de l'activation de la licence:",e.t0),e.abrupt("return",{success:!1,message:"Une erreur est survenue lors de l'activation de la licence."});case 28:case"end":return e.stop()}}),e,null,[[0,24]])})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=(0,i.A)(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l(t);case 3:return n=e.sent,e.abrupt("return",!n||!n.isActive);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Erreur lors de la vérification de la licence:",e.t0),e.abrupt("return",!0);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}n(908)},602:(e,t,n)=>{"use strict";n.d(t,{P2:()=>i});var r=n(500);function i(e,t,{blocked:n,upgrade:i,blocking:s,terminated:o}={}){const a=indexedDB.open(e,t),c=(0,r.w)(a);return i&&a.addEventListener("upgradeneeded",(e=>{i((0,r.w)(a.result),e.oldVersion,e.newVersion,(0,r.w)(a.transaction),e)})),n&&a.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),c.then((e=>{o&&e.addEventListener("close",(()=>o())),s&&e.addEventListener("versionchange",(e=>s(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),c}const s=["get","getKey","getAll","getAllKeys","count"],o=["put","add","delete","clear"],a=new Map;function c(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(a.get(t))return a.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=o.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!s.includes(n))return;const c=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return a.set(t,c),c}(0,r.r)((e=>({...e,get:(t,n,r)=>c(t,n)||e.get(t,n,r),has:(t,n)=>!!c(t,n)||e.has(t,n)})))},606:e=>{var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var a,c=[],u=!1,l=-1;function h(){u&&a&&(u=!1,a.length?c=a.concat(c):l=-1,c.length&&d())}function d(){if(!u){var e=o(h);u=!0;for(var t=c.length;t;){for(a=c,c=[];++l<t;)a&&a[l].run();l=-1,t=c.length}a=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||u||o(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},633:(e,t,n)=>{var r=n(738).default;function i(){"use strict";e.exports=i=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},s=Object.prototype,o=s.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function h(e,t,n,r){return Object.defineProperty(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r})}try{h({},"")}catch(t){h=function(e,t,n){return e[t]=n}}function d(e,n,r,i){var s=n&&n.prototype instanceof m?n:m,o=Object.create(s.prototype);return h(o,"_invoke",function(e,n,r){var i=1;return function(s,o){if(3===i)throw Error("Generator is already running");if(4===i){if("throw"===s)throw o;return{value:t,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=_(a,r);if(c){if(c===p)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(1===i)throw i=4,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=3;var u=f(e,n,r);if("normal"===u.type){if(i=r.done?4:2,u.arg===p)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=4,r.method="throw",r.arg=u.arg)}}}(e,r,new S(i||[])),!0),o}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=d;var p={};function m(){}function g(){}function y(){}var v={};h(v,c,(function(){return this}));var w=Object.getPrototypeOf,b=w&&w(w(k([])));b&&b!==s&&o.call(b,c)&&(v=b);var I=y.prototype=m.prototype=Object.create(v);function E(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(i,s,a,c){var u=f(e[i],e,s);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==r(h)&&o.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,c)}),(function(e){n("throw",e,a,c)})):t.resolve(h).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,c)}))}c(u.arg)}var i;h(this,"_invoke",(function(e,r){function s(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(s,s):s()}),!0)}function _(e,n){var r=n.method,i=e.i[r];if(i===t)return n.delegate=null,"throw"===r&&e.i.return&&(n.method="return",n.arg=t,_(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var s=f(i,e.i,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,p;var o=s.arg;return o?o.done?(n[e.r]=o.value,n.next=e.n,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,p):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function C(e){this.tryEntries.push(e)}function x(e){var n=e[4]||{};n.type="normal",n.arg=t,e[4]=n}function S(e){this.tryEntries=[[-1]],e.forEach(C,this),this.reset(!0)}function k(e){if(null!=e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function n(){for(;++i<e.length;)if(o.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}throw new TypeError(r(e)+" is not iterable")}return g.prototype=y,h(I,"constructor",y),h(y,"constructor",g),g.displayName=h(y,l,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,h(e,l,"GeneratorFunction")),e.prototype=Object.create(I),e},n.awrap=function(e){return{__await:e}},E(T.prototype),h(T.prototype,u,(function(){return this})),n.AsyncIterator=T,n.async=function(e,t,r,i,s){void 0===s&&(s=Promise);var o=new T(d(e,t,r,i),s);return n.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},E(I),h(I,l,"Generator"),h(I,c,(function(){return this})),h(I,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}},n.values=k,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(x),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(t){o.type="throw",o.arg=e,n.next=t}for(var i=n.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],o=s[4],a=this.prev,c=s[1],u=s[2];if(-1===s[0])return r("end"),!1;if(!c&&!u)throw Error("try statement without catch or finally");if(null!=s[0]&&s[0]<=a){if(a<c)return this.method="next",this.arg=t,r(c),!0;if(a<u)return r(u),!1}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r[0]>-1&&r[0]<=this.prev&&this.prev<r[2]){var i=r;break}}i&&("break"===e||"continue"===e)&&i[0]<=t&&t<=i[2]&&(i=null);var s=i?i[4]:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i[2],p):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n[2]===e)return this.complete(n[4],n[3]),x(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n[0]===e){var r=n[4];if("throw"===r.type){var i=r.arg;x(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={i:k(e),r:n,n:r},"next"===this.method&&(this.arg=t),p}},n}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},635:(e,t,n)=>{"use strict";function r(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}n.d(t,{Tt:()=>r}),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError},738:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},743:(e,t,n)=>{"use strict";n.d(t,{Am:()=>P,FA:()=>S,Fy:()=>m,I9:()=>L,Im:()=>A,Ku:()=>z,Ll:()=>v,T9:()=>d,Tj:()=>l,Uj:()=>a,XA:()=>f,ZQ:()=>g,bD:()=>D,cY:()=>p,dM:()=>C,eX:()=>_,g:()=>x,hp:()=>R,jZ:()=>y,lT:()=>I,lV:()=>b,nr:()=>E,p9:()=>q,sr:()=>w,tD:()=>O,u:()=>c,yU:()=>h,zW:()=>T});var r=n(606);const i=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==c)throw new o;const u=i<<2|s>>4;if(r.push(u),64!==a){const e=s<<4&240|a>>2;if(r.push(e),64!==c){const e=a<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(e){return function(e){const t=i(e);return s.encodeByteArray(t,!0)}(e).replace(/\./g,"")},c=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},u=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(void 0===r||void 0===r.env)return;const e=r.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&c(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},l=e=>{var t,n;return null===(n=null===(t=u())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},h=e=>{const t=l(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},d=()=>{var e;return null===(e=u())||void 0===e?void 0:e.config},f=e=>{var t;return null===(t=u())||void 0===t?void 0:t[`_${e}`]};class p{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function m(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(s)),""].join(".")}function g(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function y(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(g())}function v(){var e;const t=null===(e=u())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function w(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function b(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function I(){const e=g();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function E(){return!v()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function T(){try{return"object"==typeof indexedDB}catch(e){return!1}}function _(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}function C(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class x extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,x.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,S.prototype.create)}}class S{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(k,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new x(r,o,n)}}const k=/\{\$([^}]+)}/g;function A(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function D(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(N(n)&&N(s)){if(!D(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function N(e){return null!==e&&"object"==typeof e}function P(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function L(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function R(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function O(e,t){const n=new M(e,t);return n.subscribe.bind(n)}class M{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=F),void 0===r.error&&(r.error=F),void 0===r.complete&&(r.complete=F);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function F(){}const B=1e3,U=2,V=144e5,j=.5;function q(e,t=B,n=U){const r=t*Math.pow(n,e),i=Math.round(j*r*(Math.random()-.5)*2);return Math.min(V,r+i)}function z(e){return e&&e._delegate?e._delegate:e}},756:(e,t,n)=>{var r=n(633)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},790:(e,t,n)=>{"use strict";n.d(t,{AB:()=>du,BN:()=>Du,CL:()=>Vu,GG:()=>Au,H9:()=>Ic,HM:()=>pu,My:()=>lu,O5:()=>ju,P:()=>su,_M:()=>au,aU:()=>_c,c4:()=>Uu,gS:()=>Lu,kd:()=>Pu,mZ:()=>Nu,ol:()=>Sc,rJ:()=>bc,wP:()=>qu,x7:()=>Su});var r=n(461),i=n(125),s=n(424),o=n(743),a=n(517),c=n(606);const u="@firebase/firestore";class l{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}l.UNAUTHENTICATED=new l(null),l.GOOGLE_CREDENTIALS=new l("google-credentials-uid"),l.FIRST_PARTY=new l("first-party-uid"),l.MOCK_USER=new l("mock-user");let h="9.23.0";const d=new s.Vy("@firebase/firestore");function f(){return d.logLevel}function p(e,...t){if(d.logLevel<=s.$b.DEBUG){const n=t.map(y);d.debug(`Firestore (${h}): ${e}`,...n)}}function m(e,...t){if(d.logLevel<=s.$b.ERROR){const n=t.map(y);d.error(`Firestore (${h}): ${e}`,...n)}}function g(e,...t){if(d.logLevel<=s.$b.WARN){const n=t.map(y);d.warn(`Firestore (${h}): ${e}`,...n)}}function y(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function v(e="Unexpected state"){const t=`FIRESTORE (${h}) INTERNAL ASSERTION FAILED: `+e;throw m(t),new Error(t)}function w(e,t){e||v()}function b(e,t){return e}const I={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class E extends o.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class T{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class _{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class C{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(l.UNAUTHENTICATED)))}shutdown(){}}class x{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class S{constructor(e){this.t=e,this.currentUser=l.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new T;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new T,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{p("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(p("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new T)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(p("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(w("string"==typeof t.accessToken),new _(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return w(null===e||"string"==typeof e),new l(e)}}class k{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=l.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class A{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new k(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(l.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class D{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class N{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){const n=e=>{null!=e.error&&p("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.T;return this.T=e.token,p("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{p("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.I.getImmediate({optional:!0});e?r(e):p("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(w("string"==typeof e.token),this.T=e.token,new D(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function P(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class L{static A(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=P(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function R(e,t){return e<t?-1:e>t?1:0}function O(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function M(e){return e+"\0"}class F{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new E(I.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new E(I.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new E(I.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new E(I.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return F.fromMillis(Date.now())}static fromDate(e){return F.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new F(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?R(this.nanoseconds,e.nanoseconds):R(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class B{constructor(e){this.timestamp=e}static fromTimestamp(e){return new B(e)}static min(){return new B(new F(0,0))}static max(){return new B(new F(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class U{constructor(e,t,n){void 0===t?t=0:t>e.length&&v(),void 0===n?n=e.length-t:n>e.length-t&&v(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===U.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof U?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class V extends U{construct(e,t,n){return new V(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new E(I.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new V(t)}static emptyPath(){return new V([])}}const j=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class q extends U{construct(e,t,n){return new q(e,t,n)}static isValidIdentifier(e){return j.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),q.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new q(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new E(I.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new E(I.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new E(I.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new E(I.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new q(t)}static emptyPath(){return new q([])}}class z{constructor(e){this.path=e}static fromPath(e){return new z(V.fromString(e))}static fromName(e){return new z(V.fromString(e).popFirst(5))}static empty(){return new z(V.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===V.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return V.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new z(new V(e.slice()))}}class G{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function $(e){return e.fields.find((e=>2===e.kind))}function K(e){return e.fields.filter((e=>2!==e.kind))}G.UNKNOWN_ID=-1;class H{constructor(e,t){this.fieldPath=e,this.kind=t}}class W{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new W(0,X.min())}}function Q(e){return new X(e.readTime,e.key,-1)}class X{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new X(B.min(),z.empty(),-1)}static max(){return new X(B.max(),z.empty(),-1)}}function J(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=z.comparator(e.documentKey,t.documentKey),0!==n?n:R(e.largestBatchId,t.largestBatchId))}const Y="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Z{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function ee(e){if(e.code!==I.FAILED_PRECONDITION||e.message!==Y)throw e;p("LocalStore","Unexpectedly lost primary lease")}class te{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&v(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new te(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof te?t:te.resolve(t)}catch(e){return te.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):te.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):te.reject(t)}static resolve(e){return new te(((t,n)=>{t(e)}))}static reject(e){return new te(((t,n)=>{n(e)}))}static waitFor(e){return new te(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=te.resolve(!1);for(const n of e)t=t.next((e=>e?te.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new te(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new te(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}class ne{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.v=new T,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{t.error?this.v.reject(new se(e,t.error)):this.v.resolve()},this.transaction.onerror=t=>{const n=le(t.target.error);this.v.reject(new se(e,n))}}static open(e,t,n,r){try{return new ne(t,e.transaction(r,n))}catch(e){throw new se(t,e)}}get R(){return this.v.promise}abort(e){e&&this.v.reject(e),this.aborted||(p("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new ae(t)}}class re{constructor(e,t,n){this.name=e,this.version=t,this.V=n,12.2===re.S((0,o.ZQ)())&&m("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return p("SimpleDb","Removing database:",e),ce(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,o.zW)())return!1;if(re.C())return!0;const e=(0,o.ZQ)(),t=re.S(e),n=0<t&&t<10,r=re.N(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static C(){var e;return void 0!==c&&"YES"===(null===(e=c.env)||void 0===e?void 0:e.k)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static N(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async $(e){return this.db||(p("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new se(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new E(I.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new E(I.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new se(e,r))},r.onupgradeneeded=e=>{p("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.V.O(t,r.transaction,e.oldVersion,this.version).next((()=>{p("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.F&&(this.db.onversionchange=e=>this.F(e)),this.db}B(e){this.F=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.$(e);const t=ne.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.P(),e))).catch((e=>(t.abort(e),te.reject(e)))).toPromise();return s.catch((()=>{})),await t.R,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(p("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class ie{constructor(e){this.L=e,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(e){this.L=e}done(){this.q=!0}G(e){this.U=e}delete(){return ce(this.L.delete())}}class se extends E{constructor(e,t){super(I.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function oe(e){return"IndexedDbTransactionError"===e.name}class ae{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(p("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(p("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),ce(n)}add(e){return p("SimpleDb","ADD",this.store.name,e,e),ce(this.store.add(e))}get(e){return ce(this.store.get(e)).next((t=>(void 0===t&&(t=null),p("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return p("SimpleDb","DELETE",this.store.name,e),ce(this.store.delete(e))}count(){return p("SimpleDb","COUNT",this.store.name),ce(this.store.count())}j(e,t){const n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){const e=this.cursor(n),t=[];return this.W(e,((e,n)=>{t.push(n)})).next((()=>t))}{const e=this.store.getAll(n.range);return new te(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}}H(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new te(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}J(e,t){p("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Y=!1;const r=this.cursor(n);return this.W(r,((e,t,n)=>n.delete()))}X(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.W(r,t)}Z(e){const t=this.cursor({});return new te(((n,r)=>{t.onerror=e=>{const t=le(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}W(e,t){const n=[];return new te(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new ie(i),o=t(i.primaryKey,i.value,s);if(o instanceof te){const e=o.catch((e=>(s.done(),te.reject(e))));n.push(e)}s.isDone?r():null===s.K?i.continue():i.continue(s.K)}})).next((()=>te.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ce(e){return new te(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=le(e.target.error);n(t)}}))}let ue=!1;function le(e){const t=re.S((0,o.ZQ)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new E("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ue||(ue=!0,setTimeout((()=>{throw e}),0)),e}}return e}class he{constructor(e,t){this.asyncQueue=e,this.tt=t,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(e){p("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{p("IndexBackiller",`Documents written: ${await this.tt.nt()}`)}catch(e){oe(e)?p("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await ee(e)}await this.et(6e4)}))}}class de{constructor(e,t){this.localStore=e,this.persistence=t}async nt(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.st(t,e)))}st(e,t){const n=new Set;let r=t,i=!0;return te.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return p("IndexBackiller",`Processing collection: ${t}`),this.it(e,t,r).next((e=>{r-=e,n.add(t)}));i=!1})))).next((()=>t-r))}it(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.rt(r,n))).next((n=>(p("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}rt(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=Q(t);J(r,n)>0&&(n=r)})),new X(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class fe{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ut&&this.ut(e),e}}function pe(e){return null==e}function me(e){return 0===e&&1/e==-1/0}function ge(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=ve(t)),t=ye(e.get(n),t);return ve(t)}function ye(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function ve(e){return e+""}function we(e){const t=e.length;if(w(t>=2),2===t)return w(""===e.charAt(0)&&""===e.charAt(1)),V.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("",s);switch((t<0||t>n)&&v(),e.charAt(t+1)){case"":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:v()}s=t+2}return new V(r)}fe.ct=-1;const be=["userId","batchId"];function Ie(e,t){return[e,ge(t)]}function Ee(e,t,n){return[e,ge(t),n]}const Te={},_e=["prefixPath","collectionGroup","readTime","documentId"],Ce=["prefixPath","collectionGroup","documentId"],xe=["collectionGroup","readTime","prefixPath","documentId"],Se=["canonicalId","targetId"],ke=["targetId","path"],Ae=["path","targetId"],De=["collectionId","parent"],Ne=["indexId","uid"],Pe=["uid","sequenceNumber"],Le=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Re=["indexId","uid","orderedDocumentKey"],Oe=["userId","collectionPath","documentId"],Me=["userId","collectionPath","largestBatchId"],Fe=["userId","collectionGroup","largestBatchId"],Be=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Ue=[...Be,"documentOverlays"],Ve=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],je=Ve,qe=[...je,"indexConfiguration","indexState","indexEntries"];class ze extends Z{constructor(e,t){super(),this.ht=e,this.currentSequenceNumber=t}}function Ge(e,t){const n=b(e);return re.M(n.ht,t)}function $e(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Ke(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function He(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class We{constructor(e,t){this.comparator=e,this.root=t||Xe.EMPTY}insert(e,t){return new We(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Xe.BLACK,null,null))}remove(e){return new We(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Xe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Qe(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Qe(this.root,e,this.comparator,!1)}getReverseIterator(){return new Qe(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Qe(this.root,e,this.comparator,!0)}}class Qe{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Xe{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Xe.RED,this.left=null!=r?r:Xe.EMPTY,this.right=null!=i?i:Xe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new Xe(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Xe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Xe.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Xe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Xe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw v();if(this.right.isRed())throw v();const e=this.left.check();if(e!==this.right.check())throw v();return e+(this.isRed()?0:1)}}Xe.EMPTY=null,Xe.RED=!0,Xe.BLACK=!1,Xe.EMPTY=new class{constructor(){this.size=0}get key(){throw v()}get value(){throw v()}get color(){throw v()}get left(){throw v()}get right(){throw v()}copy(e,t,n,r,i){return this}insert(e,t,n){return new Xe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Je{constructor(e){this.comparator=e,this.data=new We(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ye(this.data.getIterator())}getIteratorFrom(e){return new Ye(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Je))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Je(this.comparator);return t.data=e,t}}class Ye{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ze(e){return e.hasNext()?e.getNext():void 0}class et{constructor(e){this.fields=e,e.sort(q.comparator)}static empty(){return new et([])}unionWith(e){let t=new Je(q.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new et(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return O(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class tt extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class nt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new tt("Invalid base64 string: "+e):e}}(e);return new nt(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new nt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return R(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}nt.EMPTY_BYTE_STRING=new nt("");const rt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function it(e){if(w(!!e),"string"==typeof e){let t=0;const n=rt.exec(e);if(w(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:st(e.seconds),nanos:st(e.nanos)}}function st(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ot(e){return"string"==typeof e?nt.fromBase64String(e):nt.fromUint8Array(e)}function at(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ct(e){const t=e.mapValue.fields.__previous_value__;return at(t)?ct(t):t}function ut(e){const t=it(e.mapValue.fields.__local_write_time__.timestampValue);return new F(t.seconds,t.nanos)}class lt{constructor(e,t,n,r,i,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class ht{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ht("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof ht&&e.projectId===this.projectId&&e.database===this.database}}const dt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},ft={nullValue:"NULL_VALUE"};function pt(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?at(e)?4:kt(e)?9007199254740991:10:v()}function mt(e,t){if(e===t)return!0;const n=pt(e);if(n!==pt(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ut(e).isEqual(ut(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=it(e.timestampValue),r=it(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return ot(e.bytesValue).isEqual(ot(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return st(e.geoPointValue.latitude)===st(t.geoPointValue.latitude)&&st(e.geoPointValue.longitude)===st(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return st(e.integerValue)===st(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=st(e.doubleValue),r=st(t.doubleValue);return n===r?me(n)===me(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return O(e.arrayValue.values||[],t.arrayValue.values||[],mt);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if($e(n)!==$e(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!mt(n[e],r[e])))return!1;return!0}(e,t);default:return v()}}function gt(e,t){return void 0!==(e.values||[]).find((e=>mt(e,t)))}function yt(e,t){if(e===t)return 0;const n=pt(e),r=pt(t);if(n!==r)return R(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return R(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=st(e.integerValue||e.doubleValue),r=st(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return vt(e.timestampValue,t.timestampValue);case 4:return vt(ut(e),ut(t));case 5:return R(e.stringValue,t.stringValue);case 6:return function(e,t){const n=ot(e),r=ot(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=R(n[e],r[e]);if(0!==t)return t}return R(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=R(st(e.latitude),st(t.latitude));return 0!==n?n:R(st(e.longitude),st(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=yt(n[e],r[e]);if(t)return t}return R(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===dt.mapValue&&t===dt.mapValue)return 0;if(e===dt.mapValue)return 1;if(t===dt.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=R(r[e],s[e]);if(0!==t)return t;const o=yt(n[r[e]],i[s[e]]);if(0!==o)return o}return R(r.length,s.length)}(e.mapValue,t.mapValue);default:throw v()}}function vt(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return R(e,t);const n=it(e),r=it(t),i=R(n.seconds,r.seconds);return 0!==i?i:R(n.nanos,r.nanos)}function wt(e){return bt(e)}function bt(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=it(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?ot(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,z.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=bt(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${bt(e.fields[i])}`;return n+"}"}(e.mapValue):v();var t,n}function It(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Et(e){return!!e&&"integerValue"in e}function Tt(e){return!!e&&"arrayValue"in e}function _t(e){return!!e&&"nullValue"in e}function Ct(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function xt(e){return!!e&&"mapValue"in e}function St(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Ke(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=St(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=St(e.arrayValue.values[n]);return t}return Object.assign({},e)}function kt(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function At(e){return"nullValue"in e?ft:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?It(ht.empty(),z.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:v()}function Dt(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?It(ht.empty(),z.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?dt:v()}function Nt(e,t){const n=yt(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Pt(e,t){const n=yt(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Lt{constructor(e){this.value=e}static empty(){return new Lt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!xt(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=St(t)}setAll(e){let t=q.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=St(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());xt(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return mt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];xt(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Ke(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Lt(St(this.value))}}function Rt(e){const t=[];return Ke(e.fields,((e,n)=>{const r=new q([e]);if(xt(n)){const e=Rt(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new et(t)}class Ot{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new Ot(e,0,B.min(),B.min(),B.min(),Lt.empty(),0)}static newFoundDocument(e,t,n,r){return new Ot(e,1,t,B.min(),n,r,0)}static newNoDocument(e,t){return new Ot(e,2,t,B.min(),B.min(),Lt.empty(),0)}static newUnknownDocument(e,t){return new Ot(e,3,t,B.min(),B.min(),Lt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(B.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Lt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Lt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ot&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ot(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Mt{constructor(e,t){this.position=e,this.inclusive=t}}function Ft(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?z.comparator(z.fromName(o.referenceValue),n.key):yt(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Bt(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!mt(e.position[n],t.position[n]))return!1;return!0}class Ut{constructor(e,t="asc"){this.field=e,this.dir=t}}function Vt(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class jt{}class qt extends jt{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Yt(e,t,n):"array-contains"===t?new nn(e,n):"in"===t?new rn(e,n):"not-in"===t?new sn(e,n):"array-contains-any"===t?new on(e,n):new qt(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Zt(e,n):new en(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(yt(t,this.value)):null!==t&&pt(this.value)===pt(t)&&this.matchesComparison(yt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return v()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class zt extends jt{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new zt(e,t)}matches(e){return Gt(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft((e=>e.isInequality()));return null!==e?e.field:null}ft(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Gt(e){return"and"===e.op}function $t(e){return"or"===e.op}function Kt(e){return Ht(e)&&Gt(e)}function Ht(e){for(const t of e.filters)if(t instanceof zt)return!1;return!0}function Wt(e){if(e instanceof qt)return e.field.canonicalString()+e.op.toString()+wt(e.value);if(Kt(e))return e.filters.map((e=>Wt(e))).join(",");{const t=e.filters.map((e=>Wt(e))).join(",");return`${e.op}(${t})`}}function Qt(e,t){return e instanceof qt?function(e,t){return t instanceof qt&&e.op===t.op&&e.field.isEqual(t.field)&&mt(e.value,t.value)}(e,t):e instanceof zt?function(e,t){return t instanceof zt&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&Qt(n,t.filters[r])),!0)}(e,t):void v()}function Xt(e,t){const n=e.filters.concat(t);return zt.create(n,e.op)}function Jt(e){return e instanceof qt?function(e){return`${e.field.canonicalString()} ${e.op} ${wt(e.value)}`}(e):e instanceof zt?function(e){return e.op.toString()+" {"+e.getFilters().map(Jt).join(" ,")+"}"}(e):"Filter"}class Yt extends qt{constructor(e,t,n){super(e,t,n),this.key=z.fromName(n.referenceValue)}matches(e){const t=z.comparator(e.key,this.key);return this.matchesComparison(t)}}class Zt extends qt{constructor(e,t){super(e,"in",t),this.keys=tn(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class en extends qt{constructor(e,t){super(e,"not-in",t),this.keys=tn(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function tn(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>z.fromName(e.referenceValue)))}class nn extends qt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Tt(t)&&gt(t.arrayValue,this.value)}}class rn extends qt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&gt(this.value.arrayValue,t)}}class sn extends qt{constructor(e,t){super(e,"not-in",t)}matches(e){if(gt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!gt(this.value.arrayValue,t)}}class on extends qt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Tt(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>gt(this.value.arrayValue,e)))}}class an{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.dt=null}}function cn(e,t=null,n=[],r=[],i=null,s=null,o=null){return new an(e,t,n,r,i,s,o)}function un(e){const t=b(e);if(null===t.dt){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>Wt(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),pe(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>wt(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>wt(e))).join(",")),t.dt=e}return t.dt}function ln(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Vt(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Qt(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Bt(e.startAt,t.startAt)&&Bt(e.endAt,t.endAt)}function hn(e){return z.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function dn(e,t){return e.filters.filter((e=>e instanceof qt&&e.field.isEqual(t)))}function fn(e,t,n){let r=ft,i=!0;for(const n of dn(e,t)){let e=ft,t=!0;switch(n.op){case"<":case"<=":e=At(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=ft}Nt({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Nt({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function pn(e,t,n){let r=dt,i=!0;for(const n of dn(e,t)){let e=dt,t=!0;switch(n.op){case">=":case">":e=Dt(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=dt}Pt({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Pt({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class mn{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function gn(e){return new mn(e)}function yn(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function vn(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function wn(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function bn(e){return null!==e.collectionGroup}function In(e){const t=b(e);if(null===t.wt){t.wt=[];const e=wn(t),n=vn(t);if(null!==e&&null===n)e.isKeyField()||t.wt.push(new Ut(e)),t.wt.push(new Ut(q.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.wt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.wt.push(new Ut(q.keyField(),e))}}}return t.wt}function En(e){const t=b(e);if(!t._t)if("F"===t.limitType)t._t=cn(t.path,t.collectionGroup,In(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of In(t)){const t="desc"===n.dir?"asc":"desc";e.push(new Ut(n.field,t))}const n=t.endAt?new Mt(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Mt(t.startAt.position,t.startAt.inclusive):null;t._t=cn(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t._t}function Tn(e,t){t.getFirstInequalityField(),wn(e);const n=e.filters.concat([t]);return new mn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function _n(e,t,n){return new mn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Cn(e,t){return ln(En(e),En(t))&&e.limitType===t.limitType}function xn(e){return`${un(En(e))}|lt:${e.limitType}`}function Sn(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>Jt(e))).join(", ")}]`),pe(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>wt(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>wt(e))).join(",")),`Target(${t})`}(En(e))}; limitType=${e.limitType})`}function kn(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):z.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of In(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Ft(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,In(e),t)||e.endAt&&!function(e,t,n){const r=Ft(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,In(e),t))}(e,t)}function An(e){return(t,n)=>{let r=!1;for(const i of In(e)){const e=Dn(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Dn(e,t,n){const r=e.field.isKeyField()?z.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?yt(r,i):v()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return v()}}class Nn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Ke(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return He(this.inner)}size(){return this.innerSize}}const Pn=new We(z.comparator);function Ln(){return Pn}const Rn=new We(z.comparator);function On(...e){let t=Rn;for(const n of e)t=t.insert(n.key,n);return t}function Mn(e){let t=Rn;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Fn(){return Un()}function Bn(){return Un()}function Un(){return new Nn((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Vn=new We(z.comparator),jn=new Je(z.comparator);function qn(...e){let t=jn;for(const n of e)t=t.add(n);return t}const zn=new Je(R);function Gn(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:me(t)?"-0":t}}function $n(e){return{integerValue:""+e}}function Kn(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!me(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?$n(t):Gn(e,t)}class Hn{constructor(){this._=void 0}}function Wn(e,t,n){return e instanceof Jn?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&at(t)&&(t=ct(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Yn?Zn(e,t):e instanceof er?tr(e,t):function(e,t){const n=Xn(e,t),r=rr(n)+rr(e.gt);return Et(n)&&Et(e.gt)?$n(r):Gn(e.serializer,r)}(e,t)}function Qn(e,t,n){return e instanceof Yn?Zn(e,t):e instanceof er?tr(e,t):n}function Xn(e,t){return e instanceof nr?Et(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class Jn extends Hn{}class Yn extends Hn{constructor(e){super(),this.elements=e}}function Zn(e,t){const n=ir(t);for(const t of e.elements)n.some((e=>mt(e,t)))||n.push(t);return{arrayValue:{values:n}}}class er extends Hn{constructor(e){super(),this.elements=e}}function tr(e,t){let n=ir(t);for(const t of e.elements)n=n.filter((e=>!mt(e,t)));return{arrayValue:{values:n}}}class nr extends Hn{constructor(e,t){super(),this.serializer=e,this.gt=t}}function rr(e){return st(e.integerValue||e.doubleValue)}function ir(e){return Tt(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class sr{constructor(e,t){this.field=e,this.transform=t}}class or{constructor(e,t){this.version=e,this.transformResults=t}}class ar{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ar}static exists(e){return new ar(void 0,e)}static updateTime(e){return new ar(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function cr(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ur{}function lr(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new br(e.key,ar.none()):new mr(e.key,e.data,ar.none());{const n=e.data,r=Lt.empty();let i=new Je(q.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new gr(e.key,r,new et(i.toArray()),ar.none())}}function hr(e,t,n){e instanceof mr?function(e,t,n){const r=e.value.clone(),i=vr(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof gr?function(e,t,n){if(!cr(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=vr(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(yr(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function dr(e,t,n,r){return e instanceof mr?function(e,t,n,r){if(!cr(e.precondition,t))return n;const i=e.value.clone(),s=wr(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof gr?function(e,t,n,r){if(!cr(e.precondition,t))return n;const i=wr(e.fieldTransforms,r,t),s=t.data;return s.setAll(yr(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return cr(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function fr(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Xn(r.transform,e||null);null!=i&&(null===n&&(n=Lt.empty()),n.set(r.field,i))}return n||null}function pr(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&O(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Yn&&t instanceof Yn||e instanceof er&&t instanceof er?O(e.elements,t.elements,mt):e instanceof nr&&t instanceof nr?mt(e.gt,t.gt):e instanceof Jn&&t instanceof Jn}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class mr extends ur{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class gr extends ur{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function yr(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function vr(e,t,n){const r=new Map;w(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Qn(o,a,n[i]))}return r}function wr(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,Wn(e,s,t))}return r}class br extends ur{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ir extends ur{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Er{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&hr(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=dr(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=dr(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Bn();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=lr(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(B.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),qn())}isEqual(e){return this.batchId===e.batchId&&O(this.mutations,e.mutations,((e,t)=>pr(e,t)))&&O(this.baseMutations,e.baseMutations,((e,t)=>pr(e,t)))}}class Tr{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){w(e.mutations.length===n.length);let r=Vn;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Tr(e,t,n,r)}}class _r{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Cr{constructor(e,t){this.count=e,this.unchangedNames=t}}var xr,Sr;function kr(e){switch(e){default:return v();case I.CANCELLED:case I.UNKNOWN:case I.DEADLINE_EXCEEDED:case I.RESOURCE_EXHAUSTED:case I.INTERNAL:case I.UNAVAILABLE:case I.UNAUTHENTICATED:return!1;case I.INVALID_ARGUMENT:case I.NOT_FOUND:case I.ALREADY_EXISTS:case I.PERMISSION_DENIED:case I.FAILED_PRECONDITION:case I.ABORTED:case I.OUT_OF_RANGE:case I.UNIMPLEMENTED:case I.DATA_LOSS:return!0}}function Ar(e){if(void 0===e)return m("GRPC error has no .code"),I.UNKNOWN;switch(e){case xr.OK:return I.OK;case xr.CANCELLED:return I.CANCELLED;case xr.UNKNOWN:return I.UNKNOWN;case xr.DEADLINE_EXCEEDED:return I.DEADLINE_EXCEEDED;case xr.RESOURCE_EXHAUSTED:return I.RESOURCE_EXHAUSTED;case xr.INTERNAL:return I.INTERNAL;case xr.UNAVAILABLE:return I.UNAVAILABLE;case xr.UNAUTHENTICATED:return I.UNAUTHENTICATED;case xr.INVALID_ARGUMENT:return I.INVALID_ARGUMENT;case xr.NOT_FOUND:return I.NOT_FOUND;case xr.ALREADY_EXISTS:return I.ALREADY_EXISTS;case xr.PERMISSION_DENIED:return I.PERMISSION_DENIED;case xr.FAILED_PRECONDITION:return I.FAILED_PRECONDITION;case xr.ABORTED:return I.ABORTED;case xr.OUT_OF_RANGE:return I.OUT_OF_RANGE;case xr.UNIMPLEMENTED:return I.UNIMPLEMENTED;case xr.DATA_LOSS:return I.DATA_LOSS;default:return v()}}(Sr=xr||(xr={}))[Sr.OK=0]="OK",Sr[Sr.CANCELLED=1]="CANCELLED",Sr[Sr.UNKNOWN=2]="UNKNOWN",Sr[Sr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Sr[Sr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Sr[Sr.NOT_FOUND=5]="NOT_FOUND",Sr[Sr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Sr[Sr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Sr[Sr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Sr[Sr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Sr[Sr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Sr[Sr.ABORTED=10]="ABORTED",Sr[Sr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Sr[Sr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Sr[Sr.INTERNAL=13]="INTERNAL",Sr[Sr.UNAVAILABLE=14]="UNAVAILABLE",Sr[Sr.DATA_LOSS=15]="DATA_LOSS";class Dr{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return Nr}static getOrCreateInstance(){return null===Nr&&(Nr=new Dr),Nr}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach((t=>t(e)))}}let Nr=null;const Pr=new a.jz([4294967295,4294967295],0);function Lr(e){const t=(new TextEncoder).encode(e),n=new a.VV;return n.update(t),new Uint8Array(n.digest())}function Rr(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new a.jz([n,r],0),new a.jz([i,s],0)]}class Or{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Mr(`Invalid padding: ${t}`);if(n<0)throw new Mr(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Mr(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Mr(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=a.jz.fromNumber(this.It)}Et(e,t,n){let r=e.add(t.multiply(a.jz.fromNumber(n)));return 1===r.compare(Pr)&&(r=new a.jz([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Tt).toNumber()}At(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;const t=Lr(e),[n,r]=Rr(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,r,e);if(!this.At(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new Or(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.It)return;const t=Lr(e),[n,r]=Rr(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,r,e);this.Rt(t)}}Rt(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Mr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Fr{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Br.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Fr(B.min(),r,new We(R),Ln(),qn())}}class Br{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Br(n,t,qn(),qn(),qn())}}class Ur{constructor(e,t,n,r){this.Pt=e,this.removedTargetIds=t,this.key=n,this.bt=r}}class Vr{constructor(e,t){this.targetId=e,this.Vt=t}}class jr{constructor(e,t,n=nt.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class qr{constructor(){this.St=0,this.Dt=$r(),this.Ct=nt.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=qn(),t=qn(),n=qn();return this.Dt.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:v()}})),new Br(this.Ct,this.xt,e,t,n)}Ft(){this.Nt=!1,this.Dt=$r()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class zr{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=Ln(),this.zt=Gr(),this.Wt=new We(R)}Ht(e){for(const t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(const t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,(t=>{const n=this.Zt(t);switch(e.state){case 0:this.te(t)&&n.$t(e.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(e.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(t);break;case 3:this.te(t)&&(n.Kt(),n.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),n.$t(e.resumeToken));break;default:v()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach(((e,n)=>{this.te(n)&&t(n)}))}ne(e){var t;const n=e.targetId,r=e.Vt.count,i=this.se(n);if(i){const s=i.target;if(hn(s))if(0===r){const e=new z(s.path);this.Yt(n,e,Ot.newNoDocument(e,B.min()))}else w(1===r);else{const i=this.ie(n);if(i!==r){const r=this.re(e,i);if(0!==r){this.ee(n);const e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,e)}null===(t=Dr.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(e,t,n){var r,i,s,o,a,c;const u={localCacheCount:t,existenceFilterCount:n.count},l=n.unchangedNames;return l&&(u.bloomFilter={applied:0===e,hashCount:null!==(r=null==l?void 0:l.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(o=null===(s=null===(i=null==l?void 0:l.bits)||void 0===i?void 0:i.bitmap)||void 0===s?void 0:s.length)&&void 0!==o?o:0,padding:null!==(c=null===(a=null==l?void 0:l.bits)||void 0===a?void 0:a.padding)&&void 0!==c?c:0}),u}(r,i,e.Vt))}}}}re(e,t){const{unchangedNames:n,count:r}=e.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:i="",padding:s=0},hashCount:o=0}=n;let a,c;try{a=ot(i).toUint8Array()}catch(e){if(e instanceof tt)return g("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{c=new Or(a,s,o)}catch(e){return g(e instanceof Mr?"BloomFilter error: ":"Applying bloom filter failed: ",e),1}return 0===c.It?1:r!==t-this.oe(e.targetId,c)?2:0}oe(e,t){const n=this.Gt.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.Gt.ue(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.vt(s)||(this.Yt(e,n,null),r++)})),r}ce(e){const t=new Map;this.Qt.forEach(((n,r)=>{const i=this.se(r);if(i){if(n.current&&hn(i.target)){const t=new z(i.target.path);null!==this.jt.get(t)||this.ae(r,t)||this.Yt(r,t,Ot.newNoDocument(t,e))}n.Mt&&(t.set(r,n.Ot()),n.Ft())}}));let n=qn();this.zt.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.se(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.jt.forEach(((t,n)=>n.setReadTime(e)));const r=new Fr(e,t,this.Wt,this.jt,n);return this.jt=Ln(),this.zt=Gr(),this.Wt=new We(R),r}Jt(e,t){if(!this.te(e))return;const n=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,n),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,n){if(!this.te(e))return;const r=this.Zt(e);this.ae(e,t)?r.Bt(t,1):r.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),n&&(this.jt=this.jt.insert(t,n))}removeTarget(e){this.Qt.delete(e)}ie(e){const t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new qr,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new Je(R),this.zt=this.zt.insert(e,t)),t}te(e){const t=null!==this.se(e);return t||p("WatchChangeAggregator","Detected inactive target",e),t}se(e){const t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new qr),this.Gt.getRemoteKeysForTarget(e).forEach((t=>{this.Yt(e,t,null)}))}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function Gr(){return new We(z.comparator)}function $r(){return new We(z.comparator)}const Kr={asc:"ASCENDING",desc:"DESCENDING"},Hr={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Wr={and:"AND",or:"OR"};class Qr{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Xr(e,t){return e.useProto3Json||pe(t)?t:{value:t}}function Jr(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Yr(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Zr(e,t){return Jr(e,t.toTimestamp())}function ei(e){return w(!!e),B.fromTimestamp(function(e){const t=it(e);return new F(t.seconds,t.nanos)}(e))}function ti(e,t){return function(e){return new V(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function ni(e){const t=V.fromString(e);return w(Ti(t)),t}function ri(e,t){return ti(e.databaseId,t.path)}function ii(e,t){const n=ni(t);if(n.get(1)!==e.databaseId.projectId)throw new E(I.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new E(I.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new z(ci(n))}function si(e,t){return ti(e.databaseId,t)}function oi(e){const t=ni(e);return 4===t.length?V.emptyPath():ci(t)}function ai(e){return new V(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ci(e){return w(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function ui(e,t,n){return{name:ri(e,t),fields:n.value.mapValue.fields}}function li(e,t){let n;if(t instanceof mr)n={update:ui(e,t.key,t.value)};else if(t instanceof br)n={delete:ri(e,t.key)};else if(t instanceof gr)n={update:ui(e,t.key,t.data),updateMask:Ei(t.fieldMask)};else{if(!(t instanceof Ir))return v();n={verify:ri(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Jn)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Yn)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof er)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof nr)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw v()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Zr(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:v()}(e,t.precondition)),n}function hi(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?ar.updateTime(ei(e.updateTime)):void 0!==e.exists?ar.exists(e.exists):ar.none()}(t.currentDocument):ar.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)w("REQUEST_TIME"===t.setToServerValue),n=new Jn;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Yn(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new er(e)}else"increment"in t?n=new nr(e,t.increment):v();const r=q.fromServerFormat(t.fieldPath);return new sr(r,n)}(e,t))):[];if(t.update){t.update.name;const i=ii(e,t.update.name),s=new Lt({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new et(t.map((e=>q.fromServerFormat(e))))}(t.updateMask);return new gr(i,s,e,n,r)}return new mr(i,s,n,r)}if(t.delete){const r=ii(e,t.delete);return new br(r,n)}if(t.verify){const r=ii(e,t.verify);return new Ir(r,n)}return v()}function di(e,t){return{documents:[si(e,t.path)]}}function fi(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=si(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=si(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0!==e.length)return Ii(zt.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:wi(e.field),direction:gi(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=Xr(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function pi(e){let t=oi(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){w(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=mi(e);return t instanceof zt&&Kt(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new Ut(bi(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,pe(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Mt(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new Mt(n,t)}(n.endAt)),function(e,t,n,r,i,s,o,a){return new mn(e,t,n,r,i,s,o,a)}(t,i,o,s,a,"F",c,u)}function mi(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=bi(e.unaryFilter.field);return qt.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=bi(e.unaryFilter.field);return qt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=bi(e.unaryFilter.field);return qt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=bi(e.unaryFilter.field);return qt.create(i,"!=",{nullValue:"NULL_VALUE"});default:return v()}}(e):void 0!==e.fieldFilter?function(e){return qt.create(bi(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return v()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return zt.create(e.compositeFilter.filters.map((e=>mi(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return v()}}(e.compositeFilter.op))}(e):v()}function gi(e){return Kr[e]}function yi(e){return Hr[e]}function vi(e){return Wr[e]}function wi(e){return{fieldPath:e.canonicalString()}}function bi(e){return q.fromServerFormat(e.fieldPath)}function Ii(e){return e instanceof qt?function(e){if("=="===e.op){if(Ct(e.value))return{unaryFilter:{field:wi(e.field),op:"IS_NAN"}};if(_t(e.value))return{unaryFilter:{field:wi(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ct(e.value))return{unaryFilter:{field:wi(e.field),op:"IS_NOT_NAN"}};if(_t(e.value))return{unaryFilter:{field:wi(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:wi(e.field),op:yi(e.op),value:e.value}}}(e):e instanceof zt?function(e){const t=e.getFilters().map((e=>Ii(e)));return 1===t.length?t[0]:{compositeFilter:{op:vi(e.op),filters:t}}}(e):v()}function Ei(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Ti(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class _i{constructor(e,t,n,r,i=B.min(),s=B.min(),o=nt.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new _i(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new _i(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new _i(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new _i(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Ci{constructor(e){this.fe=e}}function xi(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Si(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:ri(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Jr(e,t.version.toTimestamp()),createTime:Jr(e,t.createTime.toTimestamp())}}(e.fe,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:ki(t.version)};else{if(!t.isUnknownDocument())return v();r.unknownDocument={path:n.path.toArray(),version:ki(t.version)}}return r}function Si(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function ki(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Ai(e){const t=new F(e.seconds,e.nanoseconds);return B.fromTimestamp(t)}function Di(e,t){const n=(t.baseMutations||[]).map((t=>hi(e.fe,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>hi(e.fe,t))),i=F.fromMillis(t.localWriteTimeMs);return new Er(t.batchId,i,n,r)}function Ni(e){const t=Ai(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Ai(e.lastLimboFreeSnapshotVersion):B.min();let r;var i;return void 0!==e.query.documents?(w(1===(i=e.query).documents.length),r=En(gn(oi(i.documents[0])))):r=function(e){return En(pi(e))}(e.query),new _i(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,nt.fromBase64String(e.resumeToken))}function Pi(e,t){const n=ki(t.snapshotVersion),r=ki(t.lastLimboFreeSnapshotVersion);let i;i=hn(t.target)?di(e.fe,t.target):fi(e.fe,t.target);const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:un(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Li(e){const t=pi({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?_n(t,t.limit,"L"):t}function Ri(e,t){return new _r(t.largestBatchId,hi(e.fe,t.overlayMutation))}function Oi(e,t){const n=t.path.lastSegment();return[e,ge(t.path.popLast()),n]}function Mi(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:ki(r.readTime),documentKey:ge(r.documentKey.path),largestBatchId:r.largestBatchId}}class Fi{getBundleMetadata(e,t){return Bi(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:Ai(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return Bi(e).put({bundleId:(n=t).id,createTime:ki(ei(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return Ui(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:Li(t.bundledQuery),readTime:Ai(t.readTime)};var t}))}saveNamedQuery(e,t){return Ui(e).put(function(e){return{name:e.name,readTime:ki(ei(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function Bi(e){return Ge(e,"bundles")}function Ui(e){return Ge(e,"namedQueries")}class Vi{constructor(e,t){this.serializer=e,this.userId=t}static de(e,t){const n=t.uid||"";return new Vi(e,n)}getOverlay(e,t){return ji(e).get(Oi(this.userId,t)).next((e=>e?Ri(this.serializer,e):null))}getOverlays(e,t){const n=Fn();return te.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new _r(t,i);r.push(this.we(e,s))})),te.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(ge(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(ji(e).J("collectionPathOverlayIndex",r))})),te.waitFor(i)}getOverlaysForCollection(e,t,n){const r=Fn(),i=ge(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return ji(e).j("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=Ri(this.serializer,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=Fn();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ji(e).X({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=Ri(this.serializer,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}we(e,t){return ji(e).put(function(e,t,n){const[r,i,s]=Oi(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:li(e.fe,n.mutation)}}(this.serializer,this.userId,t))}}function ji(e){return Ge(e,"documentOverlays")}class qi{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(st(e.integerValue));else if("doubleValue"in e){const n=st(e.doubleValue);isNaN(n)?this.ye(t,13):(this.ye(t,15),me(n)?t.pe(0):t.pe(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ye(t,20),"string"==typeof n?t.Ie(n):(t.Ie(`${n.seconds||""}`),t.pe(n.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(ot(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ye(t,45),t.pe(n.latitude||0),t.pe(n.longitude||0)}else"mapValue"in e?kt(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):v()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){const n=e.fields||{};this.ye(t,55);for(const e of Object.keys(n))this.Te(e,t),this.me(n[e],t)}Pe(e,t){const n=e.values||[];this.ye(t,50);for(const e of n)this.me(e,t)}ve(e,t){this.ye(t,37),z.fromName(e).path.forEach((e=>{this.ye(t,60),this.be(e,t)}))}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}function zi(e){if(0===e)return 8;let t=0;return!(e>>4)&&(t+=4,e<<=4),!(e>>6)&&(t+=2,e<<=2),!(e>>7)&&(t+=1),t}function Gi(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=zi(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}qi.Ve=new qi;class $i{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Se(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.De(n.value),n=t.next();this.Ce()}xe(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ne(n.value),n=t.next();this.ke()}Me(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.De(e);else if(e<2048)this.De(960|e>>>6),this.De(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.De(480|e>>>12),this.De(128|63&e>>>6),this.De(128|63&e);else{const e=t.codePointAt(0);this.De(240|e>>>18),this.De(128|63&e>>>12),this.De(128|63&e>>>6),this.De(128|63&e)}}this.Ce()}$e(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ne(e);else if(e<2048)this.Ne(960|e>>>6),this.Ne(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ne(480|e>>>12),this.Ne(128|63&e>>>6),this.Ne(128|63&e);else{const e=t.codePointAt(0);this.Ne(240|e>>>18),this.Ne(128|63&e>>>12),this.Ne(128|63&e>>>6),this.Ne(128|63&e)}}this.ke()}Oe(e){const t=this.Fe(e),n=Gi(t);this.Be(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}Le(e){const t=this.Fe(e),n=Gi(t);this.Be(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}qe(){this.Ue(255),this.Ue(255)}Ke(){this.Ge(255),this.Ge(255)}reset(){this.position=0}seed(e){this.Be(e.length),this.buffer.set(e,this.position),this.position+=e.length}Qe(){return this.buffer.slice(0,this.position)}Fe(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}De(e){const t=255&e;0===t?(this.Ue(0),this.Ue(255)):255===t?(this.Ue(255),this.Ue(0)):this.Ue(t)}Ne(e){const t=255&e;0===t?(this.Ge(0),this.Ge(255)):255===t?(this.Ge(255),this.Ge(0)):this.Ge(e)}Ce(){this.Ue(0),this.Ue(1)}ke(){this.Ge(0),this.Ge(1)}Ue(e){this.Be(1),this.buffer[this.position++]=e}Ge(e){this.Be(1),this.buffer[this.position++]=~e}Be(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class Ki{constructor(e){this.je=e}Ae(e){this.je.Se(e)}Ie(e){this.je.Me(e)}pe(e){this.je.Oe(e)}ge(){this.je.qe()}}class Hi{constructor(e){this.je=e}Ae(e){this.je.xe(e)}Ie(e){this.je.$e(e)}pe(e){this.je.Le(e)}ge(){this.je.Ke()}}class Wi{constructor(){this.je=new $i,this.ze=new Ki(this.je),this.We=new Hi(this.je)}seed(e){this.je.seed(e)}He(e){return 0===e?this.ze:this.We}Qe(){return this.je.Qe()}reset(){this.je.reset()}}class Qi{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Je(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new Qi(this.indexId,this.documentKey,this.arrayValue,n)}}function Xi(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=Ji(e.arrayValue,t.arrayValue),0!==n?n:(n=Ji(e.directionalValue,t.directionalValue),0!==n?n:z.comparator(e.documentKey,t.documentKey)))}function Ji(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class Yi{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ye=e.orderBy,this.Xe=[];for(const t of e.filters){const e=t;e.isInequality()?this.Ze=e:this.Xe.push(e)}}tn(e){w(e.collectionGroup===this.collectionId);const t=$(e);if(void 0!==t&&!this.en(t))return!1;const n=K(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.en(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(void 0!==this.Ze){if(!r.has(this.Ze.field.canonicalString())){const e=n[i];if(!this.nn(this.Ze,e)||!this.sn(this.Ye[s++],e))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.Ye.length||!this.sn(this.Ye[s++],e))return!1}return!0}en(e){for(const t of this.Xe)if(this.nn(t,e))return!0;return!1}nn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Zi(e){var t,n;if(w(e instanceof qt||e instanceof zt),e instanceof qt){if(e instanceof rn){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>qt.create(e.field,"==",t))))||[];return zt.create(r,"or")}return e}const r=e.filters.map((e=>Zi(e)));return zt.create(r,e.op)}function es(e){if(0===e.getFilters().length)return[];const t=is(Zi(e));return w(rs(t)),ts(t)||ns(t)?[t]:t.getFilters()}function ts(e){return e instanceof qt}function ns(e){return e instanceof zt&&Kt(e)}function rs(e){return ts(e)||ns(e)||function(e){if(e instanceof zt&&$t(e)){for(const t of e.getFilters())if(!ts(t)&&!ns(t))return!1;return!0}return!1}(e)}function is(e){if(w(e instanceof qt||e instanceof zt),e instanceof qt)return e;if(1===e.filters.length)return is(e.filters[0]);const t=e.filters.map((e=>is(e)));let n=zt.create(t,e.op);return n=as(n),rs(n)?n:(w(n instanceof zt),w(Gt(n)),w(n.filters.length>1),n.filters.reduce(((e,t)=>ss(e,t))))}function ss(e,t){let n;return w(e instanceof qt||e instanceof zt),w(t instanceof qt||t instanceof zt),n=e instanceof qt?t instanceof qt?function(e,t){return zt.create([e,t],"and")}(e,t):os(e,t):t instanceof qt?os(t,e):function(e,t){if(w(e.filters.length>0&&t.filters.length>0),Gt(e)&&Gt(t))return Xt(e,t.getFilters());const n=$t(e)?e:t,r=$t(e)?t:e,i=n.filters.map((e=>ss(e,r)));return zt.create(i,"or")}(e,t),as(n)}function os(e,t){if(Gt(t))return Xt(t,e.getFilters());{const n=t.filters.map((t=>ss(e,t)));return zt.create(n,"or")}}function as(e){if(w(e instanceof qt||e instanceof zt),e instanceof qt)return e;const t=e.getFilters();if(1===t.length)return as(t[0]);if(Ht(e))return e;const n=t.map((e=>as(e))),r=[];return n.forEach((t=>{t instanceof qt?r.push(t):t instanceof zt&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:zt.create(r,e.op)}class cs{constructor(){this.rn=new us}addToCollectionParentIndex(e,t){return this.rn.add(t),te.resolve()}getCollectionParents(e,t){return te.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return te.resolve()}deleteFieldIndex(e,t){return te.resolve()}getDocumentsMatchingTarget(e,t){return te.resolve(null)}getIndexType(e,t){return te.resolve(0)}getFieldIndexes(e,t){return te.resolve([])}getNextCollectionGroupToUpdate(e){return te.resolve(null)}getMinOffset(e,t){return te.resolve(X.min())}getMinOffsetFromCollectionGroup(e,t){return te.resolve(X.min())}updateCollectionGroup(e,t,n){return te.resolve()}updateIndexEntries(e,t){return te.resolve()}}class us{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Je(V.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Je(V.comparator)).toArray()}}const ls=new Uint8Array(0);class hs{constructor(e,t){this.user=e,this.databaseId=t,this.on=new us,this.un=new Nn((e=>un(e)),((e,t)=>ln(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.on.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.on.add(t)}));const i={collectionId:n,parent:ge(r)};return ds(e).put(i)}return te.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[M(t),""],!1,!0);return ds(e).j(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(we(r.parent))}return n}))}addFieldIndex(e,t){const n=ps(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=ms(e);return i.next((e=>{n.put(Mi(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=ps(e),r=ms(e),i=fs(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}getDocumentsMatchingTarget(e,t){const n=fs(e);let r=!0;const i=new Map;return te.forEach(this.cn(t),(t=>this.an(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=qn();const r=[];return te.forEach(i,((i,s)=>{var o;p("IndexedDbIndexManager",`Using index ${o=i,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`} to execute ${un(t)}`);const a=function(e,t){const n=$(t);if(void 0===n)return null;for(const t of dn(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),c=function(e,t){const n=new Map;for(const r of K(t))for(const t of dn(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of K(t)){const t=0===i.kind?fn(e,i.fieldPath,e.startAt):pn(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new Mt(n,r)}(s,i),l=function(e,t){const n=[];let r=!0;for(const i of K(t)){const t=0===i.kind?pn(e,i.fieldPath,e.endAt):fn(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new Mt(n,r)}(s,i),h=this.hn(i,s,u),d=this.hn(i,s,l),f=this.ln(i,s,c),m=this.fn(i.indexId,a,h,u.inclusive,d,l.inclusive,f);return te.forEach(m,(i=>n.H(i,t.limit).next((t=>{t.forEach((t=>{const n=z.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return te.resolve(null)}))}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:es(zt.create(e.filters,"and")).map((t=>cn(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.un.set(e,t),t)}fn(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),c=a/(null!=t?t.length:1),u=[];for(let l=0;l<a;++l){const a=t?this.dn(t[l/c]):ls,h=this.wn(e,a,n[l%c],r),d=this._n(e,a,i[l%c],s),f=o.map((t=>this.wn(e,a,t,!0)));u.push(...this.createRange(h,d,f))}return u}wn(e,t,n,r){const i=new Qi(e,z.empty(),t,n);return r?i:i.Je()}_n(e,t,n,r){const i=new Qi(e,z.empty(),t,n);return r?i.Je():i}an(e,t){const n=new Yi(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.tn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.cn(t);return te.forEach(r,(t=>this.an(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new Je(q.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}mn(e,t){const n=new Wi;for(const r of K(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.He(r.kind);qi.Ve._e(e,i)}return n.Qe()}dn(e){const t=new Wi;return qi.Ve._e(e,t.He(0)),t.Qe()}gn(e,t){const n=new Wi;return qi.Ve._e(It(this.databaseId,t),n.He(function(e){const t=K(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Qe()}ln(e,t,n){if(null===n)return[];let r=[];r.push(new Wi);let i=0;for(const s of K(e)){const e=n[i++];for(const n of r)if(this.yn(t,s.fieldPath)&&Tt(e))r=this.pn(r,s,e);else{const t=n.He(s.kind);qi.Ve._e(e,t)}}return this.In(r)}hn(e,t,n){return this.ln(e,t,n.position)}In(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Qe();return t}pn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new Wi;r.seed(n.Qe()),qi.Ve._e(e,r.He(t.kind)),i.push(r)}return i}yn(e,t){return!!e.filters.find((e=>e instanceof qt&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=ps(e),r=ms(e);return(t?n.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.j()).next((e=>{const t=[];return te.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new W(t.sequenceNumber,new X(Ai(t.readTime),new z(we(t.documentKey)),t.largestBatchId)):W.empty(),r=e.fields.map((([e,t])=>new H(q.fromServerFormat(e),t)));return new G(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:R(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=ps(e),i=ms(e);return this.Tn(e).next((e=>r.j("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>te.forEach(t,(t=>i.put(Mi(t.indexId,this.user,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return te.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?te.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),te.forEach(i,(n=>this.En(e,t,n).next((t=>{const i=this.An(r,n);return t.isEqual(i)?te.resolve():this.vn(e,r,n,t,i)})))))))}))}Rn(e,t,n,r){return fs(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.gn(n,t.key),documentKey:t.key.path.toArray()})}Pn(e,t,n,r){return fs(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.gn(n,t.key),t.key.path.toArray()])}En(e,t,n){const r=fs(e);let i=new Je(Xi);return r.X({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.gn(n,t)])},((e,r)=>{i=i.add(new Qi(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}An(e,t){let n=new Je(Xi);const r=this.mn(t,e);if(null==r)return n;const i=$(t);if(null!=i){const s=e.data.field(i.fieldPath);if(Tt(s))for(const i of s.arrayValue.values||[])n=n.add(new Qi(t.indexId,e.key,this.dn(i),r))}else n=n.add(new Qi(t.indexId,e.key,ls,r));return n}vn(e,t,n,r,i){p("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=Ze(s),c=Ze(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=Ze(o)):t?(i(a),a=Ze(s)):(a=Ze(s),c=Ze(o))}}(r,i,Xi,(r=>{s.push(this.Rn(e,t,n,r))}),(r=>{s.push(this.Pn(e,t,n,r))})),te.waitFor(s)}Tn(e){let t=1;return ms(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>Xi(e,t))).filter(((e,t,n)=>!t||0!==Xi(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=Xi(i,e),s=Xi(i,t);if(0===n)r[0]=e.Je();else if(n>0&&s<0)r.push(i),r.push(i.Je());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.bn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,ls,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,ls,[]];i.push(IDBKeyRange.bound(t,n))}return i}bn(e,t){return Xi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(gs)}getMinOffset(e,t){return te.mapArray(this.cn(t),(t=>this.an(e,t).next((e=>e||v())))).next(gs)}}function ds(e){return Ge(e,"collectionParents")}function fs(e){return Ge(e,"indexEntries")}function ps(e){return Ge(e,"indexConfiguration")}function ms(e){return Ge(e,"indexState")}function gs(e){w(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;J(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new X(t.readTime,t.documentKey,n)}const ys={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class vs{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new vs(e,vs.DEFAULT_COLLECTION_PERCENTILE,vs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function ws(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.X({range:o},((e,t,n)=>(a++,n.delete())));s.push(c.next((()=>{w(1===a)})));const u=[];for(const e of n.mutations){const r=Ee(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return te.waitFor(s).next((()=>u))}function bs(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw v();t=e.noDocument}return JSON.stringify(t).length}vs.DEFAULT_COLLECTION_PERCENTILE=10,vs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,vs.DEFAULT=new vs(41943040,vs.DEFAULT_COLLECTION_PERCENTILE,vs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),vs.DISABLED=new vs(-1,0,0);class Is{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Vn={}}static de(e,t,n,r){w(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Is(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ts(e).X({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=_s(e),s=Ts(e);return s.add({}).next((o=>{w("number"==typeof o);const a=new Er(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>li(e.fe,t))),i=n.mutations.map((t=>li(e.fe,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,a),u=[];let l=new Je(((e,t)=>R(e.canonicalString(),t.canonicalString())));for(const e of r){const t=Ee(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,Te))}return l.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Vn[o]=a.keys()})),te.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return Ts(e).get(t).next((e=>e?(w(e.userId===this.userId),Di(this.serializer,e)):null))}Sn(e,t){return this.Vn[t]?te.resolve(this.Vn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.Vn[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Ts(e).X({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(w(t.batchId>=n),i=Di(this.serializer,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Ts(e).X({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ts(e).j("userMutationsIndex",t).next((e=>e.map((e=>Di(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Ie(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return _s(e).X({range:r},((n,r,s)=>{const[o,a,c]=n,u=we(a);if(o===this.userId&&t.path.isEqual(u))return Ts(e).get(c).next((e=>{if(!e)throw v();w(e.userId===this.userId),i.push(Di(this.serializer,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Je(R);const r=[];return t.forEach((t=>{const i=Ie(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=_s(e).X({range:s},((e,r,i)=>{const[s,o,a]=e,c=we(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),te.waitFor(r).next((()=>this.Dn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=Ie(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new Je(R);return _s(e).X({range:s},((e,t,i)=>{const[s,a,c]=e,u=we(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.Dn(e,o)))}Dn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(Ts(e).get(t).next((e=>{if(null===e)throw v();w(e.userId===this.userId),n.push(Di(this.serializer,e))})))})),te.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return ws(e.ht,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.Cn(t.batchId)})),te.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}Cn(e){delete this.Vn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return te.resolve();const n=IDBKeyRange.lowerBound([this.userId]),r=[];return _s(e).X({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=we(e[1]);r.push(t)}else n.done()})).next((()=>{w(0===r.length)}))}))}containsKey(e,t){return Es(e,this.userId,t)}xn(e){return Cs(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Es(e,t,n){const r=Ie(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return _s(e).X({range:s,Y:!0},((e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()})).next((()=>o))}function Ts(e){return Ge(e,"mutations")}function _s(e){return Ge(e,"documentMutations")}function Cs(e){return Ge(e,"mutationQueues")}class xs{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new xs(0)}static Mn(){return new xs(-1)}}class Ss{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.$n(e).next((t=>{const n=new xs(t.highestTargetId);return t.highestTargetId=n.next(),this.On(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.$n(e).next((e=>B.fromTimestamp(new F(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.$n(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.$n(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.On(e,r))))}addTargetData(e,t){return this.Fn(e,t).next((()=>this.$n(e).next((n=>(n.targetCount+=1,this.Bn(t,n),this.On(e,n))))))}updateTargetData(e,t){return this.Fn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>ks(e).delete(t.targetId))).next((()=>this.$n(e))).next((t=>(w(t.targetCount>0),t.targetCount-=1,this.On(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return ks(e).X(((s,o)=>{const a=Ni(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>te.waitFor(i))).next((()=>r))}forEachTarget(e,t){return ks(e).X(((e,n)=>{const r=Ni(n);t(r)}))}$n(e){return As(e).get("targetGlobalKey").next((e=>(w(null!==e),e)))}On(e,t){return As(e).put("targetGlobalKey",t)}Fn(e,t){return ks(e).put(Pi(this.serializer,t))}Bn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.$n(e).next((e=>e.targetCount))}getTargetData(e,t){const n=un(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return ks(e).X({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const s=Ni(n);ln(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=Ds(e);return t.forEach((t=>{const s=ge(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),te.waitFor(r)}removeMatchingKeys(e,t,n){const r=Ds(e);return te.forEach(t,(t=>{const i=ge(t.path);return te.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=Ds(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Ds(e);let i=qn();return r.X({range:n,Y:!0},((e,t,n)=>{const r=we(e[1]),s=new z(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=ge(t.path),r=IDBKeyRange.bound([n],[M(n)],!1,!0);let i=0;return Ds(e).X({index:"documentTargetsIndex",Y:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}le(e,t){return ks(e).get(t).next((e=>e?Ni(e):null))}}function ks(e){return Ge(e,"targets")}function As(e){return Ge(e,"targetGlobal")}function Ds(e){return Ge(e,"targetDocuments")}function Ns([e,t],[n,r]){const i=R(e,n);return 0===i?R(t,r):i}class Ps{constructor(e){this.Ln=e,this.buffer=new Je(Ns),this.qn=0}Un(){return++this.qn}Kn(e){const t=[e,this.Un()];if(this.buffer.size<this.Ln)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Ns(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Ls{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Qn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}Qn(e){p("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){oe(e)?p("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await ee(e)}await this.Qn(3e5)}))}}class Rs{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.zn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return te.resolve(fe.ct);const n=new Ps(t);return this.jn.forEachTarget(e,(e=>n.Kn(e.sequenceNumber))).next((()=>this.jn.Wn(e,(e=>n.Kn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(p("LruGarbageCollector","Garbage collection skipped; disabled"),te.resolve(ys)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(p("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ys):this.Hn(e,t)))}getCacheSize(e){return this.jn.getCacheSize(e)}Hn(e,t){let n,r,i,o,a,c,u;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(p("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,o=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,a=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,c=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(u=Date.now(),f()<=s.$b.DEBUG&&p("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${r} in `+(a-o)+"ms\n"+`\tRemoved ${i} targets in `+(c-a)+"ms\n"+`\tRemoved ${e} documents in `+(u-c)+"ms\n"+`Total Duration: ${u-l}ms`),te.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}class Os{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new Rs(e,t)}(this,t)}zn(e){const t=this.Jn(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Jn(e){let t=0;return this.Wn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Wn(e,t){return this.Yn(e,((e,n)=>t(n)))}addReference(e,t,n){return Ms(e,n)}removeReference(e,t,n){return Ms(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Ms(e,t)}Xn(e,t){return function(e,t){let n=!1;return Cs(e).Z((r=>Es(e,r,t).next((e=>(e&&(n=!0),te.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Yn(e,((s,o)=>{if(o<=t){const t=this.Xn(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,B.min()),Ds(e).delete([0,ge(s.path)]))))}));r.push(t)}})).next((()=>te.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Ms(e,t)}Yn(e,t){const n=Ds(e);let r,i=fe.ct;return n.X({index:"documentTargetsIndex"},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==fe.ct&&t(new z(we(r)),i),i=o,r=s):i=fe.ct})).next((()=>{i!==fe.ct&&t(new z(we(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Ms(e,t){return Ds(e).put(function(e,t){return{targetId:0,path:ge(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class Fs{constructor(){this.changes=new Nn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ot.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?te.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Bs{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return qs(e).put(n)}removeEntry(e,t,n){return qs(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Si(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Zn(e,n))))}getEntry(e,t){let n=Ot.newInvalidDocument(t);return qs(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(zs(t))},((e,r)=>{n=this.ts(t,r)})).next((()=>n))}es(e,t){let n={size:0,document:Ot.newInvalidDocument(t)};return qs(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(zs(t))},((e,r)=>{n={document:this.ts(t,r),size:bs(r)}})).next((()=>n))}getEntries(e,t){let n=Ln();return this.ns(e,t,((e,t)=>{const r=this.ts(e,t);n=n.insert(e,r)})).next((()=>n))}ss(e,t){let n=Ln(),r=new We(z.comparator);return this.ns(e,t,((e,t)=>{const i=this.ts(e,t);n=n.insert(e,i),r=r.insert(e,bs(t))})).next((()=>({documents:n,rs:r})))}ns(e,t,n){if(t.isEmpty())return te.resolve();let r=new Je($s);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(zs(r.first()),zs(r.last())),s=r.getIterator();let o=s.getNext();return qs(e).X({index:"documentKeyIndex",range:i},((e,t,r)=>{const i=z.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&$s(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.G(zs(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r){const i=t.path,s=[i.popLast().toArray(),i.lastSegment(),Si(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return qs(e).j(IDBKeyRange.bound(s,o,!0)).next((e=>{let n=Ln();for(const i of e){const e=this.ts(z.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(kn(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let i=Ln();const s=Gs(t,n),o=Gs(t,X.max());return qs(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((e,t,n)=>{const s=this.ts(z.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new Vs(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return js(e).get("remoteDocumentGlobalKey").next((e=>(w(!!e),e)))}Zn(e,t){return js(e).put("remoteDocumentGlobalKey",t)}ts(e,t){if(t){const e=function(e,t){let n;if(t.document)n=function(e,t,n){const r=ii(e,t.name),i=ei(t.updateTime),s=t.createTime?ei(t.createTime):B.min(),o=new Lt({mapValue:{fields:t.fields}}),a=Ot.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}(e.fe,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=z.fromSegments(t.noDocument.path),r=Ai(t.noDocument.readTime);n=Ot.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return v();{const e=z.fromSegments(t.unknownDocument.path),r=Ai(t.unknownDocument.version);n=Ot.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new F(e[0],e[1]);return B.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(B.min()))return e}return Ot.newInvalidDocument(e)}}function Us(e){return new Bs(e)}class Vs extends Fs{constructor(e,t){super(),this.os=e,this.trackRemovals=t,this.us=new Nn((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new Je(((e,t)=>R(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.us.get(i);if(t.push(this.os.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=xi(this.os.serializer,s);r=r.add(i.path.popLast());const c=bs(a);n+=c-o.size,t.push(this.os.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=xi(this.os.serializer,s.convertToNoDocument(B.min()));t.push(this.os.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.os.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.os.updateMetadata(e,n)),te.waitFor(t)}getFromCache(e,t){return this.os.es(e,t).next((e=>(this.us.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.os.ss(e,t).next((({documents:e,rs:t})=>(t.forEach(((t,n)=>{this.us.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function js(e){return Ge(e,"remoteDocumentGlobal")}function qs(e){return Ge(e,"remoteDocumentsV14")}function zs(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Gs(e,t){const n=t.documentKey.path.toArray();return[e,Si(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function $s(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=R(n[e],r[e]),i)return i;return i=R(n.length,r.length),i||(i=R(n[n.length-2],r[r.length-2]),i||R(n[n.length-1],r[r.length-1]))}class Ks{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Hs{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&dr(n.mutation,e,et.empty(),F.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,qn()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=qn()){const r=Fn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=On();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Fn();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,qn())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=Ln();const s=Un(),o=Un();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof gr)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),dr(o.mutation,t,o.mutation.getFieldMask(),F.now())):s.set(t.key,et.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new Ks(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=Un();let r=new We(((e,t)=>e-t)),i=qn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||et.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||qn()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Bn();c.forEach((e=>{if(!i.has(e)){const r=lr(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return te.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return z.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):bn(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):te.resolve(Fn());let o=-1,a=i;return s.next((t=>te.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?te.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,qn()))).next((e=>({batchId:o,changes:Mn(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new z(t)).next((e=>{let t=On();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const r=t.collectionGroup;let i=On();return this.indexManager.getCollectionParents(e,r).next((s=>te.forEach(s,(s=>{const o=function(e,t){return new mn(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r)))).next((e=>{r.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Ot.newInvalidDocument(r)))}));let n=On();return e.forEach(((e,i)=>{const s=r.get(e);void 0!==s&&dr(s.mutation,i,et.empty(),F.now()),kn(t,i)&&(n=n.insert(e,i))})),n}))}}class Ws{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return te.resolve(this.cs.get(t))}saveBundleMetadata(e,t){var n;return this.cs.set(t.id,{id:(n=t).id,version:n.version,createTime:ei(n.createTime)}),te.resolve()}getNamedQuery(e,t){return te.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,function(e){return{name:e.name,query:Li(e.bundledQuery),readTime:ei(e.readTime)}}(t)),te.resolve()}}class Qs{constructor(){this.overlays=new We(z.comparator),this.ls=new Map}getOverlay(e,t){return te.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Fn();return te.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.we(e,t,r)})),te.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.ls.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.ls.delete(n)),te.resolve()}getOverlaysForCollection(e,t,n){const r=Fn(),i=t.length+1,s=new z(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return te.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new We(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Fn(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Fn(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return te.resolve(o)}we(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.ls.get(r.largestBatchId).delete(n.key);this.ls.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new _r(t,n));let i=this.ls.get(t);void 0===i&&(i=qn(),this.ls.set(t,i)),this.ls.set(t,i.add(n.key))}}class Xs{constructor(){this.fs=new Je(Js.ds),this.ws=new Je(Js._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){const n=new Js(e,t);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.ys(new Js(e,t))}ps(e,t){e.forEach((e=>this.removeReference(e,t)))}Is(e){const t=new z(new V([])),n=new Js(t,e),r=new Js(t,e+1),i=[];return this.ws.forEachInRange([n,r],(e=>{this.ys(e),i.push(e.key)})),i}Ts(){this.fs.forEach((e=>this.ys(e)))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const t=new z(new V([])),n=new Js(t,e),r=new Js(t,e+1);let i=qn();return this.ws.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new Js(e,0),n=this.fs.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Js{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return z.comparator(e.key,t.key)||R(e.As,t.As)}static _s(e,t){return R(e.As,t.As)||z.comparator(e.key,t.key)}}class Ys{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new Je(Js.ds)}checkEmpty(e){return te.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Er(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.Rs=this.Rs.add(new Js(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return te.resolve(s)}lookupMutationBatch(e,t){return te.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.bs(n),i=r<0?0:r;return te.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return te.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return te.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Js(t,0),r=new Js(t,Number.POSITIVE_INFINITY),i=[];return this.Rs.forEachInRange([n,r],(e=>{const t=this.Ps(e.As);i.push(t)})),te.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Je(R);return t.forEach((e=>{const t=new Js(e,0),r=new Js(e,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([t,r],(e=>{n=n.add(e.As)}))})),te.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;z.isDocumentKey(i)||(i=i.child(""));const s=new Js(new z(i),0);let o=new Je(R);return this.Rs.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.As)),!0)}),s),te.resolve(this.Vs(o))}Vs(e){const t=[];return e.forEach((e=>{const n=this.Ps(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){w(0===this.Ss(t.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return te.forEach(t.mutations,(r=>{const i=new Js(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Rs=n}))}Cn(e){}containsKey(e,t){const n=new Js(t,0),r=this.Rs.firstAfterOrEqual(n);return te.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,te.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){const t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Zs{constructor(e){this.Ds=e,this.docs=new We(z.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Ds(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return te.resolve(n?n.document.mutableCopy():Ot.newInvalidDocument(t))}getEntries(e,t){let n=Ln();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Ot.newInvalidDocument(e))})),te.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Ln();const s=t.path,o=new z(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||J(Q(o),n)<=0||(r.has(o.key)||kn(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return te.resolve(i)}getAllFromCollectionGroup(e,t,n,r){v()}Cs(e,t){return te.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new eo(this)}getSize(e){return te.resolve(this.size)}}class eo extends Fs{constructor(e){super(),this.os=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.os.addEntry(e,r)):this.os.removeEntry(n)})),te.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class to{constructor(e){this.persistence=e,this.xs=new Nn((e=>un(e)),ln),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.Ns=0,this.ks=new Xs,this.targetCount=0,this.Ms=xs.kn()}forEachTarget(e,t){return this.xs.forEach(((e,n)=>t(n))),te.resolve()}getLastRemoteSnapshotVersion(e){return te.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return te.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),te.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ns&&(this.Ns=t),te.resolve()}Fn(e){this.xs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ms=new xs(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,te.resolve()}updateTargetData(e,t){return this.Fn(t),te.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,te.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.xs.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.xs.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),te.waitFor(i).next((()=>r))}getTargetCount(e){return te.resolve(this.targetCount)}getTargetData(e,t){const n=this.xs.get(t)||null;return te.resolve(n)}addMatchingKeys(e,t,n){return this.ks.gs(t,n),te.resolve()}removeMatchingKeys(e,t,n){this.ks.ps(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),te.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),te.resolve()}getMatchingKeysForTargetId(e,t){const n=this.ks.Es(t);return te.resolve(n)}containsKey(e,t){return te.resolve(this.ks.containsKey(t))}}class no{constructor(e,t){this.$s={},this.overlays={},this.Os=new fe(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new to(this),this.indexManager=new cs,this.remoteDocumentCache=function(e){return new Zs(e)}((e=>this.referenceDelegate.Ls(e))),this.serializer=new Ci(t),this.qs=new Ws(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Qs,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.$s[e.toKey()];return n||(n=new Ys(t,this.referenceDelegate),this.$s[e.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,n){p("MemoryPersistence","Starting transaction:",e);const r=new ro(this.Os.next());return this.referenceDelegate.Us(),n(r).next((e=>this.referenceDelegate.Ks(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gs(e,t){return te.or(Object.values(this.$s).map((n=>()=>n.containsKey(e,t))))}}class ro extends Z{constructor(e){super(),this.currentSequenceNumber=e}}class io{constructor(e){this.persistence=e,this.Qs=new Xs,this.js=null}static zs(e){return new io(e)}get Ws(){if(this.js)return this.js;throw v()}addReference(e,t,n){return this.Qs.addReference(n,t),this.Ws.delete(n.toString()),te.resolve()}removeReference(e,t,n){return this.Qs.removeReference(n,t),this.Ws.add(n.toString()),te.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),te.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach((e=>this.Ws.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Ws.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Us(){this.js=new Set}Ks(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return te.forEach(this.Ws,(n=>{const r=z.fromPath(n);return this.Hs(e,r).next((e=>{e||t.removeEntry(r,B.min())}))})).next((()=>(this.js=null,t.apply(e))))}updateLimboDocument(e,t){return this.Hs(e,t).next((e=>{e?this.Ws.delete(t.toString()):this.Ws.add(t.toString())}))}Ls(e){return 0}Hs(e,t){return te.or([()=>te.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class so{constructor(e){this.serializer=e}O(e,t,n,r){const i=new ne("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",be,{unique:!0}),e.createObjectStore("documentMutations")}(e),oo(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=te.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),oo(e)),s=s.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:B.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store("mutations").j().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",be,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return te.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Ys(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.Xs(i))))),n<7&&r>=7&&(s=s.next((()=>this.Zs(i)))),n<8&&r>=8&&(s=s.next((()=>this.ti(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.ei(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:Oe});t.createIndex("collectionPathOverlayIndex",Me,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",Fe,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:_e});t.createIndex("documentKeyIndex",Ce),t.createIndex("collectionGroupIndex",xe)}(e))).next((()=>this.ni(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>this.si(e,i)))),n<15&&r>=15&&(s=s.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Ne}).createIndex("sequenceNumberIndex",Pe,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Le}).createIndex("documentKeyIndex",Re,{unique:!1})}(e)))),s}Xs(e){let t=0;return e.store("remoteDocuments").X(((e,n)=>{t+=bs(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Ys(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.j().next((t=>te.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.j("userMutationsIndex",r).next((n=>te.forEach(n,(n=>{w(n.userId===t.userId);const r=Di(this.serializer,n);return ws(e,t.userId,r).next((()=>{}))}))))}))))}Zs(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.X(((n,i)=>{const s=new V(n),o=function(e){return[0,ge(e)]}(s);r.push(t.get(o).next((n=>n?te.resolve():(n=>t.put({targetId:0,path:ge(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>te.waitFor(r)))}))}ti(e,t){e.createObjectStore("collectionParents",{keyPath:De});const n=t.store("collectionParents"),r=new us,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:ge(r)})}};return t.store("remoteDocuments").X({Y:!0},((e,t)=>{const n=new V(e);return i(n.popLast())})).next((()=>t.store("documentMutations").X({Y:!0},(([e,t,n],r)=>{const s=we(t);return i(s.popLast())}))))}ei(e){const t=e.store("targets");return t.X(((e,n)=>{const r=Ni(n),i=Pi(this.serializer,r);return t.put(i)}))}ni(e,t){const n=t.store("remoteDocuments"),r=[];return n.X(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=(o=n,o.document?new z(V.fromString(o.document.name).popFirst(5)):o.noDocument?z.fromSegments(o.noDocument.path):o.unknownDocument?z.fromSegments(o.unknownDocument.path):v()).path.toArray();var o;const a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))})).next((()=>te.waitFor(r)))}si(e,t){const n=t.store("mutations"),r=Us(this.serializer),i=new no(io.zs,this.serializer.fe);return n.j().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:qn();Di(this.serializer,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),te.forEach(n,((e,n)=>{const s=new l(n),o=Vi.de(this.serializer,s),a=i.getIndexManager(s),c=Is.de(s,this.serializer,a,i.referenceDelegate);return new Hs(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new ze(t,fe.ct),e).next()}))}))}}function oo(e){e.createObjectStore("targetDocuments",{keyPath:ke}).createIndex("documentTargetsIndex",Ae,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Se,{unique:!0}),e.createObjectStore("targetGlobal")}const ao="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class co{constructor(e,t,n,r,i,s,o,a,c,u,l=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ii=i,this.window=s,this.document=o,this.ri=c,this.oi=u,this.ui=l,this.Os=null,this.Fs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.ai=null,this.hi=null,this.li=Number.NEGATIVE_INFINITY,this.fi=e=>Promise.resolve(),!co.D())throw new E(I.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Os(this,r),this.di=t+"main",this.serializer=new Ci(a),this.wi=new re(this.di,this.ui,new so(this.serializer)),this.Bs=new Ss(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Us(this.serializer),this.qs=new Fi,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===u&&m("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new E(I.FAILED_PRECONDITION,ao);return this.gi(),this.yi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Bs.getHighestSequenceNumber(e)))})).then((e=>{this.Os=new fe(e,this.ri)})).then((()=>{this.Fs=!0})).catch((e=>(this.wi&&this.wi.close(),Promise.reject(e))))}Ii(e){return this.fi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.wi.B((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ii.enqueueAndForget((async()=>{this.started&&await this.mi()})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>lo(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Ti(e).next((e=>{e||(this.isPrimary=!1,this.ii.enqueueRetryable((()=>this.fi(!1))))}))})).next((()=>this.Ei(e))).next((t=>this.isPrimary&&!t?this.Ai(e).next((()=>!1)):!!t&&this.vi(e).next((()=>!0)))))).catch((e=>{if(oe(e))return p("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return p("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.ii.enqueueRetryable((()=>this.fi(e))),this.isPrimary=e}))}Ti(e){return uo(e).get("owner").next((e=>te.resolve(this.Ri(e))))}Pi(e){return lo(e).delete(this.clientId)}async bi(){if(this.isPrimary&&!this.Vi(this.li,18e5)){this.li=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=Ge(e,"clientMetadata");return t.j().next((e=>{const n=this.Si(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return te.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this._i)for(const t of e)this._i.removeItem(this.Di(t.clientId))}}pi(){this.hi=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.mi().then((()=>this.bi())).then((()=>this.pi()))))}Ri(e){return!!e&&e.ownerId===this.clientId}Ei(e){return this.oi?te.resolve(!0):uo(e).get("owner").next((t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)){if(this.Ri(t)&&this.networkEnabled)return!0;if(!this.Ri(t)){if(!t.allowTabSynchronization)throw new E(I.FAILED_PRECONDITION,ao);return!1}}return!(!this.networkEnabled||!this.inForeground)||lo(e).j().next((e=>void 0===this.Si(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&p("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.Fs=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Ni(),this.ki(),await this.wi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new ze(e,fe.ct);return this.Ai(t).next((()=>this.Pi(t)))})),this.wi.close(),this.Mi()}Si(e,t){return e.filter((e=>this.Vi(e.updateTimeMs,t)&&!this.Ci(e.clientId)))}$i(){return this.runTransaction("getActiveClients","readonly",(e=>lo(e).j().next((e=>this.Si(e,18e5).map((e=>e.clientId))))))}get started(){return this.Fs}getMutationQueue(e,t){return Is.de(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new hs(e,this.serializer.fe.databaseId)}getDocumentOverlayCache(e){return Vi.de(this.serializer,e)}getBundleCache(){return this.qs}runTransaction(e,t,n){p("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=15===(s=this.ui)?qe:14===s?je:13===s?Ve:12===s?Ue:11===s?Be:void v();var s;let o;return this.wi.runTransaction(e,r,i,(r=>(o=new ze(r,this.Os?this.Os.next():fe.ct),"readwrite-primary"===t?this.Ti(o).next((e=>!!e||this.Ei(o))).next((t=>{if(!t)throw m(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ii.enqueueRetryable((()=>this.fi(!1))),new E(I.FAILED_PRECONDITION,Y);return n(o)})).next((e=>this.vi(o).next((()=>e)))):this.Oi(o).next((()=>n(o)))))).then((e=>(o.raiseOnCommittedEvent(),e)))}Oi(e){return uo(e).get("owner").next((e=>{if(null!==e&&this.Vi(e.leaseTimestampMs,5e3)&&!this.Ci(e.ownerId)&&!this.Ri(e)&&!(this.oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new E(I.FAILED_PRECONDITION,ao)}))}vi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return uo(e).put("owner",t)}static D(){return re.D()}Ai(e){const t=uo(e);return t.get("owner").next((e=>this.Ri(e)?(p("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):te.resolve()))}Vi(e,t){const n=Date.now();return!(e<n-t||e>n&&(m(`Detected an update time that is in the future: ${e} > ${n}`),1))}gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ai=()=>{this.ii.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.mi())))},this.document.addEventListener("visibilitychange",this.ai),this.inForeground="visible"===this.document.visibilityState)}Ni(){this.ai&&(this.document.removeEventListener("visibilitychange",this.ai),this.ai=null)}yi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const e=/(?:Version|Mobile)\/1[456]/;(0,o.nr)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.ii.enterRestrictedMode(!0),this.ii.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ci))}ki(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Ci(e){var t;try{const n=null!==(null===(t=this._i)||void 0===t?void 0:t.getItem(this.Di(e)));return p("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return m("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this._i)try{this._i.setItem(this.Di(this.clientId),String(Date.now()))}catch(e){m("Failed to set zombie client id.",e)}}Mi(){if(this._i)try{this._i.removeItem(this.Di(this.clientId))}catch(e){}}Di(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function uo(e){return Ge(e,"owner")}function lo(e){return Ge(e,"clientMetadata")}class ho{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Fi=n,this.Bi=r}static Li(e,t){let n=qn(),r=qn();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new ho(e,t.fromCache,n,r)}}class fo{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,n,r){return this.Ki(e,t).next((i=>i||this.Gi(e,t,r,n))).next((n=>n||this.Qi(e,t)))}Ki(e,t){if(yn(t))return te.resolve(null);let n=En(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=_n(t,null,"F"),n=En(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=qn(...r);return this.Ui.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.ji(t,r);return this.zi(t,s,i,n.readTime)?this.Ki(e,_n(t,null,"F")):this.Wi(e,s,t,n)}))))})))))}Gi(e,t,n,r){return yn(t)||r.isEqual(B.min())?this.Qi(e,t):this.Ui.getDocuments(e,n).next((i=>{const o=this.ji(t,i);return this.zi(t,o,n,r)?this.Qi(e,t):(f()<=s.$b.DEBUG&&p("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Sn(t)),this.Wi(e,o,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=B.fromTimestamp(1e9===r?new F(n+1,0):new F(n,r));return new X(i,z.empty(),t)}(r,-1)))}))}ji(e,t){let n=new Je(An(e));return t.forEach(((t,r)=>{kn(e,r)&&(n=n.add(r))})),n}zi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Qi(e,t){return f()<=s.$b.DEBUG&&p("QueryEngine","Using full collection scan to execute query:",Sn(t)),this.Ui.getDocumentsMatchingQuery(e,t,X.min())}Wi(e,t,n,r){return this.Ui.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class po{constructor(e,t,n,r){this.persistence=e,this.Hi=t,this.serializer=r,this.Ji=new We(R),this.Yi=new Nn((e=>un(e)),ln),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(n)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Hs(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ji)))}}function mo(e,t,n,r){return new po(e,t,n,r)}async function go(e,t){const n=b(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.tr(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=qn();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({er:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function yo(e){const t=b(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Bs.getLastRemoteSnapshotVersion(e)))}function vo(e,t){const n=b(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}async function wo(e,t,n){const r=b(e),i=r.Ji.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!oe(e))throw e;p("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ji=r.Ji.remove(t),r.Yi.delete(i.target)}function bo(e,t,n){const r=b(e);let i=B.min(),s=qn();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=b(e),i=r.Yi.get(n);return void 0!==i?te.resolve(r.Ji.get(i)):r.Bs.getTargetData(t,n)}(r,e,En(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Bs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.Hi.getDocumentsMatchingQuery(e,t,n?i:B.min(),n?s:qn()))).next((e=>(function(e,t,n){let r=e.Xi.get(t)||B.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Xi.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,ir:s})))))}class Io{constructor(){this.activeTargetIds=zn}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Eo{constructor(){this.Hr=new Io,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,n){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new Io,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class To{Yr(e){}shutdown(){}}class _o{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){p("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){p("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Co=null;function xo(){return null===Co?Co=268435456+Math.round(2147483648*Math.random()):Co++,"0x"+Co.toString(16)}const So={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ko{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}const Ao="WebChannelConnection";class Do extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.mo=t+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,n,r,i){const s=xo(),o=this.To(e,t);p("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const a={};return this.Eo(a,r,i),this.Ao(e,o,a,n).then((t=>(p("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw g("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,r,i,s){return this.Io(e,t,n,r,i)}Eo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+h,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}To(e,t){const n=So[e];return`${this.mo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,n,r){const i=xo();return new Promise(((s,o)=>{const c=new a.ZS;c.setWithCredentials(!0),c.listenOnce(a.Bx.COMPLETE,(()=>{try{switch(c.getLastErrorCode()){case a.O4.NO_ERROR:const t=c.getResponseJson();p(Ao,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case a.O4.TIMEOUT:p(Ao,`RPC '${e}' ${i} timed out`),o(new E(I.DEADLINE_EXCEEDED,"Request time out"));break;case a.O4.HTTP_ERROR:const n=c.getStatus();if(p(Ao,`RPC '${e}' ${i} failed with status:`,n,"response text:",c.getResponseText()),n>0){let e=c.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(I).indexOf(t)>=0?t:I.UNKNOWN}(t.status);o(new E(e,t.message))}else o(new E(I.UNKNOWN,"Server responded with status "+c.getStatus()))}else o(new E(I.UNAVAILABLE,"Connection failed."));break;default:v()}}finally{p(Ao,`RPC '${e}' ${i} completed.`)}}));const u=JSON.stringify(r);p(Ao,`RPC '${e}' ${i} sending request:`,r),c.send(t,"POST",u,n,15)}))}Ro(e,t,n){const r=xo(),i=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=(0,a.fF)(),o=(0,a.Ao)(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;void 0!==u&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.xmlHttpFactory=new a._L({})),this.Eo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;const l=i.join("");p(Ao,`Creating RPC '${e}' stream ${r}: ${l}`,c);const h=s.createWebChannel(l,c);let d=!1,f=!1;const m=new ko({ro:t=>{f?p(Ao,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(d||(p(Ao,`Opening RPC '${e}' stream ${r} transport.`),h.open(),d=!0),p(Ao,`RPC '${e}' stream ${r} sending:`,t),h.send(t))},oo:()=>h.close()}),y=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return y(h,a.iO.EventType.OPEN,(()=>{f||p(Ao,`RPC '${e}' stream ${r} transport opened.`)})),y(h,a.iO.EventType.CLOSE,(()=>{f||(f=!0,p(Ao,`RPC '${e}' stream ${r} transport closed`),m.wo())})),y(h,a.iO.EventType.ERROR,(t=>{f||(f=!0,g(Ao,`RPC '${e}' stream ${r} transport errored:`,t),m.wo(new E(I.UNAVAILABLE,"The operation could not be completed")))})),y(h,a.iO.EventType.MESSAGE,(t=>{var n;if(!f){const i=t.data[0];w(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){p(Ao,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=xr[e];if(void 0!==t)return Ar(t)}(t),i=o.message;void 0===n&&(n=I.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),f=!0,m.wo(new E(n,i)),h.close()}else p(Ao,`RPC '${e}' stream ${r} received:`,i),m._o(i)}})),y(o,a.Jh.STAT_EVENT,(t=>{t.stat===a.ro.PROXY?p(Ao,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===a.ro.NOPROXY&&p(Ao,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{m.fo()}),0),m}}function No(){return"undefined"!=typeof document?document:null}function Po(e){return new Qr(e,!0)}class Lo{constructor(e,t,n=1e3,r=1.5,i=6e4){this.ii=e,this.timerId=t,this.Po=n,this.bo=r,this.Vo=i,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const t=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),r=Math.max(0,t-n);r>0&&p("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,r,(()=>(this.Co=Date.now(),e()))),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class Ro{constructor(e,t,n,r,i,s,o,a){this.ii=e,this.$o=n,this.Oo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new Lo(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,(()=>this.zo())))}Wo(e){this.Ho(),this.stream.send(e)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(e,t){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==e?this.qo.reset():t&&t.code===I.RESOURCE_EXHAUSTED?(m(t.toString()),m("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):t&&t.code===I.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.ao(t)}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Fo===t&&this.Zo(e,n)}),(t=>{e((()=>{const e=new E(I.UNKNOWN,"Fetching auth token failed: "+t.message);return this.tu(e)}))}))}Zo(e,t){const n=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo((()=>{n((()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,(()=>(this.Ko()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.ao((e=>{n((()=>this.tu(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Go(){this.state=5,this.qo.No((async()=>{this.state=0,this.start()}))}tu(e){return p("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget((()=>this.Fo===e?t():(p("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Oo extends Ro{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:v()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(w(void 0===t||"string"==typeof t),nt.fromBase64String(t||"")):(w(void 0===t||t instanceof Uint8Array),nt.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?I.UNKNOWN:Ar(e.code);return new E(t,e.message||"")}(o);n=new jr(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=ii(e,r.document.name),s=ei(r.document.updateTime),o=r.document.createTime?ei(r.document.createTime):B.min(),a=new Lt({mapValue:{fields:r.document.fields}}),c=Ot.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new Ur(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=ii(e,r.document),s=r.readTime?ei(r.readTime):B.min(),o=Ot.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Ur([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=ii(e,r.document),s=r.removedTargetIds||[];n=new Ur([],s,i,null)}else{if(!("filter"in t))return v();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new Cr(r,i),o=e.targetId;n=new Vr(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return B.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?B.min():t.readTime?ei(t.readTime):B.min()}(e);return this.listener.nu(t,n)}su(e){const t={};t.database=ai(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=hn(r)?{documents:di(e,r)}:{query:fi(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Yr(e,t.resumeToken);const r=Xr(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(B.min())>0){n.readTime=Jr(e,t.snapshotVersion.toTimestamp());const r=Xr(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return v()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Wo(t)}iu(e){const t={};t.database=ai(this.serializer),t.removeTarget=e,this.Wo(t)}}class Mo extends Ro{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){if(w(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const t=function(e,t){return e&&e.length>0?(w(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?ei(e.updateTime):ei(t);return n.isEqual(B.min())&&(n=ei(t)),new or(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=ei(e.commitTime);return this.listener.cu(n,t)}return w(!e.writeResults||0===e.writeResults.length),this.ru=!0,this.listener.au()}hu(){const e={};e.database=ai(this.serializer),this.Wo(e)}uu(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>li(this.serializer,e)))};this.Wo(t)}}class Fo extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.lu=!1}fu(){if(this.lu)throw new E(I.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.Io(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===I.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new E(I.UNKNOWN,e.toString())}))}vo(e,t,n,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.vo(e,t,n,i,s,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===I.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new E(I.UNKNOWN,e.toString())}))}terminate(){this.lu=!0}}class Bo{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve()))))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(m(t),this.mu=!1):p("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class Uo{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=i,this.Pu.Yr((e=>{n.enqueueAndForget((async()=>{Wo(this)&&(p("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=b(e);t.vu.add(4),await jo(t),t.bu.set("Unknown"),t.vu.delete(4),await Vo(t)}(this))}))})),this.bu=new Bo(n,r)}}async function Vo(e){if(Wo(e))for(const t of e.Ru)await t(!0)}async function jo(e){for(const t of e.Ru)await t(!1)}function qo(e,t){const n=b(e);n.Au.has(t.targetId)||(n.Au.set(t.targetId,t),Ho(n)?Ko(n):ha(n).Ko()&&Go(n,t))}function zo(e,t){const n=b(e),r=ha(n);n.Au.delete(t),r.Ko()&&$o(n,t),0===n.Au.size&&(r.Ko()?r.jo():Wo(n)&&n.bu.set("Unknown"))}function Go(e,t){if(e.Vu.qt(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(B.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}ha(e).su(t)}function $o(e,t){e.Vu.qt(t),ha(e).iu(t)}function Ko(e){e.Vu=new zr({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),le:t=>e.Au.get(t)||null,ue:()=>e.datastore.serializer.databaseId}),ha(e).start(),e.bu.gu()}function Ho(e){return Wo(e)&&!ha(e).Uo()&&e.Au.size>0}function Wo(e){return 0===b(e).vu.size}function Qo(e){e.Vu=void 0}async function Xo(e){e.Au.forEach(((t,n)=>{Go(e,t)}))}async function Jo(e,t){Qo(e),Ho(e)?(e.bu.Iu(t),Ko(e)):e.bu.set("Unknown")}async function Yo(e,t,n){if(e.bu.set("Online"),t instanceof jr&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Au.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Au.delete(r),e.Vu.removeTarget(r))}(e,t)}catch(n){p("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Zo(e,n)}else if(t instanceof Ur?e.Vu.Ht(t):t instanceof Vr?e.Vu.ne(t):e.Vu.Xt(t),!n.isEqual(B.min()))try{const t=await yo(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Vu.ce(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Au.get(r);i&&e.Au.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.Au.get(t);if(!r)return;e.Au.set(t,r.withResumeToken(nt.EMPTY_BYTE_STRING,r.snapshotVersion)),$o(e,t);const i=new _i(r.target,t,n,r.sequenceNumber);Go(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){p("RemoteStore","Failed to raise snapshot:",t),await Zo(e,t)}}async function Zo(e,t,n){if(!oe(t))throw t;e.vu.add(1),await jo(e),e.bu.set("Offline"),n||(n=()=>yo(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{p("RemoteStore","Retrying IndexedDB access"),await n(),e.vu.delete(1),await Vo(e)}))}function ea(e,t){return t().catch((n=>Zo(e,n,t)))}async function ta(e){const t=b(e),n=da(t);let r=t.Eu.length>0?t.Eu[t.Eu.length-1].batchId:-1;for(;na(t);)try{const e=await vo(t.localStore,r);if(null===e){0===t.Eu.length&&n.jo();break}r=e.batchId,ra(t,e)}catch(e){await Zo(t,e)}ia(t)&&sa(t)}function na(e){return Wo(e)&&e.Eu.length<10}function ra(e,t){e.Eu.push(t);const n=da(e);n.Ko()&&n.ou&&n.uu(t.mutations)}function ia(e){return Wo(e)&&!da(e).Uo()&&e.Eu.length>0}function sa(e){da(e).start()}async function oa(e){da(e).hu()}async function aa(e){const t=da(e);for(const n of e.Eu)t.uu(n.mutations)}async function ca(e,t,n){const r=e.Eu.shift(),i=Tr.from(r,t,n);await ea(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await ta(e)}async function ua(e,t){t&&da(e).ou&&await async function(e,t){if(kr(n=t.code)&&n!==I.ABORTED){const n=e.Eu.shift();da(e).Qo(),await ea(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await ta(e)}var n}(e,t),ia(e)&&sa(e)}async function la(e,t){const n=b(e);n.asyncQueue.verifyOperationInProgress(),p("RemoteStore","RemoteStore received new credentials");const r=Wo(n);n.vu.add(3),await jo(n),r&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.vu.delete(3),await Vo(n)}function ha(e){return e.Su||(e.Su=function(e,t,n){const r=b(e);return r.fu(),new Oo(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{uo:Xo.bind(null,e),ao:Jo.bind(null,e),nu:Yo.bind(null,e)}),e.Ru.push((async t=>{t?(e.Su.Qo(),Ho(e)?Ko(e):e.bu.set("Unknown")):(await e.Su.stop(),Qo(e))}))),e.Su}function da(e){return e.Du||(e.Du=function(e,t,n){const r=b(e);return r.fu(),new Mo(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{uo:oa.bind(null,e),ao:ua.bind(null,e),au:aa.bind(null,e),cu:ca.bind(null,e)}),e.Ru.push((async t=>{t?(e.Du.Qo(),await ta(e)):(await e.Du.stop(),e.Eu.length>0&&(p("RemoteStore",`Stopping write stream with ${e.Eu.length} pending writes`),e.Eu=[]))}))),e.Du}class fa{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new T,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new fa(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new E(I.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function pa(e,t){if(m("AsyncQueue",`${t}: ${e}`),oe(e))return new E(I.UNAVAILABLE,`${t}: ${e}`);throw e}class ma{constructor(e){this.comparator=e?(t,n)=>e(t,n)||z.comparator(t.key,n.key):(e,t)=>z.comparator(e.key,t.key),this.keyedMap=On(),this.sortedSet=new We(this.comparator)}static emptySet(e){return new ma(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ma))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new ma;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class ga{constructor(){this.Cu=new We(z.comparator)}track(e){const t=e.doc.key,n=this.Cu.get(t);n?0!==e.type&&3===n.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==n.type?this.Cu=this.Cu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Cu=this.Cu.remove(t):1===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):v():this.Cu=this.Cu.insert(t,e)}xu(){const e=[];return this.Cu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class ya{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new ya(e,t,ma.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Cn(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class va{constructor(){this.Nu=void 0,this.listeners=[]}}class wa{constructor(){this.queries=new Nn((e=>xn(e)),Cn),this.onlineState="Unknown",this.ku=new Set}}async function ba(e,t){const n=b(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new va),i)try{s.Nu=await n.onListen(r)}catch(e){const n=pa(e,`Initialization of query '${Sn(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.Mu(n.onlineState),s.Nu&&t.$u(s.Nu)&&_a(n)}async function Ia(e,t){const n=b(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Ea(e,t){const n=b(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.$u(e)&&(r=!0);i.Nu=e}}r&&_a(n)}function Ta(e,t,n){const r=b(e),i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}function _a(e){e.ku.forEach((e=>{e.next()}))}class Ca{constructor(e,t,n){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new ya(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Ku||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){if(e.docChanges.length>0)return!0;const t=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Uu(e){e=ya.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class xa{constructor(e){this.key=e}}class Sa{constructor(e){this.key=e}}class ka{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=qn(),this.mutatedKeys=qn(),this.tc=An(e),this.ec=new ma(this.tc)}get nc(){return this.Yu}sc(e,t){const n=t?t.ic:new ga,r=t?t.ec:this.ec;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=kn(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.rc(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.tc(l,a)>0||c&&this.tc(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ec:s,ic:n,zi:o,mutatedKeys:i}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const i=e.ic.xu();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return v()}};return n(e)-n(t)}(e.type,t.type)||this.tc(e.doc,t.doc))),this.oc(n);const s=t?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return this.Xu=o,0!==i.length||a?{snapshot:new ya(this.query,e.ec,r,i,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:s}:{cc:s}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new ga,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach((e=>this.Yu=this.Yu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Yu=this.Yu.delete(e))),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=qn(),this.ec.forEach((e=>{this.ac(e.key)&&(this.Zu=this.Zu.add(e.key))}));const t=[];return e.forEach((e=>{this.Zu.has(e)||t.push(new Sa(e))})),this.Zu.forEach((n=>{e.has(n)||t.push(new xa(n))})),t}hc(e){this.Yu=e.ir,this.Zu=qn();const t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return ya.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class Aa{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Da{constructor(e){this.key=e,this.fc=!1}}class Na{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.dc={},this.wc=new Nn((e=>xn(e)),Cn),this._c=new Map,this.mc=new Set,this.gc=new We(z.comparator),this.yc=new Map,this.Ic=new Xs,this.Tc={},this.Ec=new Map,this.Ac=xs.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function Pa(e,t){const n=function(e){const t=b(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ra.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Wa.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Ma.bind(null,t),t.dc.nu=Ea.bind(null,t.eventManager),t.dc.Pc=Ta.bind(null,t.eventManager),t}(e);let r,i;const s=n.wc.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.lc();else{const e=await function(e,t){const n=b(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Bs.getTargetData(e,t).next((i=>i?(r=i,te.resolve(r)):n.Bs.allocateTargetId(e).next((i=>(r=new _i(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Bs.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.Ji.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(e.targetId,e),n.Yi.set(t,e.targetId)),e}))}(n.localStore,En(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await async function(e,t,n,r,i){e.Rc=(t,n,r)=>async function(e,t,n,r){let i=t.view.sc(n);i.zi&&(i=await bo(e.localStore,t.query,!1).then((({documents:e})=>t.view.sc(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return za(e,t.targetId,o.cc),o.snapshot}(e,t,n,r);const s=await bo(e.localStore,t,!0),o=new ka(t,s.ir),a=o.sc(s.documents),c=Br.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);za(e,n,u.cc);const l=new Aa(t,n,o);return e.wc.set(t,l),e._c.has(n)?e._c.get(n).push(t):e._c.set(n,[t]),u.snapshot}(n,t,r,"current"===s,e.resumeToken),n.isPrimaryClient&&qo(n.remoteStore,e)}return i}async function La(e,t){const n=b(e),r=n.wc.get(t),i=n._c.get(r.targetId);if(i.length>1)return n._c.set(r.targetId,i.filter((e=>!Cn(e,t)))),void n.wc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await wo(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),zo(n.remoteStore,r.targetId),ja(n,r.targetId)})).catch(ee)):(ja(n,r.targetId),await wo(n.localStore,r.targetId,!0))}async function Ra(e,t){const n=b(e);try{const e=await function(e,t){const n=b(e),r=t.snapshotVersion;let i=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Zi.newChangeBuffer({trackRemovals:!0});i=n.Ji;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Bs.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Bs.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(nt.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Bs.updateTargetData(e,u))}));let a=Ln(),c=qn();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(function(e,t,n){let r=qn(),i=qn();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=Ln();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(B.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):p("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{nr:r,sr:i}}))}(e,s,t.documentUpdates).next((e=>{a=e.nr,c=e.sr}))),!r.isEqual(B.min())){const t=n.Bs.getLastRemoteSnapshotVersion(e).next((t=>n.Bs.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return te.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.Ji=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.yc.get(t);r&&(w(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.fc=!0:e.modifiedDocuments.size>0?w(r.fc):e.removedDocuments.size>0&&(w(r.fc),r.fc=!1))})),await Ka(n,e,t)}catch(e){await ee(e)}}function Oa(e,t,n){const r=b(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.wc.forEach(((n,r)=>{const i=r.view.Mu(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=b(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.Mu(t)&&(r=!0)})),r&&_a(n)}(r.eventManager,t),e.length&&r.dc.nu(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Ma(e,t,n){const r=b(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.yc.get(t),s=i&&i.key;if(s){let e=new We(z.comparator);e=e.insert(s,Ot.newNoDocument(s,B.min()));const n=qn().add(s),i=new Fr(B.min(),new Map,new We(R),e,n);await Ra(r,i),r.gc=r.gc.remove(s),r.yc.delete(t),$a(r)}else await wo(r.localStore,t,!1).then((()=>ja(r,t,n))).catch(ee)}async function Fa(e,t){const n=b(e),r=t.batch.batchId;try{const e=await function(e,t){const n=b(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.Zi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=te.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);w(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=qn();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);Va(n,r,null),Ua(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Ka(n,e)}catch(e){await ee(e)}}async function Ba(e,t,n){const r=b(e);try{const e=await function(e,t){const n=b(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(w(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Va(r,t,n),Ua(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Ka(r,e)}catch(n){await ee(n)}}function Ua(e,t){(e.Ec.get(t)||[]).forEach((e=>{e.resolve()})),e.Ec.delete(t)}function Va(e,t,n){const r=b(e);let i=r.Tc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Tc[r.currentUser.toKey()]=i}}function ja(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e._c.get(t))e.wc.delete(r),n&&e.dc.Pc(r,n);e._c.delete(t),e.isPrimaryClient&&e.Ic.Is(t).forEach((t=>{e.Ic.containsKey(t)||qa(e,t)}))}function qa(e,t){e.mc.delete(t.path.canonicalString());const n=e.gc.get(t);null!==n&&(zo(e.remoteStore,n),e.gc=e.gc.remove(t),e.yc.delete(n),$a(e))}function za(e,t,n){for(const r of n)r instanceof xa?(e.Ic.addReference(r.key,t),Ga(e,r)):r instanceof Sa?(p("SyncEngine","Document no longer in limbo: "+r.key),e.Ic.removeReference(r.key,t),e.Ic.containsKey(r.key)||qa(e,r.key)):v()}function Ga(e,t){const n=t.key,r=n.path.canonicalString();e.gc.get(n)||e.mc.has(r)||(p("SyncEngine","New document in limbo: "+n),e.mc.add(r),$a(e))}function $a(e){for(;e.mc.size>0&&e.gc.size<e.maxConcurrentLimboResolutions;){const t=e.mc.values().next().value;e.mc.delete(t);const n=new z(V.fromString(t)),r=e.Ac.next();e.yc.set(r,new Da(n)),e.gc=e.gc.insert(n,r),qo(e.remoteStore,new _i(En(gn(n.path)),r,"TargetPurposeLimboResolution",fe.ct))}}async function Ka(e,t,n){const r=b(e),i=[],s=[],o=[];r.wc.isEmpty()||(r.wc.forEach(((e,a)=>{o.push(r.Rc(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=ho.Li(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.dc.nu(i),await async function(e,t){const n=b(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>te.forEach(t,(t=>te.forEach(t.Fi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>te.forEach(t.Bi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!oe(e))throw e;p("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ji.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.Ji=n.Ji.insert(t,i)}}}(r.localStore,s))}async function Ha(e,t){const n=b(e);if(!n.currentUser.isEqual(t)){p("SyncEngine","User change. New user:",t.toKey());const e=await go(n.localStore,t);n.currentUser=t,function(e){e.Ec.forEach((e=>{e.forEach((e=>{e.reject(new E(I.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ec.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Ka(n,e.er)}}function Wa(e,t){const n=b(e),r=n.yc.get(t);if(r&&r.fc)return qn().add(r.key);{let e=qn();const r=n._c.get(t);if(!r)return e;for(const t of r){const r=n.wc.get(t);e=e.unionWith(r.view.nc)}return e}}function Qa(e){const t=b(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Fa.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Ba.bind(null,t),t}class Xa{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Po(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return mo(this.persistence,new fo,e.initialUser,this.serializer)}createPersistence(e){return new no(io.zs,this.serializer)}createSharedClientState(e){return new Eo}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Ja extends Xa{constructor(e,t,n){super(),this.Vc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Vc.initialize(this,e),await Qa(this.Vc.syncEngine),await ta(this.Vc.remoteStore),await this.persistence.Ii((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}createLocalStore(e){return mo(this.persistence,new fo,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new Ls(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new de(t,this.persistence);return new he(e.asyncQueue,n)}createPersistence(e){const t=function(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?vs.withCacheSize(this.cacheSizeBytes):vs.DEFAULT;return new co(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,"undefined"!=typeof window?window:null,No(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Eo}}class Ya{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Oa(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ha.bind(null,this.syncEngine),await async function(e,t){const n=b(e);t?(n.vu.delete(2),await Vo(n)):t||(n.vu.add(2),await jo(n),n.bu.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new wa}createDatastore(e){const t=Po(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new Do(r));var r;return function(e,t,n,r){return new Fo(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Oa(this.syncEngine,e,0),s=_o.D()?new _o:new To,new Uo(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Na(e,t,n,r,i,s);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=b(e);p("RemoteStore","RemoteStore shutting down."),t.vu.add(5),await jo(t),t.Pu.shutdown(),t.bu.set("Unknown")}(this.remoteStore)}}class Za{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):m("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class ec{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new E(I.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=b(e),r=ai(n.serializer)+"/documents",i={documents:t.map((e=>ri(n.serializer,e)))},s=await n.vo("BatchGetDocuments",r,i,t.length),o=new Map;s.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){w(!!t.found),t.found.name,t.found.updateTime;const n=ii(e,t.found.name),r=ei(t.found.updateTime),i=t.found.createTime?ei(t.found.createTime):B.min(),s=new Lt({mapValue:{fields:t.found.fields}});return Ot.newFoundDocument(n,r,i,s)}(e,t):"missing"in t?function(e,t){w(!!t.missing),w(!!t.readTime);const n=ii(e,t.missing),r=ei(t.readTime);return Ot.newNoDocument(n,r)}(e,t):v()}(n.serializer,e);o.set(t.key.toString(),t)}));const a=[];return t.forEach((e=>{const t=o.get(e.toString());w(!!t),a.push(t)})),a}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new br(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=z.fromPath(t);this.mutations.push(new Ir(n,this.precondition(n)))})),await async function(e,t){const n=b(e),r=ai(n.serializer)+"/documents",i={writes:t.map((e=>li(n.serializer,e)))};await n.Io("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw v();t=B.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new E(I.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(B.min())?ar.exists(!1):ar.updateTime(t):ar.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(B.min()))throw new E(I.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ar.updateTime(t)}return ar.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class tc{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Bc=n.maxAttempts,this.qo=new Lo(this.asyncQueue,"transaction_retry")}run(){this.Bc-=1,this.Lc()}Lc(){this.qo.No((async()=>{const e=new ec(this.datastore),t=this.qc(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.Uc(e)}))))})).catch((e=>{this.Uc(e)}))}))}qc(e){try{const t=this.updateFunction(e);return!pe(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Uc(e){this.Bc>0&&this.Kc(e)?(this.Bc-=1,this.asyncQueue.enqueueAndForget((()=>(this.Lc(),Promise.resolve())))):this.deferred.reject(e)}Kc(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!kr(t)}return!1}}class nc{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=l.UNAUTHENTICATED,this.clientId=L.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{p("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(p("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new E(I.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new T;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=pa(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function rc(e,t){e.asyncQueue.verifyOperationInProgress(),p("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await go(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function ic(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){p("FirestoreClient","Using user provided OfflineComponentProvider");try{await rc(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!sc(n))throw n;g("Error using user provided cache. Falling back to memory cache: "+n),await rc(e,new Xa)}}else p("FirestoreClient","Using default OfflineComponentProvider"),await rc(e,new Xa);return e._offlineComponents}(e);p("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>la(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>la(t.remoteStore,n))),e._onlineComponents=t}function sc(e){return"FirebaseError"===e.name?e.code===I.FAILED_PRECONDITION||e.code===I.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function oc(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(p("FirestoreClient","Using user provided OnlineComponentProvider"),await ic(e,e._uninitializedComponentsProvider._online)):(p("FirestoreClient","Using default OnlineComponentProvider"),await ic(e,new Ya))),e._onlineComponents}async function ac(e){const t=await oc(e),n=t.eventManager;return n.onListen=Pa.bind(null,t.syncEngine),n.onUnlisten=La.bind(null,t.syncEngine),n}function cc(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const uc=new Map;function lc(e,t,n){if(!n)throw new E(I.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function hc(e){if(!z.isDocumentKey(e))throw new E(I.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function dc(e){if(z.isDocumentKey(e))throw new E(I.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function fc(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":v()}function pc(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new E(I.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=fc(e);throw new E(I.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class mc{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new E(I.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new E(I.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new E(I.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=cc(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new E(I.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new E(I.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new E(I.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class gc{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new mc({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new E(I.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new E(I.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new mc(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new C;switch(e.type){case"firstParty":return new A(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new E(I.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=uc.get(e);t&&(p("ComponentProvider","Removing Datastore"),uc.delete(e),t.terminate())}(this),Promise.resolve()}}class yc{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new wc(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new yc(this.firestore,e,this._key)}}class vc{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new vc(this.firestore,e,this._query)}}class wc extends vc{constructor(e,t,n){super(e,t,gn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new yc(this.firestore,null,new z(e))}withConverter(e){return new wc(this.firestore,e,this._path)}}function bc(e,t,...n){if(e=(0,o.Ku)(e),lc("collection","path",t),e instanceof gc){const r=V.fromString(t,...n);return dc(r),new wc(e,null,r)}{if(!(e instanceof yc||e instanceof wc))throw new E(I.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(V.fromString(t,...n));return dc(r),new wc(e.firestore,null,r)}}function Ic(e,t,...n){if(e=(0,o.Ku)(e),1===arguments.length&&(t=L.A()),lc("doc","path",t),e instanceof gc){const r=V.fromString(t,...n);return hc(r),new yc(e,null,new z(r))}{if(!(e instanceof yc||e instanceof wc))throw new E(I.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(V.fromString(t,...n));return hc(r),new yc(e.firestore,e instanceof wc?e.converter:null,new z(r))}}class Ec{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new Lo(this,"async_queue_retry"),this.Xc=()=>{const e=No();e&&p("AsyncQueue","Visibility state changed to "+e.visibilityState),this.qo.Mo()};const e=No();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const t=No();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise((()=>{}));const t=new T;return this.ta((()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Qc.push(e),this.ea())))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!oe(e))throw e;p("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No((()=>this.ea()))}}ta(e){const t=this.Gc.then((()=>(this.Hc=!0,e().catch((e=>{this.Wc=e,this.Hc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw m("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Hc=!1,e))))));return this.Gc=t,t}enqueueAfterDelay(e,t,n){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);const r=fa.createAndSchedule(this,e,t,n,(e=>this.na(e)));return this.zc.push(r),r}Zc(){this.Wc&&v()}verifyOperationInProgress(){}async sa(){let e;do{e=this.Gc,await e}while(e!==this.Gc)}ia(e){for(const t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then((()=>{this.zc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.zc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()}))}oa(e){this.Yc.push(e)}na(e){const t=this.zc.indexOf(e);this.zc.splice(t,1)}}class Tc extends gc{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Ec,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||xc(this),this._firestoreClient.terminate()}}function _c(e,t){const n="object"==typeof e?e:(0,r.Sx)(),i="string"==typeof e?e:t||"(default)",s=(0,r.j6)(n,"firestore").getImmediate({identifier:i});if(!s._initialized){const e=(0,o.yU)("firestore");e&&function(e,t,n,r={}){var i;const s=(e=pc(e,gc))._getSettings(),a=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&g("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=l.MOCK_USER;else{t=(0,o.Fy)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new E(I.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new l(s)}e._authCredentials=new x(new _(t,n))}}(s,...e)}return s}function Cc(e){return e._firestoreClient||xc(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function xc(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new lt(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,cc(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new nc(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.cache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.cache.kind,_offline:i.cache._offlineComponentProvider,_online:i.cache._onlineComponentProvider})}function Sc(e,t){!function(e){if(e._initialized||e._terminated)throw new E(I.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}(e=pc(e,Tc));const n=Cc(e);if(n._uninitializedComponentsProvider)throw new E(I.FAILED_PRECONDITION,"SDK cache is already specified.");g("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=e._freezeSettings(),i=new Ya;return function(e,t,n){const r=new T;return e.asyncQueue.enqueue((async()=>{try{await rc(e,n),await ic(e,t),r.resolve()}catch(e){const t=e;if(!sc(t))throw t;g("Error enabling indexeddb cache. Falling back to memory cache: "+t),r.reject(t)}})).then((()=>r.promise))}(n,i,new Ja(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}class kc{constructor(e){this._byteString=e}static fromBase64String(e){try{return new kc(nt.fromBase64String(e))}catch(e){throw new E(I.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new kc(nt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ac{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new E(I.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new q(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Dc{constructor(e){this._methodName=e}}class Nc{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new E(I.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new E(I.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return R(this._lat,e._lat)||R(this._long,e._long)}}const Pc=/^__.*__$/;class Lc{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new gr(e,this.data,this.fieldMask,t,this.fieldTransforms):new mr(e,this.data,t,this.fieldTransforms)}}class Rc{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new gr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Oc(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw v()}}class Mc{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.ua(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new Mc(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.fa(e),r}da(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.ua(),r}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return Yc(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(Oc(this.ca)&&Pc.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class Fc{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Po(e)}ya(e,t,n,r=!1){return new Mc({ca:e,methodName:t,ga:n,path:q.emptyPath(),la:!1,ma:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Bc(e){const t=e._freezeSettings(),n=Po(e._databaseId);return new Fc(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Uc(e,t,n,r,i,s={}){const o=e.ya(s.merge||s.mergeFields?2:0,t,n,i);Wc("Data must be an object, but it was:",o,r);const a=Kc(r,o);let c,u;if(s.merge)c=new et(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Qc(t,r,n);if(!o.contains(i))throw new E(I.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Zc(e,i)||e.push(i)}c=new et(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new Lc(new Lt(a),c,u)}class Vc extends Dc{_toFieldTransform(e){if(2!==e.ca)throw 1===e.ca?e._a(`${this._methodName}() can only appear at the top level of your update data`):e._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Vc}}class jc extends Dc{_toFieldTransform(e){return new sr(e.path,new Jn)}isEqual(e){return e instanceof jc}}function qc(e,t,n,r){const i=e.ya(1,t,n);Wc("Data must be an object, but it was:",i,r);const s=[],a=Lt.empty();Ke(r,((e,r)=>{const c=Jc(t,e,n);r=(0,o.Ku)(r);const u=i.da(c);if(r instanceof Vc)s.push(c);else{const e=$c(r,u);null!=e&&(s.push(c),a.set(c,e))}}));const c=new et(s);return new Rc(a,c,i.fieldTransforms)}function zc(e,t,n,r,i,s){const a=e.ya(1,t,n),c=[Qc(t,r,n)],u=[i];if(s.length%2!=0)throw new E(I.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)c.push(Qc(t,s[e])),u.push(s[e+1]);const l=[],h=Lt.empty();for(let e=c.length-1;e>=0;--e)if(!Zc(l,c[e])){const t=c[e];let n=u[e];n=(0,o.Ku)(n);const r=a.da(t);if(n instanceof Vc)l.push(t);else{const e=$c(n,r);null!=e&&(l.push(t),h.set(t,e))}}const d=new et(l);return new Rc(h,d,a.fieldTransforms)}function Gc(e,t,n,r=!1){return $c(n,e.ya(r?4:3,t))}function $c(e,t){if(Hc(e=(0,o.Ku)(e)))return Wc("Unsupported field value:",t,e),Kc(e,t);if(e instanceof Dc)return function(e,t){if(!Oc(t.ca))throw t._a(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t._a(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.la&&4!==t.ca)throw t._a("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=$c(i,t.wa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,o.Ku)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Kn(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=F.fromDate(e);return{timestampValue:Jr(t.serializer,n)}}if(e instanceof F){const n=new F(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Jr(t.serializer,n)}}if(e instanceof Nc)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof kc)return{bytesValue:Yr(t.serializer,e._byteString)};if(e instanceof yc){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t._a(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ti(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t._a(`Unsupported field value: ${fc(e)}`)}(e,t)}function Kc(e,t){const n={};return He(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ke(e,((e,r)=>{const i=$c(r,t.ha(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Hc(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof F||e instanceof Nc||e instanceof kc||e instanceof yc||e instanceof Dc)}function Wc(e,t,n){if(!Hc(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=fc(n);throw"an object"===r?t._a(e+" a custom object"):t._a(e+" "+r)}}function Qc(e,t,n){if((t=(0,o.Ku)(t))instanceof Ac)return t._internalPath;if("string"==typeof t)return Jc(e,t);throw Yc("Field path arguments must be of type string or ",e,!1,void 0,n)}const Xc=new RegExp("[~\\*/\\[\\]]");function Jc(e,t,n){if(t.search(Xc)>=0)throw Yc(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Ac(...t.split("."))._internalPath}catch(r){throw Yc(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Yc(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new E(I.INVALID_ARGUMENT,a+e+c)}function Zc(e,t){return e.some((e=>e.isEqual(t)))}class eu{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new yc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new tu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(nu("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class tu extends eu{data(){return super.data()}}function nu(e,t){return"string"==typeof t?Jc(e,t):t instanceof Ac?t._internalPath:t._delegate._internalPath}class ru{}class iu extends ru{}function su(e,t,...n){let r=[];t instanceof ru&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof cu)).length,n=e.filter((e=>e instanceof ou)).length;if(t>1||t>0&&n>0)throw new E(I.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class ou extends iu{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new ou(e,t,n)}_apply(e){const t=this._parse(e);return yu(e._query,t),new vc(e.firestore,e.converter,Tn(e._query,t))}_parse(e){const t=Bc(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new E(I.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){gu(o,s);const t=[];for(const n of o)t.push(mu(r,e,n));a={arrayValue:{values:t}}}else a=mu(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||gu(o,s),a=Gc(n,"where",o,"in"===s||"not-in"===s);return qt.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function au(e,t,n){const r=t,i=nu("where",e);return ou._create(i,r,n)}class cu extends ru{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new cu(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:zt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)yu(n,e),n=Tn(n,e)}(e._query,t),new vc(e.firestore,e.converter,Tn(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class uu extends iu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new uu(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new E(I.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new E(I.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new Ut(t,n);return function(e,t){if(null===vn(e)){const n=wn(e);null!==n&&vu(0,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new vc(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new mn(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function lu(e,t="asc"){const n=t,r=nu("orderBy",e);return uu._create(r,n)}class hu extends iu{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new hu(e,t,n)}_apply(e){return new vc(e.firestore,e.converter,_n(e._query,this._limit,this._limitType))}}function du(e){return function(e,t){if(t<=0)throw new E(I.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}("limit",e),hu._create("limit",e,"F")}class fu extends iu{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new fu(e,t,n)}_apply(e){const t=function(e,t,n,r){if(n[0]=(0,o.Ku)(n[0]),n[0]instanceof eu)return function(e,t,n,r,i){if(!r)throw new E(I.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of In(e))if(n.field.isKeyField())s.push(It(t,r.key));else{const e=r.data.field(n.field);if(at(e))throw new E(I.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new E(I.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new Mt(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=Bc(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new E(I.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const c=i[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new E(I.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!bn(e)&&-1!==c.indexOf("/"))throw new E(I.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(V.fromString(c));if(!z.isDocumentKey(n))throw new E(I.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new z(n);a.push(It(t,i))}else{const e=Gc(n,r,c);a.push(e)}}return new Mt(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}(e,this.type,this._docOrFields,this._inclusive);return new vc(e.firestore,e.converter,function(e,t){return new mn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}function pu(...e){return fu._create("startAfter",e,!1)}function mu(e,t,n){if("string"==typeof(n=(0,o.Ku)(n))){if(""===n)throw new E(I.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!bn(t)&&-1!==n.indexOf("/"))throw new E(I.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(V.fromString(n));if(!z.isDocumentKey(r))throw new E(I.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return It(e,new z(r))}if(n instanceof yc)return It(e,n._key);throw new E(I.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${fc(n)}.`)}function gu(e,t){if(!Array.isArray(e)||0===e.length)throw new E(I.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function yu(e,t){if(t.isInequality()){const n=wn(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new E(I.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);const i=vn(e);null!==i&&vu(0,r,i)}const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new E(I.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new E(I.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function vu(e,t,n){if(!n.isEqual(t))throw new E(I.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class wu{convertValue(e,t="none"){switch(pt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return st(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ot(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw v()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Ke(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new Nc(st(e.latitude),st(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=ct(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ut(e));default:return null}}convertTimestamp(e){const t=it(e);return new F(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=V.fromString(e);w(Ti(n));const r=new ht(n.get(1),n.get(3)),i=new z(n.popFirst(5));return r.isEqual(t)||m(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function bu(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Iu extends wu{constructor(e){super(),this.firestore=e}convertBytes(e){return new kc(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new yc(this.firestore,null,t)}}class Eu{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Tu extends eu{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new _u(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(nu("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class _u extends Tu{data(e={}){return super.data(e)}}class Cu{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Eu(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new _u(this._firestore,this._userDataWriter,n.key,n,new Eu(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new E(I.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new _u(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Eu(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new _u(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Eu(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:xu(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function xu(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return v()}}function Su(e){e=pc(e,yc);const t=pc(e.firestore,Tc);return function(e,t,n={}){const r=new T;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Za({next:s=>{t.enqueueAndForget((()=>Ia(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new E(I.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new E(I.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new Ca(gn(n.path),s,{includeMetadataChanges:!0,Ku:!0});return ba(e,o)}(await ac(e),e.asyncQueue,t,n,r))),r.promise}(Cc(t),e._key).then((n=>function(e,t,n){const r=n.docs.get(t._key),i=new ku(e);return new Tu(e,i,t._key,r,new Eu(n.hasPendingWrites,n.fromCache),t.converter)}(t,e,n)))}class ku extends wu{constructor(e){super(),this.firestore=e}convertBytes(e){return new kc(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new yc(this.firestore,null,t)}}function Au(e){e=pc(e,vc);const t=pc(e.firestore,Tc),n=Cc(t),r=new ku(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new E(I.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),function(e,t,n={}){const r=new T;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Za({next:n=>{t.enqueueAndForget((()=>Ia(e,o))),n.fromCache&&"server"===r.source?i.reject(new E(I.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Ca(n,s,{includeMetadataChanges:!0,Ku:!0});return ba(e,o)}(await ac(e),e.asyncQueue,t,n,r))),r.promise}(n,e._query).then((n=>new Cu(t,r,e,n)))}function Du(e,t,n){e=pc(e,yc);const r=pc(e.firestore,Tc),i=bu(e.converter,t,n);return Ru(r,[Uc(Bc(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,ar.none())])}function Nu(e,t,n,...r){e=pc(e,yc);const i=pc(e.firestore,Tc),s=Bc(i);let a;return a="string"==typeof(t=(0,o.Ku)(t))||t instanceof Ac?zc(s,"updateDoc",e._key,t,n,r):qc(s,"updateDoc",e._key,t),Ru(i,[a.toMutation(e._key,ar.exists(!0))])}function Pu(e){return Ru(pc(e.firestore,Tc),[new br(e._key,ar.none())])}function Lu(e,t){const n=pc(e.firestore,Tc),r=Ic(e),i=bu(e.converter,t);return Ru(n,[Uc(Bc(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,ar.exists(!1))]).then((()=>r))}function Ru(e,t){return function(e,t){const n=new T;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Qa(e);try{const e=await function(e,t){const n=b(e),r=F.now(),i=t.reduce(((e,t)=>e.add(t.key)),qn());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=Ln(),c=qn();return n.Zi.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=fr(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new gr(e.key,t,Rt(t.value.mapValue),ar.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Mn(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Tc[e.currentUser.toKey()];r||(r=new We(R)),r=r.insert(t,n),e.Tc[e.currentUser.toKey()]=r}(r,e.batchId,n),await Ka(r,e.changes),await ta(r.remoteStore)}catch(e){const t=pa(e,"Failed to persist write");n.reject(t)}}(await function(e){return oc(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(Cc(e),t)}const Ou={maxAttempts:5};class Mu{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Bc(e)}set(e,t,n){this._verifyNotCommitted();const r=Fu(e,this._firestore),i=bu(r.converter,t,n),s=Uc(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,ar.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=Fu(e,this._firestore);let s;return s="string"==typeof(t=(0,o.Ku)(t))||t instanceof Ac?zc(this._dataReader,"WriteBatch.update",i._key,t,n,r):qc(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,ar.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Fu(e,this._firestore);return this._mutations=this._mutations.concat(new br(t._key,ar.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new E(I.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Fu(e,t){if((e=(0,o.Ku)(e)).firestore!==t)throw new E(I.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Bu extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Bc(e)}get(e){const t=Fu(e,this._firestore),n=new Iu(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return v();const r=e[0];if(r.isFoundDocument())return new eu(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new eu(this._firestore,n,t._key,null,t.converter);throw v()}))}set(e,t,n){const r=Fu(e,this._firestore),i=bu(r.converter,t,n),s=Uc(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=Fu(e,this._firestore);let s;return s="string"==typeof(t=(0,o.Ku)(t))||t instanceof Ac?zc(this._dataReader,"Transaction.update",i._key,t,n,r):qc(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=Fu(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Fu(e,this._firestore),n=new ku(this._firestore);return super.get(e).then((e=>new Tu(this._firestore,n,t._key,e._document,new Eu(!1,!1),t.converter)))}}function Uu(e,t,n){e=pc(e,Tc);const r=Object.assign(Object.assign({},Ou),n);return function(e){if(e.maxAttempts<1)throw new E(I.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new T;return e.asyncQueue.enqueueAndForget((async()=>{const i=await function(e){return oc(e).then((e=>e.datastore))}(e);new tc(e.asyncQueue,i,n,t,r).run()})),r.promise}(Cc(e),(n=>t(new Bu(e,n))),r)}function Vu(){return new Vc("deleteField")}function ju(){return new jc("serverTimestamp")}function qu(e){return Cc(e=pc(e,Tc)),new Mu(e,(t=>Ru(e,t)))}!function(e,t=!0){!function(e){h=e}(r.MF),(0,r.om)(new i.uA("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new Tc(new S(e.getProvider("auth-internal")),new N(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new E(I.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ht(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),(0,r.KO)(u,"3.13.0",e),(0,r.KO)(u,"3.13.0","esm2017")}()},816:(e,t,n)=>{"use strict";n.d(t,{checkAndShowLicenseModal:()=>E});var r,i,s,o,a,c,u,l,h=n(848),d=n(756),f=n.n(d),p=n(908),m=n(580);function g(){r=document.getElementById("licenseModal"),i=document.getElementById("licenseForm"),s=document.getElementById("licenseKey"),o=document.getElementById("activateLicenseBtn"),a=document.getElementById("licenseError"),c=document.getElementById("licenseErrorMessage"),u=document.getElementById("licenseSuccess"),l=document.getElementById("licenseSuccessMessage"),document.getElementById("getLicenseLink")}function y(){o.addEventListener("click",v),r.addEventListener("show.bs.modal",(function(){i.reset(),a.classList.add("d-none"),u.classList.add("d-none"),o.disabled=!1})),r.addEventListener("hidden.bs.modal",(function(){u.classList.contains("d-none")||window.location.reload()})),s&&s.addEventListener("input",I)}function v(){return w.apply(this,arguments)}function w(){return(w=(0,h.A)(f().mark((function e(){var t,n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.classList.add("d-none"),u.classList.add("d-none"),i.checkValidity()){e.next=5;break}return i.reportValidity(),e.abrupt("return");case 5:if(o.disabled=!0,o.innerHTML='<i class="fas fa-spinner fa-spin me-2"></i>Activation en cours...',e.prev=7,t=auth.currentUser){e.next=12;break}return b("Vous devez être connecté pour activer une licence."),e.abrupt("return");case 12:return n=s.value.trim(),e.next=15,(0,m.activateLicense)(t.uid,n);case 15:(r=e.sent).success?(c=r.message,u.classList.remove("d-none"),l.textContent=c):b(r.message),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(7),console.error("Erreur lors de l'activation de la licence:",e.t0),b("Une erreur est survenue lors de l'activation de la licence.");case 23:return e.prev=23,o.disabled=!1,o.innerHTML='<i class="fas fa-key me-2"></i>Activer la licence',e.finish(23);case 27:case"end":return e.stop()}var c}),e,null,[[7,19,23,27]])})))).apply(this,arguments)}function b(e){a.classList.remove("d-none"),c.textContent=e}function I(e){var t=e.target.value.replace(/[^A-Z0-9]/gi,"").toUpperCase();t.length>16&&(t=t.substring(0,16));for(var n="",r=0;r<t.length;r++)r>0&&r%4==0&&r<16&&(n+="-"),n+=t[r];e.target.value=n}function E(){return T.apply(this,arguments)}function T(){return(T=(0,h.A)(f().mark((function e(){var t,n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=(0,p.xI)(),n=t.currentUser){e.next=5;break}return e.abrupt("return",!1);case 5:return e.next=7,(0,m.needsLicenseActivation)(n.uid);case 7:if(!e.sent){e.next=20;break}return e.next=11,new Promise((function(e){document.getElementById("licenseModal")?(g(),y()):fetch("license-modal.html").then((function(e){return e.text()})).then((function(e){document.body.insertAdjacentHTML("beforeend",e),g(),y()})).catch((function(e){console.error("Erreur lors du chargement du modal de licence:",e)}));var t=setInterval((function(){document.getElementById("licenseModal")&&(clearInterval(t),e())}),100);setTimeout((function(){clearInterval(t),e()}),3e3)}));case 11:if("undefined"!=typeof bootstrap&&bootstrap.Modal){e.next=14;break}return console.warn("Bootstrap n'est pas disponible. Impossible d'afficher le modal de licence."),e.abrupt("return",!0);case 14:if(r=document.getElementById("licenseModal")){e.next=18;break}return console.warn("Modal de licence introuvable dans le DOM."),e.abrupt("return",!0);case 18:try{new bootstrap.Modal(r,{backdrop:"static",keyboard:!1}).show()}catch(e){console.error("Erreur lors de l'initialisation du modal Bootstrap:",e)}return e.abrupt("return",!0);case 20:return e.abrupt("return",!1);case 23:return e.prev=23,e.t0=e.catch(0),console.error("Erreur lors de la vérification de la licence:",e.t0),e.abrupt("return",!1);case 27:case"end":return e.stop()}}),e,null,[[0,23]])})))).apply(this,arguments)}},848:(e,t,n)=>{"use strict";function r(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,s){var o=e.apply(t,n);function a(e){r(o,i,s,a,c,"next",e)}function c(e){r(o,i,s,a,c,"throw",e)}a(void 0)}))}}n.d(t,{A:()=>i})},908:(e,t,n)=>{"use strict";n.d(t,{CI:()=>r.CI,J1:()=>r.J1,eJ:()=>r.eJ,hg:()=>r.hg,x9:()=>r.x9,xI:()=>r.xI});var r=n(440)},922:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(284),i=n(327);function s(e){var t=(0,i.A)(e,"string");return"symbol"==(0,r.A)(t)?t:t+""}}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var s=r[e]={exports:{}};return n[e](s,s.exports,i),s.exports}i.m=n,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,n)=>(i.f[n](e,t),t)),[])),i.u=e=>e+".bundle.js",i.miniCssF=e=>{},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="fastnetlite:",i.l=(n,r,s,o)=>{if(e[n])e[n].push(r);else{var a,c;if(void 0!==s)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var h=u[l];if(h.getAttribute("src")==n||h.getAttribute("data-webpack")==t+s){a=h;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.setAttribute("data-webpack",t+s),a.src=n),e[n]=[r];var d=(t,r)=>{a.onerror=a.onload=null,clearTimeout(f);var i=e[n];if(delete e[n],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(r))),t)return t(r)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),c&&document.head.appendChild(a)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="/",(()=>{var e={57:0,469:0,492:0,508:0};i.f.j=(t,n)=>{var r=i.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var s=new Promise(((n,i)=>r=e[t]=[n,i]));n.push(r[2]=s);var o=i.p+i.u(t),a=new Error;i.l(o,(n=>{if(i.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var s=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,r[1](a)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,s,[o,a,c]=n,u=0;if(o.some((t=>0!==e[t]))){for(r in a)i.o(a,r)&&(i.m[r]=a[r]);c&&c(i)}for(t&&t(n);u<o.length;u++)s=o[u],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0},n=self.webpackChunkfastnetlite=self.webpackChunkfastnetlite||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{"use strict";var e=i(467),t=i(284);function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function r(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var s=i(848),o=i(756),a=i.n(o),c=i(908),u=i(405),l=(i(56),i(816));function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?h(Object(r),!0).forEach((function(n){(0,e.A)(t,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function f(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return p(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){a=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw s}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var m=(0,c.xI)(),g=(0,u.aU)();function y(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(function(e){v.apply(this,arguments)}(e),w(e),_(e,1,20,null,{status:"available"}),x(e),function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(document.getElementById("importMethod"),document.getElementById("csvImport"),document.getElementById("textImport"),document.getElementById("pdfImport"),document.getElementById("importCodesForm")),r=document.getElementById("importSubmitBtn");if(t&&n){n.querySelectorAll("input, select, textarea, button").forEach((function(e){e.disabled=!0}));var i=document.getElementById("importCodesModal");if(i){var s=i.querySelector(".modal-body");if(s){var o=document.createElement("div");o.className="alert alert-warning",o.innerHTML='\n                    <i class="fas fa-exclamation-triangle me-2"></i>\n                    <strong>Licence requise :</strong> L\'importation de codes WiFi nécessite une licence active. \n                    <a href="settings.html#subscription-tab" class="alert-link">Activez votre licence</a> pour utiliser cette fonctionnalité.\n                ',s.insertBefore(o,s.firstChild)}}r&&(r.setAttribute("data-bs-toggle","tooltip"),r.setAttribute("title","Activez votre licence pour importer des codes"),new bootstrap.Tooltip(r))}}(e,t),function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.getElementById("available-codes-tab"),r=document.getElementById("sold-codes-tab");n&&n.addEventListener("click",(function(t){t.preventDefault(),_(e,1,20,null,{status:"available"})})),r&&r.addEventListener("click",(function(t){t.preventDefault(),x(e)})),document.addEventListener("click",(function(n){if(n.target.closest(".print-receipt-btn")){n.preventDefault();var r=n.target.closest(".print-receipt-btn").dataset.codeId;if(t){showToast("Licence requise","L'impression de reçus nécessite une licence active. Veuillez activer votre licence pour utiliser cette fonctionnalité.","warning");var i=document.querySelector(".toast:last-child");i&&i.addEventListener("click",(function(){window.location.href="settings.html#subscription-tab"}))}else!function(e,t){P.apply(this,arguments)}(r,e)}})),t&&document.querySelectorAll(".advanced-filter").forEach((function(e){e.disabled=!0,e.setAttribute("data-bs-toggle","tooltip"),e.setAttribute("title","Activez votre licence pour utiliser les filtres avancés"),new bootstrap.Tooltip(e)}));var i,s=document.getElementById("searchCodes");s&&s.addEventListener("input",(function(){var t=this;clearTimeout(i),i=setTimeout((function(){var n=t.value.trim(),r=document.getElementById("filterProfile"),i=r?r.value:"all";_(e,1,20,null,{status:"available",profileId:"all"===i?null:i,searchText:n})}),300)}));var o=document.getElementById("clearSearchBtn");o&&o.addEventListener("click",(function(){var t=document.getElementById("searchCodes");if(t){t.value="";var n=document.getElementById("filterProfile"),r=n?n.value:"all";_(e,1,20,null,{status:"available",profileId:"all"===r?null:r})}}));var a=document.getElementById("filterProfile");a&&a.addEventListener("change",(function(){var t=this.value,n=document.getElementById("searchCodes"),r=n?n.value.trim():"";_(e,1,20,null,{status:"available",profileId:"all"===t?null:t,searchText:r})}));var c=document.getElementById("searchSoldCodes");c&&c.addEventListener("input",(function(){var t=this.value.trim(),n=document.getElementById("filterSoldProfile"),r=n?n.value:"all",i=document.getElementById("filterSoldPeriod"),s=i?i.value:"all";x(e,1,20,null,{searchText:t,profileId:"all"===r?null:r,period:s})}));var u=document.getElementById("clearSoldSearchBtn");u&&u.addEventListener("click",(function(){var t=document.getElementById("searchSoldCodes");t&&(t.value="",x(e))}));var l=document.getElementById("filterSoldProfile");l&&l.addEventListener("change",(function(){var t=this.value,n=document.getElementById("searchSoldCodes"),r=n?n.value.trim():"",i=document.getElementById("filterSoldPeriod"),s=i?i.value:"all";x(e,1,20,null,{searchText:r,profileId:"all"===t?null:t,period:s})}));var h=document.getElementById("filterSoldPeriod");h&&h.addEventListener("change",(function(){var t=this.value,n=document.getElementById("searchSoldCodes"),r=n?n.value.trim():"",i=document.getElementById("filterSoldProfile"),s=i?i.value:"all";x(e,1,20,null,{searchText:r,profileId:"all"===s?null:s,period:t})}))}(e,t),function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.getElementById("selectAllCodes"),r=document.getElementById("deleteSelectedCodesBtn");if(n&&r){if(t)return r.disabled=!0,r.setAttribute("data-bs-toggle","tooltip"),r.setAttribute("title","Activez votre licence pour accéder à cette fonctionnalité"),void new bootstrap.Tooltip(r);n.addEventListener("change",(function(){document.querySelectorAll("#codesList .code-checkbox").forEach((function(e){e.checked=n.checked})),i()})),document.getElementById("codesList").addEventListener("change",(function(e){if(e.target&&e.target.classList.contains("code-checkbox")){var t=document.querySelectorAll("#codesList .code-checkbox"),r=document.querySelectorAll("#codesList .code-checkbox:checked");n.checked=t.length>0&&t.length===r.length,i()}})),r.addEventListener("click",(0,s.A)(a().mark((function t(){var i,s,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=document.querySelectorAll("#codesList .code-checkbox:checked"),0!==(s=Array.from(i).map((function(e){return e.getAttribute("data-code-id")}))).length){t.next=4;break}return t.abrupt("return");case 4:if(confirm("Voulez-vous vraiment supprimer ".concat(s.length," code(s) WiFi ? Cette action est irréversible."))){t.next=6;break}return t.abrupt("return");case 6:return r.disabled=!0,r.innerHTML='\n            <span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>\n            Suppression en cours...\n        ',t.prev=8,o=(0,u.wP)(g),s.forEach((function(e){var t=(0,u.H9)(g,"wifiCodes",e);o.delete(t)})),t.next=13,o.commit();case 13:oe("success","".concat(s.length," code(s) WiFi supprimé(s) avec succès")),_(e,1,20,null,{status:"available"}),n.checked=!1,r.disabled=!0,r.innerHTML='<i class="fas fa-trash-alt me-1"></i> Supprimer les codes sélectionnés',t.next=26;break;case 20:t.prev=20,t.t0=t.catch(8),console.error("Erreur lors de la suppression des codes:",t.t0),oe("error","Erreur lors de la suppression des codes: ".concat(t.t0.message)),r.disabled=!1,r.innerHTML='<i class="fas fa-trash-alt me-1"></i> Supprimer les codes sélectionnés';case 26:case"end":return t.stop()}}),t,null,[[8,20]])}))))}else console.error("Les éléments pour la suppression en masse n'ont pas été trouvés");function i(){var e=document.querySelectorAll("#codesList .code-checkbox:checked");r.disabled=0===e.length,e.length>0?r.textContent="Supprimer ".concat(e.length," code(s) sélectionné(s)"):r.innerHTML='<i class="fas fa-trash-alt me-1"></i> Supprimer les codes sélectionnés'}}(e,t),t){document.querySelectorAll(".import-codes-btn, #importCodesBtn").forEach((function(e){e.disabled=!0,e.setAttribute("data-bs-toggle","tooltip"),e.setAttribute("title","Activez votre licence pour accéder à cette fonctionnalité"),new bootstrap.Tooltip(e)}));var n=document.querySelector(".container-fluid");if(n){var r=document.createElement("div");r.className="alert alert-warning alert-dismissible fade show mt-3",r.innerHTML='\n                <i class="fas fa-exclamation-triangle me-2"></i>\n                <strong>Licence requise :</strong> Certaines fonctionnalités sont limitées. \n                <a href="settings.html#subscription-tab" class="alert-link">Activez votre licence</a> pour accéder à toutes les fonctionnalités.\n                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n            ',n.insertBefore(r,n.firstChild)}}}function v(){return(v=(0,s.A)(a().mark((function e(t){var n,r,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=(0,u.H9)(g,"routers",t),e.next=4,(0,u.x7)(n);case 4:(r=e.sent).exists()?(i=r.data(),document.getElementById("routerName").textContent=i.name,document.title="Codes WiFi - ".concat(i.name," - FastNetLite")):(console.error("Routeur non trouvé"),alert("Routeur non trouvé"),window.location.href="routers.html"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Erreur lors de la récupération des informations du routeur:",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=(0,s.A)(a().mark((function e(t){var n,r,i,s,o,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=(0,u.rJ)(g,"profiles"),r=(0,u.P)(n,(0,u._M)("routerId","==",t)),e.next=5,(0,u.GG)(r);case 5:if(i=e.sent,(s=document.getElementById("loadingProfiles"))&&s.classList.add("d-none"),!i.empty){e.next=12;break}return(o=document.getElementById("noProfiles"))&&o.classList.remove("d-none"),e.abrupt("return");case 12:if(c=document.getElementById("profilesList")){e.next=16;break}return console.error("Élément profilesList non trouvé"),e.abrupt("return");case 16:c.innerHTML="",i.forEach((function(e){var n=e.data(),r=e.id;I(r,n,c,t),T(r,n)})),e.next=25;break;case 20:e.prev=20,e.t0=e.catch(0),console.error("Erreur lors de la récupération des profils:",e.t0),document.getElementById("loadingProfiles").classList.add("d-none"),document.getElementById("noProfiles").classList.remove("d-none");case 25:case"end":return e.stop()}}),e,null,[[0,20]])})))).apply(this,arguments)}function I(e,t,n,r){var i=document.getElementById("profileCardTemplate"),s=document.importNode(i.content,!0),o=s.querySelector(".profile-name");o&&(o.textContent=t.name);var a=s.querySelector(".profile-price");a&&(a.textContent=t.price+" FCFA");var c=s.querySelector(".profile-description");c&&(t.description?c.textContent=t.description:c.textContent="Aucune description");var u=s.querySelector(".profile-duration");u&&(u.textContent=t.duration);var l=s.querySelector(".import-codes-btn");l&&(l.dataset.profileId=e,l.addEventListener("click",(function(t){t.preventDefault();var n=document.getElementById("importProfile");n&&(n.value=e);var r=document.getElementById("importCodesModal");r&&new bootstrap.Modal(r).show()})));var h=s.querySelector(".edit-profile-btn");h&&(h.dataset.profileId=e,h.addEventListener("click",(function(t){t.preventDefault(),function(e,t){Z.apply(this,arguments)}(e,r)})));var d=s.querySelector(".delete-profile-btn");d&&(d.dataset.profileId=e,d.addEventListener("click",(function(t){t.preventDefault(),function(e,t){confirm("Êtes-vous sûr de vouloir supprimer ce profil ? Cette action est irréversible.")&&ee(e,t)}(e,r)})));var f=s.querySelector(".copy-buy-link-btn");f&&(f.dataset.profileId=e,f.addEventListener("click",(function(n){n.preventDefault(),ne(e,r,t.name)})));var p=s.querySelector(".view-codes-btn");p&&(p.dataset.profileId=e,p.addEventListener("click",(function(t){t.preventDefault(),document.getElementById("codes-tab").click(),function(e){window.selectedProfileId=e;var t=new URLSearchParams(window.location.search).get("id");if(t){var n=document.getElementById("filterStatus");n&&(n.value="all");var r=document.getElementById("searchCodes");r&&(r.value=""),document.getElementById("profiles-tab")&&ie(e,t).then((function(n){if(!document.querySelector("#codes .alert-container")){var r=document.createElement("div");r.className="alert-container mb-3",document.querySelector("#codes").insertBefore(r,document.querySelector("#codes .row"))}document.querySelector("#codes .alert-container").innerHTML='\n                    <div class="alert alert-info alert-dismissible fade show" role="alert">\n                        <i class="fas fa-filter me-2"></i> Affichage des codes pour le profil <strong>'.concat(n||e,'</strong>\n                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" id="clearProfileFilter"></button>\n                    </div>\n                '),document.getElementById("clearProfileFilter").addEventListener("click",(function(){window.selectedProfileId=null,function(e){ae.apply(this,arguments)}(t,1)}))})),_(t,1,20,null,{profileId:e})}}(e)}))),function(e,t){return E.apply(this,arguments)}(e,r).then((function(e){var t=s.querySelector(".profile-codes-count");t&&(t.textContent=e)})),n.appendChild(s)}function E(){return(E=(0,s.A)(a().mark((function e(t,n){var r,i,s,o,c,l,h,d,f,p;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Récupération du nombre de codes pour le profil ".concat(t," du routeur ").concat(n)),t&&n){e.next=5;break}return console.warn("profileId ou routerId manquant"),e.abrupt("return",0);case 5:return r=(0,u.rJ)(g,"wifiCodes"),e.prev=6,i=(0,u.P)(r,(0,u._M)("profileId","==",t),(0,u._M)("routerId","==",n)),e.next=10,(0,u.GG)(i);case 10:return s=e.sent,o=0,s.forEach((function(e){var t=e.data();"available"!==t.status||t._dummy||o++})),console.log("".concat(o," codes disponibles trouvés pour le profil ").concat(t)),e.abrupt("return",o);case 17:return e.prev=17,e.t0=e.catch(6),console.warn("Erreur lors de la requête avec deux conditions:",e.t0.message),e.prev=20,c=(0,u.P)(r,(0,u._M)("profileId","==",t)),e.next=24,(0,u.GG)(c);case 24:return l=e.sent,h=0,l.forEach((function(e){var t=e.data();t.routerId!==n||"available"!==t.status||t._dummy||h++})),console.log("".concat(h," codes disponibles trouvés pour le profil ").concat(t," (méthode alternative 1)")),e.abrupt("return",h);case 31:return e.prev=31,e.t1=e.catch(20),console.warn("Erreur lors de la requête avec une condition:",e.t1.message),d=(0,u.P)(r,(0,u.AB)(1e3)),e.next=37,(0,u.GG)(d);case 37:return f=e.sent,p=0,f.forEach((function(e){var r=e.data();r.profileId!==t||r.routerId!==n||"available"!==r.status||r._dummy||p++})),console.log("".concat(p," codes disponibles trouvés pour le profil ").concat(t," (méthode alternative 2)")),e.abrupt("return",p);case 42:e.next=48;break;case 44:return e.prev=44,e.t2=e.catch(0),console.error("Erreur générale lors de la récupération du nombre de codes:",e.t2),e.abrupt("return",0);case 48:case"end":return e.stop()}}),e,null,[[0,44],[6,17],[20,31]])})))).apply(this,arguments)}function T(e,t){var n="".concat(t.name," (").concat(t.duration," - ").concat(t.price," FCFA)"),r=document.getElementById("importProfile");if(r){var i=document.createElement("option");i.value=e,i.textContent=n,r.appendChild(i)}else console.error("Élément importProfile non trouvé");var s=document.getElementById("generateProfileSelect");if(s){var o=document.createElement("option");o.value=e,o.textContent=n,s.appendChild(o)}var a=document.getElementById("filterProfile");if(a){var c=document.createElement("option");c.value=e,c.textContent=t.name,a.appendChild(c)}var u=document.getElementById("filterSoldProfile");if(u){var l=document.createElement("option");l.value=e,l.textContent=t.name,u.appendChild(l)}}function _(e){return C.apply(this,arguments)}function C(){return C=(0,s.A)(a().mark((function e(t){var n,r,i,s,o,c,l,h,f,p,m,y,v,w,b,I,E,T,_,C,x=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=x.length>1&&void 0!==x[1]?x[1]:1,r=x.length>2&&void 0!==x[2]?x[2]:20,(i=x.length>4&&void 0!==x[4]?x[4]:{}).status=i.status||"available",e.prev=5,(s=document.getElementById("loadingCodes"))&&s.classList.remove("d-none"),(o=document.getElementById("noCodes"))&&o.classList.add("d-none"),c=(0,u.rJ)(g,"wifiCodes"),l=(0,u.P)(c,(0,u._M)("routerId","==",t),(0,u.My)("createdAt","desc")),e.prev=12,e.next=15,(0,u.GG)(l);case 15:if(h=e.sent,f=[],h.forEach((function(e){var t=e.data(),n=e.id,r=!0;if(i.status&&t.status!==i.status&&(r=!1),i.profileId&&t.profileId!==i.profileId&&(r=!1),i.searchText&&""!==i.searchText.trim()){var s=i.searchText.toLowerCase();(t.username&&t.password?"".concat(t.username,"/").concat(t.password):t.password?t.password:t.username?t.username:"").toLowerCase().includes(s)||(r=!1)}r&&f.push(d({id:n},t))})),s&&s.classList.add("d-none"),0!==f.length){e.next=23;break}return(p=document.getElementById("noCodes"))&&p.classList.remove("d-none"),e.abrupt("return");case 23:m=f.length,y=(n-1)*r,v=Math.min(y+r,m),w=f.slice(y,v),b=document.getElementById("codesList"),1===n&&(b.innerHTML=""),I=null,w.forEach((function(e){var t=e.id;I=t,D(t,e,b)})),k(m,n,r,t,I,i),e.next=41;break;case 34:e.prev=34,e.t0=e.catch(12),console.error("Erreur lors de la récupération des codes:",e.t0),e.t0.message&&e.t0.message.includes("index")&&console.warn("Un index est nécessaire pour cette requête. Créez l'index approprié dans Firebase."),s&&s.classList.add("d-none"),(E=document.getElementById("noCodes"))&&E.classList.remove("d-none");case 41:e.next=62;break;case 43:return e.prev=43,e.t1=e.catch(5),console.error("Erreur lors du chargement des codes:",e.t1),(T=document.getElementById("loadingCodes"))&&T.classList.add("d-none"),(_=document.getElementById("noCodes"))&&_.classList.remove("d-none"),e.prev=50,e.next=53,(0,u.gS)((0,u.rJ)(g,"wifiCodes"),{_dummy:!0,routerId:t,createdAt:(0,u.O5)(),status:"available"});case 53:return C=e.sent,e.next=56,(0,u.kd)(C);case 56:console.log("Collection wifiCodes créée avec succès"),e.next=62;break;case 59:e.prev=59,e.t2=e.catch(50),console.error("Erreur lors de la création de la collection wifiCodes:",e.t2);case 62:case"end":return e.stop()}}),e,null,[[5,43],[12,34],[50,59]])}))),C.apply(this,arguments)}function x(e){return S.apply(this,arguments)}function S(){return S=(0,s.A)(a().mark((function e(t){var n,r,i,s,o,c,l,h,f,p,m,y,v,w,b,I,E,T,_,C=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=C.length>1&&void 0!==C[1]?C[1]:1,r=C.length>2&&void 0!==C[2]?C[2]:20,(i=C.length>4&&void 0!==C[4]?C[4]:{}).status=i.status||"used",e.prev=5,(s=document.getElementById("loadingSoldCodes"))&&s.classList.remove("d-none"),(o=document.getElementById("noSoldCodes"))&&o.classList.add("d-none"),c=(0,u.rJ)(g,"wifiCodes"),l=(0,u.P)(c,(0,u._M)("routerId","==",t),(0,u.My)("usedAt","desc")),e.prev=12,e.next=15,(0,u.GG)(l);case 15:if(h=e.sent,f=[],h.forEach((function(e){var t=e.data(),n=e.id,r=!0;if(t.usedAt||(r=!1),i.status&&t.status!==i.status&&(r=!1),i.profileId&&t.profileId!==i.profileId&&(r=!1),i.period&&r){var s=new Date,o=t.usedAt?t.usedAt.toDate():null;if(o){if("today"===i.period)r=o>=new Date(s.getFullYear(),s.getMonth(),s.getDate());else if("week"===i.period){var a=new Date(s);a.setDate(a.getDate()-7),r=o>=a}else if("month"===i.period){var c=new Date(s);c.setDate(c.getDate()-30),r=o>=c}}else r=!1}if(i.searchText&&r){var u=i.searchText.toLowerCase(),l=t.username?t.username.toLowerCase():"",h=t.password?t.password.toLowerCase():"",p=t.clientName?t.clientName.toLowerCase():"";r=l.includes(u)||h.includes(u)||p.includes(u)}r&&f.push(d({id:n},t))})),s&&s.classList.add("d-none"),0!==f.length){e.next=23;break}return(p=document.getElementById("noSoldCodes"))&&p.classList.remove("d-none"),e.abrupt("return");case 23:m=f.length,y=(n-1)*r,v=Math.min(y+r,m),w=f.slice(y,v),b=document.getElementById("soldCodesList"),1===n&&(b.innerHTML=""),I=null,w.forEach((function(e){var t=e.id;I=t,N(t,e,b)})),A(m,n,r,t,I,i),e.next=40;break;case 34:e.prev=34,e.t0=e.catch(12),console.error("Erreur lors de la récupération des codes vendus:",e.t0),s&&s.classList.add("d-none"),(E=document.getElementById("noSoldCodes"))&&E.classList.remove("d-none");case 40:e.next=49;break;case 42:e.prev=42,e.t1=e.catch(5),console.error("Erreur lors du chargement des codes vendus:",e.t1),(T=document.getElementById("loadingSoldCodes"))&&T.classList.add("d-none"),(_=document.getElementById("noSoldCodes"))&&_.classList.remove("d-none");case 49:case"end":return e.stop()}}),e,null,[[5,42],[12,34]])}))),S.apply(this,arguments)}function k(e,t,n,r,i){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=document.getElementById("codesPagination");if(o){var a=Math.ceil(e/n);o.innerHTML="";var c=document.createElement("li");c.className="page-item ".concat(1===t?"disabled":"");var u=document.createElement("a");u.className="page-link",u.href="#",u.textContent="Précédent",u.setAttribute("aria-label","Précédent"),t>1&&u.addEventListener("click",(function(e){e.preventDefault(),_(r,t-1,n,null,s)})),c.appendChild(u),o.appendChild(c);var l=Math.max(1,t-2),h=Math.min(a,l+4);h-l<4&&(l=Math.max(1,h-4));for(var d=function(e){var i=document.createElement("li");i.className="page-item ".concat(e===t?"active":"");var a=document.createElement("a");a.className="page-link",a.href="#",a.textContent=e,e!==t&&a.addEventListener("click",(function(t){t.preventDefault(),_(r,e,n,null,s)})),i.appendChild(a),o.appendChild(i)},f=l;f<=h;f++)d(f);var p=document.createElement("li");p.className="page-item ".concat(t===a?"disabled":"");var m=document.createElement("a");m.className="page-link",m.href="#",m.textContent="Suivant",m.setAttribute("aria-label","Suivant"),t<a&&m.addEventListener("click",(function(e){e.preventDefault(),_(r,t+1,n,i,s)})),p.appendChild(m),o.appendChild(p)}}function A(e,t,n,r,i){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=document.getElementById("soldCodesPagination");if(o){var a=Math.ceil(e/n);o.innerHTML="";var c=document.createElement("li");c.className="page-item ".concat(1===t?"disabled":"");var u=document.createElement("a");u.className="page-link",u.href="#",u.textContent="Précédent",u.setAttribute("aria-label","Précédent"),t>1&&u.addEventListener("click",(function(e){e.preventDefault(),x(r,t-1,n,null,s)})),c.appendChild(u),o.appendChild(c);var l=Math.max(1,t-2),h=Math.min(a,l+4);h-l<4&&(l=Math.max(1,h-4));for(var d=function(e){var i=document.createElement("li");i.className="page-item ".concat(e===t?"active":"");var a=document.createElement("a");a.className="page-link",a.href="#",a.textContent=e,e!==t&&a.addEventListener("click",(function(t){t.preventDefault(),x(r,e,n,null,s)})),i.appendChild(a),o.appendChild(i)},f=l;f<=h;f++)d(f);var p=document.createElement("li");p.className="page-item ".concat(t===a?"disabled":"");var m=document.createElement("a");m.className="page-link",m.href="#",m.textContent="Suivant",m.setAttribute("aria-label","Suivant"),t<a&&m.addEventListener("click",(function(e){e.preventDefault(),x(r,t+1,n,i,s)})),p.appendChild(m),o.appendChild(p)}}function D(e,t,n){var r=document.createElement("tr"),i="Profil inconnu";if(t.profileId){var s=(0,u.H9)(g,"profiles",t.profileId);(0,u.x7)(s).then((function(e){e.exists()&&(i=e.data().name,r.querySelector(".code-profile").textContent=i)}))}var o=t.createdAt?new Date(t.createdAt.toDate()).toLocaleDateString("fr-FR"):"-";switch(t.usedAt&&new Date(t.usedAt.toDate()).toLocaleDateString("fr-FR"),t.status){case"available":case"used":case"expired":break;default:t.status}var a=t.username&&t.password?"".concat(t.username," / ").concat(t.password):t.password?t.password:t.username?t.username:"-",c="available"===t.status?'\n        <td>\n            <div class="form-check">\n                <input class="form-check-input code-checkbox" type="checkbox" value="'.concat(e,'" data-code-id="').concat(e,'">\n                <label class="form-check-label"></label>\n            </div>\n        </td>'):"<td></td>";r.innerHTML="\n        ".concat(c,"\n        <td><code>").concat(a,'</code></td>\n        <td class="code-profile" data-profile-id="').concat(t.profileId,'">').concat(i,"</td>\n        <td>").concat(o,"</td>\n        <td>").concat(t.price?t.price+" FCFA":"-","</td>\n        <td>").concat(t.duration||"-",'</td>\n        <td>\n            <button type="button" class="btn btn-sm btn-outline-primary view-code-btn" data-code-id="').concat(e,'">\n                <i class="fas fa-eye"></i>\n            </button>\n        </td>\n    '),n.appendChild(r)}function N(e,t,n){var r=document.createElement("tr"),i="Profil inconnu";if(t.profileId){var s=(0,u.H9)(g,"profiles",t.profileId);(0,u.x7)(s).then((function(e){e.exists()&&(i=e.data().name,r.querySelector(".code-profile").textContent=i)}))}var o=t.usedAt?new Date(t.usedAt.toDate()).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",a=t.username&&t.password?"".concat(t.username," / ").concat(t.password):t.password?t.password:t.username?t.username:"-",c=t.price?"".concat(t.price," FCFA"):"-",l=t.paymentId?'<span class="badge bg-info">'.concat(t.paymentId,"</span>"):"-";r.innerHTML="\n        <td><code>".concat(a,'</code></td>\n        <td class="code-profile" data-profile-id="').concat(t.profileId,'">').concat(i,"</td>\n        <td>").concat(t.clientName||"-","</td>\n        <td>").concat(o,"</td>\n        <td>").concat(c,"</td>\n        <td>").concat(l,'</td>\n        <td>\n            <div class="btn-group">\n                <button type="button" class="btn btn-sm btn-outline-primary view-code-btn" data-code-id="').concat(e,'">\n                    <i class="fas fa-eye"></i>\n                </button>\n                <button type="button" class="btn btn-sm btn-outline-secondary print-receipt-btn" data-code-id="').concat(e,'">\n                    <i class="fas fa-print"></i>\n                </button>\n            </div>\n        </td>\n    '),n.appendChild(r)}function P(){return(P=(0,s.A)(a().mark((function e(t,n){var r,i,s,o,c,l,h,d,f,p,m,y,v,w,b,I,E;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=(0,u.H9)(g,"wifiCodes",t),e.next=4,(0,u.x7)(r);case 4:if((i=e.sent).exists()){e.next=9;break}return console.error("Code non trouvé"),oe("error","Code non trouvé"),e.abrupt("return");case 9:if("used"===(s=i.data()).status){e.next=14;break}return console.error("Ce code n'est pas vendu"),oe("error","Ce code n'est pas vendu, impossible d'imprimer un reçu"),e.abrupt("return");case 14:if(o="Profil inconnu",c="",l="",!s.profileId){e.next=23;break}return h=(0,u.H9)(g,"profiles",s.profileId),e.next=21,(0,u.x7)(h);case 21:(d=e.sent).exists()&&(f=d.data(),o=f.name,c=f.duration,l=f.price);case 23:return p=(0,u.H9)(g,"routers",n),e.next=26,(0,u.x7)(p);case 26:m=e.sent,y="Routeur inconnu",v="FastNetLite",m.exists()&&(w=m.data(),y=w.name,v=w.businessName||"FastNetLite"),b=s.usedAt?new Date(s.usedAt.toDate()).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Date inconnue",I='\n            <div class="receipt-container" style="font-family: Arial, sans-serif; max-width: 300px; padding: 20px; border: 1px solid #ddd;">\n                <div style="text-align: center; margin-bottom: 20px;">\n                    <h2 style="margin: 0;">'.concat(v,"</h2>\n                    <p>").concat(y,'</p>\n                </div>\n                \n                <div style="margin-bottom: 20px;">\n                    <h3 style="margin: 0; border-bottom: 1px solid #ddd; padding-bottom: 5px;">REÇU</h3>\n                    <p><strong>Date:</strong> ').concat(b,"</p>\n                    <p><strong>Client:</strong> ").concat(s.clientName||"Client non spécifié","</p>\n                    <p><strong>Numéro de reçu:</strong> ").concat(t.substring(0,8),'</p>\n                </div>\n                \n                <div style="margin-bottom: 20px;">\n                    <h4 style="margin: 0; border-bottom: 1px solid #ddd; padding-bottom: 5px;">Détails</h4>\n                    <table style="width: 100%; border-collapse: collapse;">\n                        <tr>\n                            <td style="padding: 5px 0;">Profil WiFi</td>\n                            <td style="text-align: right; padding: 5px 0;">').concat(o,'</td>\n                        </tr>\n                        <tr>\n                            <td style="padding: 5px 0;">Durée</td>\n                            <td style="text-align: right; padding: 5px 0;">').concat(c,'</td>\n                        </tr>\n                        <tr>\n                            <td style="padding: 5px 0; font-weight: bold;">TOTAL</td>\n                            <td style="text-align: right; padding: 5px 0; font-weight: bold;">').concat(s.price||l||"N/A",' FCFA</td>\n                        </tr>\n                    </table>\n                </div>\n                \n                <div style="margin-bottom: 20px;">\n                    <h4 style="margin: 0; border-bottom: 1px solid #ddd; padding-bottom: 5px;">Informations de connexion</h4>\n                    <p><strong>Nom d\'utilisateur:</strong> ').concat(s.username||"N/A","</p>\n                    <p><strong>Mot de passe:</strong> ").concat(s.password||"N/A",'</p>\n                </div>\n                \n                <div style="text-align: center; font-size: 12px; margin-top: 30px;">\n                    <p>Merci pour votre achat!</p>\n                    <p>Pour toute assistance, veuillez nous contacter.</p>\n                </div>\n            </div>\n        '),(E=window.open("","_blank")).document.write("\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <title>Reçu - ".concat(s.clientName||"Client"," - ").concat(o,'</title>\n                <meta charset="UTF-8">\n                <meta name="viewport" content="width=device-width, initial-scale=1.0">\n            </head>\n            <body>\n                ').concat(I,"\n                <script>\n                    window.onload = function() {\n                        window.print();\n                        setTimeout(function() { window.close(); }, 500);\n                    };\n                <\/script>\n            </body>\n            </html>\n        ")),E.document.close(),e.next=41;break;case 37:e.prev=37,e.t0=e.catch(0),console.error("Erreur lors de l'impression du reçu:",e.t0),oe("error","Erreur lors de l'impression du reçu");case 41:case"end":return e.stop()}}),e,null,[[0,37]])})))).apply(this,arguments)}window.wifiCodesInitialized=window.wifiCodesInitialized||!1,document.addEventListener("DOMContentLoaded",(function(){window.wifiCodesInitialized?console.log("wifi-codes.js déjà initialisé, initialisation ignorée"):(window.wifiCodesInitialized=!0,console.log("Initialisation de wifi-codes.js"),(0,c.hg)(m,(function(e){if(e){console.log("Utilisateur connecté:",e.displayName),document.querySelectorAll("#userName").forEach((function(t){t.textContent=e.displayName||e.email}));var t=new URLSearchParams(window.location.search).get("id");if(!t)return sessionStorage.getItem("isRouterNavigation")?void sessionStorage.removeItem("isRouterNavigation"):(console.warn("ID du routeur non spécifié, redirection vers la liste des routeurs"),void(window.location.href="routers.html"));(0,l.checkAndShowLicenseModal)().then((function(e){y(t,e),F(t),Y(t)})).catch((function(e){console.error("Erreur lors de la vérification de la licence:",e),y(t,!0),F(t),Y(t)}))}else{var n=window.location.pathname;n.includes("index.html")||"/"===n||n.endsWith("/")||(console.log("Utilisateur non connecté, redirection vers index"),window.location.href="index.html")}})),document.querySelectorAll("#logoutBtn, #logoutBtnDropdown").forEach((function(e){e.addEventListener("click",(function(e){e.preventDefault(),firebase.auth().signOut().then((function(){window.location.href="index.html"})).catch((function(e){console.error("Erreur lors de la déconnexion:",e),alert("Erreur lors de la déconnexion. Veuillez réessayer.")}))}))})))})),document.getElementById("formatVoucher"),document.getElementById("formatUserPass");var L=document.getElementById("voucherExample"),R=document.getElementById("userPassExample");document.querySelectorAll('input[name="codeFormat"]').forEach((function(e){e.addEventListener("change",(function(){"voucher"===this.value?(L.classList.remove("d-none"),R.classList.add("d-none"),J(!1)):(L.classList.add("d-none"),R.classList.remove("d-none"),J(!0)),document.getElementById("detectedPattern").value="",document.getElementById("patternExplanation").textContent="Entrez un exemple pour générer automatiquement un pattern",document.getElementById("extractedCodesContainer").classList.add("d-none")}))})),document.getElementById("exampleVoucher").addEventListener("input",(function(){var e=this.value.trim();if(e){var t=Q(e);document.getElementById("detectedPattern").value=t,document.getElementById("patternExplanation").textContent="Pattern détecté : "+X(t)}else document.getElementById("detectedPattern").value="",document.getElementById("patternExplanation").textContent="Entrez un exemple pour générer automatiquement un pattern"}));var O=document.getElementById("exampleUser"),M=document.getElementById("examplePass");function F(e){document.addEventListener("click",(function(t){if((t.target.classList.contains("edit-profile-btn")||t.target.closest(".edit-profile-btn"))&&(t.preventDefault(),function(e,t){de.apply(this,arguments)}((t.target.classList.contains("edit-profile-btn")?t.target:t.target.closest(".edit-profile-btn")).dataset.profileId,e)),(t.target.classList.contains("delete-profile-btn")||t.target.closest(".delete-profile-btn"))&&(t.preventDefault(),ee((t.target.classList.contains("delete-profile-btn")?t.target:t.target.closest(".delete-profile-btn")).dataset.profileId,e)),t.target.classList.contains("copy-buy-link-btn")||t.target.closest(".copy-buy-link-btn")){t.preventDefault();var n=(t.target.classList.contains("copy-buy-link-btn")?t.target:t.target.closest(".copy-buy-link-btn")).dataset.profileId;ie(n,e).then((function(t){ne(n,e,t)})).catch((function(t){console.error("Erreur lors de la récupération du nom du profil:",t),ne(n,e,"Profil WiFi")}))}}));var t=document.getElementById("saveProfileBtn");t&&!t.getAttribute("data-handler-attached")&&(t.setAttribute("data-handler-attached","true"),t.addEventListener("click",(function(){var n=document.getElementById("profileName").value.trim(),r=document.getElementById("profileDescription").value.trim(),i=document.getElementById("profileDuration").value.trim(),s=parseFloat(document.getElementById("profilePrice").value);if(!n||!i||isNaN(s)){var o=document.getElementById("profileFormError");return o.textContent="Veuillez remplir tous les champs obligatoires",void o.classList.remove("d-none")}var a=document.getElementById("saveProfileSpinner");a.classList.remove("d-none"),t.disabled=!0;var c=(0,u.rJ)(g,"profiles"),l=(0,u.P)(c,(0,u._M)("routerId","==",e),(0,u._M)("name","==",n));(0,u.GG)(l).then((function(o){if(o.empty)try{var l={name:n,description:r,duration:i,price:s,routerId:e,userId:m.currentUser?m.currentUser.uid:"anonymous",createdAt:(0,u.O5)(),stats:{totalCodes:0,availableCodes:0,usedCodes:0}};(0,u.gS)(c,l).then((function(n){console.log("Profil ajouté avec ID:",n.id),bootstrap.Modal.getInstance(document.getElementById("addProfileModal")).hide(),w(e),document.getElementById("addProfileForm").reset(),document.getElementById("profileFormError").classList.add("d-none"),a.classList.add("d-none"),t.disabled=!1})).catch((function(e){console.error("Erreur lors de l'ajout du profil:",e);var n=document.getElementById("profileFormError");n.textContent="Erreur lors de l'ajout du profil: "+e.message,n.classList.remove("d-none"),a.classList.add("d-none"),t.disabled=!1}))}catch(e){console.error("Erreur lors de l'ajout du profil:",e);var h=document.getElementById("profileFormError");h.textContent="Erreur lors de l'ajout du profil: "+e.message,h.classList.remove("d-none"),a.classList.add("d-none"),t.disabled=!1}else{var d=document.getElementById("profileFormError");d.textContent="Un profil avec ce nom existe déjà",d.classList.remove("d-none"),a.classList.add("d-none"),t.disabled=!1}})).catch((function(e){console.error("Erreur lors de la vérification du profil:",e);var n=document.getElementById("profileFormError");n.textContent="Erreur lors de la vérification du profil: "+e.message,n.classList.remove("d-none"),a.classList.add("d-none"),t.disabled=!1}))})));var n=document.getElementById("importCodesBtn");n&&!n.getAttribute("data-handler-attached")&&(n.setAttribute("data-handler-attached","true"),n.addEventListener("click",(function(){var t=document.getElementById("importProfile").value;if(!t){var r=document.getElementById("importFormError");return r.textContent="Veuillez sélectionner un profil",void r.classList.remove("d-none")}var i=window.extractedCodes||[];if(0===i.length){var s=document.getElementById("importFormError");return s.textContent="Aucun code extrait. Veuillez sélectionner un fichier PDF et saisir un exemple de code.",void s.classList.remove("d-none")}document.getElementById("importCodesSpinner").classList.remove("d-none"),n.disabled=!0;var o=document.getElementById("formatUserPass").checked;W(i,t,e,o)}))),window.viewCodeHandlerAttached=window.viewCodeHandlerAttached||!1,window.viewCodeHandlerAttached||(window.viewCodeHandlerAttached=!0,document.addEventListener("click",(function(e){var t,n;(e.target.classList.contains("view-code-btn")||e.target.closest(".view-code-btn"))&&(e.preventDefault(),t=(e.target.classList.contains("view-code-btn")?e.target:e.target.closest(".view-code-btn")).dataset.codeId,n=(0,u.H9)(g,"wifiCodes",t),(0,u.x7)(n).then((function(e){if(e.exists()){var n=e.data(),r=n.username&&n.password?"".concat(n.username," / ").concat(n.password):n.code?n.code:n.username?n.username:"-";document.getElementById("codeValue").textContent=r;var i=document.getElementById("codeStatus");if(i.textContent="available"===n.status?"Disponible":"used"===n.status?"Utilisé":"expired"===n.status?"Expiré":n.status,i.className="badge",i.classList.add("available"===n.status?"bg-success":"used"===n.status?"bg-primary":"bg-secondary"),n.profileId){var s=(0,u.H9)(g,"profiles",n.profileId);(0,u.x7)(s).then((function(e){if(e.exists()){var t=e.data();document.getElementById("codeProfile").textContent=t.name,document.getElementById("codePrice").textContent=t.price+" FCFA"}else document.getElementById("codeProfile").textContent="Profil inconnu",document.getElementById("codePrice").textContent="-"}))}else document.getElementById("codeProfile").textContent="Profil inconnu",document.getElementById("codePrice").textContent="-";document.getElementById("codeCreatedAt").textContent=n.createdAt?new Date(n.createdAt.toDate()).toLocaleDateString("fr-FR"):"-",document.getElementById("codeUsedAt").textContent=n.usedAt?new Date(n.usedAt.toDate()).toLocaleDateString("fr-FR"):"-",document.getElementById("codeClient").textContent=n.clientName||"-";var o=document.getElementById("deleteCodeBtn");"available"===n.status?(o.classList.remove("d-none"),o.dataset.codeId=t):o.classList.add("d-none"),new bootstrap.Modal(document.getElementById("codeDetailsModal")).show()}else console.error("Code non trouvé"),alert("Code non trouvé")})).catch((function(e){console.error("Erreur lors de la récupération des informations du code:",e),alert("Erreur lors de la récupération des informations du code")})))})),console.log("Gestionnaire de visualisation de code attaché"))}function B(e,t,n){return U.apply(this,arguments)}function U(){return(U=(0,s.A)(a().mark((function e(t,n,r){var i,s,o,c,u,l,h,d,p,m,g,y,v,w,b,I,E,T,_,C,x;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Début du traitement du PDF avec pattern:",n,"isUserPass:",r),"undefined"!=typeof pdfjsLib){e.next=6;break}return console.log("Chargement de pdf.js..."),e.next=5,V();case 5:console.log("pdf.js chargé avec succès");case 6:return console.log("Lecture du fichier PDF..."),e.next=9,t.arrayBuffer();case 9:return i=e.sent,console.log("Fichier PDF lu, taille:",i.byteLength,"octets"),e.prev=11,console.log("Chargement du document PDF..."),e.next=15,pdfjsLib.getDocument({data:i}).promise;case 15:s=e.sent,console.log("Document PDF chargé, nombre de pages:",s.numPages),o="",c=1;case 19:if(!(c<=s.numPages)){e.next=36;break}return console.log("Extraction du texte de la page ".concat(c,"/").concat(s.numPages,"...")),e.next=23,s.getPage(c);case 23:return u=e.sent,e.next=26,u.getTextContent();case 26:l=e.sent,h=null,d="",p=l.items.sort((function(e,t){return Math.abs(e.transform[5]-t.transform[5])<5?e.transform[4]-t.transform[4]:t.transform[5]-e.transform[5]})),m=f(p);try{for(m.s();!(g=m.n()).done;)y=g.value,v=y.transform[5],null!==h&&Math.abs(v-h)>5?d+="\n":null!==h&&(d+=" "),d+=y.str,h=v}catch(e){m.e(e)}finally{m.f()}o+=d+"\n";case 33:c++,e.next=19;break;case 36:if(console.log("Texte extrait du PDF (extrait):",o.substring(0,200)+"..."),console.log("Extraction des codes avec le pattern:",n),w=q(o,n,r),console.log("Nombre de codes extraits:",w.length),0!==w.length){e.next=73;break}if(console.warn("Aucun code trouvé avec le pattern actuel. Essai avec un pattern plus souple..."),!r){e.next=59;break}if(b="([A-Za-z0-9]{4,})\\s+([A-Za-z0-9]{4,})",console.log("Nouvel essai avec pattern souple pour User/Pass:",b),I=q(o,b,!0),console.log("Nombre de codes extraits avec pattern souple:",I.length),!(I.length>0)){e.next=50;break}return z(I,!0),e.abrupt("return",I);case 50:if(E="([\\w]{3,})\\s+([\\w]{3,})",console.log("Dernier essai avec pattern très souple pour User/Pass:",E),T=q(o,E,!0),console.log("Nombre de codes extraits avec pattern très souple:",T.length),!(T.length>0)){e.next=57;break}return z(T,!0),e.abrupt("return",T);case 57:e.next=73;break;case 59:if(b="[A-Za-z0-9]{4,}",console.log("Nouvel essai avec pattern souple pour Voucher:",b),_=q(o,b,!1),console.log("Nombre de codes extraits avec pattern souple:",_.length),!(_.length>0)){e.next=66;break}return z(_,!1),e.abrupt("return",_);case 66:if(C="[\\w]{4,}",console.log("Dernier essai avec pattern très souple pour Voucher:",C),x=q(o,C,!1),console.log("Nombre de codes extraits avec pattern très souple:",x.length),!(x.length>0)){e.next=73;break}return z(x,!1),e.abrupt("return",x);case 73:return z(w,r),e.abrupt("return",w);case 77:throw e.prev=77,e.t0=e.catch(11),console.error("Erreur lors du traitement du PDF:",e.t0),e.t0;case 81:case"end":return e.stop()}}),e,null,[[11,77]])})))).apply(this,arguments)}function V(){return j.apply(this,arguments)}function j(){return(j=(0,s.A)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){var n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js",n.onload=function(){pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js",e()},n.onerror=t,document.head.appendChild(n)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e,t,n){var r,i=[];try{var s=e.replace(/\r?\n/g," ").replace(/\s+/g," ");if(console.log("Texte nettoyé (extrait):",s.substring(0,200)+"..."),n){var o;if(t.includes("\\s+")){var a=t.split("\\s+");if(2===a.length){var c=a[0].replace(/^\^|\$$/g,""),u=a[1].replace(/^\^|\$$/g,"");o="^(".concat(c,")\\s+(").concat(u,")$")}else o="^([A-Za-z0-9]{4,})\\s+([A-Za-z0-9]{4,})$"}else o="^([A-Za-z0-9]{4,})\\s+([A-Za-z0-9]{4,})$";console.log("Utilisation du pattern regex pour User/Pass:",o),r=new RegExp(o,"mi")}else try{var l=t;l.startsWith("^")||(l="^"+l),l.endsWith("$")||(l+="$"),new RegExp(l),console.log("Utilisation du pattern regex strict pour Voucher:",l),r=new RegExp(l,"mi")}catch(e){var h="^[A-Za-z0-9]{4,}$";console.warn("Pattern invalide, utilisation du pattern par défaut strict:",h),r=new RegExp(h,"mi")}var d=new Set,p=s.split(/\s+/);if(console.log("Début de l'extraction des codes avec validation stricte..."),n)for(var m=0;m<p.length-1;m++){var g="".concat(p[m]," ").concat(p[m+1]).match(r);if(g){var y=g[1],v=g[2];if(y&&v&&y.length>=3&&v.length>=3){var w="".concat(y,":").concat(v);d.has(w)||(d.add(w),i.push({username:y,password:v}),console.log("Code extrait (User/Pass):",y,v))}}}else{var b,I=f(p);try{for(I.s();!(b=I.n()).done;){var E=b.value.match(r);if(E){var T=E[0];T&&T.length>=4&&(d.has(T)||(d.add(T),i.push(T),console.log("Code extrait (Voucher):",T)))}}}catch(e){I.e(e)}finally{I.f()}}console.log("Extraction terminée. ".concat(i.length," codes uniques trouvés."))}catch(e){throw console.error("Erreur lors de l'extraction des codes:",e),e}return i}function z(e,t){var n=document.getElementById("extractedCodesContainer"),r=document.querySelector("#extractedCodesTable tbody"),i=document.getElementById("extractedCodesCount");n&&r&&i&&(i.textContent=e.length,r.innerHTML="",e.forEach((function(e,n){var i=document.createElement("tr");i.innerHTML=t?"\n                <td>".concat(e.username,"</td>\n                <td>").concat(e.password,'</td>\n                <td>\n                    <button type="button" class="btn btn-sm btn-outline-danger remove-code-btn" data-index="').concat(n,'">\n                        <i class="fas fa-times"></i>\n                    </button>\n                </td>\n            '):"\n                <td>".concat(e,'</td>\n                <td>\n                    <button type="button" class="btn btn-sm btn-outline-danger remove-code-btn" data-index="').concat(n,'">\n                        <i class="fas fa-times"></i>\n                    </button>\n                </td>\n            '),r.appendChild(i)})),n.classList.remove("d-none"),document.querySelectorAll(".remove-code-btn").forEach((function(e){e.addEventListener("click",(function(){!function(e,t){window.extractedCodes&&(window.extractedCodes.splice(e,1),z(window.extractedCodes,t))}(parseInt(this.dataset.index),t)}))})))}function G(e,t,n){window.currentExtractedCodes=e,window.currentPattern=t,window.currentIsUserPass=n,window.selectedCodes=r(e),document.getElementById("usedPattern").textContent=t,document.getElementById("totalCodesCount").textContent=e.length,document.getElementById("selectedCodesCount").textContent=e.length;var i=document.getElementById("extractedCodesListFinal");i.innerHTML="",document.getElementById("extractedCodesHeaderFinal").innerHTML=n?'\n            <th width="40px">\n                <div class="form-check">\n                    <input class="form-check-input" type="checkbox" id="selectAllCodesCheckbox" checked>\n                </div>\n            </th>\n            <th>Nom d\'utilisateur</th>\n            <th>Mot de passe</th>\n            <th width="80px">Actions</th>\n        ':'\n            <th width="40px">\n                <div class="form-check">\n                    <input class="form-check-input" type="checkbox" id="selectAllCodesCheckbox" checked>\n                </div>\n            </th>\n            <th>Code</th>\n            <th width="80px">Actions</th>\n        ',e.forEach((function(e,t){var r=document.createElement("tr"),s=document.createElement("td");if(s.innerHTML='\n            <div class="form-check">\n                <input class="form-check-input code-checkbox" type="checkbox" data-index="'.concat(t,'" checked>\n            </div>\n        '),r.appendChild(s),n){var o=document.createElement("td");o.textContent=e.username,r.appendChild(o);var a=document.createElement("td");a.textContent=e.password,r.appendChild(a)}else{var c=document.createElement("td");c.textContent=e,r.appendChild(c)}var u=document.createElement("td");u.innerHTML='\n            <button type="button" class="btn btn-sm btn-outline-danger remove-code-btn" data-index="'.concat(t,'">\n                <i class="fas fa-trash-alt"></i>\n            </button>\n        '),r.appendChild(u),i.appendChild(r)})),function(){var e=document.getElementById("selectAllCodesCheckbox");e&&e.addEventListener("change",(function(){var e=this.checked;document.querySelectorAll(".code-checkbox").forEach((function(t){t.checked=e})),$()})),document.querySelectorAll(".code-checkbox").forEach((function(e){e.addEventListener("change",(function(){$();var e=r(document.querySelectorAll(".code-checkbox")).every((function(e){return e.checked}));document.getElementById("selectAllCodesCheckbox").checked=e}))})),document.querySelectorAll(".remove-code-btn").forEach((function(e){e.addEventListener("click",(function(){var e;e=parseInt(this.getAttribute("data-index")),window.currentExtractedCodes&&(window.currentExtractedCodes.splice(e,1),G(window.currentExtractedCodes,window.currentPattern,window.currentIsUserPass),document.getElementById("totalCodesCount").textContent=window.currentExtractedCodes.length,$())}))}));var t=document.getElementById("selectAllCodesBtn");t&&t.addEventListener("click",(function(){document.querySelectorAll(".code-checkbox").forEach((function(e){e.checked=!0})),document.getElementById("selectAllCodesCheckbox").checked=!0,$()}));var n=document.getElementById("removeInvalidCodesBtn");n&&n.addEventListener("click",(function(){!function(){if(window.currentExtractedCodes&&0!==window.currentExtractedCodes.length){var e=window.currentIsUserPass,t=[];window.currentExtractedCodes.forEach((function(n,r){var i=!0;e?(!n.username||!n.password||n.username.length<3||n.password.length<3)&&(i=!1):(!n||n.length<3)&&(i=!1),i||t.push(r)}));for(var n=t.length-1;n>=0;n--)window.currentExtractedCodes.splice(t[n],1);G(window.currentExtractedCodes,window.currentPattern,e);var r="".concat(t.length," code(s) invalide(s) supprimé(s)."),i=document.getElementById("extractedCodesAlert");i.textContent=r,i.classList.remove("d-none"),setTimeout((function(){i.classList.add("d-none")}),3e3)}}()}));var i=document.getElementById("filterExtractedCodes");i&&i.addEventListener("input",(function(){!function(e){if(window.currentExtractedCodes){var t=document.getElementById("extractedCodesListFinal").querySelectorAll("tr"),n=window.currentIsUserPass;e=e.toLowerCase(),t.forEach((function(t,r){(n?t.cells[1].textContent.toLowerCase()+" "+t.cells[2].textContent.toLowerCase():t.cells[1].textContent.toLowerCase()).includes(e)?t.style.display="":t.style.display="none"}))}}(this.value)}));var s=document.getElementById("refinePatternBtn");s&&s.addEventListener("click",(function(){document.getElementById("refinePatternContainer").classList.toggle("d-none"),document.getElementById("newPattern").value=window.currentPattern,K(window.currentPattern)}));var o=document.getElementById("newPattern");o&&o.addEventListener("input",(function(){K(this.value)}));var a=document.getElementById("applyNewPatternBtn");a&&a.addEventListener("click",(function(){var e=document.getElementById("newPattern").value;e&&function(e){if(window.selectedPdfFile){document.getElementById("refinePatternContainer").classList.add("d-none");var t=document.getElementById("extractedCodesSpinner");t.classList.remove("d-none");var n="userpass"===document.querySelector('input[name="codeFormat"]:checked').value;B(window.selectedPdfFile,e,n).then((function(r){if(t.classList.add("d-none"),r&&r.length>0){window.currentPattern=e,G(r,e,n);var i=document.getElementById("extractedCodesAlert");i.textContent="".concat(r.length," code(s) extrait(s) avec le nouveau pattern."),i.classList.remove("d-none","alert-danger"),i.classList.add("alert-success"),setTimeout((function(){i.classList.add("d-none")}),3e3)}else{var s=document.getElementById("extractedCodesAlert");s.textContent="Aucun code n'a pu être extrait avec ce pattern. L'ancien pattern a été conservé.",s.classList.remove("d-none","alert-success"),s.classList.add("alert-danger"),setTimeout((function(){s.classList.add("d-none")}),3e3)}})).catch((function(e){t.classList.add("d-none");var n=document.getElementById("extractedCodesAlert");n.textContent="Erreur lors de l'application du nouveau pattern: ".concat(e.message||"Erreur inconnue"),n.classList.remove("d-none","alert-success"),n.classList.add("alert-danger"),setTimeout((function(){n.classList.add("d-none")}),3e3)}))}}(e)}));var c=document.getElementById("cancelNewPatternBtn");c&&c.addEventListener("click",(function(){document.getElementById("refinePatternContainer").classList.add("d-none")}));var u=document.getElementById("importCodesBtn");u&&u.addEventListener("click",(function(){!function(){if(window.selectedCodes&&0!==window.selectedCodes.length){var e=document.getElementById("importProfileSelect");if(!e)return console.error("L'élément #importProfileSelect n'existe pas dans le DOM"),void H(null);var t=e.value;if(t){var n=document.getElementById("routerId");H(t,n?n.value:null)}else{var r=document.getElementById("extractedCodesAlert");r&&(r.textContent="Veuillez sélectionner un profil pour l'importation.",r.classList.remove("d-none","alert-success"),r.classList.add("alert-danger"),setTimeout((function(){r.classList.add("d-none")}),3e3))}}}()}))}()}function $(){window.currentExtractedCodes&&(window.selectedCodes=[],document.querySelectorAll(".code-checkbox").forEach((function(e){if(e.checked){var t=parseInt(e.getAttribute("data-index"));t>=0&&t<window.currentExtractedCodes.length&&window.selectedCodes.push(window.currentExtractedCodes[t])}})),document.getElementById("selectedCodesCount").textContent=window.selectedCodes.length,document.getElementById("importCodesBtn").disabled=0===window.selectedCodes.length)}function K(e){var t=document.getElementById("patternExplanation");t&&e&&(t.textContent=X(e))}function H(e,t){var n=document.getElementById("importConfirmModal");if(!n){var r=document.createElement("div");r.innerHTML='\n        <div class="modal fade" id="importConfirmModal" tabindex="-1" aria-labelledby="importConfirmModalLabel" aria-hidden="true">\n            <div class="modal-dialog modal-dialog-centered">\n                <div class="modal-content">\n                    <div class="modal-header bg-primary text-white">\n                        <h5 class="modal-title" id="importConfirmModalLabel">Confirmation d\'importation</h5>\n                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>\n                    </div>\n                    <div class="modal-body">\n                        <div class="text-center mb-4">\n                            <i class="fas fa-file-import fa-3x text-primary mb-3"></i>\n                            <h4>Importation des codes WiFi</h4>\n                            <p class="lead">Vous êtes sur le point d\'importer <strong id="codesCount"></strong> codes WiFi.</p>\n                        </div>\n                        <div class="alert alert-info">\n                            <i class="fas fa-info-circle"></i> Cette action est irréversible. Les codes seront ajoutés à votre base de données.\n                        </div>\n                    </div>\n                    <div class="modal-footer justify-content-between">\n                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">\n                            <i class="fas fa-times"></i> Annuler\n                        </button>\n                        <button type="button" class="btn btn-primary" id="confirmImportBtn">\n                            <i class="fas fa-check"></i> Confirmer l\'importation\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        ',document.body.appendChild(r.firstElementChild),n=document.getElementById("importConfirmModal")}var i=document.getElementById("codesCount");i&&(i.textContent=window.selectedCodes.length);var s=new bootstrap.Modal(n,{backdrop:"static",keyboard:!1}),o=document.getElementById("confirmImportBtn");if(o){var a=o.cloneNode(!0);o.parentNode.replaceChild(a,o),a.addEventListener("click",(function(){s.hide(),function(e,t){var n=document.getElementById("extractedCodesSpinner");n&&n.classList.remove("d-none");var r=document.getElementById("importCodesBtn");r&&(r.disabled=!0),W(window.selectedCodes,e,t,window.currentIsUserPass).then((function(){n&&n.classList.add("d-none");var e=bootstrap.Modal.getInstance(document.getElementById("extractedCodesModal"));e&&e.hide();var r=document.getElementById("importForm");r&&r.reset(),t&&_(t),t&&ue(t),function(e){var t=document.createElement("div");if(t.className="success-animation-container",t.innerHTML='\n        <div class="success-animation">\n            <div class="success-animation-icon">\n                <i class="fas fa-check-circle fa-4x text-success"></i>\n            </div>\n            <div class="success-animation-text">\n                <h4>Importation réussie !</h4>\n                <p>'.concat(e," code(s) WiFi ont été importés avec succès.</p>\n            </div>\n        </div>\n    "),!document.getElementById("success-animation-style")){var n=document.createElement("style");n.id="success-animation-style",n.textContent="\n            .success-animation-container {\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                z-index: 9999;\n                background-color: white;\n                border-radius: 10px;\n                box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n                padding: 20px;\n                text-align: center;\n                animation: fadeInOut 3s ease-in-out forwards;\n            }\n            .success-animation {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n            }\n            .success-animation-icon {\n                margin-bottom: 15px;\n                animation: scaleIn 0.5s ease-out;\n            }\n            .success-animation-text h4 {\n                margin-bottom: 10px;\n                color: #28a745;\n            }\n            @keyframes fadeInOut {\n                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }\n                20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }\n                80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }\n                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }\n            }\n            @keyframes scaleIn {\n                0% { transform: scale(0); }\n                60% { transform: scale(1.2); }\n                100% { transform: scale(1); }\n            }\n        ",document.head.appendChild(n)}document.body.appendChild(t),oe("success","".concat(e," code(s) importé(s) avec succès.")),setTimeout((function(){t&&t.parentNode&&t.parentNode.removeChild(t)}),3e3)}(window.selectedCodes.length)})).catch((function(e){n.classList.add("d-none"),r.disabled=!1;var t=document.getElementById("extractedCodesAlert");t.textContent="Erreur lors de l'importation des codes: ".concat(e.message||"Erreur inconnue"),t.classList.remove("d-none","alert-success"),t.classList.add("alert-danger")}))}(e,t)}))}s.show()}function W(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise((function(o,c){if(!e||0===e.length){var l=document.getElementById("importFormError");l&&(l.textContent="Aucun code trouvé",l.classList.remove("d-none"));var h=document.getElementById("importCodesSpinner");h&&h.classList.add("d-none");var d=document.getElementById("importCodesBtn");return d&&(d.disabled=!1),void c(new Error("Aucun code trouvé"))}console.log("Importation de ".concat(e.length," codes pour le profil ").concat(n));var f=[],p=new Set;e.forEach((function(e){var n=function(e){if(i&&"object"===(0,t.A)(e))return"".concat(e.username,":").concat(e.password);if("string"==typeof e){var n=e.split(",").map((function(e){return e.trim()}));return n.length>=2?"".concat(n[0],":").concat(n[1]):e}return null}(e);n&&!p.has(n)&&(p.add(n),f.push(e))})),console.log("Après déduplication: ".concat(f.length," codes uniques"));var m=(0,u.wP)(g),y=0,v=function(){var e=(0,s.A)(a().mark((function e(o){var c,l,h,d,p,b,I,E,T,C,x,S,k,A,D,N,P,L,R,O,M,F,B,U,V;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=m,o>0&&(c=(0,u.wP)(g)),l=Math.min(o+500,f.length),h=(0,u.rJ)(g,"wifiCodes"),d=(0,u.P)(h,(0,u._M)("routerId","==",r),(0,u._M)("profileId","==",n)),e.next=8,(0,u.GG)(d);case 8:for(p=e.sent,b=new Set,p.forEach((function(e){var t=e.data(),n="".concat(t.username,":").concat(t.password);b.add(n)})),console.log("".concat(b.size," codes existants déjà dans la base de données")),I=o;I<l;I++)E=f[I],T=void 0,C=void 0,i&&"object"===(0,t.A)(E)?(T=E.username,C=E.password):"string"==typeof E&&((x=E.split(",").map((function(e){return e.trim()}))).length>=2?(T=x[0],C=x[1]):(T=E,C=E)),T&&C&&(S="".concat(T,":").concat(C),b.has(S)||(k=(0,u.H9)(h),c.set(k,{username:T,password:C,profileId:n,routerId:r,status:"available",createdAt:(0,u.O5)(),updatedAt:(0,u.O5)()}),y++));if(!(y>0)){e.next=19;break}return e.next=16,c.commit();case 16:console.log("Lot de ".concat(y," codes importés avec succès")),e.next=20;break;case 19:console.log("Aucun nouveau code à importer dans ce lot");case 20:if(!(l<f.length)){e.next=22;break}return e.abrupt("return",v(l));case 22:if(0!==y){e.next=31;break}return console.log("Aucun nouveau code importé. Tous les codes existaient déjà."),(A=document.getElementById("importFormError"))&&(A.textContent="Aucun nouveau code importé. Tous les codes existaient déjà.",A.classList.remove("d-none")),(D=document.getElementById("importCodesSpinner"))&&D.classList.add("d-none"),(N=document.getElementById("importCodesBtn"))&&(N.disabled=!1),e.abrupt("return");case 31:return e.prev=31,P=(0,u.H9)(g,"profiles",n),e.next=35,(0,u.c4)(g,function(){var e=(0,s.A)(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get(P);case 2:(n=e.sent).exists()&&(r=n.data().stats||{},t.update(P,{"stats.totalCodes":(r.totalCodes||0)+y,"stats.availableCodes":(r.availableCodes||0)+y,updatedAt:(0,u.O5)()}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 35:console.log("Statistiques du profil mises à jour avec succès"),e.next=41;break;case 38:e.prev=38,e.t0=e.catch(31),console.error("Erreur lors de la mise à jour des statistiques du profil:",e.t0);case 41:try{(L=document.getElementById("importCodesModal"))&&(R=bootstrap.Modal.getInstance(L))&&R.hide()}catch(e){console.error("Erreur lors de la fermeture du modal:",e)}try{_(r),console.log("Codes rechargés avec succès")}catch(e){console.error("Erreur lors du rechargement des codes:",e)}try{w(r),console.log("Profils rechargés avec succès")}catch(e){console.error("Erreur lors du rechargement des profils:",e)}(O=document.getElementById("importCodesForm"))&&O.reset(),(M=document.getElementById("importFormError"))&&M.classList.add("d-none"),(F=document.getElementById("extractedCodesContainer"))&&F.classList.add("d-none"),window.extractedCodes=[],(B=document.getElementById("importCodesSpinner"))&&B.classList.add("d-none"),(U=document.getElementById("importCodesBtn"))&&(U.disabled=!1),he("importSuccess","".concat(y," codes ont été importés avec succès")),e.next=66;break;case 58:e.prev=58,e.t1=e.catch(0),console.error("Erreur lors de l'importation des codes:",e.t1),(V=document.getElementById("importFormError")).textContent="Erreur lors de l'importation des codes: "+e.t1.message,V.classList.remove("d-none"),document.getElementById("importCodesSpinner").classList.add("d-none"),document.getElementById("importCodesBtn").disabled=!1;case 66:case"end":return e.stop()}}),e,null,[[0,58],[31,38]])})));return function(t){return e.apply(this,arguments)}}();v(0).then((function(e){o(e)})).catch((function(e){c(e)}))}))}function Q(e){if(!e)return"";for(var t="^",n=0;n<e.length;n++){var r=e[n];/[A-Z]/.test(r)?t+="[A-Z]":/[a-z]/.test(r)?t+="[a-z]":/\d/.test(r)?t+="\\d":t+="\\"+r}return t+"$"}function X(e){if(!e)return"";var t=e.replace(/^\^/,"Commence par ").replace(/\$$/,"").replace(/\[A-Z\]/g,"une lettre majuscule").replace(/\[a-z\]/g,"une lettre minuscule").replace(/\\d/g,"un chiffre").replace(/\\(.)/g,'le caractère "$1"');return t.replace(/\{(\d+)\}/g,"répété $1 fois").replace(/\{(\d+),(\d+)\}/g,"répété entre $1 et $2 fois").replace(/\{(\d+),\}/g,"répété au moins $1 fois").replace(/\*/g,"répété 0 ou plusieurs fois").replace(/\+/g,"répété 1 ou plusieurs fois").replace(/\?/g,"optionnel")}function J(e){var t=document.querySelector("#extractedCodesTable thead tr");t&&(t.innerHTML=e?"\n            <th>Utilisateur</th>\n            <th>Mot de passe</th>\n            <th>Actions</th>\n        ":"\n            <th>Code</th>\n            <th>Actions</th>\n        ")}function Y(e){["routerDashboardLink","wifiCodesLink","clientsLink","paymentsLink","routerSettingsLink"].forEach((function(t){var n=document.getElementById(t);if(n){var r=n.getAttribute("href");if(r)if(r.includes("?id=")){var i=r.replace(/[?&]id=[^&]*/,"?id=".concat(e));n.href=i}else r.includes("?")?n.href="".concat(r,"&id=").concat(e):n.href="".concat(r,"?id=").concat(e)}}))}function Z(){return(Z=(0,s.A)(a().mark((function e(t,n){var r,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=(0,u.H9)(g,"routers",n,"profiles",t),e.next=4,(0,u.x7)(r);case 4:(i=e.sent).exists()?(s=i.data(),document.getElementById("editProfileId").value=t,document.getElementById("editProfileName").value=s.name||"",document.getElementById("editProfileDescription").value=s.description||"",document.getElementById("editProfileDuration").value=s.duration||"",document.getElementById("editProfilePrice").value=s.price||"",document.getElementById("editProfileFormError").classList.add("d-none"),new bootstrap.Modal(document.getElementById("editProfileModal")).show()):oe("error","Profil introuvable"),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Erreur lors de la récupération du profil:",e.t0),oe("error","Erreur lors de la récupération du profil");case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function ee(e,t){return te.apply(this,arguments)}function te(){return(te=(0,s.A)(a().mark((function e(t,n){var r,i,s,o,c,l,h;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(confirm("Voulez-vous vraiment supprimer ce profil ? Cette action est irréversible.")){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,console.log("Suppression du profil ".concat(t," du routeur ").concat(n)),t&&n){e.next=6;break}throw new Error("ID de profil ou de routeur manquant");case 6:return r=(0,u.H9)(g,"profiles",t),e.next=9,(0,u.x7)(r);case 9:if(e.sent.exists()){e.next=17;break}return i=(0,u.H9)(g,"routers",n,"profiles",t),e.next=14,(0,u.x7)(i);case 14:if(e.sent.exists()){e.next=17;break}throw new Error("Profil introuvable");case 17:return s=(0,u.rJ)(g,"wifiCodes"),o=(0,u.P)(s,(0,u._M)("profileId","==",t)),e.next=21,(0,u.GG)(o);case 21:if(c=e.sent,l=(0,u.wP)(g),c.empty){e.next=28;break}if(confirm("Ce profil a ".concat(c.size," codes associés. Voulez-vous vraiment le supprimer ? Tous les codes associés seront également supprimés."))){e.next=26;break}return e.abrupt("return");case 26:c.forEach((function(e){l.delete(e.ref)})),console.log("".concat(c.size," codes associés marqués pour suppression"));case 28:return l.delete(r),h=(0,u.H9)(g,"routers",n,"profiles",t),l.delete(h),e.next=33,l.commit();case 33:console.log("Profil ".concat(t," supprimé avec succès")),w(n),oe("success","Le profil a été supprimé avec succès."),e.next=42;break;case 38:e.prev=38,e.t0=e.catch(2),console.error("Erreur lors de la suppression du profil:",e.t0),oe("error","Erreur lors de la suppression du profil: "+e.t0.message);case 42:case"end":return e.stop()}}),e,null,[[2,38]])})))).apply(this,arguments)}function ne(e,t,n){var r="".concat(window.location.origin,"/profilbuy-code.html?routerId=").concat(t,"&profileId=").concat(e);navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(r).then((function(){oe("success","Lien d'achat pour \"".concat(n,'" copié dans le presse-papier'))})).catch((function(e){console.error("Erreur lors de la copie du lien:",e),re(r,n)})):re(r,n)}function re(e,t){try{var n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",document.body.appendChild(n),n.focus(),n.select();var r=document.execCommand("copy");document.body.removeChild(n),r?oe("success","Lien d'achat pour \"".concat(t,'" copié dans le presse-papier')):oe("warning","Impossible de copier automatiquement. Voici le lien : ".concat(e))}catch(t){console.error("Erreur lors de la copie du lien (méthode de secours):",t),oe("warning","Impossible de copier automatiquement. Voici le lien : ".concat(e))}}function ie(e,t){return se.apply(this,arguments)}function se(){return(se=(0,s.A)(a().mark((function e(t,n){var r,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=(0,u.H9)(g,"routers",n,"profiles",t),e.next=4,(0,u.x7)(r);case 4:if(!(i=e.sent).exists()){e.next=7;break}return e.abrupt("return",i.data().name||"Profil sans nom");case 7:return e.abrupt("return","Profil inconnu");case 10:return e.prev=10,e.t0=e.catch(0),console.error("Erreur lors de la récupération du nom du profil:",e.t0),e.abrupt("return","Profil inconnu");case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function oe(e,t){var n="success"===e?"profilesSuccess":"profilesError",r=document.getElementById(n);r&&(r.textContent=t,r.classList.remove("d-none"),setTimeout((function(){r.classList.add("d-none")}),3e3))}function ae(){return ae=(0,s.A)(a().mark((function e(t){var n,r,o,c,l,h,d,f,p,m,y,v,w,b=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=b.length>1&&void 0!==b[1]?b[1]:null,r=b.length>2&&void 0!==b[2]?b[2]:null,console.log("Chargement des codes WiFi pour le routeur:",t),e.prev=3,(o=document.getElementById("loadingCodes"))&&o.classList.remove("d-none"),(c=document.getElementById("wifiCodesIndexError"))&&c.classList.add("d-none"),e.next=10,i.e(118).then(i.bind(i,118));case 10:return l=e.sent,h=l.executeWithIndexErrorHandling,d=l.checkAndCreateCollection,e.next=15,d("wifiCodes");case 15:return f=(0,u.rJ)(g,"wifiCodes"),p=[(0,u._M)("routerId","==",t)],n&&p.push((0,u._M)("profileId","==",n)),r&&p.push((0,u._M)("status","==",r)),e.next=21,h((0,s.A)(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.P.apply(void 0,[f].concat(p)),e.next=3,(0,u.GG)(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),(function(e){return console.log("".concat(e.size," codes WiFi trouvés")),e}),function(){var e=(0,s.A)(a().mark((function e(s){var o,c,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.warn("Erreur d'index lors de la requête des codes WiFi, utilisation d'une requête simple"),!document.getElementById("wifiCodesIndexError")){e.next=8;break}return e.next=5,i.e(118).then(i.bind(i,118));case 5:(0,e.sent.displayIndexError)("wifiCodesIndexError",s);case 8:return o=(0,u.P)(f,(0,u._M)("routerId","==",t)),e.next=11,(0,u.GG)(o);case 11:return c=e.sent,l=[],c.forEach((function(e){var t=e.data(),i=!0;n&&t.profileId!==n&&(i=!1),r&&t.status!==r&&(i=!1),i&&l.push(e)})),e.abrupt("return",{size:l.length,docs:l,forEach:function(e){return l.forEach(e)}});case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){throw console.error("Erreur lors de la requête des codes WiFi:",e),e}));case 21:return ce(m=e.sent,t),o&&o.classList.add("d-none"),ue(t),e.abrupt("return",m.size);case 28:return e.prev=28,e.t0=e.catch(3),console.error("Erreur lors du chargement des codes WiFi:",e.t0),(y=document.getElementById("loadingCodes"))&&y.classList.add("d-none"),(v=document.getElementById("wifiCodesError"))&&(v.innerHTML='\n                <div class="alert alert-danger">\n                    <h5><i class="fas fa-exclamation-triangle me-2"></i>Erreur</h5>\n                    <p>Impossible de charger les codes WiFi. Veuillez réessayer ou contacter l\'administrateur.</p>\n                    <p class="mb-0"><small>Détails: '.concat(e.t0.message,"</small></p>\n                </div>\n            "),v.classList.remove("d-none")),(w=document.getElementById("noCodes"))&&w.classList.remove("d-none"),e.abrupt("return",0);case 38:case"end":return e.stop()}}),e,null,[[3,28]])}))),ae.apply(this,arguments)}function ce(e,t){console.log("Mise à jour de la liste des codes WiFi");var n=document.getElementById("wifiCodesList");n?(n.innerHTML="",0!==e.size?e.forEach((function(e){var r=e.data();r.id=e.id;var i=document.createElement("tr"),s="",o="";switch(r.status){case"available":s="bg-success",o="Disponible";break;case"used":s="bg-warning",o="Utilisé";break;case"expired":s="bg-danger",o="Expiré";break;default:s="bg-secondary",o=r.status||"Inconnu"}var a="N/A";if(r.createdAt)try{"function"==typeof r.createdAt.toDate?a=new Date(r.createdAt.toDate()).toLocaleDateString("fr-FR"):r.createdAt instanceof Date?a=r.createdAt.toLocaleDateString("fr-FR"):"string"==typeof r.createdAt&&(a=new Date(r.createdAt).toLocaleDateString("fr-FR"))}catch(e){console.error("Erreur lors du formatage de la date:",e),a="Date invalide"}i.innerHTML='\n            <td>\n                <span class="badge '.concat(s,'">').concat(o,"</span>\n            </td>\n            <td>").concat(r.username||"N/A","</td>\n            <td>").concat(r.password||"N/A","</td>\n            <td>").concat(r.profileName||"Profil inconnu","</td>\n            <td>").concat(a,'</td>\n            <td>\n                <div class="dropdown">\n                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">\n                        Actions\n                    </button>\n                    <ul class="dropdown-menu dropdown-menu-end">\n                        <li><a class="dropdown-item view-code-btn" href="#" data-id="').concat(r.id,'"><i class="fas fa-eye me-1"></i> Détails</a></li>\n                        <li><a class="dropdown-item copy-code-btn" href="#" data-id="').concat(r.id,'"><i class="fas fa-copy me-1"></i> Copier</a></li>\n                        <li><a class="dropdown-item print-code-btn" href="#" data-id="').concat(r.id,'"><i class="fas fa-print me-1"></i> Imprimer</a></li>\n                        <li><hr class="dropdown-divider"></li>\n                        <li><a class="dropdown-item edit-code-btn" href="#" data-id="').concat(r.id,'"><i class="fas fa-edit me-1"></i> Modifier</a></li>\n                        <li><a class="dropdown-item delete-code-btn" href="#" data-id="').concat(r.id,'"><i class="fas fa-trash me-1"></i> Supprimer</a></li>\n                    </ul>\n                </div>\n            </td>\n        '),n.appendChild(i),i.querySelector(".view-code-btn").addEventListener("click",(function(e){e.preventDefault(),viewWifiCode(r.id,t)})),i.querySelector(".copy-code-btn").addEventListener("click",(function(e){e.preventDefault(),copyWifiCode(r.id,t)})),i.querySelector(".print-code-btn").addEventListener("click",(function(e){e.preventDefault(),printWifiCode(r.id,t)})),i.querySelector(".edit-code-btn").addEventListener("click",(function(e){e.preventDefault(),editWifiCode(r.id,t)})),i.querySelector(".delete-code-btn").addEventListener("click",(function(e){e.preventDefault(),deleteWifiCode(r.id,t)}))})):n.innerHTML='\n            <tr>\n                <td colspan="6" class="text-center py-4">\n                    <div class="text-muted">\n                        <i class="fas fa-key fa-3x mb-3"></i>\n                        <p>Aucun code WiFi trouvé</p>\n                    </div>\n                </td>\n            </tr>\n        '):console.error("Conteneur wifiCodesList non trouvé")}function ue(e){return le.apply(this,arguments)}function le(){return(le=(0,s.A)(a().mark((function e(t){var n,r,i,s,o,c,l,h,d,f,p,m,y,v;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Mise à jour des compteurs de codes WiFi"),e.prev=1,e.next=4,checkAndCreateCollection("wifiCodes");case 4:return n=(0,u.P)((0,u.rJ)(g,"wifiCodes"),(0,u._M)("routerId","==",t),(0,u._M)("status","==","available")),e.prev=5,e.next=8,(0,u.GG)(n);case 8:return r=e.sent,i=r.size,(s=document.getElementById("availableCodesCount"))&&(s.textContent=i),o=(0,u.P)((0,u.rJ)(g,"wifiCodes"),(0,u._M)("routerId","==",t)),e.next=15,(0,u.GG)(o);case 15:return c=e.sent,l=c.size,(h=document.getElementById("totalCodesCount"))&&(h.textContent=l),e.abrupt("return",{available:i,total:l});case 22:if(e.prev=22,e.t0=e.catch(5),!handleFirebaseError(e.t0).isIndexError){e.next=41;break}return console.warn("Erreur d'index lors du comptage des codes WiFi, utilisation d'un comptage manuel"),d=(0,u.P)((0,u.rJ)(g,"wifiCodes"),(0,u._M)("routerId","==",t)),e.next=30,(0,u.GG)(d);case 30:return f=e.sent,p=0,m=f.size,f.forEach((function(e){"available"===e.data().status&&p++})),(y=document.getElementById("availableCodesCount"))&&(y.textContent=p),(v=document.getElementById("totalCodesCount"))&&(v.textContent=m),e.abrupt("return",{available:p,total:m});case 41:throw e.t0;case 42:e.next=48;break;case 44:return e.prev=44,e.t1=e.catch(1),console.error("Erreur lors de la mise à jour des compteurs de codes WiFi:",e.t1),e.abrupt("return",{available:0,total:0});case 48:case"end":return e.stop()}}),e,null,[[1,44],[5,22]])})))).apply(this,arguments)}function he(e,t){var n=document.getElementById(e);n&&(n.textContent=t,n.classList.remove("d-none"),setTimeout((function(){n.classList.add("d-none")}),5e3))}function de(){return(de=(0,s.A)(a().mark((function e(t,n){var r,i,o,c,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=(0,u.H9)(g,"profiles",t),e.next=4,(0,u.x7)(r);case 4:if((i=e.sent).exists()){e.next=8;break}return alert("Profil non trouvé"),e.abrupt("return");case 8:o=i.data(),document.getElementById("editProfileId").value=t,document.getElementById("editProfileName").value=o.name||"",document.getElementById("editProfileDescription").value=o.description||"",document.getElementById("editProfileDuration").value=o.duration||"",document.getElementById("editProfilePrice").value=o.price||"",new bootstrap.Modal(document.getElementById("editProfileModal")).show(),c=document.getElementById("saveEditProfileBtn"),l=c.cloneNode(!0),c.parentNode.replaceChild(l,c),l.addEventListener("click",(0,s.A)(a().mark((function e(){var t,i,s,o,c,h,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("editProfileName").value.trim(),i=document.getElementById("editProfileDescription").value.trim(),s=document.getElementById("editProfileDuration").value.trim(),o=parseFloat(document.getElementById("editProfilePrice").value),t&&s&&!isNaN(o)){e.next=9;break}return(c=document.getElementById("editProfileFormError")).textContent="Veuillez remplir tous les champs obligatoires",c.classList.remove("d-none"),e.abrupt("return");case 9:return(h=document.getElementById("editProfileSpinner")).classList.remove("d-none"),l.disabled=!0,e.prev=12,e.next=15,(0,u.mZ)(r,{name:t,description:i,duration:s,price:o,updatedAt:(0,u.O5)()});case 15:bootstrap.Modal.getInstance(document.getElementById("editProfileModal")).hide(),w(n),he("profilesSuccess","Le profil a été mis à jour avec succès."),e.next=27;break;case 21:e.prev=21,e.t0=e.catch(12),console.error("Erreur lors de la mise à jour du profil:",e.t0),(d=document.getElementById("editProfileFormError")).textContent="Erreur lors de la mise à jour du profil: "+e.t0.message,d.classList.remove("d-none");case 27:return e.prev=27,h.classList.add("d-none"),l.disabled=!1,e.finish(27);case 31:case"end":return e.stop()}}),e,null,[[12,21,27,31]])})))),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(0),console.error("Erreur lors de la récupération du profil:",e.t0),alert("Erreur lors de la récupération du profil: "+e.t0.message);case 26:case"end":return e.stop()}}),e,null,[[0,22]])})))).apply(this,arguments)}[O,M].forEach((function(e){e.addEventListener("input",(function(){var e=O.value.trim(),t=M.value.trim();if(e&&t){var n=Q(e),r=Q(t),i="".concat(n,"\\s+").concat(r);document.getElementById("detectedPattern").value=i,document.getElementById("patternExplanation").textContent="Pattern utilisateur : "+X(n)+" | Pattern mot de passe : "+X(r)}else document.getElementById("detectedPattern").value="",document.getElementById("patternExplanation").textContent="Entrez des exemples pour générer automatiquement un pattern"}))})),document.getElementById("pdfFile").addEventListener("change",(function(e){if(this.files&&this.files[0]){window.selectedPdfFile=this.files[0];var t=this.files[0].name,n=document.createElement("div");n.className="alert alert-info mt-2",n.innerHTML='<i class="fas fa-file-pdf me-2"></i> Fichier sélectionné: <strong>'.concat(t,"</strong>");var r=document.querySelector("#pdfFile + .alert");r&&r.remove(),this.parentNode.insertBefore(n,this.nextSibling),document.getElementById("importFormError").classList.add("d-none"),document.getElementById("extractCodesBtn").disabled=!1}})),document.getElementById("extractCodesBtn").addEventListener("click",(function(){var e=this;if(!window.selectedPdfFile){var t=document.getElementById("importFormError");return t.textContent="Veuillez sélectionner un fichier PDF.",void t.classList.remove("d-none")}var n=document.getElementById("detectedPattern").value,r=document.getElementById("formatUserPass").checked;n||(console.log("Aucun pattern fourni, génération d'un pattern par défaut"),r?(n="([A-Za-z0-9]{4,})\\s+([A-Za-z0-9]{4,})",document.getElementById("detectedPattern").value=n,document.getElementById("patternExplanation").textContent="Pattern par défaut: 4+ caractères alphanumériques, espace, 4+ caractères alphanumériques"):(n="[A-Za-z0-9]{4,}",document.getElementById("detectedPattern").value=n,document.getElementById("patternExplanation").textContent="Pattern par défaut: 4+ caractères alphanumériques"));var i=document.getElementById("extractCodesSpinner");i.classList.remove("d-none"),this.disabled=!0,B(window.selectedPdfFile,n,r).then((function(t){if(window.extractedCodes=t||[],i.classList.add("d-none"),e.disabled=!1,t&&t.length>0)window.extractedCodes=t,bootstrap.Modal.getInstance(document.getElementById("importCodesModal")).hide(),G(t,n,r),new bootstrap.Modal(document.getElementById("extractedCodesModal"),{backdrop:"static",keyboard:!1}).show();else{var s=document.getElementById("importFormError");s.textContent="Aucun code n'a pu être extrait du PDF. Essayez avec un exemple différent ou un autre fichier.",s.classList.remove("d-none")}})).catch((function(t){console.error("Erreur lors du traitement du PDF:",t);var n=document.getElementById("importFormError");n.textContent="Erreur lors du traitement du PDF: ".concat(t.message||"Erreur inconnue"),n.classList.remove("d-none"),i.classList.add("d-none"),e.disabled=!1}))}))})()})();