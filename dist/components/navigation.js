function activateCurrentPageLink(){const e=window.location.pathname.split("/").pop()||"index.html";let t;switch(document.querySelectorAll("#mainNavigation .nav-link").forEach((e=>{e.classList.remove("active")})),!0){case e.includes("dashboard"):t=document.getElementById("nav-dashboard");break;case e.includes("routers"):t=document.getElementById("nav-routers");break;case e.includes("stats"):t=document.getElementById("nav-stats");break;case e.includes("logs"):t=document.getElementById("nav-logs");break;case e.includes("notifications"):t=document.getElementById("nav-notifications");break;case e.includes("settings"):t=document.getElementById("nav-settings")}t&&t.classList.add("active")}function setupRouterNavigation(){console.log("Initialisation de la navigation du routeur");const e=window.routerUtils.getRouterId();if(console.log("ID du routeur détecté:",e),!e){const e=document.getElementById("routerSubNav");return e&&e.classList.add("d-none"),document.body.classList.remove("has-router-sidebar"),void document.body.classList.remove("has-router-bottom-nav")}const t=document.getElementById("routerSubNav");if(t){if(t.classList.remove("d-none"),window.innerWidth>=992){document.body.classList.add("has-router-sidebar"),document.body.classList.remove("has-router-bottom-nav"),t.classList.add("router-sidebar");const e=t.querySelector(".nav-pills");e&&(e.classList.add("flex-column"),e.classList.remove("flex-nowrap"))}else{document.body.classList.add("has-router-bottom-nav"),document.body.classList.remove("has-router-sidebar"),t.classList.remove("router-sidebar");const e=t.querySelector(".nav-pills");e&&(e.classList.remove("flex-column"),e.classList.add("flex-nowrap"))}void 0!==window.routerUtils&&"function"==typeof window.routerUtils.updateRouterNavigationLinks?window.routerUtils.updateRouterNavigationLinks(e):(console.error("La fonction updateRouterNavigationLinks n'est pas disponible"),updateRouterLinksManually(e));const o=window.location.pathname.split("/").pop()||"index.html";document.querySelectorAll("#routerSubNav .nav-link").forEach((e=>{e.classList.remove("active")}));let n=null;if(o.includes("router-dashboard")?n="nav-router-dashboard":o.includes("clients")?n="nav-router-users":o.includes("wifi-codes")?n="nav-router-wifi-codes":o.includes("payments")?n="nav-router-payments":o.includes("router-settings")&&(n="nav-router-settings"),n){const e=document.getElementById(n);e&&(e.classList.add("active"),console.log("Lien activé:",n))}else console.log("Aucun lien à activer pour la page:",o);displayRouterName(e),window.addEventListener("resize",handleRouterNavResponsive)}}function updateRouterLinksManually(e){if(!e)return void console.warn("Tentative de mise à jour manuelle des liens sans ID de routeur");const t={"nav-router-dashboard":`router-dashboard.html?id=${e}`,"nav-router-users":`clients.html?id=${e}`,"nav-router-wifi-codes":`wifi-codes.html?id=${e}`,"nav-router-payments":`payments.html?id=${e}`,"nav-router-settings":`router-settings.html?id=${e}`};Object.entries(t).forEach((([e,t])=>{const o=document.getElementById(e);o?(o.setAttribute("href",t),console.log(`Mise à jour manuelle du lien ${e} vers ${t}`)):console.warn(`Lien avec ID ${e} non trouvé dans le DOM`)}))}function handleRouterNavResponsive(){const e=document.getElementById("routerSubNav");if(!e||e.classList.contains("d-none"))return;const t=e.querySelector(".nav-pills");window.innerWidth>=992?(document.body.classList.add("has-router-sidebar"),document.body.classList.remove("has-router-bottom-nav"),e.classList.add("router-sidebar"),t&&(t.classList.add("flex-column"),t.classList.remove("flex-nowrap"))):(document.body.classList.add("has-router-bottom-nav"),document.body.classList.remove("has-router-sidebar"),e.classList.remove("router-sidebar"),t&&(t.classList.remove("flex-column"),t.classList.add("flex-nowrap")))}async function displayRouterName(e){try{console.log("Tentative d'affichage du nom du routeur:",e);const t=document.getElementById("currentRouterName");if(!t)return void console.warn("L'élément pour afficher le nom du routeur n'existe pas");t.textContent="Routeur "+e.substring(0,4);let o=0;const n=10;for(;o<n&&!window.db&&(!window.firebase||!window.firebase.firestore);)console.log(`Attente de l'initialisation de Firebase (tentative ${o+1}/${n})`),await new Promise((e=>setTimeout(e,500))),o++;if(!(window.db||window.firebase&&window.firebase.firestore()))return void console.warn("Firebase n'est pas initialisé après plusieurs tentatives");try{let o;if(window.db&&window.doc&&window.getDoc)console.log("Utilisation de l'API Firebase moderne"),o=await window.getDoc(window.doc(window.db,"routers",e));else{if(!window.firebase||"function"!=typeof window.firebase.firestore)return void console.warn("Aucune API Firebase disponible");{console.log("Utilisation de l'API Firebase ancienne");const t=window.firebase.firestore().collection("routers").doc(e);o=await t.get()}}if(o&&o.exists()){const n=o.data();t.textContent=n.name||"Routeur "+e.substring(0,4),console.log("Nom du routeur récupéré:",n.name)}else console.warn("Le document du routeur n'existe pas dans Firestore")}catch(e){console.error("Erreur Firebase lors de la récupération du nom du routeur:",e)}}catch(e){console.error("Erreur lors de la récupération du nom du routeur:",e)}}function setupLogoutButton(){const e=document.getElementById("navLogoutBtn");e&&e.addEventListener("click",(async e=>{e.preventDefault();try{if("undefined"==typeof auth)return void console.warn("Firebase n'est pas initialisé dans ce contexte");await signOut(auth),window.location.href="index.html"}catch(e){console.error("Erreur lors de la déconnexion:",e),alert("Erreur lors de la déconnexion. Veuillez réessayer.")}}))}function displayUserName(){const e=document.getElementById("navUserName");e&&("undefined"!=typeof auth?auth.onAuthStateChanged((t=>{e.textContent=t&&(t.displayName||t.email)||"Utilisateur"})):console.warn("Firebase n'est pas initialisé dans ce contexte"))}document.addEventListener("DOMContentLoaded",(async()=>{window.routerUtils||(console.warn("routerUtils non disponible. Certaines fonctionnalités de navigation peuvent être limitées."),window.routerUtils={getRouterId:function(){const e=new URLSearchParams(window.location.search);let t=e.get("routerId")||e.get("id");return console.log("ID du routeur détecté (fallback):",t||"aucun"),t},isRouterPage:function(){return null!==this.getRouterId()},updateRouterNavigationLinks:function(){console.warn("Fonction updateRouterNavigationLinks non disponible")}});const e=document.getElementById("navigation-container");if(e)try{const t=await fetch("./components/navigation.html");if(!t.ok)throw new Error(`Erreur lors du chargement de la navigation: ${t.status}`);const o=await t.text();e.innerHTML=o,activateCurrentPageLink(),setupRouterNavigation(),setupLogoutButton(),displayUserName()}catch(t){console.error("Erreur lors du chargement de la navigation:",t),e.innerHTML='\n            <div class="alert alert-danger">\n                Impossible de charger la navigation. Veuillez rafraîchir la page ou contacter l\'administrateur.\n            </div>\n        '}else console.error("Conteneur de navigation non trouvé. Assurez-vous d'ajouter un div avec id='navigation-container' dans vos pages.")}));