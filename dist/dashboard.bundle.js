/*! For license information please see dashboard.bundle.js.LICENSE.txt */
(()=>{var t={56:(t,e,n)=>{"use strict";var i=n(467),r=n(461);(0,r.KO)("firebase","9.23.0","app");var s=n(405),o=n(908),a=n(743),c=n(125);const l="firebasestorage.googleapis.com",u="storageBucket";class h extends a.g{constructor(t,e,n=0){super(p(t),`Firebase Storage: ${e} (${p(t)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,h.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return p(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var d,f;function p(t){return"storage/"+t}function g(){return new h(d.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function m(t){return new h(d.INVALID_ARGUMENT,t)}function y(){return new h(d.APP_DELETED,"The Firebase app was deleted.")}function v(t,e){return new h(d.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function b(t){throw new h(d.INTERNAL_ERROR,"Internal error: "+t)}!function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(d||(d={}));class w{constructor(t,e){this.bucket=t,this.path_=e}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=w.makeFromUrl(t,e)}catch(e){return new w(t,"")}if(""===n.path)return n;throw i=t,new h(d.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.");var i}static makeFromUrl(t,e){let n=null;const i="([A-Za-z0-9.\\-_]+)",r=new RegExp("^gs://"+i+"(/(.*))?$","i");function s(t){t.path_=decodeURIComponent(t.path)}const o=e.replace(/[.]/g,"\\."),a=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${e===l?"(?:storage.googleapis.com|storage.cloud.google.com)":e}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let e=0;e<a.length;e++){const i=a[e],r=i.regex.exec(t);if(r){const t=r[i.indices.bucket];let e=r[i.indices.path];e||(e=""),n=new w(t,e),i.postModify(n);break}}if(null==n)throw function(t){return new h(d.INVALID_URL,"Invalid URL '"+t+"'.")}(t);return n}}class _{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}function x(t){return"string"==typeof t||t instanceof String}function I(t){return E()&&t instanceof Blob}function E(){return"undefined"!=typeof Blob&&!(0,a.Ll)()}function T(t,e,n,i){if(i<e)throw m(`Invalid value for '${t}'. Expected ${e} or greater.`);if(i>n)throw m(`Invalid value for '${t}'. Expected ${n} or less.`)}function k(t,e,n){let i=e;return null==n&&(i=`https://${e}`),`${n}://${i}/v0${t}`}function S(t){const e=encodeURIComponent;let n="?";for(const i in t)t.hasOwnProperty(i)&&(n=n+(e(i)+"=")+e(t[i])+"&");return n=n.slice(0,-1),n}!function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"}(f||(f={}));class C{constructor(t,e,n,i,r,s,o,a,c,l,u,h=!0){this.url_=t,this.method_=e,this.headers_=n,this.body_=i,this.successCodes_=r,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=u,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((t,e)=>{this.resolve_=t,this.reject_=e,this.start_()}))}start_(){const t=(t,e)=>{const n=this.resolve_,i=this.reject_,r=e.connection;if(e.wasSuccessCode)try{const t=this.callback_(r,r.getResponse());void 0!==t?n(t):n()}catch(t){i(t)}else if(null!==r){const t=g();t.serverResponse=r.getErrorText(),this.errorCallback_?i(this.errorCallback_(r,t)):i(t)}else e.canceled?i(this.appDelete_?y():new h(d.CANCELED,"User canceled the upload/download.")):i(new h(d.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?t(0,new A(!1,null,!0)):this.backoffId_=function(t,e,n){let i=1,r=null,s=null,o=!1,a=0;function c(){return 2===a}let l=!1;function u(...t){l||(l=!0,e.apply(null,t))}function h(e){r=setTimeout((()=>{r=null,t(f,c())}),e)}function d(){s&&clearTimeout(s)}function f(t,...e){if(l)return void d();if(t)return d(),void u.call(null,t,...e);if(c()||o)return d(),void u.call(null,t,...e);let n;i<64&&(i*=2),1===a?(a=2,n=0):n=1e3*(i+Math.random()),h(n)}let p=!1;function g(t){p||(p=!0,d(),l||(null!==r?(t||(a=2),clearTimeout(r),h(0)):t||(a=1)))}return h(0),s=setTimeout((()=>{o=!0,g(!0)}),n),g}(((t,e)=>{if(e)return void t(!1,new A(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const i=t=>{const e=t.loaded,n=t.lengthComputable?t.total:-1;null!==this.progressCallback_&&this.progressCallback_(e,n)};null!==this.progressCallback_&&n.addUploadProgressListener(i),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(i),this.pendingConnection_=null;const e=n.getErrorCode()===f.NO_ERROR,r=n.getStatus();if(!e||function(t,e){const n=t>=500&&t<600,i=-1!==[408,429].indexOf(t),r=-1!==e.indexOf(t);return n||i||r}(r,this.additionalRetryCodes_)&&this.retry){const e=n.getErrorCode()===f.ABORT;return void t(!1,new A(!1,null,e))}const s=-1!==this.successCodes_.indexOf(r);t(!0,new A(s,n))}))}),t,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class A{constructor(t,e,n){this.wasSuccessCode=t,this.connection=e,this.canceled=!!n}}function D(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function M(...t){const e=D();if(void 0!==e){const n=new e;for(let e=0;e<t.length;e++)n.append(t[e]);return n.getBlob()}if(E())return new Blob(t);throw new h(d.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}const O="base64",P="base64url",R="data_url";class N{constructor(t,e){this.data=t,this.contentType=e||null}}function L(t){const e=[];for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);i<=127?e.push(i):i<=2047?e.push(192|i>>6,128|63&i):55296==(64512&i)?n<t.length-1&&56320==(64512&t.charCodeAt(n+1))?(i=65536|(1023&i)<<10|1023&t.charCodeAt(++n),e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i)):e.push(239,191,189):56320==(64512&i)?e.push(239,191,189):e.push(224|i>>12,128|i>>6&63,128|63&i)}return new Uint8Array(e)}function F(t,e){switch(t){case O:{const n=-1!==e.indexOf("-"),i=-1!==e.indexOf("_");if(n||i)throw v(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case P:{const n=-1!==e.indexOf("+"),i=-1!==e.indexOf("/");if(n||i)throw v(t,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=function(t){if("undefined"==typeof atob)throw new h(d.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(t)}(e)}catch(e){if(e.message.includes("polyfill"))throw e;throw v(t,"Invalid character found")}const i=new Uint8Array(n.length);for(let t=0;t<n.length;t++)i[t]=n.charCodeAt(t);return i}class V{constructor(t){this.base64=!1,this.contentType=null;const e=t.match(/^data:([^,]+)?,/);if(null===e)throw v(R,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=e[1]||null;var i,r;null!=n&&(this.base64=(r=";base64",(i=n).length>=7&&i.substring(i.length-7)===r),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=t.substring(t.indexOf(",")+1)}}class B{constructor(t,e){let n=0,i="";I(t)?(this.data_=t,n=t.size,i=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=i}size(){return this.size_}type(){return this.type_}slice(t,e){if(I(this.data_)){const s=(n=this.data_,i=t,r=e,n.webkitSlice?n.webkitSlice(i,r):n.mozSlice?n.mozSlice(i,r):n.slice?n.slice(i,r):null);return null===s?null:new B(s)}var n,i,r;{const n=new Uint8Array(this.data_.buffer,t,e-t);return new B(n,!0)}}static getBlob(...t){if(E()){const e=t.map((t=>t instanceof B?t.data_:t));return new B(M.apply(null,e))}{const e=t.map((t=>x(t)?function(t,e){switch(t){case"raw":return new N(L(e));case O:case P:return new N(F(t,e));case R:return new N(function(t){const e=new V(t);return e.base64?F(O,e.rest):function(t){let e;try{e=decodeURIComponent(t)}catch(t){throw v(R,"Malformed data URL.")}return L(e)}(e.rest)}(e),new V(e).contentType)}throw g()}("raw",t).data:t.data_));let n=0;e.forEach((t=>{n+=t.byteLength}));const i=new Uint8Array(n);let r=0;return e.forEach((t=>{for(let e=0;e<t.length;e++)i[r++]=t[e]})),new B(i,!0)}}uploadData(){return this.data_}}function U(t){let e;try{e=JSON.parse(t)}catch(t){return null}return"object"!=typeof(n=e)||Array.isArray(n)?null:e;var n}function j(t){const e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function z(t,e){return e}class q{constructor(t,e,n,i){this.server=t,this.local=e||t,this.writable=!!n,this.xform=i||z}}let $=null;function H(){if($)return $;const t=[];t.push(new q("bucket")),t.push(new q("generation")),t.push(new q("metageneration")),t.push(new q("name","fullPath",!0));const e=new q("name");e.xform=function(t,e){return function(t){return!x(t)||t.length<2?t:j(t)}(e)},t.push(e);const n=new q("size");return n.xform=function(t,e){return void 0!==e?Number(e):e},t.push(n),t.push(new q("timeCreated")),t.push(new q("updated")),t.push(new q("md5Hash",null,!0)),t.push(new q("cacheControl",null,!0)),t.push(new q("contentDisposition",null,!0)),t.push(new q("contentEncoding",null,!0)),t.push(new q("contentLanguage",null,!0)),t.push(new q("contentType",null,!0)),t.push(new q("metadata","customMetadata",!0)),$=t,$}function K(t,e,n){const i=U(e);return null===i?null:function(t,e,n){const i={type:"file"},r=n.length;for(let t=0;t<r;t++){const r=n[t];i[r.local]=r.xform(i,e[r.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){const n=t.bucket,i=t.fullPath,r=new w(n,i);return e._makeStorageReference(r)}})}(i,t),i}(t,i,n)}class G{constructor(t,e,n,i){this.url=t,this.method=e,this.handler=n,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function W(t){if(!t)throw g()}function Q(t){return function(e,n){let i;var r,s;return 401===e.getStatus()?i=e.getErrorText().includes("Firebase App Check token is invalid")?new h(d.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new h(d.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(s=t.bucket,i=new h(d.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(r=t.path,i=new h(d.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")):i=n,i.status=e.getStatus(),i.serverResponse=n.serverResponse,i}}function Y(t){const e=Q(t);return function(n,i){let r=e(n,i);var s;return 404===n.getStatus()&&(s=t.path,r=new h(d.OBJECT_NOT_FOUND,"Object '"+s+"' does not exist.")),r.serverResponse=i.serverResponse,r}}function X(t,e,n,i,r){const s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){let t="";for(let e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();o["Content-Type"]="multipart/related; boundary="+a;const c=function(t,e,n){const i=Object.assign({},n);return i.fullPath=t.path,i.size=e.size(),i.contentType||(i.contentType=function(t,e){return e&&e.type()||"application/octet-stream"}(0,e)),i}(e,i,r),l="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+function(t,e){const n={},i=e.length;for(let r=0;r<i;r++){const i=e[r];i.writable&&(n[i.server]=t[i.local])}return JSON.stringify(n)}(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",u="\r\n--"+a+"--",f=B.getBlob(l,i,u);if(null===f)throw new h(d.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.");const p={name:c.fullPath},g=k(s,t.host,t._protocol),m=t.maxUploadRetryTime,y=new G(g,"POST",function(t,e){return function(n,i){const r=K(t,i,e);return W(null!==r),r}}(t,n),m);return y.urlParams=p,y.headers=o,y.body=f.uploadData(),y.errorHandler=Q(e),y}class J{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=f.NO_ERROR,this.sendPromise_=new Promise((t=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=f.ABORT,t()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=f.NETWORK_ERROR,t()})),this.xhr_.addEventListener("load",(()=>{t()}))}))}send(t,e,n,i){if(this.sent_)throw b("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),void 0!==i)for(const t in i)i.hasOwnProperty(t)&&this.xhr_.setRequestHeader(t,i[t].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw b("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw b("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}}getResponse(){if(!this.sent_)throw b("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw b("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",t)}}class Z extends J{initXhr(){this.xhr_.responseType="text"}}function tt(){return new Z}class et{constructor(t,e){this._service=t,this._location=e instanceof w?e:w.makeFromUrl(e,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new et(t,e)}get root(){const t=new w(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return j(this._location.path)}get storage(){return this._service}get parent(){const t=function(t){if(0===t.length)return null;const e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this._location.path);if(null===t)return null;const e=new w(this._location.bucket,t);return new et(this._service,e)}_throwIfRoot(t){if(""===this._location.path)throw function(t){return new h(d.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)}}function nt(t){t._throwIfRoot("getDownloadURL");const e=function(t,e,n){const i=k(e.fullServerUrl(),t.host,t._protocol),r=t.maxOperationRetryTime,s=new G(i,"GET",function(t,e){return function(n,i){const r=K(t,i,e);return W(null!==r),function(t,e,n,i){const r=U(e);if(null===r)return null;if(!x(r.downloadTokens))return null;const s=r.downloadTokens;if(0===s.length)return null;const o=encodeURIComponent;return s.split(",").map((e=>{const r=t.bucket,s=t.fullPath;return k("/b/"+o(r)+"/o/"+o(s),n,i)+S({alt:"media",token:e})}))[0]}(r,i,t.host,t._protocol)}}(t,n),r);return s.errorHandler=Y(e),s}(t.storage,t._location,H());return t.storage.makeRequestWithTokens(e,tt).then((t=>{if(null===t)throw new h(d.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t}))}function it(t,e){if(t instanceof st){const n=t;if(null==n._bucket)throw new h(d.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+u+"' property when initializing the app?");const i=new et(n,n._bucket);return null!=e?it(i,e):i}return void 0!==e?function(t,e){const n=function(t,e){const n=e.split("/").filter((t=>t.length>0)).join("/");return 0===t.length?n:t+"/"+n}(t._location.path,e),i=new w(t._location.bucket,n);return new et(t.storage,i)}(t,e):t}function rt(t,e){const n=null==e?void 0:e[u];return null==n?null:w.makeFromBucketSpec(n,t)}class st{constructor(t,e,n,i,r){this.app=t,this._authProvider=e,this._appCheckProvider=n,this._url=i,this._firebaseVersion=r,this._bucket=null,this._host=l,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?w.makeFromBucketSpec(i,this._host):rt(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,null!=this._url?this._bucket=w.makeFromBucketSpec(this._url,t):this._bucket=rt(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){T("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){T("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const e=await t.getToken();if(null!==e)return e.accessToken}return null}async _getAppCheckToken(){const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((t=>t.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new et(this,t)}_makeRequest(t,e,n,i,r=!0){if(this._deleted)return new _(y());{const s=function(t,e,n,i,r,s,o=!0){const a=S(t.urlParams),c=t.url+a,l=Object.assign({},t.headers);return function(t,e){e&&(t["X-Firebase-GMPID"]=e)}(l,e),function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(l,n),function(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(null!=e?e:"AppManager")}(l,s),function(t,e){null!==e&&(t["X-Firebase-AppCheck"]=e)}(l,i),new C(c,t.method,l,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,r,o)}(t,this._appId,n,i,e,this._firebaseVersion,r);return this._requests.add(s),s.getPromise().then((()=>this._requests.delete(s)),(()=>this._requests.delete(s))),s}}async makeRequestWithTokens(t,e){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,n,i).getPromise()}}const ot="@firebase/storage",at="0.11.2",ct="storage";function lt(t,e,n){return function(t,e,n){t._throwIfRoot("uploadBytes");const i=X(t.storage,t._location,H(),new B(e,!0),n);return t.storage.makeRequestWithTokens(i,tt).then((e=>({metadata:e,ref:t})))}(t=(0,a.Ku)(t),e,n)}function ut(t){return nt(t=(0,a.Ku)(t))}function ht(t,e){return function(t,e){if(e&&/^[A-Za-z]+:\/\//.test(e)){if(t instanceof st)return new et(t,e);throw m("To use ref(service, url), the first argument must be a Storage instance.")}return it(t,e)}(t=(0,a.Ku)(t),e)}(0,r.om)(new c.uA(ct,(function(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new st(n,i,s,e,r.MF)}),"PUBLIC").setMultipleInstances(!0)),(0,r.KO)(ot,at,""),(0,r.KO)(ot,at,"esm2017");var dt=n(424);let ft,pt;const gt=new WeakMap,mt=new WeakMap,yt=new WeakMap,vt=new WeakMap,bt=new WeakMap;let wt={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return mt.get(t);if("objectStoreNames"===e)return t.objectStoreNames||yt.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return xt(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function _t(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(pt||(pt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(It(this),t),xt(gt.get(this))}:function(...t){return xt(e.apply(It(this),t))}:function(t,...n){const i=e.call(It(this),t,...n);return yt.set(i,t.sort?t.sort():[t]),xt(i)}:(t instanceof IDBTransaction&&function(t){if(mt.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",s),t.removeEventListener("abort",s)},r=()=>{e(),i()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",s),t.addEventListener("abort",s)}));mt.set(t,e)}(t),n=t,(ft||(ft=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>n instanceof t))?new Proxy(t,wt):t);var e,n}function xt(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",s)},r=()=>{e(xt(t.result)),i()},s=()=>{n(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&gt.set(e,t)})).catch((()=>{})),bt.set(e,t),e}(t);if(vt.has(t))return vt.get(t);const e=_t(t);return e!==t&&(vt.set(t,e),bt.set(e,t)),e}const It=t=>bt.get(t),Et=["get","getKey","getAll","getAllKeys","count"],Tt=["put","add","delete","clear"],kt=new Map;function St(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(kt.get(e))return kt.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=Tt.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!Et.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),r&&s.done]))[0]};return kt.set(e,s),s}var Ct;Ct=wt,wt={...Ct,get:(t,e,n)=>St(t,e)||Ct.get(t,e,n),has:(t,e)=>!!St(t,e)||Ct.has(t,e)};const At="@firebase/installations",Dt="0.6.4",Mt=`w:${Dt}`,Ot="FIS_v2",Pt=new a.FA("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Rt(t){return t instanceof a.g&&t.code.includes("request-failed")}function Nt({projectId:t}){return`https://firebaseinstallations.googleapis.com/v1/projects/${t}/installations`}function Lt(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function Ft(t,e){const n=(await e.json()).error;return Pt.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Vt({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function Bt(t){const e=await t();return e.status>=500&&e.status<600?t():e}function Ut(t){return new Promise((e=>{setTimeout(e,t)}))}const jt=/^[cdef][\w-]{21}$/;function zt(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){var e;return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(t);return jt.test(e)?e:""}catch(t){return""}}function qt(t){return`${t.appName}!${t.appId}`}const $t=new Map;function Ht(t,e){const n=qt(t);Kt(n,e),function(t,e){const n=(!Gt&&"BroadcastChannel"in self&&(Gt=new BroadcastChannel("[Firebase] FID Change"),Gt.onmessage=t=>{Kt(t.data.key,t.data.fid)}),Gt);n&&n.postMessage({key:t,fid:e}),0===$t.size&&Gt&&(Gt.close(),Gt=null)}(n,e)}function Kt(t,e){const n=$t.get(t);if(n)for(const t of n)t(e)}let Gt=null;const Wt="firebase-installations-store";let Qt=null;function Yt(){return Qt||(Qt=function(t,e,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(t,e),a=xt(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(xt(o.result),t.oldVersion,t.newVersion,xt(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{s&&t.addEventListener("close",(()=>s())),r&&t.addEventListener("versionchange",(()=>r()))})).catch((()=>{})),a}("firebase-installations-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(Wt)}})),Qt}async function Xt(t,e){const n=qt(t),i=(await Yt()).transaction(Wt,"readwrite"),r=i.objectStore(Wt),s=await r.get(n);return await r.put(e,n),await i.done,s&&s.fid===e.fid||Ht(t,e.fid),e}async function Jt(t){const e=qt(t),n=(await Yt()).transaction(Wt,"readwrite");await n.objectStore(Wt).delete(e),await n.done}async function Zt(t,e){const n=qt(t),i=(await Yt()).transaction(Wt,"readwrite"),r=i.objectStore(Wt),s=await r.get(n),o=e(s);return void 0===o?await r.delete(n):await r.put(o,n),await i.done,!o||s&&s.fid===o.fid||Ht(t,o.fid),o}async function te(t){let e;const n=await Zt(t.appConfig,(n=>{const i=function(t){return ie(t||{fid:zt(),registrationStatus:0})}(n),r=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(Pt.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const i=Nt(t),r=Vt(t),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&r.append("x-firebase-client",t)}const o={fid:n,authVersion:Ot,appId:t.appId,sdkVersion:Mt},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await Bt((()=>fetch(i,a)));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:Lt(t.authToken)}}throw await Ft("Create Installation",c)}(t,e);return Xt(t.appConfig,n)}catch(n){throw Rt(n)&&409===n.customData.serverCode?await Jt(t.appConfig):await Xt(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:i}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:ee(t)}:{installationEntry:e}}(t,i);return e=r.registrationPromise,r.installationEntry}));return""===n.fid?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function ee(t){let e=await ne(t.appConfig);for(;1===e.registrationStatus;)await Ut(100),e=await ne(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await te(t);return n||e}return e}function ne(t){return Zt(t,(t=>{if(!t)throw Pt.create("installation-not-found");return ie(t)}))}function ie(t){return 1===(e=t).registrationStatus&&e.registrationTime+1e4<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function re({appConfig:t,heartbeatServiceProvider:e},n){const i=function(t,{fid:e}){return`${Nt(t)}/${e}/authTokens:generate`}(t,n),r=function(t,{refreshToken:e}){const n=Vt(t);return n.append("Authorization",function(t){return`${Ot} ${t}`}(e)),n}(t,n),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&r.append("x-firebase-client",t)}const o={installation:{sdkVersion:Mt,appId:t.appId}},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await Bt((()=>fetch(i,a)));if(c.ok)return Lt(await c.json());throw await Ft("Generate Auth Token",c)}async function se(t,e=!1){let n;const i=await Zt(t.appConfig,(i=>{if(!ae(i))throw Pt.create("not-registered");const r=i.authToken;if(!e&&(2===(s=r).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+36e5}(s)))return i;var s;if(1===r.requestStatus)return n=async function(t,e){let n=await oe(t.appConfig);for(;1===n.authToken.requestStatus;)await Ut(100),n=await oe(t.appConfig);const i=n.authToken;return 0===i.requestStatus?se(t,e):i}(t,e),i;{if(!navigator.onLine)throw Pt.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(i);return n=async function(t,e){try{const n=await re(t,e),i=Object.assign(Object.assign({},e),{authToken:n});return await Xt(t.appConfig,i),n}catch(n){if(!Rt(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Xt(t.appConfig,n)}else await Jt(t.appConfig);throw n}}(t,e),e}}));return n?await n:i.authToken}function oe(t){return Zt(t,(t=>{if(!ae(t))throw Pt.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+1e4<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function ae(t){return void 0!==t&&2===t.registrationStatus}function ce(t){return Pt.create("missing-app-config-values",{valueName:t})}const le="installations";(0,r.om)(new c.uA(le,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw ce("App Configuration");if(!t.name)throw ce("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw ce(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:(0,r.j6)(e,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),(0,r.om)(new c.uA("installations-internal",(t=>{const e=t.getProvider("app").getImmediate(),n=(0,r.j6)(e,le).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:i}=await te(e);return i?i.catch(console.error):se(e).catch(console.error),n.fid}(n),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await te(t);e&&await e}(n),(await se(n,e)).token}(n,t)}}),"PRIVATE")),(0,r.KO)(At,Dt),(0,r.KO)(At,Dt,"esm2017");const ue="analytics",he="https://www.googletagmanager.com/gtag/js",de=new dt.Vy("@firebase/analytics"),fe=new a.FA("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function pe(t){if(!t.startsWith(he)){const e=fe.create("invalid-gtag-resource",{gtagURL:t});return de.warn(e.message),""}return t}function ge(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}const me=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function ye(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function ve(t,e=me,n){const{appId:i,apiKey:r,measurementId:s}=t.options;if(!i)throw fe.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:i};throw fe.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new we;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),be({appId:i,apiKey:r,measurementId:s},o,a,e)}async function be(t,{throttleEndTimeMillis:e,backoffCount:n},i,r=me){var s;const{appId:o,measurementId:c}=t;try{await function(t,e){return new Promise(((n,i)=>{const r=Math.max(e-Date.now(),0),s=setTimeout(n,r);t.addEventListener((()=>{clearTimeout(s),i(fe.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(i,e)}catch(t){if(c)return de.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:o,measurementId:c};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:i}=t,r={method:"GET",headers:ye(i)},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(s,r);if(200!==o.status&&304!==o.status){let t="";try{const n=await o.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw fe.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return r.deleteThrottleMetadata(o),e}catch(e){const l=e;if(!function(t){if(!(t instanceof a.g&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(l)){if(r.deleteThrottleMetadata(o),c)return de.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null==l?void 0:l.message}]`),{appId:o,measurementId:c};throw e}const u=503===Number(null===(s=null==l?void 0:l.customData)||void 0===s?void 0:s.httpStatus)?(0,a.p9)(n,r.intervalMillis,30):(0,a.p9)(n,r.intervalMillis),h={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return r.setThrottleMetadata(o,h),de.debug(`Calling attemptFetch again in ${u} millis`),be(t,h,i,r)}}class we{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}let _e,xe;async function Ie(t,e,n,i,r,s,o){var c;const l=ve(t);l.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&de.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>de.error(t))),e.push(l);const u=async function(){if(!(0,a.zW)())return de.warn(fe.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await(0,a.eX)()}catch(t){return de.warn(fe.create("indexeddb-unavailable",{errorInfo:null==t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?i.getId():void 0)),[h,d]=await Promise.all([l,u]);(function(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(he)&&n.src.includes(t))return n;return null})(s)||function(t,e){const n=function(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",e)),n}(0,{createScriptURL:pe}),i=document.createElement("script"),r=`${he}?l=${t}&id=${e}`;i.src=n?null==n?void 0:n.createScriptURL(r):r,i.async=!0,document.head.appendChild(i)}(s,h.measurementId),xe&&(r("consent","default",xe),xe=void 0),r("js",new Date);const f=null!==(c=null==o?void 0:o.config)&&void 0!==c?c:{};return f.origin="firebase",f.update=!0,null!=d&&(f.firebase_id=d),r("config",h.measurementId,f),_e&&(r("set",_e),_e=void 0),h.measurementId}class Ee{constructor(t){this.app=t}_delete(){return delete Te[this.app.options.appId],Promise.resolve()}}let Te={},ke=[];const Se={};let Ce,Ae,De="dataLayer",Me=!1;function Oe(t,e,n){!function(){const t=[];if((0,a.sr)()&&t.push("This is a browser extension environment."),(0,a.dM)()||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),n=fe.create("invalid-analytics-context",{errorInfo:e});de.warn(n.message)}}();const i=t.options.appId;if(!i)throw fe.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw fe.create("no-api-key");de.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Te[i])throw fe.create("already-exists",{id:i});if(!Me){!function(t){let e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(De);const{wrappedGtag:t,gtagCore:e}=function(t,e,n,i,r){let s=function(...t){window[i].push(arguments)};return window[r]&&"function"==typeof window[r]&&(s=window[r]),window[r]=function(t,e,n,i){return async function(r,...s){try{if("event"===r){const[i,r]=s;await async function(t,e,n,i,r){try{let s=[];if(r&&r.send_to){let t=r.send_to;Array.isArray(t)||(t=[t]);const i=await ge(n);for(const n of t){const t=i.find((t=>t.measurementId===n)),r=t&&e[t.appId];if(!r){s=[];break}s.push(r)}}0===s.length&&(s=Object.values(e)),await Promise.all(s),t("event",i,r||{})}catch(t){de.error(t)}}(t,e,n,i,r)}else if("config"===r){const[r,o]=s;await async function(t,e,n,i,r,s){const o=i[r];try{if(o)await e[o];else{const t=(await ge(n)).find((t=>t.measurementId===r));t&&await e[t.appId]}}catch(t){de.error(t)}t("config",r,s)}(t,e,n,i,r,o)}else if("consent"===r){const[e]=s;t("consent","update",e)}else if("get"===r){const[e,n,i]=s;t("get",e,n,i)}else if("set"===r){const[e]=s;t("set",e)}else t(r,...s)}catch(t){de.error(t)}}}(s,t,e,n),{gtagCore:s,wrappedGtag:window[r]}}(Te,ke,Se,De,"gtag");Ae=t,Ce=e,Me=!0}return Te[i]=Ie(t,ke,Se,e,Ce,De,n),new Ee(t)}const Pe="@firebase/analytics",Re="0.10.0";(0,r.om)(new c.uA(ue,((t,{options:e})=>Oe(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),(0,r.om)(new c.uA("analytics-internal",(function(t){try{const e=t.getProvider(ue).getImmediate();return{logEvent:(t,n,i)=>function(t,e,n,i){t=(0,a.Ku)(t),async function(t,e,n,i,r){if(r&&r.global)t("event",n,i);else{const r=await e;t("event",n,Object.assign(Object.assign({},i),{send_to:r}))}}(Ae,Te[t.app.options.appId],e,n,i).catch((t=>de.error(t)))}(e,t,n,i)}}catch(t){throw fe.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),(0,r.KO)(Pe,Re),(0,r.KO)(Pe,Re,"esm2017");var Ne=(0,r.Wp)({apiKey:"AIzaSyAzd4ZozdCWCy6bQK255uyVFdOrbsHoxfQ",authDomain:"fastnetlite.firebaseapp.com",projectId:"fastnetlite",storageBucket:"fastnetlite.firebasestorage.app",messagingSenderId:"539673548783",appId:"1:539673548783:web:a9f7da3299069f0abf081a",measurementId:"G-GSR54JNW8J"}),Le=(0,s.aU)(Ne),Fe=(0,o.xI)(Ne),Ve=function(t=(0,r.Sx)(),e){t=(0,a.Ku)(t);const n=(0,r.j6)(t,ct).getImmediate({identifier:e}),i=(0,a.yU)("storage");return i&&function(t,e,n,i={}){!function(t,e,n,i={}){t.host=`${e}:${n}`,t._protocol="http";const{mockUserToken:r}=i;r&&(t._overrideAuthToken="string"==typeof r?r:(0,a.Fy)(r,t.app.options.projectId))}(t,e,n,i)}(n,...i),n}(Ne);!function(t=(0,r.Sx)()){t=(0,a.Ku)(t);const e=(0,r.j6)(t,ue);e.isInitialized()?e.getImmediate():function(t,e={}){const n=(0,r.j6)(t,ue);if(n.isInitialized()){const t=n.getImmediate();if((0,a.bD)(e,n.getOptions()))return t;throw fe.create("already-initialized")}n.initialize({options:e})}(t)}(Ne),(0,s.ol)(Le).catch((function(t){"failed-precondition"===t.code?console.warn("La persistance des données ne peut pas être activée car plusieurs onglets sont ouverts"):"unimplemented"===t.code&&console.warn("Le navigateur ne prend pas en charge la persistance des données hors ligne")})),window.firebase={auth:function(){return{signInWithEmailAndPassword:function(t,e){return(0,o.x9)(Fe,t,e)},createUserWithEmailAndPassword:function(t,e){return(0,o.eJ)(Fe,t,e)},signOut:function(){return console.log("Déconnexion en cours..."),(0,o.CI)(Fe).then((function(){console.log("Déconnexion réussie"),window.location.href="index.html"})).catch((function(t){throw console.error("Erreur lors de la déconnexion:",t),t}))},onAuthStateChanged:function(t){return(0,o.hg)(Fe,(function(e){console.log("Changement d'état d'authentification:",e?e.email:"aucun utilisateur"),e&&(Fe.currentUser=e),t(e)}))},sendPasswordResetEmail:function(t){return(0,o.J1)(Fe,t)},get currentUser(){return Fe.currentUser}}},firestore:function(){return firebase.firestore.FieldValue||(firebase.firestore.FieldValue={serverTimestamp:function(){return(0,s.O5)()},delete:function(){return(0,s.CL)()}}),{collection:function(t){var e=(0,s.rJ)(Le,t);return(0,i.A)((0,i.A)({doc:function(e){var n=(0,s.H9)(Le,t,e);return{get:function(){return(0,s.x7)(n)},set:function(t){return(0,s.BN)(n,t)},update:function(t){return(0,s.BN)(n,t,{merge:!0})},delete:function(){return(0,s.kd)(n)},id:n.id,path:n.path,onSnapshot:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return onSnapshot(n,(function(e){t({exists:e.exists(),id:e.id,data:function(){return e.data()},ref:e.ref})}))}))}},add:function(t){return(0,s.gS)(e,t)},get:function(){return(0,s.GG)(e)},where:function(t,n,r){var o=(0,s.P)(e,(0,s._M)(t,n,r));return(0,i.A)((0,i.A)({get:function(){return(0,s.GG)(o)},onSnapshot:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return onSnapshot(o,(function(e){t({docs:e.docs.map((function(t){return{id:t.id,data:function(){return t.data()},ref:t.ref,exists:t.exists()}})),empty:e.empty,size:e.size})}))})),orderBy:function(t,e){var n=(0,s.P)(o,(0,s.My)(t,e||"asc"));return{get:function(){return(0,s.GG)(n)},limit:function(t){var e=(0,s.P)(n,(0,s.AB)(t));return{get:function(){return(0,s.GG)(e)},limit:function(t){var n=(0,s.P)(e,(0,s.AB)(t));return{get:function(){return(0,s.GG)(n)}}}}}}}},"orderBy",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=(0,s.P)(o,(0,s.My)(t,e));return{get:function(){return(0,s.GG)(n)},limit:function(t){var e=(0,s.P)(n,(0,s.AB)(t));return{get:function(){return(0,s.GG)(e)}}}}})),"limit",(function(t){var e=(0,s.P)(o,(0,s.AB)(t));return{get:function(){return(0,s.GG)(e)}}}))},orderBy:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",i=(0,s.P)(e,(0,s.My)(t,n));return{get:function(){return(0,s.GG)(i)},limit:function(t){var e=(0,s.P)(i,(0,s.AB)(t));return{get:function(){return(0,s.GG)(e)}}}}},limit:function(t){var n=(0,s.P)(e,(0,s.AB)(t));return{get:function(){return(0,s.GG)(n)}}}},"add",(function(t){return(0,s.gS)(e,t).then((function(t){return{id:t.id,path:t.path,get:function(){return(0,s.x7)(t)},set:function(e){return(0,s.BN)(t,e)},update:function(e){return(0,s.BN)(t,e,{merge:!0})},delete:function(){return(0,s.kd)(t)}}})).catch((function(t){throw console.error("Erreur lors de l'ajout du document:",t),t}))})),"get",(function(){return(0,s.GG)(e)}))},doc:function(t){var e=t.split("/"),n=e.slice(0,e.length-1).join("/"),i=e[e.length-1],r=(0,s.H9)(Le,n,i);return{get:function(){return(0,s.x7)(r)},set:function(t){return(0,s.BN)(r,t)},update:function(t){return(0,s.BN)(r,t,{merge:!0})},delete:function(){return(0,s.kd)(r)},id:r.id,path:r.path}},FieldValue:{serverTimestamp:function(){return(0,s.O5)()},delete:function(){return(0,s.CL)()}},Timestamp:{fromDate:function(t){var e=new Date(t).getTime();return{seconds:Math.floor(e/1e3),nanoseconds:0}},now:function(){return(0,s.O5)()}}}},storage:function(){return{ref:function(t){var e=ht(Ve,t);return{put:function(t){return lt(e,t)},getDownloadURL:function(){return ut(e)},delete:function(){return t=e,function(t){t._throwIfRoot("deleteObject");const e=function(t,e){const n=k(e.fullServerUrl(),t.host,t._protocol),i=t.maxOperationRetryTime,r=new G(n,"DELETE",(function(t,e){}),i);return r.successCodes=[200,204],r.errorHandler=Y(e),r}(t.storage,t._location);return t.storage.makeRequestWithTokens(e,tt)}(t=(0,a.Ku)(t));var t}}}}}},window.db=Le,window.auth=Fe,window.storage=Ve,window.firestore={collection:s.rJ,doc:s.H9,setDoc:s.BN,getDoc:s.x7,getDocs:s.GG,query:s.P,where:s._M,orderBy:s.My,limit:s.AB,startAfter:s.HM,serverTimestamp:s.O5},Fe.currentUser?console.log("Utilisateur déjà connecté:",Fe.currentUser.email):console.log("Aucun utilisateur connecté"),(0,o.hg)(Fe,(function(t){t?console.log("Utilisateur connecté:",t.email):console.log("Utilisateur déconnecté")})),window.firebase.firestore=Object.assign({},{collection:function(t){return(0,s.rJ)(Le,t)},doc:function(t){return(0,s.H9)(Le,t)},setDoc:function(t,e){return(0,s.BN)(t,e)},getDoc:function(t){return(0,s.x7)(t)},getDocs:function(t){return(0,s.GG)(t)},query:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return s.P.apply(void 0,[t].concat(n))},where:function(t,e,n){return(0,s._M)(t,e,n)},orderBy:function(t,e){return(0,s.My)(t,e)},limit:function(t){return(0,s.AB)(t)},startAfter:function(t){return(0,s.HM)(t)},serverTimestamp:function(){return(0,s.O5)()},FieldValue:{serverTimestamp:function(){return(0,s.O5)()},delete:function(){return(0,s.CL)()}}}),window.storageRef=ht,window.uploadBytes=lt,window.getDownloadURL=ut,window.signInWithEmailAndPassword=o.x9,window.createUserWithEmailAndPassword=o.eJ,window.signOut=o.CI,window.onAuthStateChanged=o.hg,window.sendPasswordResetEmail=o.J1,window.checkAuth=function(){return new Promise((function(t){var e=(0,o.hg)(Fe,(function(n){e(),t(n)}))}))},console.log("Configuration Firebase chargée avec SDK moderne"),window.indexJsInitialized=window.indexJsInitialized||!1,document.addEventListener("DOMContentLoaded",(function(){window.indexJsInitialized?console.log("src/index.js déjà initialisé, initialisation ignorée"):(window.indexJsInitialized=!0,console.log("FastNetLite initialisé avec SDK Firebase moderne"))}))},118:(t,e,n)=>{"use strict";n.r(e),n.d(e,{checkAndCreateCollection:()=>h,createCompositeIndexes:()=>x,displayIndexError:()=>_,documentExists:()=>g,executeWithIndexErrorHandling:()=>v,handleFirebaseError:()=>w,handleFirebaseIndexError:()=>y,initializeCollections:()=>f});var i=n(467),r=n(848),s=n(756),o=n.n(s),a=n(405);function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){(0,i.A)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var u=(0,a.aU)();function h(t){return d.apply(this,arguments)}function d(){return d=(0,r.A)(o().mark((function t(e){var n,i,s,c=arguments;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:{},t.prev=1,console.log("Vérification de la collection: ".concat(e)),i=(0,a.H9)((0,a.rJ)(u,e),"dummy_doc"),t.next=6,(0,a.x7)(i);case 6:if(t.sent.exists()){t.next=15;break}return s=l(l({},n),{},{_dummy:!0,createdAt:(0,a.O5)()}),t.next=11,(0,a.BN)(i,s);case 11:console.log("Collection ".concat(e," créée avec document factice")),setTimeout((0,r.A)(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,a.kd)(i);case 3:console.log("Document factice supprimé de ".concat(e)),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.error("Erreur lors de la suppression du document factice: ".concat(t.t0));case 9:case"end":return t.stop()}}),t,null,[[0,6]])}))),2e3),t.next=16;break;case 15:console.log("Collection ".concat(e," existe déjà"));case 16:return t.abrupt("return",!0);case 19:return t.prev=19,t.t0=t.catch(1),console.error("Erreur lors de la vérification/création de la collection ".concat(e,":"),t.t0),t.abrupt("return",!1);case 23:case"end":return t.stop()}}),t,null,[[1,19]])}))),d.apply(this,arguments)}function f(t){return p.apply(this,arguments)}function p(){return p=(0,r.A)(o().mark((function t(e){var n,i=arguments;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:null,t.prev=1,console.log("Initialisation des collections..."),t.next=5,h("routers",{userId:e});case 5:if(!n){t.next=14;break}return t.next=8,h("profiles",{routerId:n});case 8:return t.next=10,h("wifiCodes",{routerId:n});case 10:return t.next=12,h("clients",{routerId:n});case 12:return t.next=14,h("payments",{routerId:n});case 14:return console.log("Toutes les collections ont été vérifiées et initialisées si nécessaire"),t.abrupt("return",!0);case 18:return t.prev=18,t.t0=t.catch(1),console.error("Erreur lors de l'initialisation des collections:",t.t0),t.abrupt("return",!1);case 22:case"end":return t.stop()}}),t,null,[[1,18]])}))),p.apply(this,arguments)}function g(t,e){return m.apply(this,arguments)}function m(){return(m=(0,r.A)(o().mark((function t(e,n){var i,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i=(0,a.H9)(u,e,n),t.next=4,(0,a.x7)(i);case 4:return r=t.sent,t.abrupt("return",r.exists());case 8:return t.prev=8,t.t0=t.catch(0),console.error("Erreur lors de la vérification de l'existence du document ".concat(n," dans ").concat(e,":"),t.t0),t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))).apply(this,arguments)}function y(t){var e,n=t.message&&t.message.includes("index");return{isIndexError:n,indexUrl:n&&(null===(e=t.message.match(/https:\/\/console\.firebase\.google\.com[^\s]+/))||void 0===e?void 0:e[0])||null,message:t.message,originalError:t}}function v(t,e,n,i){return b.apply(this,arguments)}function b(){return(b=(0,r.A)(o().mark((function t(e,n,i,r){var s,a;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:return s=t.sent,t.abrupt("return",n(s));case 7:if(t.prev=7,t.t0=t.catch(0),!(a=y(t.t0)).isIndexError){t.next=15;break}return console.warn("Erreur d'index Firebase détectée:",a.message),t.abrupt("return",i(a));case 15:return console.error("Erreur lors de l'exécution de la requête:",t.t0),t.abrupt("return",r(t.t0));case 17:case"end":return t.stop()}}),t,null,[[0,7]])})))).apply(this,arguments)}function w(t){var e={isIndexError:!1,indexUrl:null,collection:null,fields:[],message:t.message,originalError:t};if(t.message&&t.message.includes("index")){e.isIndexError=!0;var n=t.message.match(/https:\/\/console\.firebase\.google\.com[^\s"']+/);n&&(e.indexUrl=n[0]);var i=t.message.match(/collection ([a-zA-Z0-9_-]+)/);i&&(e.collection=i[1]);var r=t.message.match(/\[([^\]]+)\]/);r&&(e.fields=r[1].split(", ").map((function(t){return t.trim()}))),console.warn("Erreur d'index Firebase détectée pour la collection ".concat(e.collection||"inconnue")),e.indexUrl&&console.info("Créez l'index en visitant: ".concat(e.indexUrl))}return e}function _(t,e){var n=document.getElementById(t);n&&(n.classList.remove("d-none"),n.innerHTML='\n        <div class="alert alert-warning">\n            <p><strong>Erreur d\'index Firebase :</strong> Cette requête nécessite un index composé.</p>\n            '.concat(e.collection?"<p>Collection concernée: <code>".concat(e.collection,"</code></p>"):"","\n            ").concat(e.fields.length>0?"<p>Champs: <code>".concat(e.fields.join("</code>, <code>"),"</code></p>"):"","\n            ").concat(e.indexUrl?'<p>Cliquez sur <a href="'.concat(e.indexUrl,'" target="_blank">ce lien</a> pour créer l\'index nécessaire.</p>'):"",'\n            <p class="mb-0">Après avoir créé l\'index, actualisez la page.</p>\n        </div>\n    '))}function x(t){return I.apply(this,arguments)}function I(){return(I=(0,r.A)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("Création des index composites..."),[{collection:"payments",fields:["routerId","createdAt"],description:"Paiements par routeur et date de création"},{collection:"wifiCodes",fields:["routerId","profileId","status"],description:"Codes par routeur, profil et statut"},{collection:"clients",fields:["routerId","createdAt"],description:"Clients par routeur et date de création"},{collection:"routers",fields:["userId","name"],description:"Routeurs par utilisateur et nom"}].forEach((function(t){console.log("Index requis pour ".concat(t.collection,": ").concat(t.fields.join(", ")," - ").concat(t.description))})),console.log("Note: Les index composites doivent être créés manuellement dans la console Firebase"),console.log("Vous pouvez créer les index nécessaires en suivant les liens dans les messages d'erreur");case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},125:(t,e,n)=>{"use strict";n.d(e,{h1:()=>a,uA:()=>r});var i=n(743);class r{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const s="[DEFAULT]";class o{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new i.cY;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),i=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(i)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:s})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=s){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=s){return this.instances.has(t)}getOptions(t=s){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(i);return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(t),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&t(s,i),()=>{r.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===s?void 0:i),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var i;return n||null}normalizeInstanceIdentifier(t=s){return this.component?this.component.multipleInstances?t:s:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new o(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}},284:(t,e,n)=>{"use strict";function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}n.d(e,{A:()=>i})},327:(t,e,n)=>{"use strict";n.d(e,{A:()=>r});var i=n(284);function r(t,e){if("object"!=(0,i.A)(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=(0,i.A)(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}},405:(t,e,n)=>{"use strict";n.d(e,{AB:()=>i.AB,BN:()=>i.BN,CL:()=>i.CL,Dc:()=>i.Dc,GG:()=>i.GG,H9:()=>i.H9,HM:()=>i.HM,My:()=>i.My,O5:()=>i.O5,P:()=>i.P,_M:()=>i._M,aU:()=>i.aU,gS:()=>i.gS,kd:()=>i.kd,mZ:()=>i.mZ,ol:()=>i.ol,rJ:()=>i.rJ,x7:()=>i.x7});var i=n(790)},424:(t,e,n)=>{"use strict";n.d(e,{$b:()=>r,Vy:()=>l});const i=[];var r;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(r||(r={}));const s={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},o=r.INFO,a={[r.DEBUG]:"log",[r.VERBOSE]:"log",[r.INFO]:"info",[r.WARN]:"warn",[r.ERROR]:"error"},c=(t,e,...n)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),r=a[e];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[r](`[${i}]  ${t.name}:`,...n)};class l{constructor(t){this.name=t,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,i.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in r))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?s[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,r.DEBUG,...t),this._logHandler(this,r.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,r.VERBOSE,...t),this._logHandler(this,r.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,r.INFO,...t),this._logHandler(this,r.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,r.WARN,...t),this._logHandler(this,r.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,r.ERROR,...t),this._logHandler(this,r.ERROR,...t)}}},440:(t,e,n)=>{"use strict";n.d(e,{CI:()=>i.B,J1:()=>i.a3,eJ:()=>i.a8,hg:()=>i.x,x9:()=>i.a9,xI:()=>i.o});var i=n(509);n(743),n(461),n(424),n(125)},461:(t,e,n)=>{"use strict";n.d(e,{KO:()=>G,MF:()=>$,Sx:()=>K,Wp:()=>H,j6:()=>j,om:()=>U});var i=n(125),r=n(424),s=n(743),o=n(602);class a{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const c="@firebase/app",l="0.9.13",u=new r.Vy("@firebase/app"),h="@firebase/app-compat",d="@firebase/analytics-compat",f="@firebase/analytics",p="@firebase/app-check-compat",g="@firebase/app-check",m="@firebase/auth",y="@firebase/auth-compat",v="@firebase/database",b="@firebase/database-compat",w="@firebase/functions",_="@firebase/functions-compat",x="@firebase/installations",I="@firebase/installations-compat",E="@firebase/messaging",T="@firebase/messaging-compat",k="@firebase/performance",S="@firebase/performance-compat",C="@firebase/remote-config",A="@firebase/remote-config-compat",D="@firebase/storage",M="@firebase/storage-compat",O="@firebase/firestore",P="@firebase/firestore-compat",R="firebase",N="[DEFAULT]",L={[c]:"fire-core",[h]:"fire-core-compat",[f]:"fire-analytics",[d]:"fire-analytics-compat",[g]:"fire-app-check",[p]:"fire-app-check-compat",[m]:"fire-auth",[y]:"fire-auth-compat",[v]:"fire-rtdb",[b]:"fire-rtdb-compat",[w]:"fire-fn",[_]:"fire-fn-compat",[x]:"fire-iid",[I]:"fire-iid-compat",[E]:"fire-fcm",[T]:"fire-fcm-compat",[k]:"fire-perf",[S]:"fire-perf-compat",[C]:"fire-rc",[A]:"fire-rc-compat",[D]:"fire-gcs",[M]:"fire-gcs-compat",[O]:"fire-fst",[P]:"fire-fst-compat","fire-js":"fire-js",[R]:"fire-js-all"},F=new Map,V=new Map;function B(t,e){try{t.container.addComponent(e)}catch(n){u.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function U(t){const e=t.name;if(V.has(e))return u.debug(`There were multiple attempts to register component ${e}.`),!1;V.set(e,t);for(const e of F.values())B(e,t);return!0}function j(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const z=new s.FA("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class q{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new i.uA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw z.create("app-deleted",{appName:this._name})}}const $="9.23.0";function H(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:N,automaticDataCollectionEnabled:!1},e),o=r.name;if("string"!=typeof o||!o)throw z.create("bad-app-name",{appName:String(o)});if(n||(n=(0,s.T9)()),!n)throw z.create("no-options");const a=F.get(o);if(a){if((0,s.bD)(n,a.options)&&(0,s.bD)(r,a.config))return a;throw z.create("duplicate-app",{appName:o})}const c=new i.h1(o);for(const t of V.values())c.addComponent(t);const l=new q(n,r,c);return F.set(o,l),l}function K(t=N){const e=F.get(t);if(!e&&t===N&&(0,s.T9)())return H();if(!e)throw z.create("no-app",{appName:t});return e}function G(t,e,n){var r;let s=null!==(r=L[t])&&void 0!==r?r:t;n&&(s+=`-${n}`);const o=s.match(/\s|\//),a=e.match(/\s|\//);if(o||a){const t=[`Unable to register library "${s}" with version "${e}":`];return o&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&t.push("and"),a&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void u.warn(t.join(" "))}U(new i.uA(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const W="firebase-heartbeat-store";let Q=null;function Y(){return Q||(Q=(0,o.P2)("firebase-heartbeat-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(W)}}).catch((t=>{throw z.create("idb-open",{originalErrorMessage:t.message})}))),Q}async function X(t,e){try{const n=(await Y()).transaction(W,"readwrite"),i=n.objectStore(W);await i.put(e,J(t)),await n.done}catch(t){if(t instanceof s.g)u.warn(t.message);else{const e=z.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});u.warn(e.message)}}}function J(t){return`${t.name}!${t.options.appId}`}class Z{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new et(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=tt();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=tt(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let i=t.slice();for(const r of t){const t=n.find((t=>t.agent===r.agent));if(t){if(t.dates.push(r.date),nt(n)>e){t.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),nt(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=(0,s.Uj)(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function tt(){return(new Date).toISOString().substring(0,10)}class et{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,s.zW)()&&(0,s.eX)().then((()=>!0)).catch((()=>!1))}async read(){return await this._canUseIndexedDBPromise&&await async function(t){try{const e=await Y();return await e.transaction(W).objectStore(W).get(J(t))}catch(t){if(t instanceof s.g)u.warn(t.message);else{const e=z.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});u.warn(e.message)}}}(this.app)||{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return X(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return X(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function nt(t){return(0,s.Uj)(JSON.stringify({version:2,heartbeats:t})).length}U(new i.uA("platform-logger",(t=>new a(t)),"PRIVATE")),U(new i.uA("heartbeat",(t=>new Z(t)),"PRIVATE")),G(c,l,""),G(c,l,"esm2017"),G("fire-js","")},467:(t,e,n)=>{"use strict";n.d(e,{A:()=>r});var i=n(922);function r(t,e,n){return(e=(0,i.A)(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},500:(t,e,n)=>{"use strict";n.d(e,{r:()=>d,w:()=>p});const i=(t,e)=>e.some((e=>t instanceof e));let r,s;const o=new WeakMap,a=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap;let h={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return a.get(t);if("objectStoreNames"===e)return t.objectStoreNames||c.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function d(t){h=t(h)}function f(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(s||(s=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(g(this),t),p(o.get(this))}:function(...t){return p(e.apply(g(this),t))}:function(t,...n){const i=e.call(g(this),t,...n);return c.set(i,t.sort?t.sort():[t]),p(i)}:(t instanceof IDBTransaction&&function(t){if(a.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",s),t.removeEventListener("abort",s)},r=()=>{e(),i()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",s),t.addEventListener("abort",s)}));a.set(t,e)}(t),i(t,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,h):t);var e}function p(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",s)},r=()=>{e(p(t.result)),i()},s=()=>{n(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&o.set(e,t)})).catch((()=>{})),u.set(e,t),e}(t);if(l.has(t))return l.get(t);const e=f(t);return e!==t&&(l.set(t,e),u.set(e,t)),e}const g=t=>u.get(t)},509:(t,e,n)=>{"use strict";n.d(e,{B:()=>Ht,a3:()=>jt,a8:()=>zt,a9:()=>qt,o:()=>Xe,x:()=>$t});var i=n(743),r=n(461),s=n(635),o=n(424),a=n(125);const c=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},l=new i.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),u=new o.Vy("@firebase/auth");function h(t,...e){u.logLevel<=o.$b.ERROR&&u.error(`Auth (${r.MF}): ${t}`,...e)}function d(t,...e){throw p(t,...e)}function f(t,...e){return p(t,...e)}function p(t,...e){if("string"!=typeof t){const n=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=t.name),t._errorFactory.create(n,...i)}return l.create(t,...e)}function g(t,e,...n){if(!t)throw p(e,...n)}function m(t){const e="INTERNAL ASSERTION FAILED: "+t;throw h(e),new Error(e)}function y(t,e){t||m(e)}function v(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.href)||""}function b(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.protocol)||null}class w{constructor(t,e){this.shortDelay=t,this.longDelay=e,y(e>t,"Short delay should be less than long delay!"),this.isMobile=(0,i.jZ)()||(0,i.lV)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===b()||"https:"===b()||(0,i.sr)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function _(t,e){y(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class x{static initialize(t,e,n){this.fetchImpl=t,e&&(this.headersImpl=e),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void m("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void m("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void m("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const I={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},E=new w(3e4,6e4);function T(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function k(t,e,n,r,s={}){return S(t,s,(async()=>{let s={},o={};r&&("GET"===e?o=r:s={body:JSON.stringify(r)});const a=(0,i.Am)(Object.assign({key:t.config.apiKey},o)).slice(1),c=await t._getAdditionalHeaders();return c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode),x.fetch()(A(t,t.config.apiHost,n,a),Object.assign({method:e,headers:c,referrerPolicy:"no-referrer"},s))}))}async function S(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},I),e);try{const e=new D(t),s=await Promise.race([n(),e.promise]);e.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw M(t,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const e=s.ok?o.errorMessage:o.error.message,[n,a]=e.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw M(t,"credential-already-in-use",o);if("EMAIL_EXISTS"===n)throw M(t,"email-already-in-use",o);if("USER_DISABLED"===n)throw M(t,"user-disabled",o);const l=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw function(t,e,n){const r=Object.assign(Object.assign({},c()),{[e]:n});return new i.FA("auth","Firebase",r).create(e,{appName:t.name})}(t,l,a);d(t,l)}}catch(e){if(e instanceof i.g)throw e;d(t,"network-request-failed",{message:String(e)})}}async function C(t,e,n,i,r={}){const s=await k(t,e,n,i,r);return"mfaPendingCredential"in s&&d(t,"multi-factor-auth-required",{_serverResponse:s}),s}function A(t,e,n,i){const r=`${e}${n}?${i}`;return t.config.emulator?_(t.config,r):`${t.config.apiScheme}://${r}`}class D{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise(((t,e)=>{this.timer=setTimeout((()=>e(f(this.auth,"network-request-failed"))),E.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function M(t,e,n){const i={appName:t.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const r=f(t,e,i);return r.customData._tokenResponse=n,r}function O(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch(t){}}function P(t){return 1e3*Number(t)}function R(t){const[e,n,r]=t.split(".");if(void 0===e||void 0===n||void 0===r)return h("JWT malformed, contained fewer than 3 sections"),null;try{const t=(0,i.u)(n);return t?JSON.parse(t):(h("Failed to decode base64 JWT payload"),null)}catch(t){return h("Caught error parsing JWT payload as JSON",null==t?void 0:t.toString()),null}}async function N(t,e,n=!1){if(n)return e;try{return await e}catch(e){throw e instanceof i.g&&function({code:t}){return"auth/user-disabled"===t||"auth/user-token-expired"===t}(e)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class L{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){const t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}{this.errorBackoff=3e4;const t=(null!==(e=this.user.stsTokenManager.expirationTime)&&void 0!==e?e:0)-Date.now()-3e5;return Math.max(0,t)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout((async()=>{await this.iteration()}),e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===(null==t?void 0:t.code)&&this.schedule(!0))}this.schedule()}}class F{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=O(this.lastLoginAt),this.creationTime=O(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function V(t){var e;const n=t.auth,i=await t.getIdToken(),r=await N(t,async function(t,e){return k(t,"POST","/v1/accounts:lookup",e)}(n,{idToken:i}));g(null==r?void 0:r.users.length,n,"internal-error");const o=r.users[0];t._notifyReloadListener(o);const a=(null===(e=o.providerUserInfo)||void 0===e?void 0:e.length)?o.providerUserInfo.map((t=>{var{providerId:e}=t,n=(0,s.Tt)(t,["providerId"]);return{providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],c=(l=t.providerData,u=a,[...l.filter((t=>!u.some((e=>e.providerId===t.providerId)))),...u]);var l,u;const h=t.isAnonymous,d=!(t.email&&o.passwordHash||(null==c?void 0:c.length)),f=!!h&&d,p={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:c,metadata:new F(o.createdAt,o.lastLoginAt),isAnonymous:f};Object.assign(t,p)}class B{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){g(t.idToken,"internal-error"),g(void 0!==t.idToken,"internal-error"),g(void 0!==t.refreshToken,"internal-error");const e="expiresIn"in t&&void 0!==t.expiresIn?Number(t.expiresIn):function(t){const e=R(t);return g(e,"internal-error"),g(void 0!==e.exp,"internal-error"),g(void 0!==e.iat,"internal-error"),Number(e.exp)-Number(e.iat)}(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}async getToken(t,e=!1){return g(!this.accessToken||this.refreshToken,t,"user-token-expired"),e||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(t,e){const n=await S(t,{},(async()=>{const n=(0,i.Am)({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=t.config,o=A(t,r,"/v1/token",`key=${s}`),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",x.fetch()(o,{method:"POST",headers:a,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(t,e);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(t,e,n){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(t,e){const{refreshToken:n,accessToken:i,expirationTime:r}=e,s=new B;return n&&(g("string"==typeof n,"internal-error",{appName:t}),s.refreshToken=n),i&&(g("string"==typeof i,"internal-error",{appName:t}),s.accessToken=i),r&&(g("number"==typeof r,"internal-error",{appName:t}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new B,this.toJSON())}_performRefresh(){return m("not implemented")}}function U(t,e){g("string"==typeof t||void 0===t,"internal-error",{appName:e})}class j{constructor(t){var{uid:e,auth:n,stsTokenManager:i}=t,r=(0,s.Tt)(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new L(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new F(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(t){const e=await N(this,this.stsTokenManager.getToken(this.auth,t));return g(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return async function(t,e=!1){const n=(0,i.Ku)(t),r=await n.getIdToken(e),s=R(r);g(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o="object"==typeof s.firebase?s.firebase:void 0,a=null==o?void 0:o.sign_in_provider;return{claims:s,token:r,authTime:O(P(s.auth_time)),issuedAtTime:O(P(s.iat)),expirationTime:O(P(s.exp)),signInProvider:a||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}}(this,t)}reload(){return async function(t){const e=(0,i.Ku)(t);await V(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}(this)}_assign(t){this!==t&&(g(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map((t=>Object.assign({},t))),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const e=new j(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return e.metadata._copy(this.metadata),e}_onReload(t){g(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),e&&await V(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const t=await this.getIdToken();return await N(this,async function(t,e){return k(t,"POST","/v1/accounts:delete",e)}(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((t=>Object.assign({},t))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var n,i,r,s,o,a,c,l;const u=null!==(n=e.displayName)&&void 0!==n?n:void 0,h=null!==(i=e.email)&&void 0!==i?i:void 0,d=null!==(r=e.phoneNumber)&&void 0!==r?r:void 0,f=null!==(s=e.photoURL)&&void 0!==s?s:void 0,p=null!==(o=e.tenantId)&&void 0!==o?o:void 0,m=null!==(a=e._redirectEventId)&&void 0!==a?a:void 0,y=null!==(c=e.createdAt)&&void 0!==c?c:void 0,v=null!==(l=e.lastLoginAt)&&void 0!==l?l:void 0,{uid:b,emailVerified:w,isAnonymous:_,providerData:x,stsTokenManager:I}=e;g(b&&I,t,"internal-error");const E=B.fromJSON(this.name,I);g("string"==typeof b,t,"internal-error"),U(u,t.name),U(h,t.name),g("boolean"==typeof w,t,"internal-error"),g("boolean"==typeof _,t,"internal-error"),U(d,t.name),U(f,t.name),U(p,t.name),U(m,t.name),U(y,t.name),U(v,t.name);const T=new j({uid:b,auth:t,email:h,emailVerified:w,displayName:u,isAnonymous:_,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:y,lastLoginAt:v});return x&&Array.isArray(x)&&(T.providerData=x.map((t=>Object.assign({},t)))),m&&(T._redirectEventId=m),T}static async _fromIdTokenResponse(t,e,n=!1){const i=new B;i.updateFromServerResponse(e);const r=new j({uid:e.localId,auth:t,stsTokenManager:i,isAnonymous:n});return await V(r),r}}const z=new Map;function q(t){y(t instanceof Function,"Expected a class definition");let e=z.get(t);return e?(y(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,z.set(t,e),e)}class ${constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return void 0===e?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}$.type="NONE";const H=$;function K(t,e,n){return`firebase:${t}:${e}:${n}`}class G{constructor(t,e,n){this.persistence=t,this.auth=e,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=K(this.userKey,i.apiKey,r),this.fullPersistenceKey=K("persistence",i.apiKey,r),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?j._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=t,e?this.setCurrentUser(e):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,n="authUser"){if(!e.length)return new G(q(H),t,n);const i=(await Promise.all(e.map((async t=>{if(await t._isAvailable())return t})))).filter((t=>t));let r=i[0]||q(H);const s=K(n,t.config.apiKey,t.name);let o=null;for(const n of e)try{const e=await n._get(s);if(e){const i=j._fromJSON(t,e);n!==r&&(o=i),r=n;break}}catch(t){}const a=i.filter((t=>t._shouldAllowMigration));return r._shouldAllowMigration&&a.length?(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(e.map((async t=>{if(t!==r)try{await t._remove(s)}catch(t){}}))),new G(r,t,n)):new G(r,t,n)}}function W(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(J(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Q(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(tt(e))return"Blackberry";if(et(e))return"Webos";if(Y(e))return"Safari";if((e.includes("chrome/")||X(e))&&!e.includes("edge/"))return"Chrome";if(Z(e))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(e);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Q(t=(0,i.ZQ)()){return/firefox\//i.test(t)}function Y(t=(0,i.ZQ)()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function X(t=(0,i.ZQ)()){return/crios\//i.test(t)}function J(t=(0,i.ZQ)()){return/iemobile/i.test(t)}function Z(t=(0,i.ZQ)()){return/android/i.test(t)}function tt(t=(0,i.ZQ)()){return/blackberry/i.test(t)}function et(t=(0,i.ZQ)()){return/webos/i.test(t)}function nt(t=(0,i.ZQ)()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function it(t=(0,i.ZQ)()){return nt(t)||Z(t)||et(t)||tt(t)||/windows phone/i.test(t)||J(t)}function rt(t,e=[]){let n;switch(t){case"Browser":n=W((0,i.ZQ)());break;case"Worker":n=`${W((0,i.ZQ)())}-${t}`;break;default:n=t}const s=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${r.MF}/${s}`}async function st(t,e){return k(t,"GET","/v2/recaptchaConfig",T(t,e))}function ot(t){return void 0!==t&&void 0!==t.enterprise}class at{constructor(t){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===t.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.emailPasswordEnabled=t.recaptchaEnforcementState.some((t=>"EMAIL_PASSWORD_PROVIDER"===t.provider&&"OFF"!==t.enforcementState))}}function ct(t){return new Promise(((e,n)=>{const i=document.createElement("script");var r,s;i.setAttribute("src",t),i.onload=e,i.onerror=t=>{const e=f("internal-error");e.customData=t,n(e)},i.type="text/javascript",i.charset="UTF-8",(null!==(s=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==s?s:document).appendChild(i)}))}function lt(t){return`__${t}${Math.floor(1e6*Math.random())}`}class ut{constructor(t){this.type="recaptcha-enterprise",this.auth=pt(t)}async verify(t="verify",e=!1){function n(e,n,i){const r=window.grecaptcha;ot(r)?r.enterprise.ready((()=>{r.enterprise.execute(e,{action:t}).then((t=>{n(t)})).catch((()=>{n("NO_RECAPTCHA")}))})):i(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((t,i)=>{(async function(t){if(!e){if(null==t.tenantId&&null!=t._agentRecaptchaConfig)return t._agentRecaptchaConfig.siteKey;if(null!=t.tenantId&&void 0!==t._tenantRecaptchaConfigs[t.tenantId])return t._tenantRecaptchaConfigs[t.tenantId].siteKey}return new Promise((async(e,n)=>{st(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((i=>{if(void 0!==i.recaptchaKey){const n=new at(i);return null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,e(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((t=>{n(t)}))}))})(this.auth).then((r=>{if(!e&&ot(window.grecaptcha))n(r,t,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));ct("https://www.google.com/recaptcha/enterprise.js?render="+r).then((()=>{n(r,t,i)})).catch((t=>{i(t)}))}})).catch((t=>{i(t)}))}))}}async function ht(t,e,n,i=!1){const r=new ut(t);let s;try{s=await r.verify(n)}catch(t){s=await r.verify(n,!0)}const o=Object.assign({},e);return i?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}class dt{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const n=e=>new Promise(((n,i)=>{try{n(t(e))}catch(t){i(t)}}));n.onAbort=e,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const e=[];try{for(const n of this.queue)await n(t),n.onAbort&&e.push(n.onAbort)}catch(t){e.reverse();for(const t of e)try{t()}catch(t){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==t?void 0:t.message})}}}class ft{constructor(t,e,n,i){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new gt(this),this.idTokenSubscription=new gt(this),this.beforeStateQueue=new dt(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=l,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=q(e)),this._initializationPromise=this.queue((async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await G.create(this,t),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(t){}await this.initializeCurrentUser(e),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();return this.currentUser||t?this.currentUser&&t&&this.currentUser.uid===t.uid?(this._currentUser._assign(t),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(t,!0):void 0}async initializeCurrentUser(t){var e;const n=await this.assertedPersistence.getCurrentUser();let i=n,r=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(e=this.redirectUser)||void 0===e?void 0:e._redirectEventId,s=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(t);n&&n!==s||!(null==o?void 0:o.user)||(i=o.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(t){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(t)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return g(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch(t){await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await V(t)}catch(t){if("auth/network-request-failed"!==(null==t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(t){const e=t?(0,i.Ku)(t):null;return e&&g(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&g(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue((async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(t){return this.queue((async()=>{await this.assertedPersistence.setPersistence(q(t))}))}async initializeRecaptchaConfig(){const t=await st(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),e=new at(t);null==this.tenantId?this._agentRecaptchaConfig=e:this._tenantRecaptchaConfigs[this.tenantId]=e,e.emailPasswordEnabled&&new ut(this).verify()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new i.FA("auth","Firebase",t())}onAuthStateChanged(t,e,n){return this.registerStateListener(this.authStateSubscription,t,e,n)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,n){return this.registerStateListener(this.idTokenSubscription,t,e,n)}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(t=this._currentUser)||void 0===t?void 0:t.toJSON()}}async _setRedirectUser(t,e){const n=await this.getOrInitRedirectPersistenceManager(e);return null===t?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&q(t)||this._popupRedirectResolver;g(e,this,"argument-error"),this.redirectPersistenceManager=await G.create(this,[q(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(e=this._currentUser)||void 0===e?void 0:e._redirectEventId)===t?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(t)))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,n,i){if(this._deleted)return()=>{};const r="function"==typeof e?e:e.next.bind(e),s=this._isInitialized?Promise.resolve():this._initializationPromise;return g(s,this,"internal-error"),s.then((()=>r(this.currentUser))),"function"==typeof e?t.addObserver(e,n,i):t.addObserver(e)}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return g(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){t&&!this.frameworks.includes(t)&&(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=rt(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(e["X-Firebase-AppCheck"]=i),e}async _getAppCheckToken(){var t;const e=await(null===(t=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getToken());return(null==e?void 0:e.error)&&function(t,...e){u.logLevel<=o.$b.WARN&&u.warn(`Auth (${r.MF}): ${t}`,...e)}(`Error while retrieving App Check token: ${e.error}`),null==e?void 0:e.token}}function pt(t){return(0,i.Ku)(t)}class gt{constructor(t){this.auth=t,this.observer=null,this.addObserver=(0,i.tD)((t=>this.observer=t))}get next(){return g(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function mt(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function yt(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}class vt{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return m("not implemented")}_getIdTokenResponse(t){return m("not implemented")}_linkToIdToken(t,e){return m("not implemented")}_getReauthenticationResolver(t){return m("not implemented")}}async function bt(t,e){return C(t,"POST","/v1/accounts:signInWithPassword",T(t,e))}async function wt(t,e){return async function(t,e){return k(t,"POST","/v1/accounts:sendOobCode",T(t,e))}(t,e)}class _t extends vt{constructor(t,e,n,i=null){super("password",n),this._email=t,this._password=e,this._tenantId=i}static _fromEmailAndPassword(t,e){return new _t(t,e,"password")}static _fromEmailAndCode(t,e,n=null){return new _t(t,e,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t;if((null==e?void 0:e.email)&&(null==e?void 0:e.password)){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){var e;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null===(e=t._getRecaptchaConfig())||void 0===e?void 0:e.emailPasswordEnabled){const e=await ht(t,n,"signInWithPassword");return bt(t,e)}return bt(t,n).catch((async e=>{if("auth/missing-recaptcha-token"===e.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const e=await ht(t,n,"signInWithPassword");return bt(t,e)}return Promise.reject(e)}));case"emailLink":return async function(t,e){return C(t,"POST","/v1/accounts:signInWithEmailLink",T(t,e))}(t,{email:this._email,oobCode:this._password});default:d(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":return async function(t,e){return k(t,"POST","/v1/accounts:update",e)}(t,{idToken:e,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(t,e){return C(t,"POST","/v1/accounts:signInWithEmailLink",T(t,e))}(t,{idToken:e,email:this._email,oobCode:this._password});default:d(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}async function xt(t,e){return C(t,"POST","/v1/accounts:signInWithIdp",T(t,e))}class It extends vt{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new It(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):d("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t,{providerId:n,signInMethod:i}=e,r=(0,s.Tt)(e,["providerId","signInMethod"]);if(!n||!i)return null;const o=new It(n,i);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(t){return xt(t,this.buildRequest())}_linkToIdToken(t,e){const n=this.buildRequest();return n.idToken=e,xt(t,n)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,xt(t,e)}buildRequest(){const t={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=(0,i.Am)(e)}return t}}const Et={USER_NOT_FOUND:"user-not-found"};class Tt extends vt{constructor(t){super("phone","phone"),this.params=t}static _fromVerification(t,e){return new Tt({verificationId:t,verificationCode:e})}static _fromTokenResponse(t,e){return new Tt({phoneNumber:t,temporaryProof:e})}_getIdTokenResponse(t){return async function(t,e){return C(t,"POST","/v1/accounts:signInWithPhoneNumber",T(t,e))}(t,this._makeVerificationRequest())}_linkToIdToken(t,e){return async function(t,e){const n=await C(t,"POST","/v1/accounts:signInWithPhoneNumber",T(t,e));if(n.temporaryProof)throw M(t,"account-exists-with-different-credential",n);return n}(t,Object.assign({idToken:e},this._makeVerificationRequest()))}_getReauthenticationResolver(t){return async function(t,e){return C(t,"POST","/v1/accounts:signInWithPhoneNumber",T(t,Object.assign(Object.assign({},e),{operation:"REAUTH"})),Et)}(t,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:t,phoneNumber:e,verificationId:n,verificationCode:i}=this.params;return t&&e?{temporaryProof:t,phoneNumber:e}:{sessionInfo:n,code:i}}toJSON(){const t={providerId:this.providerId};return this.params.phoneNumber&&(t.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(t.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(t.verificationCode=this.params.verificationCode),this.params.verificationId&&(t.verificationId=this.params.verificationId),t}static fromJSON(t){"string"==typeof t&&(t=JSON.parse(t));const{verificationId:e,verificationCode:n,phoneNumber:i,temporaryProof:r}=t;return n||e||i||r?new Tt({verificationId:e,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class kt{constructor(t){var e,n,r,s,o,a;const c=(0,i.I9)((0,i.hp)(t)),l=null!==(e=c.apiKey)&&void 0!==e?e:null,u=null!==(n=c.oobCode)&&void 0!==n?n:null,h=function(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=c.mode)&&void 0!==r?r:null);g(l&&u&&h,"argument-error"),this.apiKey=l,this.operation=h,this.code=u,this.continueUrl=null!==(s=c.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(o=c.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=c.tenantId)&&void 0!==a?a:null}static parseLink(t){const e=function(t){const e=(0,i.I9)((0,i.hp)(t)).link,n=e?(0,i.I9)((0,i.hp)(e)).deep_link_id:null,r=(0,i.I9)((0,i.hp)(t)).deep_link_id;return(r?(0,i.I9)((0,i.hp)(r)).link:null)||r||n||e||t}(t);try{return new kt(e)}catch(t){return null}}}class St{constructor(){this.providerId=St.PROVIDER_ID}static credential(t,e){return _t._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const n=kt.parseLink(e);return g(n,"argument-error"),_t._fromEmailAndCode(t,n.code,n.tenantId)}}St.PROVIDER_ID="password",St.EMAIL_PASSWORD_SIGN_IN_METHOD="password",St.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Ct{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class At extends Ct{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class Dt extends At{constructor(){super("facebook.com")}static credential(t){return It._fromParams({providerId:Dt.PROVIDER_ID,signInMethod:Dt.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Dt.credentialFromTaggedObject(t)}static credentialFromError(t){return Dt.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Dt.credential(t.oauthAccessToken)}catch(t){return null}}}Dt.FACEBOOK_SIGN_IN_METHOD="facebook.com",Dt.PROVIDER_ID="facebook.com";class Mt extends At{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return It._fromParams({providerId:Mt.PROVIDER_ID,signInMethod:Mt.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return Mt.credentialFromTaggedObject(t)}static credentialFromError(t){return Mt.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:n}=t;if(!e&&!n)return null;try{return Mt.credential(e,n)}catch(t){return null}}}Mt.GOOGLE_SIGN_IN_METHOD="google.com",Mt.PROVIDER_ID="google.com";class Ot extends At{constructor(){super("github.com")}static credential(t){return It._fromParams({providerId:Ot.PROVIDER_ID,signInMethod:Ot.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Ot.credentialFromTaggedObject(t)}static credentialFromError(t){return Ot.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Ot.credential(t.oauthAccessToken)}catch(t){return null}}}Ot.GITHUB_SIGN_IN_METHOD="github.com",Ot.PROVIDER_ID="github.com";class Pt extends At{constructor(){super("twitter.com")}static credential(t,e){return It._fromParams({providerId:Pt.PROVIDER_ID,signInMethod:Pt.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return Pt.credentialFromTaggedObject(t)}static credentialFromError(t){return Pt.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:n}=t;if(!e||!n)return null;try{return Pt.credential(e,n)}catch(t){return null}}}async function Rt(t,e){return C(t,"POST","/v1/accounts:signUp",T(t,e))}Pt.TWITTER_SIGN_IN_METHOD="twitter.com",Pt.PROVIDER_ID="twitter.com";class Nt{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,n,i=!1){const r=await j._fromIdTokenResponse(t,n,i),s=Lt(n);return new Nt({user:r,providerId:s,_tokenResponse:n,operationType:e})}static async _forOperation(t,e,n){await t._updateTokensIfNecessary(n,!0);const i=Lt(n);return new Nt({user:t,providerId:i,_tokenResponse:n,operationType:e})}}function Lt(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class Ft extends i.g{constructor(t,e,n,i){var r;super(e.code,e.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Ft.prototype),this.customData={appName:t.name,tenantId:null!==(r=t.tenantId)&&void 0!==r?r:void 0,_serverResponse:e.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(t,e,n,i){return new Ft(t,e,n,i)}}function Vt(t,e,n,i){return("reauthenticate"===e?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Ft._fromErrorAndOperation(t,n,e,i);throw n}))}async function Bt(t,e,n=!1){const i="signIn",r=await Vt(t,i,e),s=await Nt._fromIdTokenResponse(t,i,r);return n||await t._updateCurrentUser(s.user),s}function Ut(t,e,n){var i;g((null===(i=n.url)||void 0===i?void 0:i.length)>0,t,"invalid-continue-uri"),g(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,t,"invalid-dynamic-link-domain"),e.continueUrl=n.url,e.dynamicLinkDomain=n.dynamicLinkDomain,e.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(g(n.iOS.bundleId.length>0,t,"missing-ios-bundle-id"),e.iOSBundleId=n.iOS.bundleId),n.android&&(g(n.android.packageName.length>0,t,"missing-android-pkg-name"),e.androidInstallApp=n.android.installApp,e.androidMinimumVersionCode=n.android.minimumVersion,e.androidPackageName=n.android.packageName)}async function jt(t,e,n){var i;const r=pt(t),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};if(null===(i=r._getRecaptchaConfig())||void 0===i?void 0:i.emailPasswordEnabled){const t=await ht(r,s,"getOobCode",!0);n&&Ut(r,t,n),await wt(r,t)}else n&&Ut(r,s,n),await wt(r,s).catch((async t=>{if("auth/missing-recaptcha-token"!==t.code)return Promise.reject(t);{console.log("Password resets are protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the password reset flow.");const t=await ht(r,s,"getOobCode",!0);n&&Ut(r,t,n),await wt(r,t)}}))}async function zt(t,e,n){var i;const r=pt(t),s={returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"};let o;if(null===(i=r._getRecaptchaConfig())||void 0===i?void 0:i.emailPasswordEnabled){const t=await ht(r,s,"signUpPassword");o=Rt(r,t)}else o=Rt(r,s).catch((async t=>{if("auth/missing-recaptcha-token"===t.code){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const t=await ht(r,s,"signUpPassword");return Rt(r,t)}return Promise.reject(t)}));const a=await o.catch((t=>Promise.reject(t))),c=await Nt._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(c.user),c}function qt(t,e,n){return async function(t,e){return Bt(pt(t),e)}((0,i.Ku)(t),St.credential(e,n))}function $t(t,e,n,r){return(0,i.Ku)(t).onAuthStateChanged(e,n,r)}function Ht(t){return(0,i.Ku)(t).signOut()}new WeakMap;const Kt="__sak";class Gt{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(Kt,"1"),this.storage.removeItem(Kt),Promise.resolve(!0)):Promise.resolve(!1)}catch(t){return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}class Wt extends Gt{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const t=(0,i.ZQ)();return Y(t)||nt(t)}()&&function(){try{return!(!window||window===window.top)}catch(t){return!1}}(),this.fallbackToPolling=it(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const n=this.storage.getItem(e),i=this.localCache[e];n!==i&&t(e,i,n)}}onStorageEvent(t,e=!1){if(!t.key)return void this.forAllChangedKeys(((t,e,n)=>{this.notifyListeners(t,n)}));const n=t.key;if(e?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(t.newValue!==i)null!==t.newValue?this.storage.setItem(n,t.newValue):this.storage.removeItem(n);else if(this.localCache[n]===t.newValue&&!e)return}const r=()=>{const t=this.storage.getItem(n);(e||this.localCache[n]!==t)&&this.notifyListeners(n,t)},s=this.storage.getItem(n);(0,i.lT)()&&10===document.documentMode&&s!==t.newValue&&t.newValue!==t.oldValue?setTimeout(r,10):r()}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const t of Array.from(n))t(e?JSON.parse(e):e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((t,e,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}Wt.type="LOCAL";const Qt=Wt;class Yt extends Gt{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(t,e){}_removeListener(t,e){}}Yt.type="SESSION";const Xt=Yt;class Jt{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find((e=>e.isListeningto(t)));if(e)return e;const n=new Jt(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:n,eventType:i,data:r}=e.data,s=this.handlersMap[i];if(!(null==s?void 0:s.size))return;e.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(s).map((async t=>t(e.origin,r))),a=await function(t){return Promise.all(t.map((async t=>{try{return{fulfilled:!0,value:await t}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);e.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(t,e){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),e&&0!==this.handlersMap[t].size||delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Zt(t="",e=10){let n="";for(let t=0;t<e;t++)n+=Math.floor(10*Math.random());return t+n}Jt.receivers=[];class te{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,s;return new Promise(((o,a)=>{const c=Zt("",20);i.port1.start();const l=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:i,onMessage(t){const e=t;if(e.data.eventId===c)switch(e.data.status){case"ack":clearTimeout(l),r=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(r),o(e.data.response);break;default:clearTimeout(l),clearTimeout(r),a(new Error("invalid_response"))}}},this.handlers.add(s),i.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:t,eventId:c,data:e},[i.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function ee(){return window}function ne(){return void 0!==ee().WorkerGlobalScope&&"function"==typeof ee().importScripts}const ie="firebaseLocalStorageDb",re="firebaseLocalStorage",se="fbase_key";class oe{constructor(t){this.request=t}toPromise(){return new Promise(((t,e)=>{this.request.addEventListener("success",(()=>{t(this.request.result)})),this.request.addEventListener("error",(()=>{e(this.request.error)}))}))}}function ae(t,e){return t.transaction([re],e?"readwrite":"readonly").objectStore(re)}function ce(){const t=indexedDB.open(ie,1);return new Promise(((e,n)=>{t.addEventListener("error",(()=>{n(t.error)})),t.addEventListener("upgradeneeded",(()=>{const e=t.result;try{e.createObjectStore(re,{keyPath:se})}catch(t){n(t)}})),t.addEventListener("success",(async()=>{const n=t.result;n.objectStoreNames.contains(re)?e(n):(n.close(),await function(){const t=indexedDB.deleteDatabase(ie);return new oe(t).toPromise()}(),e(await ce()))}))}))}async function le(t,e,n){const i=ae(t,!0).put({[se]:e,value:n});return new oe(i).toPromise()}function ue(t,e){const n=ae(t,!0).delete(e);return new oe(n).toPromise()}class he{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await ce()),this.db}async _withRetries(t){let e=0;for(;;)try{const e=await this._openDb();return await t(e)}catch(t){if(e++>3)throw t;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ne()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Jt._getInstance(ne()?self:null),this.receiver._subscribe("keyChanged",(async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)}))),this.receiver._subscribe("ping",(async(t,e)=>["keyChanged"]))}async initializeSender(){var t,e;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new te(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(t=n[0])||void 0===t?void 0:t.fulfilled)&&(null===(e=n[0])||void 0===e?void 0:e.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){var e;if(this.sender&&this.activeServiceWorker&&((null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await ce();return await le(t,Kt,"1"),await ue(t,Kt),!0}catch(t){}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite((async()=>(await this._withRetries((n=>le(n,t,e))),this.localCache[t]=e,this.notifyServiceWorker(t))))}async _get(t){const e=await this._withRetries((e=>async function(t,e){const n=ae(t,!1).get(e),i=await new oe(n).toPromise();return void 0===i?null:i.value}(e,t)));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite((async()=>(await this._withRetries((e=>ue(e,t))),delete this.localCache[t],this.notifyServiceWorker(t))))}async _poll(){const t=await this._withRetries((t=>{const e=ae(t,!1).getAll();return new oe(e).toPromise()}));if(!t)return[];if(0!==this.pendingWrites)return[];const e=[],n=new Set;for(const{fbase_key:i,value:r}of t)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),e.push(i));for(const t of Object.keys(this.localCache))this.localCache[t]&&!n.has(t)&&(this.notifyListeners(t,null),e.push(t));return e}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const t of Array.from(n))t(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}he.type="LOCAL";const de=he;lt("rcb"),new w(3e4,6e4);class fe{constructor(t){this.providerId=fe.PROVIDER_ID,this.auth=pt(t)}verifyPhoneNumber(t,e){return async function(t,e,n){var i;const r=await n.verify();try{let s;if(g("string"==typeof r,t,"argument-error"),g("recaptcha"===n.type,t,"argument-error"),s="string"==typeof e?{phoneNumber:e}:e,"session"in s){const e=s.session;if("phoneNumber"in s){g("enroll"===e.type,t,"internal-error");const n=await function(t,e){return k(t,"POST","/v2/accounts/mfaEnrollment:start",T(t,e))}(t,{idToken:e.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:r}});return n.phoneSessionInfo.sessionInfo}{g("signin"===e.type,t,"internal-error");const n=(null===(i=s.multiFactorHint)||void 0===i?void 0:i.uid)||s.multiFactorUid;g(n,t,"missing-multi-factor-info");const o=await function(t,e){return k(t,"POST","/v2/accounts/mfaSignIn:start",T(t,e))}(t,{mfaPendingCredential:e.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:r}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:e}=await async function(t,e){return k(t,"POST","/v1/accounts:sendVerificationCode",T(t,e))}(t,{phoneNumber:s.phoneNumber,recaptchaToken:r});return e}}finally{n._reset()}}(this.auth,t,(0,i.Ku)(e))}static credential(t,e){return Tt._fromVerification(t,e)}static credentialFromResult(t){const e=t;return fe.credentialFromTaggedObject(e)}static credentialFromError(t){return fe.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{phoneNumber:e,temporaryProof:n}=t;return e&&n?Tt._fromTokenResponse(e,n):null}}fe.PROVIDER_ID="phone",fe.PHONE_SIGN_IN_METHOD="phone";class pe extends vt{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return xt(t,this._buildIdpRequest())}_linkToIdToken(t,e){return xt(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return xt(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function ge(t){return Bt(t.auth,new pe(t),t.bypassAuthState)}function me(t){const{auth:e,user:n}=t;return g(n,e,"internal-error"),async function(t,e,n=!1){const{auth:i}=t,r="reauthenticate";try{const s=await N(t,Vt(i,r,e,t),n);g(s.idToken,i,"internal-error");const o=R(s.idToken);g(o,i,"internal-error");const{sub:a}=o;return g(t.uid===a,i,"user-mismatch"),Nt._forOperation(t,r,s)}catch(t){throw"auth/user-not-found"===(null==t?void 0:t.code)&&d(i,"user-mismatch"),t}}(n,new pe(t),t.bypassAuthState)}async function ye(t){const{auth:e,user:n}=t;return g(n,e,"internal-error"),async function(t,e,n=!1){const i=await N(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Nt._forOperation(t,"link",i)}(n,new pe(t),t.bypassAuthState)}class ve{constructor(t,e,n,i,r=!1){this.auth=t,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise((async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(t){this.reject(t)}}))}async onAuthEvent(t){const{urlResponse:e,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=t;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:e,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(t){this.reject(t)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return ge;case"linkViaPopup":case"linkViaRedirect":return ye;case"reauthViaPopup":case"reauthViaRedirect":return me;default:d(this.auth,"internal-error")}}resolve(t){y(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){y(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const be=new w(2e3,1e4);class we extends ve{constructor(t,e,n,i,r){super(t,e,i,r),this.provider=n,this.authWindow=null,this.pollId=null,we.currentPopupAction&&we.currentPopupAction.cancel(),we.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return g(t,this.auth,"internal-error"),t}async onExecution(){y(1===this.filter.length,"Popup operations only handle one event");const t=Zt();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch((t=>{this.reject(t)})),this.resolver._isIframeWebStorageSupported(this.auth,(t=>{t||this.reject(f(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var t;return(null===(t=this.authWindow)||void 0===t?void 0:t.associatedEvent)||null}cancel(){this.reject(f(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,we.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e,n;(null===(n=null===(e=this.authWindow)||void 0===e?void 0:e.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(f(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(t,be.get())};t()}}we.currentPopupAction=null;const _e=new Map;class xe extends ve{constructor(t,e,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,n),this.eventId=null}async execute(){let t=_e.get(this.auth._key());if(!t){try{const e=await async function(t,e){const n=function(t){return K("pendingRedirect",t.config.apiKey,t.name)}(e),i=function(t){return q(t._redirectPersistence)}(t);if(!await i._isAvailable())return!1;const r="true"===await i._get(n);return await i._remove(n),r}(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(e)}catch(e){t=()=>Promise.reject(e)}_e.set(this.auth._key(),t)}return this.bypassAuthState||_e.set(this.auth._key(),(()=>Promise.resolve(null))),t()}async onAuthEvent(t){if("signInViaRedirect"===t.type)return super.onAuthEvent(t);if("unknown"!==t.type){if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Ie(t,e){_e.set(t._key(),e)}async function Ee(t,e,n=!1){const i=pt(t),r=function(t,e){return e?q(e):(g(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}(i,e),s=new xe(i,r,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,e)),o}class Te{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(t,n)&&(e=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))})),this.hasHandledPotentialRedirect||!function(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Se(t);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var n;if(t.error&&!Se(t)){const i=(null===(n=t.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";e.onError(f(this.auth,i))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const n=null===e.eventId||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(ke(t))}saveEventToCache(t){this.cachedEventUids.add(ke(t)),this.lastProcessedEventTime=Date.now()}}function ke(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter((t=>t)).join("-")}function Se({type:t,error:e}){return"unknown"===t&&"auth/no-auth-event"===(null==e?void 0:e.code)}const Ce=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ae=/^https?/;function De(t){const e=v(),{protocol:n,hostname:i}=new URL(e);if(t.startsWith("chrome-extension://")){const r=new URL(t);return""===r.hostname&&""===i?"chrome-extension:"===n&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!Ae.test(n))return!1;if(Ce.test(t))return i===t;const r=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const Me=new w(3e4,6e4);function Oe(){const t=ee().___jsl;if(null==t?void 0:t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let Pe=null;function Re(t){return Pe=Pe||function(t){return new Promise(((e,n)=>{var i,r,s;function o(){Oe(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Oe(),n(f(t,"network-request-failed"))},timeout:Me.get()})}if(null===(r=null===(i=ee().gapi)||void 0===i?void 0:i.iframes)||void 0===r?void 0:r.Iframe)e(gapi.iframes.getContext());else{if(!(null===(s=ee().gapi)||void 0===s?void 0:s.load)){const e=lt("iframefcb");return ee()[e]=()=>{gapi.load?o():n(f(t,"network-request-failed"))},ct(`https://apis.google.com/js/api.js?onload=${e}`).catch((t=>n(t)))}o()}})).catch((t=>{throw Pe=null,t}))}(t),Pe}const Ne=new w(5e3,15e3),Le={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Fe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Ve(t){const e=t.config;g(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?_(e,"emulator/auth/iframe"):`https://${t.config.authDomain}/__/auth/iframe`,s={apiKey:e.apiKey,appName:t.name,v:r.MF},o=Fe.get(t.config.apiHost);o&&(s.eid=o);const a=t._getFrameworks();return a.length&&(s.fw=a.join(",")),`${n}?${(0,i.Am)(s).slice(1)}`}const Be={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Ue{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(t){}}}const je=encodeURIComponent("fac");async function ze(t,e,n,s,o,a){g(t.config.authDomain,t,"auth-domain-config-required"),g(t.config.apiKey,t,"invalid-api-key");const c={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:s,v:r.MF,eventId:o};if(e instanceof Ct){e.setDefaultLanguage(t.languageCode),c.providerId=e.providerId||"",(0,i.Im)(e.getCustomParameters())||(c.customParameters=JSON.stringify(e.getCustomParameters()));for(const[t,e]of Object.entries(a||{}))c[t]=e}if(e instanceof At){const t=e.getScopes().filter((t=>""!==t));t.length>0&&(c.scopes=t.join(","))}t.tenantId&&(c.tid=t.tenantId);const l=c;for(const t of Object.keys(l))void 0===l[t]&&delete l[t];const u=await t._getAppCheckToken(),h=u?`#${je}=${encodeURIComponent(u)}`:"";return`${function({config:t}){return t.emulator?_(t,"emulator/auth/handler"):`https://${t.authDomain}/__/auth/handler`}(t)}?${(0,i.Am)(l).slice(1)}${h}`}const qe="webStorageSupport",$e=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Xt,this._completeRedirectFn=Ee,this._overrideRedirectResult=Ie}async _openPopup(t,e,n,r){var s;return y(null===(s=this.eventManagers[t._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()"),function(t,e,n,r=500,s=600){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const l=Object.assign(Object.assign({},Be),{width:r.toString(),height:s.toString(),top:o,left:a}),u=(0,i.ZQ)().toLowerCase();n&&(c=X(u)?"_blank":n),Q(u)&&(e=e||"http://localhost",l.scrollbars="yes");const h=Object.entries(l).reduce(((t,[e,n])=>`${t}${e}=${n},`),"");if(function(t=(0,i.ZQ)()){var e;return nt(t)&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(u)&&"_self"!==c)return function(t,e){const n=document.createElement("a");n.href=t,n.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(e||"",c),new Ue(null);const d=window.open(e||"",c,h);g(d,t,"popup-blocked");try{d.focus()}catch(t){}return new Ue(d)}(t,await ze(t,e,n,v(),r),Zt())}async _openRedirect(t,e,n,i){return await this._originValidation(t),r=await ze(t,e,n,v(),i),ee().location.href=r,new Promise((()=>{}));var r}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:t,promise:n}=this.eventManagers[e];return t?Promise.resolve(t):(y(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(t);return this.eventManagers[e]={promise:n},n.catch((()=>{delete this.eventManagers[e]})),n}async initAndGetManager(t){const e=await async function(t){const e=await Re(t),n=ee().gapi;return g(n,t,"internal-error"),e.open({where:document.body,url:Ve(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Le,dontclear:!0},(e=>new Promise((async(n,i)=>{await e.restyle({setHideOnLeave:!1});const r=f(t,"network-request-failed"),s=ee().setTimeout((()=>{i(r)}),Ne.get());function o(){ee().clearTimeout(s),n(e)}e.ping(o).then(o,(()=>{i(r)}))}))))}(t),n=new Te(t);return e.register("authEvent",(e=>(g(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(qe,{type:qe},(n=>{var i;const r=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i[qe];void 0!==r&&e(!!r),d(t,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=async function(t){if(t.config.emulator)return;const{authorizedDomains:e}=await async function(t,e={}){return k(t,"GET","/v1/projects",e)}(t);for(const t of e)try{if(De(t))return}catch(t){}d(t,"unauthorized-domain")}(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return it()||Y()||nt()}};var He="@firebase/auth",Ke="0.23.2";class Ge{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),(null===(t=this.auth.currentUser)||void 0===t?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged((e=>{t((null==e?void 0:e.stsTokenManager.accessToken)||null)}));this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){g(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const We=(0,i.XA)("authIdTokenMaxAge")||300;let Qe=null;const Ye=t=>async e=>{const n=e&&await e.getIdTokenResult(),i=n&&((new Date).getTime()-Date.parse(n.issuedAtTime))/1e3;if(i&&i>We)return;const r=null==n?void 0:n.token;Qe!==r&&(Qe=r,await fetch(t,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function Xe(t=(0,r.Sx)()){const e=(0,r.j6)(t,"auth");if(e.isInitialized())return e.getImmediate();const n=function(t,e){const n=(0,r.j6)(t,"auth");if(n.isInitialized()){const t=n.getImmediate(),r=n.getOptions();if((0,i.bD)(r,null!=e?e:{}))return t;d(t,"already-initialized")}return n.initialize({options:e})}(t,{popupRedirectResolver:$e,persistence:[de,Qt,Xt]}),s=(0,i.XA)("authTokenSyncURL");if(s){const t=Ye(s);!function(t,e,n){(0,i.Ku)(t).beforeAuthStateChanged(e,n)}(n,t,(()=>t(n.currentUser))),function(e){(0,i.Ku)(e).onIdTokenChanged((e=>t(e)),void 0,void 0)}(n)}const o=(0,i.Tj)("auth");return o&&function(t,e,n){const i=pt(t);g(i._canInitEmulator,i,"emulator-config-failed"),g(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const r=!!(null==n?void 0:n.disableWarnings),s=mt(e),{host:o,port:a}=function(t){const e=mt(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const t=r[1];return{host:t,port:yt(i.substr(t.length+1))}}{const[t,e]=i.split(":");return{host:t,port:yt(e)}}}(e),c=null===a?"":`:${a}`;i.config.emulator={url:`${s}//${o}${c}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||function(){function t(){const t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",t):t())}()}(n,`http://${o}`),n}var Je;Je="Browser",(0,r.om)(new a.uA("auth",((t,{options:e})=>{const n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),r=t.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;g(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:Je,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:rt(Je)},c=new ft(n,i,r,a);return function(t,e){const n=(null==e?void 0:e.persistence)||[],i=(Array.isArray(n)?n:[n]).map(q);(null==e?void 0:e.errorMap)&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(i,null==e?void 0:e.popupRedirectResolver)}(c,e),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((t,e,n)=>{t.getProvider("auth-internal").initialize()}))),(0,r.om)(new a.uA("auth-internal",(t=>(t=>new Ge(t))(pt(t.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,r.KO)(He,Ke,function(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Je)),(0,r.KO)(He,Ke,"esm2017")},517:(t,e,n)=>{"use strict";n.d(e,{Ao:()=>fi,Bx:()=>gi,Jh:()=>mi,O4:()=>pi,VV:()=>_i,ZS:()=>wi,_L:()=>vi,fF:()=>di,iO:()=>bi,jz:()=>xi,ro:()=>yi});var i,r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},s={},o=o||{},a=r||self;function c(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function l(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var u="closure_uid_"+(1e9*Math.random()>>>0),h=0;function d(t,e,n){return t.call.apply(t.bind,arguments)}function f(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function p(t,e,n){return(p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?d:f).apply(null,arguments)}function g(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function m(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return e.prototype[n].apply(t,r)}}function y(){this.s=this.s,this.o=this.o}y.prototype.s=!1,y.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,u)&&t[u]||(t[u]=++h))},y.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const v=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function b(t){const e=t.length;if(0<e){const n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}return[]}function w(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(c(n)){const e=t.length||0,i=n.length||0;t.length=e+i;for(let r=0;r<i;r++)t[e+r]=n[r]}else t.push(n)}}function _(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}_.prototype.h=function(){this.defaultPrevented=!0};var x=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{a.addEventListener("test",(()=>{}),e),a.removeEventListener("test",(()=>{}),e)}catch(t){}return t}();function I(t){return/^[\s\xa0]*$/.test(t)}function E(){var t=a.navigator;return t&&(t=t.userAgent)?t:""}function T(t){return-1!=E().indexOf(t)}function k(t){return k[" "](t),t}k[" "]=function(){};var S,C,A,D=T("Opera"),M=T("Trident")||T("MSIE"),O=T("Edge"),P=O||M,R=T("Gecko")&&!(-1!=E().toLowerCase().indexOf("webkit")&&!T("Edge"))&&!(T("Trident")||T("MSIE"))&&!T("Edge"),N=-1!=E().toLowerCase().indexOf("webkit")&&!T("Edge");function L(){var t=a.document;return t?t.documentMode:void 0}t:{var F="",V=(C=E(),R?/rv:([^\);]+)(\)|;)/.exec(C):O?/Edge\/([\d\.]+)/.exec(C):M?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(C):N?/WebKit\/(\S+)/.exec(C):D?/(?:Version)[ \/]?(\S+)/.exec(C):void 0);if(V&&(F=V?V[1]:""),M){var B=L();if(null!=B&&B>parseFloat(F)){S=String(B);break t}}S=F}a.document&&M?A=L()||parseInt(S,10)||void 0:A=void 0;var U=A;function j(t,e){if(_.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(R){t:{try{k(e.nodeName);var r=!0;break t}catch(t){}r=!1}r||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:z[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&j.$.h.call(this)}}m(j,_);var z={2:"touch",3:"pen",4:"mouse"};j.prototype.h=function(){j.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var q="closure_listenable_"+(1e6*Math.random()|0),$=0;function H(t,e,n,i,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.la=r,this.key=++$,this.fa=this.ia=!1}function K(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function G(t,e,n){for(const i in t)e.call(n,t[i],i,t)}function W(t){const e={};for(const n in t)e[n]=t[n];return e}const Q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(t,e){let n,i;for(let e=1;e<arguments.length;e++){for(n in i=arguments[e],i)t[n]=i[n];for(let e=0;e<Q.length;e++)n=Q[e],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function X(t){this.src=t,this.g={},this.h=0}function J(t,e){var n=e.type;if(n in t.g){var i,r=t.g[n],s=v(r,e);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(K(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function Z(t,e,n,i){for(var r=0;r<t.length;++r){var s=t[r];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==i)return r}return-1}X.prototype.add=function(t,e,n,i,r){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=Z(t,e,i,r);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new H(e,this.src,s,!!i,r)).ia=n,t.push(e)),e};var tt="closure_lm_"+(1e6*Math.random()|0),et={};function nt(t,e,n,i,r){if(i&&i.once)return rt(t,e,n,i,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)nt(t,e[s],n,i,r);return null}return n=ht(n),t&&t[q]?t.O(e,n,l(i)?!!i.capture:!!i,r):it(t,e,n,!1,i,r)}function it(t,e,n,i,r,s){if(!e)throw Error("Invalid event type");var o=l(r)?!!r.capture:!!r,a=lt(t);if(a||(t[tt]=a=new X(t)),(n=a.add(e,n,i,o,s)).proxy)return n;if(i=function(){const t=ct;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)x||(r=o),void 0===r&&(r=!1),t.addEventListener(e.toString(),i,r);else if(t.attachEvent)t.attachEvent(at(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return n}function rt(t,e,n,i,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)rt(t,e[s],n,i,r);return null}return n=ht(n),t&&t[q]?t.P(e,n,l(i)?!!i.capture:!!i,r):it(t,e,n,!0,i,r)}function st(t,e,n,i,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)st(t,e[s],n,i,r);else i=l(i)?!!i.capture:!!i,n=ht(n),t&&t[q]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=Z(s=t.g[e],n,i,r))&&(K(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=lt(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Z(e,n,i,r)),(n=-1<t?e[t]:null)&&ot(n))}function ot(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[q])J(e.i,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(at(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=lt(e))?(J(n,t),0==n.h&&(n.src=null,e[tt]=null)):K(t)}}}function at(t){return t in et?et[t]:et[t]="on"+t}function ct(t,e){if(t.fa)t=!0;else{e=new j(e,this);var n=t.listener,i=t.la||t.src;t.ia&&ot(t),t=n.call(i,e)}return t}function lt(t){return(t=t[tt])instanceof X?t:null}var ut="__closure_events_fn_"+(1e9*Math.random()>>>0);function ht(t){return"function"==typeof t?t:(t[ut]||(t[ut]=function(e){return t.handleEvent(e)}),t[ut])}function dt(){y.call(this),this.i=new X(this),this.S=this,this.J=null}function ft(t,e){var n,i=t.J;if(i)for(n=[];i;i=i.J)n.push(i);if(t=t.S,i=e.type||e,"string"==typeof e)e=new _(e,t);else if(e instanceof _)e.target=e.target||t;else{var r=e;Y(e=new _(i,t),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];r=pt(o,i,!0,e)&&r}if(r=pt(o=e.g=t,i,!0,e)&&r,r=pt(o,i,!1,e)&&r,n)for(s=0;s<n.length;s++)r=pt(o=e.g=n[s],i,!1,e)&&r}function pt(t,e,n,i){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&J(t.i,o),r=!1!==a.call(c,i)&&r}}return r&&!i.defaultPrevented}m(dt,y),dt.prototype[q]=!0,dt.prototype.removeEventListener=function(t,e,n,i){st(this,t,e,n,i)},dt.prototype.N=function(){if(dt.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],i=0;i<n.length;i++)K(n[i]);delete e.g[t],e.h--}}this.J=null},dt.prototype.O=function(t,e,n,i){return this.i.add(String(t),e,!1,n,i)},dt.prototype.P=function(t,e,n,i){return this.i.add(String(t),e,!0,n,i)};var gt=a.JSON.stringify;function mt(){var t=It;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var yt=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new vt),(t=>t.reset()));class vt{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function bt(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function wt(t){a.setTimeout((()=>{throw t}),0)}let _t,xt=!1,It=new class{constructor(){this.h=this.g=null}add(t,e){const n=yt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},Et=()=>{const t=a.Promise.resolve(void 0);_t=()=>{t.then(Tt)}};var Tt=()=>{for(var t;t=mt();){try{t.h.call(t.g)}catch(t){wt(t)}var e=yt;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}xt=!1};function kt(t,e){dt.call(this),this.h=t||1,this.g=e||a,this.j=p(this.qb,this),this.l=Date.now()}function St(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function Ct(t,e,n){if("function"==typeof t)n&&(t=p(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=p(t.handleEvent,t)}return 2147483647<Number(e)?-1:a.setTimeout(t,e||0)}function At(t){t.g=Ct((()=>{t.g=null,t.i&&(t.i=!1,At(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}m(kt,dt),(i=kt.prototype).ga=!1,i.T=null,i.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ft(this,"tick"),this.ga&&(St(this),this.start()))}},i.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},i.N=function(){kt.$.N.call(this),St(this),delete this.g};class Dt extends y{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:At(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Mt(t){y.call(this),this.h=t,this.g={}}m(Mt,y);var Ot=[];function Pt(t,e,n,i){Array.isArray(n)||(n&&(Ot[0]=n.toString()),n=Ot);for(var r=0;r<n.length;r++){var s=nt(e,n[r],i||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function Rt(t){G(t.g,(function(t,e){this.g.hasOwnProperty(e)&&ot(t)}),t),t.g={}}function Nt(){this.g=!0}function Lt(t,e,n,i){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var i=n[t];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}return gt(n)}catch(t){return e}}(t,n)+(i?" "+i:"")}))}Mt.prototype.N=function(){Mt.$.N.call(this),Rt(this)},Mt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Nt.prototype.Ea=function(){this.g=!1},Nt.prototype.info=function(){};var Ft={},Vt=null;function Bt(){return Vt=Vt||new dt}function Ut(t){_.call(this,Ft.Ta,t)}function jt(t){const e=Bt();ft(e,new Ut(e))}function zt(t,e){_.call(this,Ft.STAT_EVENT,t),this.stat=e}function qt(t){const e=Bt();ft(e,new zt(e,t))}function $t(t,e){_.call(this,Ft.Ua,t),this.size=e}function Ht(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return a.setTimeout((function(){t()}),e)}Ft.Ta="serverreachability",m(Ut,_),Ft.STAT_EVENT="statevent",m(zt,_),Ft.Ua="timingevent",m($t,_);var Kt={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Gt={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Wt(){}function Qt(t){return t.h||(t.h=t.i())}function Yt(){}Wt.prototype.h=null;var Xt,Jt={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Zt(){_.call(this,"d")}function te(){_.call(this,"c")}function ee(){}function ne(t,e,n,i){this.l=t,this.j=e,this.m=n,this.W=i||1,this.U=new Mt(this),this.P=re,t=P?125:void 0,this.V=new kt(t),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ie}function ie(){this.i=null,this.g="",this.h=!1}m(Zt,_),m(te,_),m(ee,Wt),ee.prototype.g=function(){return new XMLHttpRequest},ee.prototype.i=function(){return{}},Xt=new ee;var re=45e3,se={},oe={};function ae(t,e,n){t.L=1,t.v=ke(_e(e)),t.s=n,t.S=!0,ce(t,null)}function ce(t,e){t.G=Date.now(),de(t),t.A=_e(t.v);var n=t.A,i=t.W;Array.isArray(i)||(i=[String(i)]),Be(n.i,"t",i),t.C=0,n=t.l.J,t.h=new ie,t.g=Un(t.l,n?e:null,!t.s),0<t.O&&(t.M=new Dt(p(t.Pa,t,t.g),t.O)),Pt(t.U,t.g,"readystatechange",t.nb),e=t.I?W(t.I):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.A,t.u,t.s,e)):(t.u="GET",t.g.ha(t.A,t.u,null,e)),jt(),function(t,e,n,i,r,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var h=u.split("_");o=2<=h.length&&"type"==h[1]?o+(u+"=")+l+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.W,t.s)}function le(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.l.Ha}function ue(t,e,n){let i,r=!0;for(;!t.J&&t.C<n.length;){if(i=he(t,n),i==oe){4==e&&(t.o=4,qt(14),r=!1),Lt(t.j,t.m,null,"[Incomplete Response]");break}if(i==se){t.o=4,qt(15),Lt(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}Lt(t.j,t.m,i,null),ye(t,i)}le(t)&&i!=oe&&i!=se&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,qt(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),On(e),e.M=!0,qt(11))):(Lt(t.j,t.m,n,"[Invalid Chunked Response]"),me(t),ge(t))}function he(t,e){var n=t.C,i=e.indexOf("\n",n);return-1==i?oe:(n=Number(e.substring(n,i)),isNaN(n)?se:(i+=1)+n>e.length?oe:(e=e.slice(i,i+n),t.C=i+n,e))}function de(t){t.Y=Date.now()+t.P,fe(t,t.P)}function fe(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Ht(p(t.lb,t),e)}function pe(t){t.B&&(a.clearTimeout(t.B),t.B=null)}function ge(t){0==t.l.H||t.J||Nn(t.l,t)}function me(t){pe(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,St(t.V),Rt(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function ye(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||Ke(n.i,t)))if(!t.K&&Ke(n.i,t)&&3==n.H){try{var i=n.Ja.g.parse(e)}catch(t){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;Rn(n),En(n)}Mn(n),qt(18)}}else n.Fa=r[1],0<n.Fa-n.V&&37500>r[2]&&n.G&&0==n.A&&!n.v&&(n.v=Ht(p(n.ib,n),6e3));if(1>=He(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else Fn(n,11)}else if((t.K||n.g==t)&&Rn(n),!I(e))for(r=n.Ja.g.parse(e),e=0;e<r.length;e++){let l=r[e];if(n.V=l[0],l=l[1],2==n.H)if("c"==l[0]){n.K=l[1],n.pa=l[2];const e=l[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const r=l[4];null!=r&&(n.Ga=r,n.l.info("SVER="+n.Ga));const u=l[5];null!=u&&"number"==typeof u&&0<u&&(i=1.5*u,n.L=i,n.l.info("backChannelRequestTimeoutMs_="+i)),i=n;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=i.i;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Ge(s,s.h),s.h=null))}if(i.F){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(i.Da=t,Te(i.I,i.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((i=n).wa=Bn(i,i.J?i.pa:null,i.Y),o.K){We(i.i,o);var a=o,c=i.L;c&&a.setTimeout(c),a.B&&(pe(a),de(a)),i.g=o}else Dn(i);0<n.j.length&&kn(n)}else"stop"!=l[0]&&"close"!=l[0]||Fn(n,7);else 3==n.H&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?Fn(n,7):In(n):"noop"!=l[0]&&n.h&&n.h.Aa(l),n.A=0)}jt()}catch(t){}}function ve(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(c(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(c(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const i in t)e[n++]=i;return e}}}(t),i=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(c(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}(t),r=i.length,s=0;s<r;s++)e.call(void 0,i[s],n&&n[s],t)}(i=ne.prototype).setTimeout=function(t){this.P=t},i.nb=function(t){t=t.target;const e=this.M;e&&3==yn(t)?e.l():this.Pa(t)},i.Pa=function(t){try{if(t==this.g)t:{const h=yn(this.g);var e=this.g.Ia();if(this.g.da(),!(3>h)&&(3!=h||P||this.g&&(this.h.h||this.g.ja()||vn(this.g)))){this.J||4!=h||7==e||jt(),pe(this);var n=this.g.da();this.ca=n;e:if(le(this)){var i=vn(this.g);t="";var r=i.length,s=4==yn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){me(this),ge(this);var o="";break e}this.h.i=new a.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,t+=this.h.i.decode(i[e],{stream:s&&e==r-1});i.splice(0,r),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,i,r,s,o){t.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(c)){var u=c;break e}}u=null}if(!(n=u)){this.i=!1,this.o=3,qt(12),me(this),ge(this);break t}Lt(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ye(this,n)}this.S?(ue(this,h,o),P&&this.i&&3==h&&(Pt(this.U,this.V,"tick",this.mb),this.V.start())):(Lt(this.j,this.m,o,null),ye(this,o)),4==h&&me(this),this.i&&!this.J&&(4==h?Nn(this.l,this):(this.i=!1,de(this)))}else(function(t){const e={};t=(t.g&&2<=yn(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<t.length;i++){if(I(t[i]))continue;var n=bt(t[i]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[r]||[];e[r]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,qt(12)):(this.o=0,qt(13)),me(this),ge(this)}}}catch(t){}},i.mb=function(){if(this.g){var t=yn(this.g),e=this.g.ja();this.C<e.length&&(pe(this),ue(this,t,e),this.i&&4!=t&&de(this))}},i.cancel=function(){this.J=!0,me(this)},i.lb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.L&&(jt(),qt(17)),me(this),this.o=2,ge(this)):fe(this,this.Y-t)};var be=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function we(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof we){this.h=t.h,xe(this,t.j),this.s=t.s,this.g=t.g,Ie(this,t.m),this.l=t.l;var e=t.i,n=new Ne;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Ee(this,n),this.o=t.o}else t&&(e=String(t).match(be))?(this.h=!1,xe(this,e[1]||"",!0),this.s=Se(e[2]||""),this.g=Se(e[3]||"",!0),Ie(this,e[4]),this.l=Se(e[5]||"",!0),Ee(this,e[6]||"",!0),this.o=Se(e[7]||"")):(this.h=!1,this.i=new Ne(null,this.h))}function _e(t){return new we(t)}function xe(t,e,n){t.j=n?Se(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Ie(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Ee(t,e,n){e instanceof Ne?(t.i=e,function(t,e){e&&!t.j&&(Le(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Fe(this,e),Be(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Ce(e,Pe)),t.i=new Ne(e,t.h))}function Te(t,e,n){t.i.set(e,n)}function ke(t){return Te(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Se(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ce(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Ae),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ae(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}we.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Ce(e,De,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Ce(e,De,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ce(n,"/"==n.charAt(0)?Oe:Me,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Ce(n,Re)),t.join("")};var De=/[#\/\?@]/g,Me=/[#\?:]/g,Oe=/[#\?]/g,Pe=/[#\?@]/g,Re=/#/g;function Ne(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Le(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),r=null;if(0<=i){var s=t[n].substring(0,i);r=t[n].substring(i+1)}else s=t[n];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Fe(t,e){Le(t),e=Ue(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Ve(t,e){return Le(t),e=Ue(t,e),t.g.has(e)}function Be(t,e,n){Fe(t,e),0<n.length&&(t.i=null,t.g.set(Ue(t,e),b(n)),t.h+=n.length)}function Ue(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(i=Ne.prototype).add=function(t,e){Le(this),this.i=null,t=Ue(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},i.forEach=function(t,e){Le(this),this.g.forEach((function(n,i){n.forEach((function(n){t.call(e,n,i,this)}),this)}),this)},i.ta=function(){Le(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let i=0;i<e.length;i++){const r=t[i];for(let t=0;t<r.length;t++)n.push(e[i])}return n},i.Z=function(t){Le(this);let e=[];if("string"==typeof t)Ve(this,t)&&(e=e.concat(this.g.get(Ue(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},i.set=function(t,e){return Le(this),this.i=null,Ve(this,t=Ue(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},i.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},i.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var i=e[n];const s=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var r=s;""!==o[i]&&(r+="="+encodeURIComponent(String(o[i]))),t.push(r)}}return this.i=t.join("&")};var je=class{constructor(t,e){this.g=t,this.map=e}};function ze(t){this.l=t||qe,t=a.PerformanceNavigationTiming?0<(t=a.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(a.g&&a.g.Ka&&a.g.Ka()&&a.g.Ka().ec),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var qe=10;function $e(t){return!!t.h||!!t.g&&t.g.size>=t.j}function He(t){return t.h?1:t.g?t.g.size:0}function Ke(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Ge(t,e){t.g?t.g.add(e):t.h=e}function We(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Qe(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return b(t.i)}ze.prototype.cancel=function(){if(this.i=Qe(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var Ye=class{stringify(t){return a.JSON.stringify(t,void 0)}parse(t){return a.JSON.parse(t,void 0)}};function Xe(){this.g=new Ye}function Je(t,e,n){const i=n||"";try{ve(t,(function(t,n){let r=t;l(t)&&(r=gt(t)),e.push(i+n+"="+encodeURIComponent(r))}))}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}function Ze(t,e,n,i,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(i)}catch(t){}}function tn(t){this.l=t.fc||null,this.j=t.ob||!1}function en(t,e){dt.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=nn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}m(tn,Wt),tn.prototype.g=function(){return new en(this.l,this.j)},tn.prototype.i=function(t){return function(){return t}}({}),m(en,dt);var nn=0;function rn(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function sn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,on(t)}function on(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(i=en.prototype).open=function(t,e){if(this.readyState!=nn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,on(this)},i.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||a).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},i.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,sn(this)),this.readyState=nn},i.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,on(this)),this.g&&(this.readyState=3,on(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==a.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;rn(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},i.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?sn(this):on(this),3==this.readyState&&rn(this)}},i.Za=function(t){this.g&&(this.response=this.responseText=t,sn(this))},i.Ya=function(t){this.g&&(this.response=t,sn(this))},i.ka=function(){this.g&&sn(this)},i.setRequestHeader=function(t,e){this.v.append(t,e)},i.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(en.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var an=a.JSON.parse;function cn(t){dt.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=ln,this.L=this.M=!1}m(cn,dt);var ln="",un=/^https?$/i,hn=["POST","PUT"];function dn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,fn(t),gn(t)}function fn(t){t.F||(t.F=!0,ft(t,"complete"),ft(t,"error"))}function pn(t){if(t.h&&void 0!==o&&(!t.C[1]||4!=yn(t)||2!=t.da()))if(t.v&&4==yn(t))Ct(t.La,0,t);else if(ft(t,"readystatechange"),4==yn(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===o){var r=String(t.I).match(be)[1]||null;!r&&a.self&&a.self.location&&(r=a.self.location.protocol.slice(0,-1)),i=!un.test(r?r.toLowerCase():"")}n=i}if(n)ft(t,"complete"),ft(t,"success");else{t.m=6;try{var s=2<yn(t)?t.g.statusText:""}catch(t){s=""}t.j=s+" ["+t.da()+"]",fn(t)}}finally{gn(t)}}}function gn(t,e){if(t.g){mn(t);const n=t.g,i=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||ft(t,"ready");try{n.onreadystatechange=i}catch(t){}}}function mn(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(a.clearTimeout(t.A),t.A=null)}function yn(t){return t.g?t.g.readyState:0}function vn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case ln:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function bn(t){let e="";return G(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function wn(t,e,n){t:{for(i in n){var i=!1;break t}i=!0}i||(n=bn(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Te(t,e,n))}function _n(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function xn(t){this.Ga=0,this.j=[],this.l=new Nt,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=_n("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=_n("baseRetryDelayMs",5e3,t),this.hb=_n("retryDelaySeedMs",1e4,t),this.eb=_n("forwardChannelMaxRetries",2,t),this.xa=_n("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.dc||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new ze(t&&t.concurrentRequestLimit),this.Ja=new Xe,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function In(t){if(Tn(t),3==t.H){var e=t.W++,n=_e(t.I);if(Te(n,"SID",t.K),Te(n,"RID",e),Te(n,"TYPE","terminate"),Cn(t,n),(e=new ne(t,t.l,e)).L=2,e.v=ke(_e(n)),n=!1,a.navigator&&a.navigator.sendBeacon)try{n=a.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&a.Image&&((new Image).src=e.v,n=!0),n||(e.g=Un(e.l,null),e.g.ha(e.v)),e.G=Date.now(),de(e)}Vn(t)}function En(t){t.g&&(On(t),t.g.cancel(),t.g=null)}function Tn(t){En(t),t.u&&(a.clearTimeout(t.u),t.u=null),Rn(t),t.i.cancel(),t.m&&("number"==typeof t.m&&a.clearTimeout(t.m),t.m=null)}function kn(t){if(!$e(t.i)&&!t.m){t.m=!0;var e=t.Na;_t||Et(),xt||(_t(),xt=!0),It.add(e,t),t.C=0}}function Sn(t,e){var n;n=e?e.m:t.W++;const i=_e(t.I);Te(i,"SID",t.K),Te(i,"RID",n),Te(i,"AID",t.V),Cn(t,i),t.o&&t.s&&wn(i,t.o,t.s),n=new ne(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=An(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),Ge(t.i,n),ae(n,i,e)}function Cn(t,e){t.na&&G(t.na,(function(t,n){Te(e,n,t)})),t.h&&ve({},(function(t,n){Te(e,n,t)}))}function An(t,e,n){n=Math.min(t.j.length,n);var i=t.h?p(t.h.Va,t.h,t):null;t:{var r=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=r[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=r[o].g;const a=r[o].map;if(n-=e,0>n)e=Math.max(0,r[o].g-100),s=!1;else try{Je(a,t,"req"+n+"_")}catch(t){i&&i(a)}}if(s){i=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,i}function Dn(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;_t||Et(),xt||(_t(),xt=!0),It.add(e,t),t.A=0}}function Mn(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=Ht(p(t.Ma,t),Ln(t,t.A)),t.A++,0))}function On(t){null!=t.B&&(a.clearTimeout(t.B),t.B=null)}function Pn(t){t.g=new ne(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=_e(t.wa);Te(e,"RID","rpc"),Te(e,"SID",t.K),Te(e,"AID",t.V),Te(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Te(e,"TO",t.qa),Te(e,"TYPE","xmlhttp"),Cn(t,e),t.o&&t.s&&wn(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.v=ke(_e(e)),n.s=null,n.S=!0,ce(n,t)}function Rn(t){null!=t.v&&(a.clearTimeout(t.v),t.v=null)}function Nn(t,e){var n=null;if(t.g==e){Rn(t),On(t),t.g=null;var i=2}else{if(!Ke(t.i,e))return;n=e.F,We(t.i,e),i=1}if(0!=t.H)if(e.i)if(1==i){n=e.s?e.s.length:0,e=Date.now()-e.G;var r=t.C;ft(i=Bt(),new $t(i,n)),kn(t)}else Dn(t);else if(3==(r=e.o)||0==r&&0<e.ca||!(1==i&&function(t,e){return!(He(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=Ht(p(t.Na,t,e),Ln(t,t.C)),t.C++,0)))}(t,e)||2==i&&Mn(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),r){case 1:Fn(t,5);break;case 4:Fn(t,10);break;case 3:Fn(t,6);break;default:Fn(t,2)}}function Ln(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Fn(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var i=p(t.pb,t);n||(n=new we("//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||xe(n,"https"),ke(n)),function(t,e){const n=new Nt;if(a.Image){const i=new Image;i.onload=g(Ze,n,i,"TestLoadImage: loaded",!0,e),i.onerror=g(Ze,n,i,"TestLoadImage: error",!1,e),i.onabort=g(Ze,n,i,"TestLoadImage: abort",!1,e),i.ontimeout=g(Ze,n,i,"TestLoadImage: timeout",!1,e),a.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=t}else e(!1)}(n.toString(),i)}else qt(2);t.H=0,t.h&&t.h.za(e),Vn(t),Tn(t)}function Vn(t){if(t.H=0,t.ma=[],t.h){const e=Qe(t.i);0==e.length&&0==t.j.length||(w(t.ma,e),w(t.ma,t.j),t.i.i.length=0,b(t.j),t.j.length=0),t.h.ya()}}function Bn(t,e,n){var i=n instanceof we?_e(n):new we(n);if(""!=i.g)e&&(i.g=e+"."+i.g),Ie(i,i.m);else{var r=a.location;i=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var s=new we(null);i&&xe(s,i),e&&(s.g=e),r&&Ie(s,r),n&&(s.l=n),i=s}return n=t.F,e=t.Da,n&&e&&Te(i,n,e),Te(i,"VER",t.ra),Cn(t,i),i}function Un(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ha&&!t.va?new cn(new tn({ob:!0})):new cn(t.va)).Oa(t.J),e}function jn(){}function zn(){if(M&&!(10<=Number(U)))throw Error("Environmental error: no available transport.")}function qn(t,e){dt.call(this),this.g=new xn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!I(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!I(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Kn(this)}function $n(t){Zt.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Hn(){te.call(this),this.status=1}function Kn(t){this.g=t}function Gn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Wn(t,e,n){n||(n=0);var i=Array(16);if("string"==typeof e)for(var r=0;16>r;++r)i[r]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(r=0;16>r;++r)i[r]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],r=t.g[2];var s=t.g[3],o=e+(s^n&(r^s))+i[0]+3614090360&4294967295;o=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(r^s))+i[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(r^s))+i[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(r^s))+i[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^s&(n^r))+i[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(n^r))+i[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(n^r))+i[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(n^r))+i[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^r^s)+i[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^s)+i[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^s)+i[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^s)+i[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(r^(n|~s))+i[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~n))+i[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~e))+i[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(n|~s))+i[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~n))+i[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~e))+i[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(n|~s))+i[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~n))+i[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~e))+i[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(r^(n|~s))+i[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((r=s+((o=r+(e^(s|~n))+i[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+i[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+r&4294967295,t.g[3]=t.g[3]+s&4294967295}function Qn(t,e){this.h=e;for(var n=[],i=!0,r=t.length-1;0<=r;r--){var s=0|t[r];i&&s==e||(n[r]=s,i=!1)}this.g=n}(i=cn.prototype).Oa=function(t){this.M=t},i.ha=function(t,e,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Xt.g(),this.C=this.u?Qt(this.u):Qt(Xt),this.g.onreadystatechange=p(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void dn(this,t)}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)n.set(r,i[r]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const t of i.keys())n.set(t,i.get(t))}i=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),r=a.FormData&&t instanceof a.FormData,!(0<=v(hn,e))||i||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{mn(this),0<this.B&&((this.L=function(t){return M&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=p(this.ua,this)):this.A=Ct(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){dn(this,t)}},i.ua=function(){void 0!==o&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ft(this,"timeout"),this.abort(8))},i.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,ft(this,"complete"),ft(this,"abort"),gn(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),gn(this,!0)),cn.$.N.call(this)},i.La=function(){this.s||(this.G||this.v||this.l?pn(this):this.kb())},i.kb=function(){pn(this)},i.isActive=function(){return!!this.g},i.da=function(){try{return 2<yn(this)?this.g.status:-1}catch(t){return-1}},i.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},i.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),an(e)}},i.Ia=function(){return this.m},i.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(i=xn.prototype).ra=8,i.H=1,i.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const r=new ne(this,this.l,t);let s=this.s;if(this.U&&(s?(s=W(s),Y(s,this.U)):s=this.U),null!==this.o||this.O||(r.I=s,s=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var i=this.j[n];if(void 0===(i="__data__"in i.map&&"string"==typeof(i=i.map.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=An(this,r,e),Te(n=_e(this.I),"RID",t),Te(n,"CVER",22),this.F&&Te(n,"X-HTTP-Session-Id",this.F),Cn(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(bn(s)))+"&"+e:this.o&&wn(n,this.o,s)),Ge(this.i,r),this.bb&&Te(n,"TYPE","init"),this.P?(Te(n,"$req",e),Te(n,"SID","null"),r.aa=!0,ae(r,n,null)):ae(r,n,e),this.H=2}}else 3==this.H&&(t?Sn(this,t):0==this.j.length||$e(this.i)||Sn(this))},i.Ma=function(){if(this.u=null,Pn(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=Ht(p(this.jb,this),t)}},i.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,qt(10),En(this),Pn(this))},i.ib=function(){null!=this.v&&(this.v=null,En(this),Mn(this),qt(19))},i.pb=function(t){t?(this.l.info("Successfully pinged google.com"),qt(2)):(this.l.info("Failed to ping google.com"),qt(1))},i.isActive=function(){return!!this.h&&this.h.isActive(this)},(i=jn.prototype).Ba=function(){},i.Aa=function(){},i.za=function(){},i.ya=function(){},i.isActive=function(){return!0},i.Va=function(){},zn.prototype.g=function(t,e){return new qn(t,e)},m(qn,dt),qn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;qt(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=Bn(t,null,t.Y),kn(t)},qn.prototype.close=function(){In(this.g)},qn.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=gt(t),t=n);e.j.push(new je(e.fb++,t)),3==e.H&&kn(e)},qn.prototype.N=function(){this.g.h=null,delete this.j,In(this.g),delete this.g,qn.$.N.call(this)},m($n,Zt),m(Hn,te),m(Kn,jn),Kn.prototype.Ba=function(){ft(this.g,"a")},Kn.prototype.Aa=function(t){ft(this.g,new $n(t))},Kn.prototype.za=function(t){ft(this.g,new Hn)},Kn.prototype.ya=function(){ft(this.g,"b")},m(Gn,(function(){this.blockSize=-1})),Gn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Gn.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,i=this.m,r=this.h,s=0;s<e;){if(0==r)for(;s<=n;)Wn(this,t,s),s+=this.blockSize;if("string"==typeof t){for(;s<e;)if(i[r++]=t.charCodeAt(s++),r==this.blockSize){Wn(this,i),r=0;break}}else for(;s<e;)if(i[r++]=t[s++],r==this.blockSize){Wn(this,i),r=0;break}}this.h=r,this.i+=e},Gn.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var i=0;32>i;i+=8)t[n++]=this.g[e]>>>i&255;return t};var Yn={};function Xn(t){return-128<=t&&128>t?function(t){var e=Yn;return Object.prototype.hasOwnProperty.call(e,t)?e[t]:e[t]=function(t){return new Qn([0|t],0>t?-1:0)}(t)}(t):new Qn([0|t],0>t?-1:0)}function Jn(t){if(isNaN(t)||!isFinite(t))return ti;if(0>t)return si(Jn(-t));for(var e=[],n=1,i=0;t>=n;i++)e[i]=t/n|0,n*=Zn;return new Qn(e,0)}var Zn=4294967296,ti=Xn(0),ei=Xn(1),ni=Xn(16777216);function ii(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function ri(t){return-1==t.h}function si(t){for(var e=t.g.length,n=[],i=0;i<e;i++)n[i]=~t.g[i];return new Qn(n,~t.h).add(ei)}function oi(t,e){return t.add(si(e))}function ai(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function ci(t,e){this.g=t,this.h=e}function li(t,e){if(ii(e))throw Error("division by zero");if(ii(t))return new ci(ti,ti);if(ri(t))return e=li(si(t),e),new ci(si(e.g),si(e.h));if(ri(e))return e=li(t,si(e)),new ci(si(e.g),e.h);if(30<t.g.length){if(ri(t)||ri(e))throw Error("slowDivide_ only works with positive integers.");for(var n=ei,i=e;0>=i.X(t);)n=ui(n),i=ui(i);var r=hi(n,1),s=hi(i,1);for(i=hi(i,2),n=hi(n,2);!ii(i);){var o=s.add(i);0>=o.X(t)&&(r=r.add(n),s=o),i=hi(i,1),n=hi(n,1)}return e=oi(t,r.R(e)),new ci(r,e)}for(r=ti;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),o=(s=Jn(n)).R(e);ri(o)||0<o.X(t);)o=(s=Jn(n-=i)).R(e);ii(s)&&(s=ei),r=r.add(s),t=oi(t,o)}return new ci(r,t)}function ui(t){for(var e=t.g.length+1,n=[],i=0;i<e;i++)n[i]=t.D(i)<<1|t.D(i-1)>>>31;return new Qn(n,t.h)}function hi(t,e){var n=e>>5;e%=32;for(var i=t.g.length-n,r=[],s=0;s<i;s++)r[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new Qn(r,t.h)}(i=Qn.prototype).ea=function(){if(ri(this))return-si(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var i=this.D(n);t+=(0<=i?i:Zn+i)*e,e*=Zn}return t},i.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(ii(this))return"0";if(ri(this))return"-"+si(this).toString(t);for(var e=Jn(Math.pow(t,6)),n=this,i="";;){var r=li(n,e).g,s=((0<(n=oi(n,r.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(ii(n=r))return s+i;for(;6>s.length;)s="0"+s;i=s+i}},i.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},i.X=function(t){return ri(t=oi(this,t))?-1:ii(t)?0:1},i.abs=function(){return ri(this)?si(this):this},i.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0,r=0;r<=e;r++){var s=i+(65535&this.D(r))+(65535&t.D(r)),o=(s>>>16)+(this.D(r)>>>16)+(t.D(r)>>>16);i=o>>>16,s&=65535,o&=65535,n[r]=o<<16|s}return new Qn(n,-2147483648&n[n.length-1]?-1:0)},i.R=function(t){if(ii(this)||ii(t))return ti;if(ri(this))return ri(t)?si(this).R(si(t)):si(si(this).R(t));if(ri(t))return si(this.R(si(t)));if(0>this.X(ni)&&0>t.X(ni))return Jn(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],i=0;i<2*e;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<t.g.length;r++){var s=this.D(i)>>>16,o=65535&this.D(i),a=t.D(r)>>>16,c=65535&t.D(r);n[2*i+2*r]+=o*c,ai(n,2*i+2*r),n[2*i+2*r+1]+=s*c,ai(n,2*i+2*r+1),n[2*i+2*r+1]+=o*a,ai(n,2*i+2*r+1),n[2*i+2*r+2]+=s*a,ai(n,2*i+2*r+2)}for(i=0;i<e;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=e;i<2*e;i++)n[i]=0;return new Qn(n,0)},i.gb=function(t){return li(this,t).h},i.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)&t.D(i);return new Qn(n,this.h&t.h)},i.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)|t.D(i);return new Qn(n,this.h|t.h)},i.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)^t.D(i);return new Qn(n,this.h^t.h)},zn.prototype.createWebChannel=zn.prototype.g,qn.prototype.send=qn.prototype.u,qn.prototype.open=qn.prototype.m,qn.prototype.close=qn.prototype.close,Kt.NO_ERROR=0,Kt.TIMEOUT=8,Kt.HTTP_ERROR=6,Gt.COMPLETE="complete",Yt.EventType=Jt,Jt.OPEN="a",Jt.CLOSE="b",Jt.ERROR="c",Jt.MESSAGE="d",dt.prototype.listen=dt.prototype.O,cn.prototype.listenOnce=cn.prototype.P,cn.prototype.getLastError=cn.prototype.Sa,cn.prototype.getLastErrorCode=cn.prototype.Ia,cn.prototype.getStatus=cn.prototype.da,cn.prototype.getResponseJson=cn.prototype.Wa,cn.prototype.getResponseText=cn.prototype.ja,cn.prototype.send=cn.prototype.ha,cn.prototype.setWithCredentials=cn.prototype.Oa,Gn.prototype.digest=Gn.prototype.l,Gn.prototype.reset=Gn.prototype.reset,Gn.prototype.update=Gn.prototype.j,Qn.prototype.add=Qn.prototype.add,Qn.prototype.multiply=Qn.prototype.R,Qn.prototype.modulo=Qn.prototype.gb,Qn.prototype.compare=Qn.prototype.X,Qn.prototype.toNumber=Qn.prototype.ea,Qn.prototype.toString=Qn.prototype.toString,Qn.prototype.getBits=Qn.prototype.D,Qn.fromNumber=Jn,Qn.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return si(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=Jn(Math.pow(n,8)),r=ti,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),a=parseInt(e.substring(s,s+o),n);8>o?(o=Jn(Math.pow(n,o)),r=r.R(o).add(Jn(a))):r=(r=r.R(i)).add(Jn(a))}return r};var di=s.createWebChannelTransport=function(){return new zn},fi=s.getStatEventTarget=function(){return Bt()},pi=s.ErrorCode=Kt,gi=s.EventType=Gt,mi=s.Event=Ft,yi=s.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},vi=s.FetchXmlHttpFactory=tn,bi=s.WebChannel=Yt,wi=s.XhrIo=cn,_i=s.Md5=Gn,xi=s.Integer=Qn},580:(t,e,n)=>{"use strict";n.d(e,{activateLicense:()=>d,needsLicenseActivation:()=>p});var i=n(467),r=n(848),s=n(756),o=n.n(s),a=n(405);function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){(0,i.A)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function u(t){return h.apply(this,arguments)}function h(){return(h=(0,r.A)(o().mark((function t(e){var n,i,r,s,c,u,h,d,f;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=(0,a.aU)(),i=(0,a.H9)(n,"users",e,"subscription","current"),t.next=5,(0,a.x7)(i);case 5:if((r=t.sent).exists()){t.next=8;break}return t.abrupt("return",null);case 8:if((s=r.data()).licenseKeyId){t.next=11;break}return t.abrupt("return",null);case 11:return c=(0,a.H9)(n,"licenses",s.licenseKeyId),t.next=14,(0,a.x7)(c);case 14:if((u=t.sent).exists()){t.next=17;break}return t.abrupt("return",null);case 17:if(h=u.data(),d=new Date,f=h.expirationDate.toDate(),!(d>f)){t.next=26;break}return t.next=23,(0,a.mZ)(c,{status:"expired"});case 23:return t.next=25,(0,a.mZ)(i,{status:"expired",updatedAt:(0,a.O5)()});case 25:return t.abrupt("return",l(l({},h),{},{status:"expired",isActive:!1}));case 26:return t.abrupt("return",l(l({},h),{},{isActive:!0}));case 29:return t.prev=29,t.t0=t.catch(0),console.error("Erreur lors de la vérification de la licence:",t.t0),t.abrupt("return",null);case 33:case"end":return t.stop()}}),t,null,[[0,29]])})))).apply(this,arguments)}function d(t,e){return f.apply(this,arguments)}function f(){return(f=(0,r.A)(o().mark((function t(e,n){var i,r,s,c,u,h,d,f,p;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i=(0,a.aU)(),r=(0,a.rJ)(i,"licenses"),s=(0,a.P)(r,(0,a._M)("licenseKey","==",n)),t.next=6,(0,a.GG)(s);case 6:if(!(c=t.sent).empty){t.next=9;break}return t.abrupt("return",{success:!1,message:"Clé de licence invalide."});case 9:if(u=c.docs[0],"available"===(h=u.data()).status){t.next=13;break}return t.abrupt("return",{success:!1,message:"Cette licence est déjà utilisée ou a expiré."});case 13:return d=new Date,(f=new Date(d)).setDate(d.getDate()+h.duration),t.next=18,(0,a.mZ)((0,a.H9)(i,"licenses",u.id),{status:"activated",userId:e,activationDate:d,expirationDate:f,updatedAt:(0,a.O5)()});case 18:return p=(0,a.H9)(i,"users",e,"subscription","current"),t.next=21,(0,a.BN)(p,{licenseKeyId:u.id,status:"active",activationDate:d,expirationDate:f,plan:h.plan,updatedAt:(0,a.O5)()});case 21:return t.abrupt("return",{success:!0,message:"Licence activée avec succès!",licenseData:l(l({},h),{},{activationDate:d,expirationDate:f,status:"activated"})});case 24:return t.prev=24,t.t0=t.catch(0),console.error("Erreur lors de l'activation de la licence:",t.t0),t.abrupt("return",{success:!1,message:"Une erreur est survenue lors de l'activation de la licence."});case 28:case"end":return t.stop()}}),t,null,[[0,24]])})))).apply(this,arguments)}function p(t){return g.apply(this,arguments)}function g(){return(g=(0,r.A)(o().mark((function t(e){var n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,u(e);case 3:return n=t.sent,t.abrupt("return",!n||!n.isActive);case 7:return t.prev=7,t.t0=t.catch(0),console.error("Erreur lors de la vérification de la licence:",t.t0),t.abrupt("return",!0);case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))).apply(this,arguments)}n(908)},602:(t,e,n)=>{"use strict";n.d(e,{P2:()=>r});var i=n(500);function r(t,e,{blocked:n,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(t,e),c=(0,i.w)(a);return r&&a.addEventListener("upgradeneeded",(t=>{r((0,i.w)(a.result),t.oldVersion,t.newVersion,(0,i.w)(a.transaction),t)})),n&&a.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),c.then((t=>{o&&t.addEventListener("close",(()=>o())),s&&t.addEventListener("versionchange",(t=>s(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),c}const s=["get","getKey","getAll","getAllKeys","count"],o=["put","add","delete","clear"],a=new Map;function c(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(a.get(e))return a.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=o.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!s.includes(n))return;const c=async function(t,...e){const s=this.transaction(t,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),r&&s.done]))[0]};return a.set(e,c),c}(0,i.r)((t=>({...t,get:(e,n,i)=>c(e,n)||t.get(e,n,i),has:(e,n)=>!!c(e,n)||t.has(e,n)})))},606:t=>{var e,n,i=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(t){if(e===setTimeout)return setTimeout(t,0);if((e===r||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:r}catch(t){e=r}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var a,c=[],l=!1,u=-1;function h(){l&&a&&(l=!1,a.length?c=a.concat(c):u=-1,c.length&&d())}function d(){if(!l){var t=o(h);l=!0;for(var e=c.length;e;){for(a=c,c=[];++u<e;)a&&a[u].run();u=-1,e=c.length}a=null,l=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{return n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function p(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new f(t,e)),1!==c.length||l||o(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},633:(t,e,n)=>{var i=n(738).default;function r(){"use strict";t.exports=r=function(){return n},t.exports.__esModule=!0,t.exports.default=t.exports;var e,n={},s=Object.prototype,o=s.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",l=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function h(t,e,n,i){return Object.defineProperty(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i})}try{h({},"")}catch(e){h=function(t,e,n){return t[e]=n}}function d(t,n,i,r){var s=n&&n.prototype instanceof g?n:g,o=Object.create(s.prototype);return h(o,"_invoke",function(t,n,i){var r=1;return function(s,o){if(3===r)throw Error("Generator is already running");if(4===r){if("throw"===s)throw o;return{value:e,done:!0}}for(i.method=s,i.arg=o;;){var a=i.delegate;if(a){var c=E(a,i);if(c){if(c===p)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(1===r)throw r=4,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=3;var l=f(t,n,i);if("normal"===l.type){if(r=i.done?4:2,l.arg===p)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r=4,i.method="throw",i.arg=l.arg)}}}(t,i,new S(r||[])),!0),o}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}n.wrap=d;var p={};function g(){}function m(){}function y(){}var v={};h(v,c,(function(){return this}));var b=Object.getPrototypeOf,w=b&&b(b(C([])));w&&w!==s&&o.call(w,c)&&(v=w);var _=y.prototype=g.prototype=Object.create(v);function x(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function I(t,e){function n(r,s,a,c){var l=f(t[r],t,s);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==i(h)&&o.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(h).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,c)}))}c(l.arg)}var r;h(this,"_invoke",(function(t,i){function s(){return new e((function(e,r){n(t,i,e,r)}))}return r=r?r.then(s,s):s()}),!0)}function E(t,n){var i=n.method,r=t.i[i];if(r===e)return n.delegate=null,"throw"===i&&t.i.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),p;var s=f(r,t.i,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,p;var o=s.arg;return o?o.done?(n[t.r]=o.value,n.next=t.n,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,p):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function T(t){this.tryEntries.push(t)}function k(t){var n=t[4]||{};n.type="normal",n.arg=e,t[4]=n}function S(t){this.tryEntries=[[-1]],t.forEach(T,this),this.reset(!0)}function C(t){if(null!=t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,s=function n(){for(;++r<t.length;)if(o.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}throw new TypeError(i(t)+" is not iterable")}return m.prototype=y,h(_,"constructor",y),h(y,"constructor",m),m.displayName=h(y,u,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,h(t,u,"GeneratorFunction")),t.prototype=Object.create(_),t},n.awrap=function(t){return{__await:t}},x(I.prototype),h(I.prototype,l,(function(){return this})),n.AsyncIterator=I,n.async=function(t,e,i,r,s){void 0===s&&(s=Promise);var o=new I(d(t,e,i,r),s);return n.isGeneratorFunction(e)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},x(_),h(_,u,"Generator"),h(_,c,(function(){return this})),h(_,"toString",(function(){return"[object Generator]"})),n.keys=function(t){var e=Object(t),n=[];for(var i in e)n.unshift(i);return function t(){for(;n.length;)if((i=n.pop())in e)return t.value=i,t.done=!1,t;return t.done=!0,t}},n.values=C,S.prototype={constructor:S,reset:function(t){if(this.prev=this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(e){o.type="throw",o.arg=t,n.next=e}for(var r=n.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r],o=s[4],a=this.prev,c=s[1],l=s[2];if(-1===s[0])return i("end"),!1;if(!c&&!l)throw Error("try statement without catch or finally");if(null!=s[0]&&s[0]<=a){if(a<c)return this.method="next",this.arg=e,i(c),!0;if(a<l)return i(l),!1}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i[0]>-1&&i[0]<=this.prev&&this.prev<i[2]){var r=i;break}}r&&("break"===t||"continue"===t)&&r[0]<=e&&e<=r[2]&&(r=null);var s=r?r[4]:{};return s.type=t,s.arg=e,r?(this.method="next",this.next=r[2],p):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n[2]===t)return this.complete(n[4],n[3]),k(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n[0]===t){var i=n[4];if("throw"===i.type){var r=i.arg;k(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={i:C(t),r:n,n:i},"next"===this.method&&(this.arg=e),p}},n}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},635:(t,e,n)=>{"use strict";function i(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}n.d(e,{Tt:()=>i}),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError},738:t=>{function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},743:(t,e,n)=>{"use strict";n.d(e,{Am:()=>O,FA:()=>S,Fy:()=>g,I9:()=>P,Im:()=>A,Ku:()=>q,Ll:()=>v,T9:()=>d,Tj:()=>u,Uj:()=>a,XA:()=>f,ZQ:()=>m,bD:()=>D,cY:()=>p,dM:()=>T,eX:()=>E,g:()=>k,hp:()=>R,jZ:()=>y,lT:()=>_,lV:()=>w,nr:()=>x,p9:()=>z,sr:()=>b,tD:()=>N,u:()=>c,yU:()=>h,zW:()=>I});var i=n(606);const r=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296==(64512&r)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&t.charCodeAt(++i)),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128)}return e},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let e=0;e<t.length;e+=3){const r=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,l=r>>2,u=(3&r)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),i.push(n[l],n[u],n[h],n[d])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(r(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,i=0;for(;n<t.length;){const r=t[n++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=t[n++];e[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(s>>10)),e[i++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let e=0;e<t.length;){const r=n[t.charAt(e++)],s=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==r||null==s||null==a||null==c)throw new o;const l=r<<2|s>>4;if(i.push(l),64!==a){const t=s<<4&240|a>>2;if(i.push(t),64!==c){const t=a<<6&192|c;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(t){return function(t){const e=r(t);return s.encodeByteArray(e,!0)}(t).replace(/\./g,"")},c=function(t){try{return s.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null},l=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(void 0===i||void 0===i.env)return;const t=i.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&c(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},u=t=>{var e,n;return null===(n=null===(e=l())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]},h=t=>{const e=u(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),i]:[e.substring(0,n),i]},d=()=>{var t;return null===(t=l())||void 0===t?void 0:t.config},f=t=>{var e;return null===(e=l())||void 0===e?void 0:e[`_${t}`]};class p{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function g(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",i=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t);return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(s)),""].join(".")}function m(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function y(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(m())}function v(){var t;const e=null===(t=l())||void 0===t?void 0:t.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}function b(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function w(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function _(){const t=m();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function x(){return!v()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function I(){try{return"object"==typeof indexedDB}catch(t){return!1}}function E(){return new Promise(((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var t;e((null===(t=r.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}function T(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class k extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,k.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,S.prototype.create)}}class S{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,r=this.errors[t],s=r?function(t,e){return t.replace(C,((t,n)=>{const i=e[n];return null!=i?String(i):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new k(i,o,n)}}const C=/\{\$([^}]+)}/g;function A(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function D(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const r of n){if(!i.includes(r))return!1;const n=t[r],s=e[r];if(M(n)&&M(s)){if(!D(n,s))return!1}else if(n!==s)return!1}for(const t of i)if(!n.includes(t))return!1;return!0}function M(t){return null!==t&&"object"==typeof t}function O(t){const e=[];for(const[n,i]of Object.entries(t))Array.isArray(i)?i.forEach((t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function P(t){const e={};return t.replace(/^\?/,"").split("&").forEach((t=>{if(t){const[n,i]=t.split("=");e[decodeURIComponent(n)]=decodeURIComponent(i)}})),e}function R(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function N(t,e){const n=new L(t,e);return n.subscribe.bind(n)}class L{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((()=>{t(this)})).catch((t=>{this.error(t)}))}next(t){this.forEachObserver((e=>{e.next(t)}))}error(t){this.forEachObserver((e=>{e.error(t)})),this.close(t)}complete(){this.forEachObserver((t=>{t.complete()})),this.close()}subscribe(t,e,n){let i;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");i=function(t){if("object"!=typeof t||null===t)return!1;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return!0;return!1}(t)?t:{next:t,error:e,complete:n},void 0===i.next&&(i.next=F),void 0===i.error&&(i.error=F),void 0===i.complete&&(i.complete=F);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(t){}})),this.observers.push(i),r}unsubscribeOne(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[t])try{e(this.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function F(){}const V=1e3,B=2,U=144e5,j=.5;function z(t,e=V,n=B){const i=e*Math.pow(n,t),r=Math.round(j*i*(Math.random()-.5)*2);return Math.min(U,i+r)}function q(t){return t&&t._delegate?t._delegate:t}},756:(t,e,n)=>{var i=n(633)();t.exports=i;try{regeneratorRuntime=i}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}},790:(t,e,n)=>{"use strict";n.d(e,{AB:()=>al,BN:()=>El,CL:()=>Al,Dc:()=>F,GG:()=>Il,H9:()=>vc,HM:()=>ll,My:()=>sl,O5:()=>Dl,P:()=>tl,_M:()=>nl,aU:()=>_c,gS:()=>Sl,kd:()=>kl,mZ:()=>Tl,ol:()=>Ec,rJ:()=>yc,x7:()=>_l});var i=n(461),r=n(125),s=n(424),o=n(743),a=n(517),c=n(606);const l="@firebase/firestore";class u{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}u.UNAUTHENTICATED=new u(null),u.GOOGLE_CREDENTIALS=new u("google-credentials-uid"),u.FIRST_PARTY=new u("first-party-uid"),u.MOCK_USER=new u("mock-user");let h="9.23.0";const d=new s.Vy("@firebase/firestore");function f(){return d.logLevel}function p(t,...e){if(d.logLevel<=s.$b.DEBUG){const n=e.map(y);d.debug(`Firestore (${h}): ${t}`,...n)}}function g(t,...e){if(d.logLevel<=s.$b.ERROR){const n=e.map(y);d.error(`Firestore (${h}): ${t}`,...n)}}function m(t,...e){if(d.logLevel<=s.$b.WARN){const n=e.map(y);d.warn(`Firestore (${h}): ${t}`,...n)}}function y(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function v(t="Unexpected state"){const e=`FIRESTORE (${h}) INTERNAL ASSERTION FAILED: `+t;throw g(e),new Error(e)}function b(t,e){t||v()}function w(t,e){return t}const _={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class x extends o.g{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class I{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class E{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class T{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(u.UNAUTHENTICATED)))}shutdown(){}}class k{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class S{constructor(t){this.t=t,this.currentUser=u.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const i=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let r=new I;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new I,t.enqueueRetryable((()=>i(this.currentUser)))};const s=()=>{const e=r;t.enqueueRetryable((async()=>{await e.promise,await i(this.currentUser)}))},o=t=>{p("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(p("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new I)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(p("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(b("string"==typeof e.accessToken),new E(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return b(null===t||"string"==typeof t),new u(t)}}class C{constructor(t,e,n){this.h=t,this.l=e,this.m=n,this.type="FirstParty",this.user=u.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const t=this.p();return t&&this.g.set("Authorization",t),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class A{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new C(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(u.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class D{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class M{constructor(t){this.I=t,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(t,e){const n=t=>{null!=t.error&&p("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.T;return this.T=t.token,p("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const i=t=>{p("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.I.onInit((t=>i(t))),setTimeout((()=>{if(!this.appCheck){const t=this.I.getImmediate({optional:!0});t?i(t):p("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(b("string"==typeof t.token),this.T=t.token,new D(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function O(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class P{static A(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=O(40);for(let i=0;i<n.length;++i)e.length<20&&n[i]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return e}}function R(t,e){return t<e?-1:t>e?1:0}function N(t,e,n){return t.length===e.length&&t.every(((t,i)=>n(t,e[i])))}function L(t){return t+"\0"}class F{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new x(_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new x(_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new x(_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new x(_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return F.fromMillis(Date.now())}static fromDate(t){return F.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new F(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?R(this.nanoseconds,t.nanoseconds):R(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class V{constructor(t){this.timestamp=t}static fromTimestamp(t){return new V(t)}static min(){return new V(new F(0,0))}static max(){return new V(new F(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class B{constructor(t,e,n){void 0===e?e=0:e>t.length&&v(),void 0===n?n=t.length-e:n>t.length-e&&v(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===B.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof B?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=t.get(i),r=e.get(i);if(n<r)return-1;if(n>r)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class U extends B{construct(t,e,n){return new U(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new x(_.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new U(e)}static emptyPath(){return new U([])}}const j=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class z extends B{construct(t,e,n){return new z(t,e,n)}static isValidIdentifier(t){return j.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),z.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new z(["__name__"])}static fromServerFormat(t){const e=[];let n="",i=0;const r=()=>{if(0===n.length)throw new x(_.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;i<t.length;){const e=t[i];if("\\"===e){if(i+1===t.length)throw new x(_.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[i+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new x(_.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,i+=2}else"`"===e?(s=!s,i++):"."!==e||s?(n+=e,i++):(r(),i++)}if(r(),s)throw new x(_.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new z(e)}static emptyPath(){return new z([])}}class q{constructor(t){this.path=t}static fromPath(t){return new q(U.fromString(t))}static fromName(t){return new q(U.fromString(t).popFirst(5))}static empty(){return new q(U.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===U.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return U.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new q(new U(t.slice()))}}class ${constructor(t,e,n,i){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=i}}function H(t){return t.fields.find((t=>2===t.kind))}function K(t){return t.fields.filter((t=>2!==t.kind))}$.UNKNOWN_ID=-1;class G{constructor(t,e){this.fieldPath=t,this.kind=e}}class W{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new W(0,Y.min())}}function Q(t){return new Y(t.readTime,t.key,-1)}class Y{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Y(V.min(),q.empty(),-1)}static max(){return new Y(V.max(),q.empty(),-1)}}function X(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=q.comparator(t.documentKey,e.documentKey),0!==n?n:R(t.largestBatchId,e.largestBatchId))}const J="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Z{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function tt(t){if(t.code!==_.FAILED_PRECONDITION||t.message!==J)throw t;p("LocalStore","Unexpectedly lost primary lease")}class et{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&v(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new et(((n,i)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,i)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,i)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof et?e:et.resolve(e)}catch(t){return et.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):et.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):et.reject(e)}static resolve(t){return new et(((e,n)=>{e(t)}))}static reject(t){return new et(((e,n)=>{n(t)}))}static waitFor(t){return new et(((e,n)=>{let i=0,r=0,s=!1;t.forEach((t=>{++i,t.next((()=>{++r,s&&r===i&&e()}),(t=>n(t)))})),s=!0,r===i&&e()}))}static or(t){let e=et.resolve(!1);for(const n of t)e=e.next((t=>t?et.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,i)=>{n.push(e.call(this,t,i))})),this.waitFor(n)}static mapArray(t,e){return new et(((n,i)=>{const r=t.length,s=new Array(r);let o=0;for(let a=0;a<r;a++){const c=a;e(t[c]).next((t=>{s[c]=t,++o,o===r&&n(s)}),(t=>i(t)))}}))}static doWhile(t,e){return new et(((n,i)=>{const r=()=>{!0===t()?e().next((()=>{r()}),i):n()};r()}))}}class nt{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.v=new I,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{e.error?this.v.reject(new st(t,e.error)):this.v.resolve()},this.transaction.onerror=e=>{const n=ut(e.target.error);this.v.reject(new st(t,n))}}static open(t,e,n,i){try{return new nt(e,t.transaction(i,n))}catch(t){throw new st(e,t)}}get R(){return this.v.promise}abort(t){t&&this.v.reject(t),this.aborted||(p("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new at(e)}}class it{constructor(t,e,n){this.name=t,this.version=e,this.V=n,12.2===it.S((0,o.ZQ)())&&g("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return p("SimpleDb","Removing database:",t),ct(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!(0,o.zW)())return!1;if(it.C())return!0;const t=(0,o.ZQ)(),e=it.S(t),n=0<e&&e<10,i=it.N(t),r=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||r)}static C(){var t;return void 0!==c&&"YES"===(null===(t=c.env)||void 0===t?void 0:t.k)}static M(t,e){return t.store(e)}static S(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static N(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async $(t){return this.db||(p("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=t=>{const n=t.target.result;e(n)},i.onblocked=()=>{n(new st(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=e=>{const i=e.target.error;"VersionError"===i.name?n(new x(_.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===i.name?n(new x(_.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+i)):n(new st(t,i))},i.onupgradeneeded=t=>{p("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.V.O(e,i.transaction,t.oldVersion,this.version).next((()=>{p("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.F&&(this.db.onversionchange=t=>this.F(t)),this.db}B(t){this.F=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,i){const r="readonly"===e;let s=0;for(;;){++s;try{this.db=await this.$(t);const e=nt.open(this.db,t,r?"readonly":"readwrite",n),s=i(e).next((t=>(e.P(),t))).catch((t=>(e.abort(t),et.reject(t)))).toPromise();return s.catch((()=>{})),await e.R,s}catch(t){const e=t,n="FirebaseError"!==e.name&&s<3;if(p("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class rt{constructor(t){this.L=t,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(t){this.L=t}done(){this.q=!0}G(t){this.U=t}delete(){return ct(this.L.delete())}}class st extends x{constructor(t,e){super(_.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function ot(t){return"IndexedDbTransactionError"===t.name}class at{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(p("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(p("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ct(n)}add(t){return p("SimpleDb","ADD",this.store.name,t,t),ct(this.store.add(t))}get(t){return ct(this.store.get(t)).next((e=>(void 0===e&&(e=null),p("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return p("SimpleDb","DELETE",this.store.name,t),ct(this.store.delete(t))}count(){return p("SimpleDb","COUNT",this.store.name),ct(this.store.count())}j(t,e){const n=this.options(t,e);if(n.index||"function"!=typeof this.store.getAll){const t=this.cursor(n),e=[];return this.W(t,((t,n)=>{e.push(n)})).next((()=>e))}{const t=this.store.getAll(n.range);return new et(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}}H(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new et(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}J(t,e){p("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.Y=!1;const i=this.cursor(n);return this.W(i,((t,e,n)=>n.delete()))}X(t,e){let n;e?n=t:(n={},e=t);const i=this.cursor(n);return this.W(i,e)}Z(t){const e=this.cursor({});return new et(((n,i)=>{e.onerror=t=>{const e=ut(t.target.error);i(e)},e.onsuccess=e=>{const i=e.target.result;i?t(i.primaryKey,i.value).next((t=>{t?i.continue():n()})):n()}}))}W(t,e){const n=[];return new et(((i,r)=>{t.onerror=t=>{r(t.target.error)},t.onsuccess=t=>{const r=t.target.result;if(!r)return void i();const s=new rt(r),o=e(r.primaryKey,r.value,s);if(o instanceof et){const t=o.catch((t=>(s.done(),et.reject(t))));n.push(t)}s.isDone?i():null===s.K?r.continue():r.continue(s.K)}})).next((()=>et.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.Y?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function ct(t){return new et(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=ut(t.target.error);n(e)}}))}let lt=!1;function ut(t){const e=it.S((0,o.ZQ)());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return lt||(lt=!0,setTimeout((()=>{throw t}),0)),t}}return t}class ht{constructor(t,e){this.asyncQueue=t,this.tt=e,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(t){p("IndexBackiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,(async()=>{this.task=null;try{p("IndexBackiller",`Documents written: ${await this.tt.nt()}`)}catch(t){ot(t)?p("IndexBackiller","Ignoring IndexedDB error during index backfill: ",t):await tt(t)}await this.et(6e4)}))}}class dt{constructor(t,e){this.localStore=t,this.persistence=e}async nt(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(e=>this.st(e,t)))}st(t,e){const n=new Set;let i=e,r=!0;return et.doWhile((()=>!0===r&&i>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next((e=>{if(null!==e&&!n.has(e))return p("IndexBackiller",`Processing collection: ${e}`),this.it(t,e,i).next((t=>{i-=t,n.add(e)}));r=!1})))).next((()=>e-i))}it(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next((i=>this.localStore.localDocuments.getNextDocuments(t,e,i,n).next((n=>{const r=n.changes;return this.localStore.indexManager.updateIndexEntries(t,r).next((()=>this.rt(i,n))).next((n=>(p("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(t,e,n)))).next((()=>r.size))}))))}rt(t,e){let n=t;return e.changes.forEach(((t,e)=>{const i=Q(e);X(i,n)>0&&(n=i)})),new Y(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}}class ft{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ot(t),this.ut=t=>e.writeSequenceNumber(t))}ot(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ut&&this.ut(t),t}}function pt(t){return null==t}function gt(t){return 0===t&&1/t==-1/0}function mt(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=vt(e)),e=yt(t.get(n),e);return vt(e)}function yt(t,e){let n=e;const i=t.length;for(let e=0;e<i;e++){const i=t.charAt(e);switch(i){case"\0":n+="";break;case"":n+="";break;default:n+=i}}return n}function vt(t){return t+""}function bt(t){const e=t.length;if(b(e>=2),2===e)return b(""===t.charAt(0)&&""===t.charAt(1)),U.emptyPath();const n=e-2,i=[];let r="";for(let s=0;s<e;){const e=t.indexOf("",s);switch((e<0||e>n)&&v(),t.charAt(e+1)){case"":const n=t.substring(s,e);let o;0===r.length?o=n:(r+=n,o=r,r=""),i.push(o);break;case"":r+=t.substring(s,e),r+="\0";break;case"":r+=t.substring(s,e+1);break;default:v()}s=e+2}return new U(i)}ft.ct=-1;const wt=["userId","batchId"];function _t(t,e){return[t,mt(e)]}function xt(t,e,n){return[t,mt(e),n]}const It={},Et=["prefixPath","collectionGroup","readTime","documentId"],Tt=["prefixPath","collectionGroup","documentId"],kt=["collectionGroup","readTime","prefixPath","documentId"],St=["canonicalId","targetId"],Ct=["targetId","path"],At=["path","targetId"],Dt=["collectionId","parent"],Mt=["indexId","uid"],Ot=["uid","sequenceNumber"],Pt=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Rt=["indexId","uid","orderedDocumentKey"],Nt=["userId","collectionPath","documentId"],Lt=["userId","collectionPath","largestBatchId"],Ft=["userId","collectionGroup","largestBatchId"],Vt=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Bt=[...Vt,"documentOverlays"],Ut=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],jt=Ut,zt=[...jt,"indexConfiguration","indexState","indexEntries"];class qt extends Z{constructor(t,e){super(),this.ht=t,this.currentSequenceNumber=e}}function $t(t,e){const n=w(t);return it.M(n.ht,e)}function Ht(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Kt(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Gt(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Wt{constructor(t,e){this.comparator=t,this.root=e||Yt.EMPTY}insert(t,e){return new Wt(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Yt.BLACK,null,null))}remove(t){return new Wt(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Yt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(0===i)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Qt(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Qt(this.root,t,this.comparator,!1)}getReverseIterator(){return new Qt(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Qt(this.root,t,this.comparator,!0)}}class Qt{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!t.isEmpty();)if(r=e?n(t.key,e):1,e&&i&&(r*=-1),r<0)t=this.isReverse?t.left:t.right;else{if(0===r){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Yt{constructor(t,e,n,i,r){this.key=t,this.value=e,this.color=null!=n?n:Yt.RED,this.left=null!=i?i:Yt.EMPTY,this.right=null!=r?r:Yt.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,r){return new Yt(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const r=n(t,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Yt.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return Yt.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Yt.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Yt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw v();if(this.right.isRed())throw v();const t=this.left.check();if(t!==this.right.check())throw v();return t+(this.isRed()?0:1)}}Yt.EMPTY=null,Yt.RED=!0,Yt.BLACK=!1,Yt.EMPTY=new class{constructor(){this.size=0}get key(){throw v()}get value(){throw v()}get color(){throw v()}get left(){throw v()}get right(){throw v()}copy(t,e,n,i,r){return this}insert(t,e,n){return new Yt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Xt{constructor(t){this.comparator=t,this.data=new Wt(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Jt(this.data.getIterator())}getIteratorFrom(t){return new Jt(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Xt))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(t,i))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Xt(this.comparator);return e.data=t,e}}class Jt{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Zt(t){return t.hasNext()?t.getNext():void 0}class te{constructor(t){this.fields=t,t.sort(z.comparator)}static empty(){return new te([])}unionWith(t){let e=new Xt(z.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new te(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return N(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class ee extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ne{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new ee("Invalid base64 string: "+t):t}}(t);return new ne(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new ne(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return R(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ne.EMPTY_BYTE_STRING=new ne("");const ie=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function re(t){if(b(!!t),"string"==typeof t){let e=0;const n=ie.exec(t);if(b(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:se(t.seconds),nanos:se(t.nanos)}}function se(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function oe(t){return"string"==typeof t?ne.fromBase64String(t):ne.fromUint8Array(t)}function ae(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ce(t){const e=t.mapValue.fields.__previous_value__;return ae(e)?ce(e):e}function le(t){const e=re(t.mapValue.fields.__local_write_time__.timestampValue);return new F(e.seconds,e.nanos)}class ue{constructor(t,e,n,i,r,s,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class he{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new he("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof he&&t.projectId===this.projectId&&t.database===this.database}}const de={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},fe={nullValue:"NULL_VALUE"};function pe(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ae(t)?4:Ce(t)?9007199254740991:10:v()}function ge(t,e){if(t===e)return!0;const n=pe(t);if(n!==pe(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return le(t).isEqual(le(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=re(t.timestampValue),i=re(e.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return oe(t.bytesValue).isEqual(oe(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return se(t.geoPointValue.latitude)===se(e.geoPointValue.latitude)&&se(t.geoPointValue.longitude)===se(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return se(t.integerValue)===se(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=se(t.doubleValue),i=se(e.doubleValue);return n===i?gt(n)===gt(i):isNaN(n)&&isNaN(i)}return!1}(t,e);case 9:return N(t.arrayValue.values||[],e.arrayValue.values||[],ge);case 10:return function(t,e){const n=t.mapValue.fields||{},i=e.mapValue.fields||{};if(Ht(n)!==Ht(i))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===i[t]||!ge(n[t],i[t])))return!1;return!0}(t,e);default:return v()}}function me(t,e){return void 0!==(t.values||[]).find((t=>ge(t,e)))}function ye(t,e){if(t===e)return 0;const n=pe(t),i=pe(e);if(n!==i)return R(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return R(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=se(t.integerValue||t.doubleValue),i=se(e.integerValue||e.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(t,e);case 3:return ve(t.timestampValue,e.timestampValue);case 4:return ve(le(t),le(e));case 5:return R(t.stringValue,e.stringValue);case 6:return function(t,e){const n=oe(t),i=oe(e);return n.compareTo(i)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),i=e.split("/");for(let t=0;t<n.length&&t<i.length;t++){const e=R(n[t],i[t]);if(0!==e)return e}return R(n.length,i.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=R(se(t.latitude),se(e.latitude));return 0!==n?n:R(se(t.longitude),se(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],i=e.values||[];for(let t=0;t<n.length&&t<i.length;++t){const e=ye(n[t],i[t]);if(e)return e}return R(n.length,i.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===de.mapValue&&e===de.mapValue)return 0;if(t===de.mapValue)return 1;if(e===de.mapValue)return-1;const n=t.fields||{},i=Object.keys(n),r=e.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let t=0;t<i.length&&t<s.length;++t){const e=R(i[t],s[t]);if(0!==e)return e;const o=ye(n[i[t]],r[s[t]]);if(0!==o)return o}return R(i.length,s.length)}(t.mapValue,e.mapValue);default:throw v()}}function ve(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return R(t,e);const n=re(t),i=re(e),r=R(n.seconds,i.seconds);return 0!==r?r:R(n.nanos,i.nanos)}function be(t){return we(t)}function we(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=re(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?oe(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,q.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const i of t.values||[])n?n=!1:e+=",",e+=we(i);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",i=!0;for(const r of e)i?i=!1:n+=",",n+=`${r}:${we(t.fields[r])}`;return n+"}"}(t.mapValue):v();var e,n}function _e(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function xe(t){return!!t&&"integerValue"in t}function Ie(t){return!!t&&"arrayValue"in t}function Ee(t){return!!t&&"nullValue"in t}function Te(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function ke(t){return!!t&&"mapValue"in t}function Se(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Kt(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Se(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Se(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Ce(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}function Ae(t){return"nullValue"in t?fe:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?_e(he.empty(),q.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?{mapValue:{}}:v()}function De(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?_e(he.empty(),q.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?{mapValue:{}}:"mapValue"in t?de:v()}function Me(t,e){const n=ye(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function Oe(t,e){const n=ye(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}class Pe{constructor(t){this.value=t}static empty(){return new Pe({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!ke(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Se(e)}setAll(t){let e=z.emptyPath(),n={},i=[];t.forEach(((t,r)=>{if(!e.isImmediateParentOf(r)){const t=this.getFieldsMap(e);this.applyChanges(t,n,i),n={},i=[],e=r.popLast()}t?n[r.lastSegment()]=Se(t):i.push(r.lastSegment())}));const r=this.getFieldsMap(e);this.applyChanges(r,n,i)}delete(t){const e=this.field(t.popLast());ke(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ge(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];ke(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){Kt(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Pe(Se(this.value))}}function Re(t){const e=[];return Kt(t.fields,((t,n)=>{const i=new z([t]);if(ke(n)){const t=Re(n.mapValue).fields;if(0===t.length)e.push(i);else for(const n of t)e.push(i.child(n))}else e.push(i)})),new te(e)}class Ne{constructor(t,e,n,i,r,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=r,this.data=s,this.documentState=o}static newInvalidDocument(t){return new Ne(t,0,V.min(),V.min(),V.min(),Pe.empty(),0)}static newFoundDocument(t,e,n,i){return new Ne(t,1,e,V.min(),n,i,0)}static newNoDocument(t,e){return new Ne(t,2,e,V.min(),V.min(),Pe.empty(),0)}static newUnknownDocument(t,e){return new Ne(t,3,e,V.min(),V.min(),Pe.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(V.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Pe.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Pe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=V.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Ne&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Ne(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Le{constructor(t,e){this.position=t,this.inclusive=e}}function Fe(t,e,n){let i=0;for(let r=0;r<t.position.length;r++){const s=e[r],o=t.position[r];if(i=s.field.isKeyField()?q.comparator(q.fromName(o.referenceValue),n.key):ye(o,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function Ve(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!ge(t.position[n],e.position[n]))return!1;return!0}class Be{constructor(t,e="asc"){this.field=t,this.dir=e}}function Ue(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class je{}class ze extends je{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Je(t,e,n):"array-contains"===e?new nn(t,n):"in"===e?new rn(t,n):"not-in"===e?new sn(t,n):"array-contains-any"===e?new on(t,n):new ze(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Ze(t,n):new tn(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(ye(e,this.value)):null!==e&&pe(this.value)===pe(e)&&this.matchesComparison(ye(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return v()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class qe extends je{constructor(t,e){super(),this.filters=t,this.op=e,this.lt=null}static create(t,e){return new qe(t,e)}matches(t){return $e(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const t=this.ft((t=>t.isInequality()));return null!==t?t.field:null}ft(t){for(const e of this.getFlattenedFilters())if(t(e))return e;return null}}function $e(t){return"and"===t.op}function He(t){return"or"===t.op}function Ke(t){return Ge(t)&&$e(t)}function Ge(t){for(const e of t.filters)if(e instanceof qe)return!1;return!0}function We(t){if(t instanceof ze)return t.field.canonicalString()+t.op.toString()+be(t.value);if(Ke(t))return t.filters.map((t=>We(t))).join(",");{const e=t.filters.map((t=>We(t))).join(",");return`${t.op}(${e})`}}function Qe(t,e){return t instanceof ze?function(t,e){return e instanceof ze&&t.op===e.op&&t.field.isEqual(e.field)&&ge(t.value,e.value)}(t,e):t instanceof qe?function(t,e){return e instanceof qe&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,i)=>t&&Qe(n,e.filters[i])),!0)}(t,e):void v()}function Ye(t,e){const n=t.filters.concat(e);return qe.create(n,t.op)}function Xe(t){return t instanceof ze?function(t){return`${t.field.canonicalString()} ${t.op} ${be(t.value)}`}(t):t instanceof qe?function(t){return t.op.toString()+" {"+t.getFilters().map(Xe).join(" ,")+"}"}(t):"Filter"}class Je extends ze{constructor(t,e,n){super(t,e,n),this.key=q.fromName(n.referenceValue)}matches(t){const e=q.comparator(t.key,this.key);return this.matchesComparison(e)}}class Ze extends ze{constructor(t,e){super(t,"in",e),this.keys=en(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class tn extends ze{constructor(t,e){super(t,"not-in",e),this.keys=en(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function en(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>q.fromName(t.referenceValue)))}class nn extends ze{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Ie(e)&&me(e.arrayValue,this.value)}}class rn extends ze{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&me(this.value.arrayValue,e)}}class sn extends ze{constructor(t,e){super(t,"not-in",e)}matches(t){if(me(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!me(this.value.arrayValue,e)}}class on extends ze{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Ie(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>me(this.value.arrayValue,t)))}}class an{constructor(t,e=null,n=[],i=[],r=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=o,this.dt=null}}function cn(t,e=null,n=[],i=[],r=null,s=null,o=null){return new an(t,e,n,i,r,s,o)}function ln(t){const e=w(t);if(null===e.dt){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>We(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),pt(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>be(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>be(t))).join(",")),e.dt=t}return e.dt}function un(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Ue(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Qe(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ve(t.startAt,e.startAt)&&Ve(t.endAt,e.endAt)}function hn(t){return q.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}function dn(t,e){return t.filters.filter((t=>t instanceof ze&&t.field.isEqual(e)))}function fn(t,e,n){let i=fe,r=!0;for(const n of dn(t,e)){let t=fe,e=!0;switch(n.op){case"<":case"<=":t=Ae(n.value);break;case"==":case"in":case">=":t=n.value;break;case">":t=n.value,e=!1;break;case"!=":case"not-in":t=fe}Me({value:i,inclusive:r},{value:t,inclusive:e})<0&&(i=t,r=e)}if(null!==n)for(let s=0;s<t.orderBy.length;++s)if(t.orderBy[s].field.isEqual(e)){const t=n.position[s];Me({value:i,inclusive:r},{value:t,inclusive:n.inclusive})<0&&(i=t,r=n.inclusive);break}return{value:i,inclusive:r}}function pn(t,e,n){let i=de,r=!0;for(const n of dn(t,e)){let t=de,e=!0;switch(n.op){case">=":case">":t=De(n.value),e=!1;break;case"==":case"in":case"<=":t=n.value;break;case"<":t=n.value,e=!1;break;case"!=":case"not-in":t=de}Oe({value:i,inclusive:r},{value:t,inclusive:e})>0&&(i=t,r=e)}if(null!==n)for(let s=0;s<t.orderBy.length;++s)if(t.orderBy[s].field.isEqual(e)){const t=n.position[s];Oe({value:i,inclusive:r},{value:t,inclusive:n.inclusive})>0&&(i=t,r=n.inclusive);break}return{value:i,inclusive:r}}class gn{constructor(t,e=null,n=[],i=[],r=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function mn(t){return new gn(t)}function yn(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function vn(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function bn(t){for(const e of t.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function wn(t){return null!==t.collectionGroup}function _n(t){const e=w(t);if(null===e.wt){e.wt=[];const t=bn(e),n=vn(e);if(null!==t&&null===n)t.isKeyField()||e.wt.push(new Be(t)),e.wt.push(new Be(z.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.wt.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new Be(z.keyField(),t))}}}return e.wt}function xn(t){const e=w(t);if(!e._t)if("F"===e.limitType)e._t=cn(e.path,e.collectionGroup,_n(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of _n(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Be(n.field,e))}const n=e.endAt?new Le(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new Le(e.startAt.position,e.startAt.inclusive):null;e._t=cn(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}return e._t}function In(t,e){e.getFirstInequalityField(),bn(t);const n=t.filters.concat([e]);return new gn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function En(t,e,n){return new gn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Tn(t,e){return un(xn(t),xn(e))&&t.limitType===e.limitType}function kn(t){return`${ln(xn(t))}|lt:${t.limitType}`}function Sn(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>Xe(t))).join(", ")}]`),pt(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>be(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>be(t))).join(",")),`Target(${e})`}(xn(t))}; limitType=${t.limitType})`}function Cn(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):q.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of _n(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const i=Fe(t,e,n);return t.inclusive?i<=0:i<0}(t.startAt,_n(t),e)||t.endAt&&!function(t,e,n){const i=Fe(t,e,n);return t.inclusive?i>=0:i>0}(t.endAt,_n(t),e))}(t,e)}function An(t){return(e,n)=>{let i=!1;for(const r of _n(t)){const t=Dn(r,e,n);if(0!==t)return t;i=i||r.field.isKeyField()}return 0}}function Dn(t,e,n){const i=t.field.isKeyField()?q.comparator(e.key,n.key):function(t,e,n){const i=e.data.field(t),r=n.data.field(t);return null!==i&&null!==r?ye(i,r):v()}(t.field,e,n);switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return v()}}class Mn{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,i]of n)if(this.equalsFn(e,t))return i}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),i=this.inner[n];if(void 0===i)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],t))return void(i[n]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return 1===n.length?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){Kt(this.inner,((e,n)=>{for(const[e,i]of n)t(e,i)}))}isEmpty(){return Gt(this.inner)}size(){return this.innerSize}}const On=new Wt(q.comparator);function Pn(){return On}const Rn=new Wt(q.comparator);function Nn(...t){let e=Rn;for(const n of t)e=e.insert(n.key,n);return e}function Ln(t){let e=Rn;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Fn(){return Bn()}function Vn(){return Bn()}function Bn(){return new Mn((t=>t.toString()),((t,e)=>t.isEqual(e)))}const Un=new Wt(q.comparator),jn=new Xt(q.comparator);function zn(...t){let e=jn;for(const n of t)e=e.add(n);return e}const qn=new Xt(R);function $n(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:gt(e)?"-0":e}}function Hn(t){return{integerValue:""+t}}function Kn(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!gt(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?Hn(e):$n(t,e)}class Gn{constructor(){this._=void 0}}function Wn(t,e,n){return t instanceof Xn?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&ae(e)&&(e=ce(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Jn?Zn(t,e):t instanceof ti?ei(t,e):function(t,e){const n=Yn(t,e),i=ii(n)+ii(t.gt);return xe(n)&&xe(t.gt)?Hn(i):$n(t.serializer,i)}(t,e)}function Qn(t,e,n){return t instanceof Jn?Zn(t,e):t instanceof ti?ei(t,e):n}function Yn(t,e){return t instanceof ni?xe(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class Xn extends Gn{}class Jn extends Gn{constructor(t){super(),this.elements=t}}function Zn(t,e){const n=ri(e);for(const e of t.elements)n.some((t=>ge(t,e)))||n.push(e);return{arrayValue:{values:n}}}class ti extends Gn{constructor(t){super(),this.elements=t}}function ei(t,e){let n=ri(e);for(const e of t.elements)n=n.filter((t=>!ge(t,e)));return{arrayValue:{values:n}}}class ni extends Gn{constructor(t,e){super(),this.serializer=t,this.gt=e}}function ii(t){return se(t.integerValue||t.doubleValue)}function ri(t){return Ie(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class si{constructor(t,e){this.field=t,this.transform=e}}class oi{constructor(t,e){this.version=t,this.transformResults=e}}class ai{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new ai}static exists(t){return new ai(void 0,t)}static updateTime(t){return new ai(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function ci(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class li{}function ui(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new wi(t.key,ai.none()):new gi(t.key,t.data,ai.none());{const n=t.data,i=Pe.empty();let r=new Xt(z.comparator);for(let t of e.fields)if(!r.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?i.delete(t):i.set(t,e),r=r.add(t)}return new mi(t.key,i,new te(r.toArray()),ai.none())}}function hi(t,e,n){t instanceof gi?function(t,e,n){const i=t.value.clone(),r=vi(t.fieldTransforms,e,n.transformResults);i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):t instanceof mi?function(t,e,n){if(!ci(t.precondition,e))return void e.convertToUnknownDocument(n.version);const i=vi(t.fieldTransforms,e,n.transformResults),r=e.data;r.setAll(yi(t)),r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function di(t,e,n,i){return t instanceof gi?function(t,e,n,i){if(!ci(t.precondition,e))return n;const r=t.value.clone(),s=bi(t.fieldTransforms,i,e);return r.setAll(s),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null}(t,e,n,i):t instanceof mi?function(t,e,n,i){if(!ci(t.precondition,e))return n;const r=bi(t.fieldTransforms,i,e),s=e.data;return s.setAll(yi(t)),s.setAll(r),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,i):function(t,e,n){return ci(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function fi(t,e){let n=null;for(const i of t.fieldTransforms){const t=e.data.field(i.field),r=Yn(i.transform,t||null);null!=r&&(null===n&&(n=Pe.empty()),n.set(i.field,r))}return n||null}function pi(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&N(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Jn&&e instanceof Jn||t instanceof ti&&e instanceof ti?N(t.elements,e.elements,ge):t instanceof ni&&e instanceof ni?ge(t.gt,e.gt):t instanceof Xn&&e instanceof Xn}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class gi extends li{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class mi extends li{constructor(t,e,n,i,r=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function yi(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}})),e}function vi(t,e,n){const i=new Map;b(t.length===n.length);for(let r=0;r<n.length;r++){const s=t[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,Qn(o,a,n[r]))}return i}function bi(t,e,n){const i=new Map;for(const r of t){const t=r.transform,s=n.data.field(r.field);i.set(r.field,Wn(t,s,e))}return i}class wi extends li{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class _i extends li{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class xi{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const i=this.mutations[e];i.key.isEqual(t.key)&&hi(i,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=di(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=di(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Vn();return this.mutations.forEach((i=>{const r=t.get(i.key),s=r.overlayedDocument;let o=this.applyToLocalView(s,r.mutatedFields);o=e.has(i.key)?null:o;const a=ui(s,o);null!==a&&n.set(i.key,a),s.isValidDocument()||s.convertToNoDocument(V.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),zn())}isEqual(t){return this.batchId===t.batchId&&N(this.mutations,t.mutations,((t,e)=>pi(t,e)))&&N(this.baseMutations,t.baseMutations,((t,e)=>pi(t,e)))}}class Ii{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){b(t.mutations.length===n.length);let i=Un;const r=t.mutations;for(let t=0;t<r.length;t++)i=i.insert(r[t].key,n[t].version);return new Ii(t,e,n,i)}}class Ei{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ti{constructor(t,e){this.count=t,this.unchangedNames=e}}var ki,Si;function Ci(t){if(void 0===t)return g("GRPC error has no .code"),_.UNKNOWN;switch(t){case ki.OK:return _.OK;case ki.CANCELLED:return _.CANCELLED;case ki.UNKNOWN:return _.UNKNOWN;case ki.DEADLINE_EXCEEDED:return _.DEADLINE_EXCEEDED;case ki.RESOURCE_EXHAUSTED:return _.RESOURCE_EXHAUSTED;case ki.INTERNAL:return _.INTERNAL;case ki.UNAVAILABLE:return _.UNAVAILABLE;case ki.UNAUTHENTICATED:return _.UNAUTHENTICATED;case ki.INVALID_ARGUMENT:return _.INVALID_ARGUMENT;case ki.NOT_FOUND:return _.NOT_FOUND;case ki.ALREADY_EXISTS:return _.ALREADY_EXISTS;case ki.PERMISSION_DENIED:return _.PERMISSION_DENIED;case ki.FAILED_PRECONDITION:return _.FAILED_PRECONDITION;case ki.ABORTED:return _.ABORTED;case ki.OUT_OF_RANGE:return _.OUT_OF_RANGE;case ki.UNIMPLEMENTED:return _.UNIMPLEMENTED;case ki.DATA_LOSS:return _.DATA_LOSS;default:return v()}}(Si=ki||(ki={}))[Si.OK=0]="OK",Si[Si.CANCELLED=1]="CANCELLED",Si[Si.UNKNOWN=2]="UNKNOWN",Si[Si.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Si[Si.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Si[Si.NOT_FOUND=5]="NOT_FOUND",Si[Si.ALREADY_EXISTS=6]="ALREADY_EXISTS",Si[Si.PERMISSION_DENIED=7]="PERMISSION_DENIED",Si[Si.UNAUTHENTICATED=16]="UNAUTHENTICATED",Si[Si.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Si[Si.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Si[Si.ABORTED=10]="ABORTED",Si[Si.OUT_OF_RANGE=11]="OUT_OF_RANGE",Si[Si.UNIMPLEMENTED=12]="UNIMPLEMENTED",Si[Si.INTERNAL=13]="INTERNAL",Si[Si.UNAVAILABLE=14]="UNAVAILABLE",Si[Si.DATA_LOSS=15]="DATA_LOSS";class Ai{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return Di}static getOrCreateInstance(){return null===Di&&(Di=new Ai),Di}onExistenceFilterMismatch(t){const e=Symbol();return this.onExistenceFilterMismatchCallbacks.set(e,t),()=>this.onExistenceFilterMismatchCallbacks.delete(e)}notifyOnExistenceFilterMismatch(t){this.onExistenceFilterMismatchCallbacks.forEach((e=>e(t)))}}let Di=null;const Mi=new a.jz([4294967295,4294967295],0);function Oi(t){const e=(new TextEncoder).encode(t),n=new a.VV;return n.update(e),new Uint8Array(n.digest())}function Pi(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new a.jz([n,i],0),new a.jz([r,s],0)]}class Ri{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Ni(`Invalid padding: ${e}`);if(n<0)throw new Ni(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new Ni(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new Ni(`Invalid padding when bitmap length is 0: ${e}`);this.It=8*t.length-e,this.Tt=a.jz.fromNumber(this.It)}Et(t,e,n){let i=t.add(e.multiply(a.jz.fromNumber(n)));return 1===i.compare(Mi)&&(i=new a.jz([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Tt).toNumber()}At(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}vt(t){if(0===this.It)return!1;const e=Oi(t),[n,i]=Pi(e);for(let t=0;t<this.hashCount;t++){const e=this.Et(n,i,t);if(!this.At(e))return!1}return!0}static create(t,e,n){const i=t%8==0?0:8-t%8,r=new Uint8Array(Math.ceil(t/8)),s=new Ri(r,i,e);return n.forEach((t=>s.insert(t))),s}insert(t){if(0===this.It)return;const e=Oi(t),[n,i]=Pi(e);for(let t=0;t<this.hashCount;t++){const e=this.Et(n,i,t);this.Rt(e)}}Rt(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Ni extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Li{constructor(t,e,n,i,r){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const i=new Map;return i.set(t,Fi.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Li(V.min(),i,new Wt(R),Pn(),zn())}}class Fi{constructor(t,e,n,i,r){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Fi(n,e,zn(),zn(),zn())}}class Vi{constructor(t,e,n,i){this.Pt=t,this.removedTargetIds=e,this.key=n,this.bt=i}}class Bi{constructor(t,e){this.targetId=t,this.Vt=e}}class Ui{constructor(t,e,n=ne.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}}class ji{constructor(){this.St=0,this.Dt=$i(),this.Ct=ne.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(t){t.approximateByteSize()>0&&(this.Nt=!0,this.Ct=t)}Ot(){let t=zn(),e=zn(),n=zn();return this.Dt.forEach(((i,r)=>{switch(r){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:v()}})),new Fi(this.Ct,this.xt,t,e,n)}Ft(){this.Nt=!1,this.Dt=$i()}Bt(t,e){this.Nt=!0,this.Dt=this.Dt.insert(t,e)}Lt(t){this.Nt=!0,this.Dt=this.Dt.remove(t)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class zi{constructor(t){this.Gt=t,this.Qt=new Map,this.jt=Pn(),this.zt=qi(),this.Wt=new Wt(R)}Ht(t){for(const e of t.Pt)t.bt&&t.bt.isFoundDocument()?this.Jt(e,t.bt):this.Yt(e,t.key,t.bt);for(const e of t.removedTargetIds)this.Yt(e,t.key,t.bt)}Xt(t){this.forEachTarget(t,(e=>{const n=this.Zt(e);switch(t.state){case 0:this.te(e)&&n.$t(t.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(t.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(e);break;case 3:this.te(e)&&(n.Kt(),n.$t(t.resumeToken));break;case 4:this.te(e)&&(this.ee(e),n.$t(t.resumeToken));break;default:v()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Qt.forEach(((t,n)=>{this.te(n)&&e(n)}))}ne(t){var e;const n=t.targetId,i=t.Vt.count,r=this.se(n);if(r){const s=r.target;if(hn(s))if(0===i){const t=new q(s.path);this.Yt(n,t,Ne.newNoDocument(t,V.min()))}else b(1===i);else{const r=this.ie(n);if(r!==i){const i=this.re(t,r);if(0!==i){this.ee(n);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,t)}null===(e=Ai.instance)||void 0===e||e.notifyOnExistenceFilterMismatch(function(t,e,n){var i,r,s,o,a,c;const l={localCacheCount:e,existenceFilterCount:n.count},u=n.unchangedNames;return u&&(l.bloomFilter={applied:0===t,hashCount:null!==(i=null==u?void 0:u.hashCount)&&void 0!==i?i:0,bitmapLength:null!==(o=null===(s=null===(r=null==u?void 0:u.bits)||void 0===r?void 0:r.bitmap)||void 0===s?void 0:s.length)&&void 0!==o?o:0,padding:null!==(c=null===(a=null==u?void 0:u.bits)||void 0===a?void 0:a.padding)&&void 0!==c?c:0}),l}(i,r,t.Vt))}}}}re(t,e){const{unchangedNames:n,count:i}=t.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=n;let a,c;try{a=oe(r).toUint8Array()}catch(t){if(t instanceof ee)return m("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw t}try{c=new Ri(a,s,o)}catch(t){return m(t instanceof Ni?"BloomFilter error: ":"Applying bloom filter failed: ",t),1}return 0===c.It?1:i!==e-this.oe(t.targetId,c)?2:0}oe(t,e){const n=this.Gt.getRemoteKeysForTarget(t);let i=0;return n.forEach((n=>{const r=this.Gt.ue(),s=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;e.vt(s)||(this.Yt(t,n,null),i++)})),i}ce(t){const e=new Map;this.Qt.forEach(((n,i)=>{const r=this.se(i);if(r){if(n.current&&hn(r.target)){const e=new q(r.target.path);null!==this.jt.get(e)||this.ae(i,e)||this.Yt(i,e,Ne.newNoDocument(e,t))}n.Mt&&(e.set(i,n.Ot()),n.Ft())}}));let n=zn();this.zt.forEach(((t,e)=>{let i=!0;e.forEachWhile((t=>{const e=this.se(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(i=!1,!1)})),i&&(n=n.add(t))})),this.jt.forEach(((e,n)=>n.setReadTime(t)));const i=new Li(t,e,this.Wt,this.jt,n);return this.jt=Pn(),this.zt=qi(),this.Wt=new Wt(R),i}Jt(t,e){if(!this.te(t))return;const n=this.ae(t,e.key)?2:0;this.Zt(t).Bt(e.key,n),this.jt=this.jt.insert(e.key,e),this.zt=this.zt.insert(e.key,this.he(e.key).add(t))}Yt(t,e,n){if(!this.te(t))return;const i=this.Zt(t);this.ae(t,e)?i.Bt(e,1):i.Lt(e),this.zt=this.zt.insert(e,this.he(e).delete(t)),n&&(this.jt=this.jt.insert(e,n))}removeTarget(t){this.Qt.delete(t)}ie(t){const e=this.Zt(t).Ot();return this.Gt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}qt(t){this.Zt(t).qt()}Zt(t){let e=this.Qt.get(t);return e||(e=new ji,this.Qt.set(t,e)),e}he(t){let e=this.zt.get(t);return e||(e=new Xt(R),this.zt=this.zt.insert(t,e)),e}te(t){const e=null!==this.se(t);return e||p("WatchChangeAggregator","Detected inactive target",t),e}se(t){const e=this.Qt.get(t);return e&&e.kt?null:this.Gt.le(t)}ee(t){this.Qt.set(t,new ji),this.Gt.getRemoteKeysForTarget(t).forEach((e=>{this.Yt(t,e,null)}))}ae(t,e){return this.Gt.getRemoteKeysForTarget(t).has(e)}}function qi(){return new Wt(q.comparator)}function $i(){return new Wt(q.comparator)}const Hi={asc:"ASCENDING",desc:"DESCENDING"},Ki={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Gi={and:"AND",or:"OR"};class Wi{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Qi(t,e){return t.useProto3Json||pt(e)?e:{value:e}}function Yi(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Xi(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Ji(t,e){return Yi(t,e.toTimestamp())}function Zi(t){return b(!!t),V.fromTimestamp(function(t){const e=re(t);return new F(e.seconds,e.nanos)}(t))}function tr(t,e){return function(t){return new U(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function er(t){const e=U.fromString(t);return b(xr(e)),e}function nr(t,e){return tr(t.databaseId,e.path)}function ir(t,e){const n=er(e);if(n.get(1)!==t.databaseId.projectId)throw new x(_.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new x(_.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new q(ar(n))}function rr(t,e){return tr(t.databaseId,e)}function sr(t){const e=er(t);return 4===e.length?U.emptyPath():ar(e)}function or(t){return new U(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ar(t){return b(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function cr(t,e,n){return{name:nr(t,e),fields:n.value.mapValue.fields}}function lr(t,e){let n;if(e instanceof gi)n={update:cr(t,e.key,e.value)};else if(e instanceof wi)n={delete:nr(t,e.key)};else if(e instanceof mi)n={update:cr(t,e.key,e.data),updateMask:_r(e.fieldMask)};else{if(!(e instanceof _i))return v();n={verify:nr(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Xn)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Jn)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ti)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ni)return{fieldPath:e.field.canonicalString(),increment:n.gt};throw v()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Ji(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:v()}(t,e.precondition)),n}function ur(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?ai.updateTime(Zi(t.updateTime)):void 0!==t.exists?ai.exists(t.exists):ai.none()}(e.currentDocument):ai.none(),i=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)b("REQUEST_TIME"===e.setToServerValue),n=new Xn;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Jn(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new ti(t)}else"increment"in e?n=new ni(t,e.increment):v();const i=z.fromServerFormat(e.fieldPath);return new si(i,n)}(t,e))):[];if(e.update){e.update.name;const r=ir(t,e.update.name),s=new Pe({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new te(e.map((t=>z.fromServerFormat(t))))}(e.updateMask);return new mi(r,s,t,n,i)}return new gi(r,s,n,i)}if(e.delete){const i=ir(t,e.delete);return new wi(i,n)}if(e.verify){const i=ir(t,e.verify);return new _i(i,n)}return v()}function hr(t,e){return{documents:[rr(t,e.path)]}}function dr(t,e){const n={structuredQuery:{}},i=e.path;null!==e.collectionGroup?(n.parent=rr(t,i),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=rr(t,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const r=function(t){if(0!==t.length)return wr(qe.create(t,"and"))}(e.filters);r&&(n.structuredQuery.where=r);const s=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:vr(t.field),direction:gr(t.dir)}}(t)))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const o=Qi(t,e.limit);var a;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function fr(t){let e=sr(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let r=null;if(i>0){b(1===i);const t=n.from[0];t.allDescendants?r=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=pr(t);return e instanceof qe&&Ke(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new Be(br(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,pt(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new Le(n,e)}(n.startAt));let l=null;return n.endAt&&(l=function(t){const e=!t.before,n=t.values||[];return new Le(n,e)}(n.endAt)),function(t,e,n,i,r,s,o,a){return new gn(t,e,n,i,r,s,o,a)}(e,r,o,s,a,"F",c,l)}function pr(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=br(t.unaryFilter.field);return ze.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=br(t.unaryFilter.field);return ze.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=br(t.unaryFilter.field);return ze.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=br(t.unaryFilter.field);return ze.create(r,"!=",{nullValue:"NULL_VALUE"});default:return v()}}(t):void 0!==t.fieldFilter?function(t){return ze.create(br(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return v()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return qe.create(t.compositeFilter.filters.map((t=>pr(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return v()}}(t.compositeFilter.op))}(t):v()}function gr(t){return Hi[t]}function mr(t){return Ki[t]}function yr(t){return Gi[t]}function vr(t){return{fieldPath:t.canonicalString()}}function br(t){return z.fromServerFormat(t.fieldPath)}function wr(t){return t instanceof ze?function(t){if("=="===t.op){if(Te(t.value))return{unaryFilter:{field:vr(t.field),op:"IS_NAN"}};if(Ee(t.value))return{unaryFilter:{field:vr(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Te(t.value))return{unaryFilter:{field:vr(t.field),op:"IS_NOT_NAN"}};if(Ee(t.value))return{unaryFilter:{field:vr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:vr(t.field),op:mr(t.op),value:t.value}}}(t):t instanceof qe?function(t){const e=t.getFilters().map((t=>wr(t)));return 1===e.length?e[0]:{compositeFilter:{op:yr(t.op),filters:e}}}(t):v()}function _r(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function xr(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Ir{constructor(t,e,n,i,r=V.min(),s=V.min(),o=ne.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Ir(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Ir(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Ir(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Ir(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Er{constructor(t){this.fe=t}}function Tr(t,e){const n=e.key,i={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:kr(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document=function(t,e){return{name:nr(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Yi(t,e.version.toTimestamp()),createTime:Yi(t,e.createTime.toTimestamp())}}(t.fe,e);else if(e.isNoDocument())i.noDocument={path:n.path.toArray(),readTime:Sr(e.version)};else{if(!e.isUnknownDocument())return v();i.unknownDocument={path:n.path.toArray(),version:Sr(e.version)}}return i}function kr(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Sr(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Cr(t){const e=new F(t.seconds,t.nanoseconds);return V.fromTimestamp(e)}function Ar(t,e){const n=(e.baseMutations||[]).map((e=>ur(t.fe,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const i=e.mutations[t+1];n.updateTransforms=i.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const i=e.mutations.map((e=>ur(t.fe,e))),r=F.fromMillis(e.localWriteTimeMs);return new xi(e.batchId,r,n,i)}function Dr(t){const e=Cr(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Cr(t.lastLimboFreeSnapshotVersion):V.min();let i;var r;return void 0!==t.query.documents?(b(1===(r=t.query).documents.length),i=xn(mn(sr(r.documents[0])))):i=function(t){return xn(fr(t))}(t.query),new Ir(i,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,ne.fromBase64String(t.resumeToken))}function Mr(t,e){const n=Sr(e.snapshotVersion),i=Sr(e.lastLimboFreeSnapshotVersion);let r;r=hn(e.target)?hr(t.fe,e.target):dr(t.fe,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ln(e.target),readTime:n,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function Or(t){const e=fr({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?En(e,e.limit,"L"):e}function Pr(t,e){return new Ei(e.largestBatchId,ur(t.fe,e.overlayMutation))}function Rr(t,e){const n=e.path.lastSegment();return[t,mt(e.path.popLast()),n]}function Nr(t,e,n,i){return{indexId:t,uid:e.uid||"",sequenceNumber:n,readTime:Sr(i.readTime),documentKey:mt(i.documentKey.path),largestBatchId:i.largestBatchId}}class Lr{getBundleMetadata(t,e){return Fr(t).get(e).next((t=>{if(t)return{id:(e=t).bundleId,createTime:Cr(e.createTime),version:e.version};var e}))}saveBundleMetadata(t,e){return Fr(t).put({bundleId:(n=e).id,createTime:Sr(Zi(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return Vr(t).get(e).next((t=>{if(t)return{name:(e=t).name,query:Or(e.bundledQuery),readTime:Cr(e.readTime)};var e}))}saveNamedQuery(t,e){return Vr(t).put(function(t){return{name:t.name,readTime:Sr(Zi(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function Fr(t){return $t(t,"bundles")}function Vr(t){return $t(t,"namedQueries")}class Br{constructor(t,e){this.serializer=t,this.userId=e}static de(t,e){const n=e.uid||"";return new Br(t,n)}getOverlay(t,e){return Ur(t).get(Rr(this.userId,e)).next((t=>t?Pr(this.serializer,t):null))}getOverlays(t,e){const n=Fn();return et.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){const i=[];return n.forEach(((n,r)=>{const s=new Ei(e,r);i.push(this.we(t,s))})),et.waitFor(i)}removeOverlaysForBatchId(t,e,n){const i=new Set;e.forEach((t=>i.add(mt(t.getCollectionPath()))));const r=[];return i.forEach((e=>{const i=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);r.push(Ur(t).J("collectionPathOverlayIndex",i))})),et.waitFor(r)}getOverlaysForCollection(t,e,n){const i=Fn(),r=mt(e),s=IDBKeyRange.bound([this.userId,r,n],[this.userId,r,Number.POSITIVE_INFINITY],!0);return Ur(t).j("collectionPathOverlayIndex",s).next((t=>{for(const e of t){const t=Pr(this.serializer,e);i.set(t.getKey(),t)}return i}))}getOverlaysForCollectionGroup(t,e,n,i){const r=Fn();let s;const o=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return Ur(t).X({index:"collectionGroupOverlayIndex",range:o},((t,e,n)=>{const o=Pr(this.serializer,e);r.size()<i||o.largestBatchId===s?(r.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>r))}we(t,e){return Ur(t).put(function(t,e,n){const[i,r,s]=Rr(e,n.mutation.key);return{userId:e,collectionPath:r,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:lr(t.fe,n.mutation)}}(this.serializer,this.userId,e))}}function Ur(t){return $t(t,"documentOverlays")}class jr{constructor(){}_e(t,e){this.me(t,e),e.ge()}me(t,e){if("nullValue"in t)this.ye(e,5);else if("booleanValue"in t)this.ye(e,10),e.pe(t.booleanValue?1:0);else if("integerValue"in t)this.ye(e,15),e.pe(se(t.integerValue));else if("doubleValue"in t){const n=se(t.doubleValue);isNaN(n)?this.ye(e,13):(this.ye(e,15),gt(n)?e.pe(0):e.pe(n))}else if("timestampValue"in t){const n=t.timestampValue;this.ye(e,20),"string"==typeof n?e.Ie(n):(e.Ie(`${n.seconds||""}`),e.pe(n.nanos||0))}else if("stringValue"in t)this.Te(t.stringValue,e),this.Ee(e);else if("bytesValue"in t)this.ye(e,30),e.Ae(oe(t.bytesValue)),this.Ee(e);else if("referenceValue"in t)this.ve(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.ye(e,45),e.pe(n.latitude||0),e.pe(n.longitude||0)}else"mapValue"in t?Ce(t)?this.ye(e,Number.MAX_SAFE_INTEGER):(this.Re(t.mapValue,e),this.Ee(e)):"arrayValue"in t?(this.Pe(t.arrayValue,e),this.Ee(e)):v()}Te(t,e){this.ye(e,25),this.be(t,e)}be(t,e){e.Ie(t)}Re(t,e){const n=t.fields||{};this.ye(e,55);for(const t of Object.keys(n))this.Te(t,e),this.me(n[t],e)}Pe(t,e){const n=t.values||[];this.ye(e,50);for(const t of n)this.me(t,e)}ve(t,e){this.ye(e,37),q.fromName(t).path.forEach((t=>{this.ye(e,60),this.be(t,e)}))}ye(t,e){t.pe(e)}Ee(t){t.pe(2)}}function zr(t){if(0===t)return 8;let e=0;return!(t>>4)&&(e+=4,t<<=4),!(t>>6)&&(e+=2,t<<=2),!(t>>7)&&(e+=1),e}function qr(t){const e=64-function(t){let e=0;for(let n=0;n<8;++n){const i=zr(255&t[n]);if(e+=i,8!==i)break}return e}(t);return Math.ceil(e/8)}jr.Ve=new jr;class $r{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Se(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.De(n.value),n=e.next();this.Ce()}xe(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Ne(n.value),n=e.next();this.ke()}Me(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.De(t);else if(t<2048)this.De(960|t>>>6),this.De(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.De(480|t>>>12),this.De(128|63&t>>>6),this.De(128|63&t);else{const t=e.codePointAt(0);this.De(240|t>>>18),this.De(128|63&t>>>12),this.De(128|63&t>>>6),this.De(128|63&t)}}this.Ce()}$e(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.Ne(t);else if(t<2048)this.Ne(960|t>>>6),this.Ne(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.Ne(480|t>>>12),this.Ne(128|63&t>>>6),this.Ne(128|63&t);else{const t=e.codePointAt(0);this.Ne(240|t>>>18),this.Ne(128|63&t>>>12),this.Ne(128|63&t>>>6),this.Ne(128|63&t)}}this.ke()}Oe(t){const e=this.Fe(t),n=qr(e);this.Be(1+n),this.buffer[this.position++]=255&n;for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=255&e[t]}Le(t){const e=this.Fe(t),n=qr(e);this.Be(1+n),this.buffer[this.position++]=~(255&n);for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=~(255&e[t])}qe(){this.Ue(255),this.Ue(255)}Ke(){this.Ge(255),this.Ge(255)}reset(){this.position=0}seed(t){this.Be(t.length),this.buffer.set(t,this.position),this.position+=t.length}Qe(){return this.buffer.slice(0,this.position)}Fe(t){const e=function(t){const e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,t,!1),new Uint8Array(e.buffer)}(t),n=!!(128&e[0]);e[0]^=n?255:128;for(let t=1;t<e.length;++t)e[t]^=n?255:0;return e}De(t){const e=255&t;0===e?(this.Ue(0),this.Ue(255)):255===e?(this.Ue(255),this.Ue(0)):this.Ue(e)}Ne(t){const e=255&t;0===e?(this.Ge(0),this.Ge(255)):255===e?(this.Ge(255),this.Ge(0)):this.Ge(t)}Ce(){this.Ue(0),this.Ue(1)}ke(){this.Ge(0),this.Ge(1)}Ue(t){this.Be(1),this.buffer[this.position++]=t}Ge(t){this.Be(1),this.buffer[this.position++]=~t}Be(t){const e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);const i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class Hr{constructor(t){this.je=t}Ae(t){this.je.Se(t)}Ie(t){this.je.Me(t)}pe(t){this.je.Oe(t)}ge(){this.je.qe()}}class Kr{constructor(t){this.je=t}Ae(t){this.je.xe(t)}Ie(t){this.je.$e(t)}pe(t){this.je.Le(t)}ge(){this.je.Ke()}}class Gr{constructor(){this.je=new $r,this.ze=new Hr(this.je),this.We=new Kr(this.je)}seed(t){this.je.seed(t)}He(t){return 0===t?this.ze:this.We}Qe(){return this.je.Qe()}reset(){this.je.reset()}}class Wr{constructor(t,e,n,i){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=i}Je(){const t=this.directionalValue.length,e=0===t||255===this.directionalValue[t-1]?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new Wr(this.indexId,this.documentKey,this.arrayValue,n)}}function Qr(t,e){let n=t.indexId-e.indexId;return 0!==n?n:(n=Yr(t.arrayValue,e.arrayValue),0!==n?n:(n=Yr(t.directionalValue,e.directionalValue),0!==n?n:q.comparator(t.documentKey,e.documentKey)))}function Yr(t,e){for(let n=0;n<t.length&&n<e.length;++n){const i=t[n]-e[n];if(0!==i)return i}return t.length-e.length}class Xr{constructor(t){this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.Ye=t.orderBy,this.Xe=[];for(const e of t.filters){const t=e;t.isInequality()?this.Ze=t:this.Xe.push(t)}}tn(t){b(t.collectionGroup===this.collectionId);const e=H(t);if(void 0!==e&&!this.en(e))return!1;const n=K(t);let i=new Set,r=0,s=0;for(;r<n.length&&this.en(n[r]);++r)i=i.add(n[r].fieldPath.canonicalString());if(r===n.length)return!0;if(void 0!==this.Ze){if(!i.has(this.Ze.field.canonicalString())){const t=n[r];if(!this.nn(this.Ze,t)||!this.sn(this.Ye[s++],t))return!1}++r}for(;r<n.length;++r){const t=n[r];if(s>=this.Ye.length||!this.sn(this.Ye[s++],t))return!1}return!0}en(t){for(const e of this.Xe)if(this.nn(e,t))return!0;return!1}nn(t,e){if(void 0===t||!t.field.isEqual(e.fieldPath))return!1;const n="array-contains"===t.op||"array-contains-any"===t.op;return 2===e.kind===n}sn(t,e){return!!t.field.isEqual(e.fieldPath)&&(0===e.kind&&"asc"===t.dir||1===e.kind&&"desc"===t.dir)}}function Jr(t){var e,n;if(b(t instanceof ze||t instanceof qe),t instanceof ze){if(t instanceof rn){const i=(null===(n=null===(e=t.value.arrayValue)||void 0===e?void 0:e.values)||void 0===n?void 0:n.map((e=>ze.create(t.field,"==",e))))||[];return qe.create(i,"or")}return t}const i=t.filters.map((t=>Jr(t)));return qe.create(i,t.op)}function Zr(t){if(0===t.getFilters().length)return[];const e=is(Jr(t));return b(ns(e)),ts(e)||es(e)?[e]:e.getFilters()}function ts(t){return t instanceof ze}function es(t){return t instanceof qe&&Ke(t)}function ns(t){return ts(t)||es(t)||function(t){if(t instanceof qe&&He(t)){for(const e of t.getFilters())if(!ts(e)&&!es(e))return!1;return!0}return!1}(t)}function is(t){if(b(t instanceof ze||t instanceof qe),t instanceof ze)return t;if(1===t.filters.length)return is(t.filters[0]);const e=t.filters.map((t=>is(t)));let n=qe.create(e,t.op);return n=os(n),ns(n)?n:(b(n instanceof qe),b($e(n)),b(n.filters.length>1),n.filters.reduce(((t,e)=>rs(t,e))))}function rs(t,e){let n;return b(t instanceof ze||t instanceof qe),b(e instanceof ze||e instanceof qe),n=t instanceof ze?e instanceof ze?function(t,e){return qe.create([t,e],"and")}(t,e):ss(t,e):e instanceof ze?ss(e,t):function(t,e){if(b(t.filters.length>0&&e.filters.length>0),$e(t)&&$e(e))return Ye(t,e.getFilters());const n=He(t)?t:e,i=He(t)?e:t,r=n.filters.map((t=>rs(t,i)));return qe.create(r,"or")}(t,e),os(n)}function ss(t,e){if($e(e))return Ye(e,t.getFilters());{const n=e.filters.map((e=>rs(t,e)));return qe.create(n,"or")}}function os(t){if(b(t instanceof ze||t instanceof qe),t instanceof ze)return t;const e=t.getFilters();if(1===e.length)return os(e[0]);if(Ge(t))return t;const n=e.map((t=>os(t))),i=[];return n.forEach((e=>{e instanceof ze?i.push(e):e instanceof qe&&(e.op===t.op?i.push(...e.filters):i.push(e))})),1===i.length?i[0]:qe.create(i,t.op)}class as{constructor(){this.rn=new cs}addToCollectionParentIndex(t,e){return this.rn.add(e),et.resolve()}getCollectionParents(t,e){return et.resolve(this.rn.getEntries(e))}addFieldIndex(t,e){return et.resolve()}deleteFieldIndex(t,e){return et.resolve()}getDocumentsMatchingTarget(t,e){return et.resolve(null)}getIndexType(t,e){return et.resolve(0)}getFieldIndexes(t,e){return et.resolve([])}getNextCollectionGroupToUpdate(t){return et.resolve(null)}getMinOffset(t,e){return et.resolve(Y.min())}getMinOffsetFromCollectionGroup(t,e){return et.resolve(Y.min())}updateCollectionGroup(t,e,n){return et.resolve()}updateIndexEntries(t,e){return et.resolve()}}class cs{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new Xt(U.comparator),r=!i.has(n);return this.index[e]=i.add(n),r}has(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new Xt(U.comparator)).toArray()}}const ls=new Uint8Array(0);class us{constructor(t,e){this.user=t,this.databaseId=e,this.on=new cs,this.un=new Mn((t=>ln(t)),((t,e)=>un(t,e))),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.on.has(e)){const n=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((()=>{this.on.add(e)}));const r={collectionId:n,parent:mt(i)};return hs(t).put(r)}return et.resolve()}getCollectionParents(t,e){const n=[],i=IDBKeyRange.bound([e,""],[L(e),""],!1,!0);return hs(t).j(i).next((t=>{for(const i of t){if(i.collectionId!==e)break;n.push(bt(i.parent))}return n}))}addFieldIndex(t,e){const n=fs(t),i=function(t){return{indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map((t=>[t.fieldPath.canonicalString(),t.kind]))}}(e);delete i.indexId;const r=n.add(i);if(e.indexState){const n=ps(t);return r.next((t=>{n.put(Nr(t,this.user,e.indexState.sequenceNumber,e.indexState.offset))}))}return r.next()}deleteFieldIndex(t,e){const n=fs(t),i=ps(t),r=ds(t);return n.delete(e.indexId).next((()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))).next((()=>r.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))))}getDocumentsMatchingTarget(t,e){const n=ds(t);let i=!0;const r=new Map;return et.forEach(this.cn(e),(e=>this.an(t,e).next((t=>{i&&(i=!!t),r.set(e,t)})))).next((()=>{if(i){let t=zn();const i=[];return et.forEach(r,((r,s)=>{var o;p("IndexedDbIndexManager",`Using index ${o=r,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((t=>`${t.fieldPath}:${t.kind}`)).join(",")}`} to execute ${ln(e)}`);const a=function(t,e){const n=H(e);if(void 0===n)return null;for(const e of dn(t,n.fieldPath))switch(e.op){case"array-contains-any":return e.value.arrayValue.values||[];case"array-contains":return[e.value]}return null}(s,r),c=function(t,e){const n=new Map;for(const i of K(e))for(const e of dn(t,i.fieldPath))switch(e.op){case"==":case"in":n.set(i.fieldPath.canonicalString(),e.value);break;case"not-in":case"!=":return n.set(i.fieldPath.canonicalString(),e.value),Array.from(n.values())}return null}(s,r),l=function(t,e){const n=[];let i=!0;for(const r of K(e)){const e=0===r.kind?fn(t,r.fieldPath,t.startAt):pn(t,r.fieldPath,t.startAt);n.push(e.value),i&&(i=e.inclusive)}return new Le(n,i)}(s,r),u=function(t,e){const n=[];let i=!0;for(const r of K(e)){const e=0===r.kind?pn(t,r.fieldPath,t.endAt):fn(t,r.fieldPath,t.endAt);n.push(e.value),i&&(i=e.inclusive)}return new Le(n,i)}(s,r),h=this.hn(r,s,l),d=this.hn(r,s,u),f=this.ln(r,s,c),g=this.fn(r.indexId,a,h,l.inclusive,d,u.inclusive,f);return et.forEach(g,(r=>n.H(r,e.limit).next((e=>{e.forEach((e=>{const n=q.fromSegments(e.documentKey);t.has(n)||(t=t.add(n),i.push(n))}))}))))})).next((()=>i))}return et.resolve(null)}))}cn(t){let e=this.un.get(t);return e||(e=0===t.filters.length?[t]:Zr(qe.create(t.filters,"and")).map((e=>cn(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt))),this.un.set(t,e),e)}fn(t,e,n,i,r,s,o){const a=(null!=e?e.length:1)*Math.max(n.length,r.length),c=a/(null!=e?e.length:1),l=[];for(let u=0;u<a;++u){const a=e?this.dn(e[u/c]):ls,h=this.wn(t,a,n[u%c],i),d=this._n(t,a,r[u%c],s),f=o.map((e=>this.wn(t,a,e,!0)));l.push(...this.createRange(h,d,f))}return l}wn(t,e,n,i){const r=new Wr(t,q.empty(),e,n);return i?r:r.Je()}_n(t,e,n,i){const r=new Wr(t,q.empty(),e,n);return i?r.Je():r}an(t,e){const n=new Xr(e),i=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next((t=>{let e=null;for(const i of t)n.tn(i)&&(!e||i.fields.length>e.fields.length)&&(e=i);return e}))}getIndexType(t,e){let n=2;const i=this.cn(e);return et.forEach(i,(e=>this.an(t,e).next((t=>{t?0!==n&&t.fields.length<function(t){let e=new Xt(z.comparator),n=!1;for(const i of t.filters)for(const t of i.getFlattenedFilters())t.field.isKeyField()||("array-contains"===t.op||"array-contains-any"===t.op?n=!0:e=e.add(t.field));for(const n of t.orderBy)n.field.isKeyField()||(e=e.add(n.field));return e.size+(n?1:0)}(e)&&(n=1):n=0})))).next((()=>function(t){return null!==t.limit}(e)&&i.length>1&&2===n?1:n))}mn(t,e){const n=new Gr;for(const i of K(t)){const t=e.data.field(i.fieldPath);if(null==t)return null;const r=n.He(i.kind);jr.Ve._e(t,r)}return n.Qe()}dn(t){const e=new Gr;return jr.Ve._e(t,e.He(0)),e.Qe()}gn(t,e){const n=new Gr;return jr.Ve._e(_e(this.databaseId,e),n.He(function(t){const e=K(t);return 0===e.length?0:e[e.length-1].kind}(t))),n.Qe()}ln(t,e,n){if(null===n)return[];let i=[];i.push(new Gr);let r=0;for(const s of K(t)){const t=n[r++];for(const n of i)if(this.yn(e,s.fieldPath)&&Ie(t))i=this.pn(i,s,t);else{const e=n.He(s.kind);jr.Ve._e(t,e)}}return this.In(i)}hn(t,e,n){return this.ln(t,e,n.position)}In(t){const e=[];for(let n=0;n<t.length;++n)e[n]=t[n].Qe();return e}pn(t,e,n){const i=[...t],r=[];for(const t of n.arrayValue.values||[])for(const n of i){const i=new Gr;i.seed(n.Qe()),jr.Ve._e(t,i.He(e.kind)),r.push(i)}return r}yn(t,e){return!!t.filters.find((t=>t instanceof ze&&t.field.isEqual(e)&&("in"===t.op||"not-in"===t.op)))}getFieldIndexes(t,e){const n=fs(t),i=ps(t);return(e?n.j("collectionGroupIndex",IDBKeyRange.bound(e,e)):n.j()).next((t=>{const e=[];return et.forEach(t,(t=>i.get([t.indexId,this.uid]).next((n=>{e.push(function(t,e){const n=e?new W(e.sequenceNumber,new Y(Cr(e.readTime),new q(bt(e.documentKey)),e.largestBatchId)):W.empty(),i=t.fields.map((([t,e])=>new G(z.fromServerFormat(t),e)));return new $(t.indexId,t.collectionGroup,i,n)}(t,n))})))).next((()=>e))}))}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next((t=>0===t.length?null:(t.sort(((t,e)=>{const n=t.indexState.sequenceNumber-e.indexState.sequenceNumber;return 0!==n?n:R(t.collectionGroup,e.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(t,e,n){const i=fs(t),r=ps(t);return this.Tn(t).next((t=>i.j("collectionGroupIndex",IDBKeyRange.bound(e,e)).next((e=>et.forEach(e,(e=>r.put(Nr(e.indexId,this.user,t,n))))))))}updateIndexEntries(t,e){const n=new Map;return et.forEach(e,((e,i)=>{const r=n.get(e.collectionGroup);return(r?et.resolve(r):this.getFieldIndexes(t,e.collectionGroup)).next((r=>(n.set(e.collectionGroup,r),et.forEach(r,(n=>this.En(t,e,n).next((e=>{const r=this.An(i,n);return e.isEqual(r)?et.resolve():this.vn(t,i,n,e,r)})))))))}))}Rn(t,e,n,i){return ds(t).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.gn(n,e.key),documentKey:e.key.path.toArray()})}Pn(t,e,n,i){return ds(t).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.gn(n,e.key),e.key.path.toArray()])}En(t,e,n){const i=ds(t);let r=new Xt(Qr);return i.X({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.gn(n,e)])},((t,i)=>{r=r.add(new Wr(n.indexId,e,i.arrayValue,i.directionalValue))})).next((()=>r))}An(t,e){let n=new Xt(Qr);const i=this.mn(e,t);if(null==i)return n;const r=H(e);if(null!=r){const s=t.data.field(r.fieldPath);if(Ie(s))for(const r of s.arrayValue.values||[])n=n.add(new Wr(e.indexId,t.key,this.dn(r),i))}else n=n.add(new Wr(e.indexId,t.key,ls,i));return n}vn(t,e,n,i,r){p("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);const s=[];return function(t,e,n,i,r){const s=t.getIterator(),o=e.getIterator();let a=Zt(s),c=Zt(o);for(;a||c;){let t=!1,e=!1;if(a&&c){const i=n(a,c);i<0?e=!0:i>0&&(t=!0)}else null!=a?e=!0:t=!0;t?(i(c),c=Zt(o)):e?(r(a),a=Zt(s)):(a=Zt(s),c=Zt(o))}}(i,r,Qr,(i=>{s.push(this.Rn(t,e,n,i))}),(i=>{s.push(this.Pn(t,e,n,i))})),et.waitFor(s)}Tn(t){let e=1;return ps(t).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((t,n,i)=>{i.done(),e=n.sequenceNumber+1})).next((()=>e))}createRange(t,e,n){n=n.sort(((t,e)=>Qr(t,e))).filter(((t,e,n)=>!e||0!==Qr(t,n[e-1])));const i=[];i.push(t);for(const r of n){const n=Qr(r,t),s=Qr(r,e);if(0===n)i[0]=t.Je();else if(n>0&&s<0)i.push(r),i.push(r.Je());else if(s>0)break}i.push(e);const r=[];for(let t=0;t<i.length;t+=2){if(this.bn(i[t],i[t+1]))return[];const e=[i[t].indexId,this.uid,i[t].arrayValue,i[t].directionalValue,ls,[]],n=[i[t+1].indexId,this.uid,i[t+1].arrayValue,i[t+1].directionalValue,ls,[]];r.push(IDBKeyRange.bound(e,n))}return r}bn(t,e){return Qr(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(gs)}getMinOffset(t,e){return et.mapArray(this.cn(e),(e=>this.an(t,e).next((t=>t||v())))).next(gs)}}function hs(t){return $t(t,"collectionParents")}function ds(t){return $t(t,"indexEntries")}function fs(t){return $t(t,"indexConfiguration")}function ps(t){return $t(t,"indexState")}function gs(t){b(0!==t.length);let e=t[0].indexState.offset,n=e.largestBatchId;for(let i=1;i<t.length;i++){const r=t[i].indexState.offset;X(r,e)<0&&(e=r),n<r.largestBatchId&&(n=r.largestBatchId)}return new Y(e.readTime,e.documentKey,n)}const ms={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ys{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new ys(t,ys.DEFAULT_COLLECTION_PERCENTILE,ys.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function vs(t,e,n){const i=t.store("mutations"),r=t.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=i.X({range:o},((t,e,n)=>(a++,n.delete())));s.push(c.next((()=>{b(1===a)})));const l=[];for(const t of n.mutations){const i=xt(e,t.key.path,n.batchId);s.push(r.delete(i)),l.push(t.key)}return et.waitFor(s).next((()=>l))}function bs(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw v();e=t.noDocument}return JSON.stringify(e).length}ys.DEFAULT_COLLECTION_PERCENTILE=10,ys.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ys.DEFAULT=new ys(41943040,ys.DEFAULT_COLLECTION_PERCENTILE,ys.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ys.DISABLED=new ys(-1,0,0);class ws{constructor(t,e,n,i){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=i,this.Vn={}}static de(t,e,n,i){b(""!==t.uid);const r=t.isAuthenticated()?t.uid:"";return new ws(r,e,n,i)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return xs(t).X({index:"userMutationsIndex",range:n},((t,n,i)=>{e=!1,i.done()})).next((()=>e))}addMutationBatch(t,e,n,i){const r=Is(t),s=xs(t);return s.add({}).next((o=>{b("number"==typeof o);const a=new xi(o,e,n,i),c=function(t,e,n){const i=n.baseMutations.map((e=>lr(t.fe,e))),r=n.mutations.map((e=>lr(t.fe,e)));return{userId:e,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:i,mutations:r}}(this.serializer,this.userId,a),l=[];let u=new Xt(((t,e)=>R(t.canonicalString(),e.canonicalString())));for(const t of i){const e=xt(this.userId,t.key.path,o);u=u.add(t.key.path.popLast()),l.push(s.put(c)),l.push(r.put(e,It))}return u.forEach((e=>{l.push(this.indexManager.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.Vn[o]=a.keys()})),et.waitFor(l).next((()=>a))}))}lookupMutationBatch(t,e){return xs(t).get(e).next((t=>t?(b(t.userId===this.userId),Ar(this.serializer,t)):null))}Sn(t,e){return this.Vn[e]?et.resolve(this.Vn[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.Vn[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,i=IDBKeyRange.lowerBound([this.userId,n]);let r=null;return xs(t).X({index:"userMutationsIndex",range:i},((t,e,i)=>{e.userId===this.userId&&(b(e.batchId>=n),r=Ar(this.serializer,e)),i.done()})).next((()=>r))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return xs(t).X({index:"userMutationsIndex",range:e,reverse:!0},((t,e,i)=>{n=e.batchId,i.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return xs(t).j("userMutationsIndex",e).next((t=>t.map((t=>Ar(this.serializer,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=_t(this.userId,e.path),i=IDBKeyRange.lowerBound(n),r=[];return Is(t).X({range:i},((n,i,s)=>{const[o,a,c]=n,l=bt(a);if(o===this.userId&&e.path.isEqual(l))return xs(t).get(c).next((t=>{if(!t)throw v();b(t.userId===this.userId),r.push(Ar(this.serializer,t))}));s.done()})).next((()=>r))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Xt(R);const i=[];return e.forEach((e=>{const r=_t(this.userId,e.path),s=IDBKeyRange.lowerBound(r),o=Is(t).X({range:s},((t,i,r)=>{const[s,o,a]=t,c=bt(o);s===this.userId&&e.path.isEqual(c)?n=n.add(a):r.done()}));i.push(o)})),et.waitFor(i).next((()=>this.Dn(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1,r=_t(this.userId,n),s=IDBKeyRange.lowerBound(r);let o=new Xt(R);return Is(t).X({range:s},((t,e,r)=>{const[s,a,c]=t,l=bt(a);s===this.userId&&n.isPrefixOf(l)?l.length===i&&(o=o.add(c)):r.done()})).next((()=>this.Dn(t,o)))}Dn(t,e){const n=[],i=[];return e.forEach((e=>{i.push(xs(t).get(e).next((t=>{if(null===t)throw v();b(t.userId===this.userId),n.push(Ar(this.serializer,t))})))})),et.waitFor(i).next((()=>n))}removeMutationBatch(t,e){return vs(t.ht,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.Cn(e.batchId)})),et.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}Cn(t){delete this.Vn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return et.resolve();const n=IDBKeyRange.lowerBound([this.userId]),i=[];return Is(t).X({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=bt(t[1]);i.push(e)}else n.done()})).next((()=>{b(0===i.length)}))}))}containsKey(t,e){return _s(t,this.userId,e)}xn(t){return Es(t).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function _s(t,e,n){const i=_t(e,n.path),r=i[1],s=IDBKeyRange.lowerBound(i);let o=!1;return Is(t).X({range:s,Y:!0},((t,n,i)=>{const[s,a,c]=t;s===e&&a===r&&(o=!0),i.done()})).next((()=>o))}function xs(t){return $t(t,"mutations")}function Is(t){return $t(t,"documentMutations")}function Es(t){return $t(t,"mutationQueues")}class Ts{constructor(t){this.Nn=t}next(){return this.Nn+=2,this.Nn}static kn(){return new Ts(0)}static Mn(){return new Ts(-1)}}class ks{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.$n(t).next((e=>{const n=new Ts(e.highestTargetId);return e.highestTargetId=n.next(),this.On(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.$n(t).next((t=>V.fromTimestamp(new F(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.$n(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.$n(t).next((i=>(i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.On(t,i))))}addTargetData(t,e){return this.Fn(t,e).next((()=>this.$n(t).next((n=>(n.targetCount+=1,this.Bn(e,n),this.On(t,n))))))}updateTargetData(t,e){return this.Fn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>Ss(t).delete(e.targetId))).next((()=>this.$n(t))).next((e=>(b(e.targetCount>0),e.targetCount-=1,this.On(t,e))))}removeTargets(t,e,n){let i=0;const r=[];return Ss(t).X(((s,o)=>{const a=Dr(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,r.push(this.removeTargetData(t,a)))})).next((()=>et.waitFor(r))).next((()=>i))}forEachTarget(t,e){return Ss(t).X(((t,n)=>{const i=Dr(n);e(i)}))}$n(t){return Cs(t).get("targetGlobalKey").next((t=>(b(null!==t),t)))}On(t,e){return Cs(t).put("targetGlobalKey",e)}Fn(t,e){return Ss(t).put(Mr(this.serializer,e))}Bn(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.$n(t).next((t=>t.targetCount))}getTargetData(t,e){const n=ln(e),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let r=null;return Ss(t).X({range:i,index:"queryTargetsIndex"},((t,n,i)=>{const s=Dr(n);un(e,s.target)&&(r=s,i.done())})).next((()=>r))}addMatchingKeys(t,e,n){const i=[],r=As(t);return e.forEach((e=>{const s=mt(e.path);i.push(r.put({targetId:n,path:s})),i.push(this.referenceDelegate.addReference(t,n,e))})),et.waitFor(i)}removeMatchingKeys(t,e,n){const i=As(t);return et.forEach(e,(e=>{const r=mt(e.path);return et.waitFor([i.delete([n,r]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=As(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),i=As(t);let r=zn();return i.X({range:n,Y:!0},((t,e,n)=>{const i=bt(t[1]),s=new q(i);r=r.add(s)})).next((()=>r))}containsKey(t,e){const n=mt(e.path),i=IDBKeyRange.bound([n],[L(n)],!1,!0);let r=0;return As(t).X({index:"documentTargetsIndex",Y:!0,range:i},(([t,e],n,i)=>{0!==t&&(r++,i.done())})).next((()=>r>0))}le(t,e){return Ss(t).get(e).next((t=>t?Dr(t):null))}}function Ss(t){return $t(t,"targets")}function Cs(t){return $t(t,"targetGlobal")}function As(t){return $t(t,"targetDocuments")}function Ds([t,e],[n,i]){const r=R(t,n);return 0===r?R(e,i):r}class Ms{constructor(t){this.Ln=t,this.buffer=new Xt(Ds),this.qn=0}Un(){return++this.qn}Kn(t){const e=[t,this.Un()];if(this.buffer.size<this.Ln)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Ds(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Os{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Qn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}Qn(t){p("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ot(t)?p("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await tt(t)}await this.Qn(3e5)}))}}class Ps{constructor(t,e){this.jn=t,this.params=e}calculateTargetCount(t,e){return this.jn.zn(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return et.resolve(ft.ct);const n=new Ms(e);return this.jn.forEachTarget(t,(t=>n.Kn(t.sequenceNumber))).next((()=>this.jn.Wn(t,(t=>n.Kn(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.jn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.jn.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(p("LruGarbageCollector","Garbage collection skipped; disabled"),et.resolve(ms)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(p("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ms):this.Hn(t,e)))}getCacheSize(t){return this.jn.getCacheSize(t)}Hn(t,e){let n,i,r,o,a,c,l;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(p("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),i=this.params.maximumSequenceNumbersToCollect):i=e,o=Date.now(),this.nthSequenceNumber(t,i)))).next((i=>(n=i,a=Date.now(),this.removeTargets(t,n,e)))).next((e=>(r=e,c=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(l=Date.now(),f()<=s.$b.DEBUG&&p("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-u}ms\n\tDetermined least recently used ${i} in `+(a-o)+"ms\n"+`\tRemoved ${r} targets in `+(c-a)+"ms\n"+`\tRemoved ${t} documents in `+(l-c)+"ms\n"+`Total Duration: ${l-u}ms`),et.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:t}))))}}class Rs{constructor(t,e){this.db=t,this.garbageCollector=function(t,e){return new Ps(t,e)}(this,e)}zn(t){const e=this.Jn(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}Jn(t){let e=0;return this.Wn(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Wn(t,e){return this.Yn(t,((t,n)=>e(n)))}addReference(t,e,n){return Ns(t,n)}removeReference(t,e,n){return Ns(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Ns(t,e)}Xn(t,e){return function(t,e){let n=!1;return Es(t).Z((i=>_s(t,i,e).next((t=>(t&&(n=!0),et.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let r=0;return this.Yn(t,((s,o)=>{if(o<=e){const e=this.Xn(t,s).next((e=>{if(!e)return r++,n.getEntry(t,s).next((()=>(n.removeEntry(s,V.min()),As(t).delete([0,mt(s.path)]))))}));i.push(e)}})).next((()=>et.waitFor(i))).next((()=>n.apply(t))).next((()=>r))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Ns(t,e)}Yn(t,e){const n=As(t);let i,r=ft.ct;return n.X({index:"documentTargetsIndex"},(([t,n],{path:s,sequenceNumber:o})=>{0===t?(r!==ft.ct&&e(new q(bt(i)),r),r=o,i=s):r=ft.ct})).next((()=>{r!==ft.ct&&e(new q(bt(i)),r)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function Ns(t,e){return As(t).put(function(t,e){return{targetId:0,path:mt(t.path),sequenceNumber:e}}(e,t.currentSequenceNumber))}class Ls{constructor(){this.changes=new Mn((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Ne.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?et.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Fs{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return js(t).put(n)}removeEntry(t,e,n){return js(t).delete(function(t,e){const n=t.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],kr(e),n[n.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.Zn(t,n))))}getEntry(t,e){let n=Ne.newInvalidDocument(e);return js(t).X({index:"documentKeyIndex",range:IDBKeyRange.only(zs(e))},((t,i)=>{n=this.ts(e,i)})).next((()=>n))}es(t,e){let n={size:0,document:Ne.newInvalidDocument(e)};return js(t).X({index:"documentKeyIndex",range:IDBKeyRange.only(zs(e))},((t,i)=>{n={document:this.ts(e,i),size:bs(i)}})).next((()=>n))}getEntries(t,e){let n=Pn();return this.ns(t,e,((t,e)=>{const i=this.ts(t,e);n=n.insert(t,i)})).next((()=>n))}ss(t,e){let n=Pn(),i=new Wt(q.comparator);return this.ns(t,e,((t,e)=>{const r=this.ts(t,e);n=n.insert(t,r),i=i.insert(t,bs(e))})).next((()=>({documents:n,rs:i})))}ns(t,e,n){if(e.isEmpty())return et.resolve();let i=new Xt($s);e.forEach((t=>i=i.add(t)));const r=IDBKeyRange.bound(zs(i.first()),zs(i.last())),s=i.getIterator();let o=s.getNext();return js(t).X({index:"documentKeyIndex",range:r},((t,e,i)=>{const r=q.fromSegments([...e.prefixPath,e.collectionGroup,e.documentId]);for(;o&&$s(o,r)<0;)n(o,null),o=s.getNext();o&&o.isEqual(r)&&(n(o,e),o=s.hasNext()?s.getNext():null),o?i.G(zs(o)):i.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(t,e,n,i){const r=e.path,s=[r.popLast().toArray(),r.lastSegment(),kr(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[r.popLast().toArray(),r.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return js(t).j(IDBKeyRange.bound(s,o,!0)).next((t=>{let n=Pn();for(const r of t){const t=this.ts(q.fromSegments(r.prefixPath.concat(r.collectionGroup,r.documentId)),r);t.isFoundDocument()&&(Cn(e,t)||i.has(t.key))&&(n=n.insert(t.key,t))}return n}))}getAllFromCollectionGroup(t,e,n,i){let r=Pn();const s=qs(e,n),o=qs(e,Y.max());return js(t).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((t,e,n)=>{const s=this.ts(q.fromSegments(e.prefixPath.concat(e.collectionGroup,e.documentId)),e);r=r.insert(s.key,s),r.size===i&&n.done()})).next((()=>r))}newChangeBuffer(t){return new Bs(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return Us(t).get("remoteDocumentGlobalKey").next((t=>(b(!!t),t)))}Zn(t,e){return Us(t).put("remoteDocumentGlobalKey",e)}ts(t,e){if(e){const t=function(t,e){let n;if(e.document)n=function(t,e,n){const i=ir(t,e.name),r=Zi(e.updateTime),s=e.createTime?Zi(e.createTime):V.min(),o=new Pe({mapValue:{fields:e.fields}}),a=Ne.newFoundDocument(i,r,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}(t.fe,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const t=q.fromSegments(e.noDocument.path),i=Cr(e.noDocument.readTime);n=Ne.newNoDocument(t,i),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return v();{const t=q.fromSegments(e.unknownDocument.path),i=Cr(e.unknownDocument.version);n=Ne.newUnknownDocument(t,i)}}return e.readTime&&n.setReadTime(function(t){const e=new F(t[0],t[1]);return V.fromTimestamp(e)}(e.readTime)),n}(this.serializer,e);if(!t.isNoDocument()||!t.version.isEqual(V.min()))return t}return Ne.newInvalidDocument(t)}}function Vs(t){return new Fs(t)}class Bs extends Ls{constructor(t,e){super(),this.os=t,this.trackRemovals=e,this.us=new Mn((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,i=new Xt(((t,e)=>R(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((r,s)=>{const o=this.us.get(r);if(e.push(this.os.removeEntry(t,r,o.readTime)),s.isValidDocument()){const a=Tr(this.os.serializer,s);i=i.add(r.path.popLast());const c=bs(a);n+=c-o.size,e.push(this.os.addEntry(t,r,a))}else if(n-=o.size,this.trackRemovals){const n=Tr(this.os.serializer,s.convertToNoDocument(V.min()));e.push(this.os.addEntry(t,r,n))}})),i.forEach((n=>{e.push(this.os.indexManager.addToCollectionParentIndex(t,n))})),e.push(this.os.updateMetadata(t,n)),et.waitFor(e)}getFromCache(t,e){return this.os.es(t,e).next((t=>(this.us.set(e,{size:t.size,readTime:t.document.readTime}),t.document)))}getAllFromCache(t,e){return this.os.ss(t,e).next((({documents:t,rs:e})=>(e.forEach(((e,n)=>{this.us.set(e,{size:n,readTime:t.get(e).readTime})})),t)))}}function Us(t){return $t(t,"remoteDocumentGlobal")}function js(t){return $t(t,"remoteDocumentsV14")}function zs(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function qs(t,e){const n=e.documentKey.path.toArray();return[t,kr(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function $s(t,e){const n=t.path.toArray(),i=e.path.toArray();let r=0;for(let t=0;t<n.length-2&&t<i.length-2;++t)if(r=R(n[t],i[t]),r)return r;return r=R(n.length,i.length),r||(r=R(n[n.length-2],i[i.length-2]),r||R(n[n.length-1],i[i.length-1]))}class Hs{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Ks{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((i=>(n=i,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&di(n.mutation,t,te.empty(),F.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,zn()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=zn()){const i=Fn();return this.populateOverlays(t,i,e).next((()=>this.computeViews(t,e,i,n).next((t=>{let e=Nn();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Fn();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,zn())))}populateOverlays(t,e,n){const i=[];return n.forEach((t=>{e.has(t)||i.push(t)})),this.documentOverlayCache.getOverlays(t,i).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,i){let r=Pn();const s=Bn(),o=Bn();return e.forEach(((t,e)=>{const o=n.get(e.key);i.has(e.key)&&(void 0===o||o.mutation instanceof mi)?r=r.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),di(o.mutation,e,o.mutation.getFieldMask(),F.now())):s.set(e.key,te.empty())})),this.recalculateAndSaveOverlays(t,r).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new Hs(e,null!==(n=s.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Bn();let i=new Wt(((t,e)=>t-e)),r=zn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const r of t)r.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||te.empty();o=r.applyToLocalView(s,o),n.set(t,o);const a=(i.get(r.batchId)||zn()).add(t);i=i.insert(r.batchId,a)}))})).next((()=>{const s=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,c=i.value,l=Vn();c.forEach((t=>{if(!r.has(t)){const i=ui(e.get(t),n.get(t));null!==i&&l.set(t,i),r=r.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,a,l))}return et.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return q.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):wn(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next((r=>{const s=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-r.size):et.resolve(Fn());let o=-1,a=r;return s.next((e=>et.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(e)?et.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,r))).next((()=>this.computeViews(t,a,e,zn()))).next((t=>({batchId:o,changes:Ln(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new q(e)).next((t=>{let e=Nn();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const i=e.collectionGroup;let r=Nn();return this.indexManager.getCollectionParents(t,i).next((s=>et.forEach(s,(s=>{const o=function(t,e){return new gn(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{r=r.insert(t,e)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(t,e,n){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((r=>(i=r,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i)))).next((t=>{i.forEach(((e,n)=>{const i=n.getKey();null===t.get(i)&&(t=t.insert(i,Ne.newInvalidDocument(i)))}));let n=Nn();return t.forEach(((t,r)=>{const s=i.get(t);void 0!==s&&di(s.mutation,r,te.empty(),F.now()),Cn(e,r)&&(n=n.insert(t,r))})),n}))}}class Gs{constructor(t){this.serializer=t,this.cs=new Map,this.hs=new Map}getBundleMetadata(t,e){return et.resolve(this.cs.get(e))}saveBundleMetadata(t,e){var n;return this.cs.set(e.id,{id:(n=e).id,version:n.version,createTime:Zi(n.createTime)}),et.resolve()}getNamedQuery(t,e){return et.resolve(this.hs.get(e))}saveNamedQuery(t,e){return this.hs.set(e.name,function(t){return{name:t.name,query:Or(t.bundledQuery),readTime:Zi(t.readTime)}}(e)),et.resolve()}}class Ws{constructor(){this.overlays=new Wt(q.comparator),this.ls=new Map}getOverlay(t,e){return et.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Fn();return et.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,i)=>{this.we(t,e,i)})),et.resolve()}removeOverlaysForBatchId(t,e,n){const i=this.ls.get(n);return void 0!==i&&(i.forEach((t=>this.overlays=this.overlays.remove(t))),this.ls.delete(n)),et.resolve()}getOverlaysForCollection(t,e,n){const i=Fn(),r=e.length+1,s=new q(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===r&&t.largestBatchId>n&&i.set(t.getKey(),t)}return et.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let r=new Wt(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=r.get(t.largestBatchId);null===e&&(e=Fn(),r=r.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Fn(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=i)););return et.resolve(o)}we(t,e,n){const i=this.overlays.get(n.key);if(null!==i){const t=this.ls.get(i.largestBatchId).delete(n.key);this.ls.set(i.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Ei(e,n));let r=this.ls.get(e);void 0===r&&(r=zn(),this.ls.set(e,r)),this.ls.set(e,r.add(n.key))}}class Qs{constructor(){this.fs=new Xt(Ys.ds),this.ws=new Xt(Ys._s)}isEmpty(){return this.fs.isEmpty()}addReference(t,e){const n=new Ys(t,e);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.ys(new Ys(t,e))}ps(t,e){t.forEach((t=>this.removeReference(t,e)))}Is(t){const e=new q(new U([])),n=new Ys(e,t),i=new Ys(e,t+1),r=[];return this.ws.forEachInRange([n,i],(t=>{this.ys(t),r.push(t.key)})),r}Ts(){this.fs.forEach((t=>this.ys(t)))}ys(t){this.fs=this.fs.delete(t),this.ws=this.ws.delete(t)}Es(t){const e=new q(new U([])),n=new Ys(e,t),i=new Ys(e,t+1);let r=zn();return this.ws.forEachInRange([n,i],(t=>{r=r.add(t.key)})),r}containsKey(t){const e=new Ys(t,0),n=this.fs.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Ys{constructor(t,e){this.key=t,this.As=e}static ds(t,e){return q.comparator(t.key,e.key)||R(t.As,e.As)}static _s(t,e){return R(t.As,e.As)||q.comparator(t.key,e.key)}}class Xs{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.vs=1,this.Rs=new Xt(Ys.ds)}checkEmpty(t){return et.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,i){const r=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new xi(r,e,n,i);this.mutationQueue.push(s);for(const e of i)this.Rs=this.Rs.add(new Ys(e.key,r)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return et.resolve(s)}lookupMutationBatch(t,e){return et.resolve(this.Ps(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,i=this.bs(n),r=i<0?0:i;return et.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return et.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(t){return et.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Ys(e,0),i=new Ys(e,Number.POSITIVE_INFINITY),r=[];return this.Rs.forEachInRange([n,i],(t=>{const e=this.Ps(t.As);r.push(e)})),et.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Xt(R);return e.forEach((t=>{const e=new Ys(t,0),i=new Ys(t,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([e,i],(t=>{n=n.add(t.As)}))})),et.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1;let r=n;q.isDocumentKey(r)||(r=r.child(""));const s=new Ys(new q(r),0);let o=new Xt(R);return this.Rs.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===i&&(o=o.add(t.As)),!0)}),s),et.resolve(this.Vs(o))}Vs(t){const e=[];return t.forEach((t=>{const n=this.Ps(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){b(0===this.Ss(e.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return et.forEach(e.mutations,(i=>{const r=new Ys(i.key,e.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((()=>{this.Rs=n}))}Cn(t){}containsKey(t,e){const n=new Ys(e,0),i=this.Rs.firstAfterOrEqual(n);return et.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,et.resolve()}Ss(t,e){return this.bs(t)}bs(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Ps(t){const e=this.bs(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Js{constructor(t){this.Ds=t,this.docs=new Wt(q.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,i=this.docs.get(n),r=i?i.size:0,s=this.Ds(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return et.resolve(n?n.document.mutableCopy():Ne.newInvalidDocument(e))}getEntries(t,e){let n=Pn();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Ne.newInvalidDocument(t))})),et.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let r=Pn();const s=e.path,o=new q(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||X(Q(o),n)<=0||(i.has(o.key)||Cn(e,o))&&(r=r.insert(o.key,o.mutableCopy()))}return et.resolve(r)}getAllFromCollectionGroup(t,e,n,i){v()}Cs(t,e){return et.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Zs(this)}getSize(t){return et.resolve(this.size)}}class Zs extends Ls{constructor(t){super(),this.os=t}applyChanges(t){const e=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?e.push(this.os.addEntry(t,i)):this.os.removeEntry(n)})),et.waitFor(e)}getFromCache(t,e){return this.os.getEntry(t,e)}getAllFromCache(t,e){return this.os.getEntries(t,e)}}class to{constructor(t){this.persistence=t,this.xs=new Mn((t=>ln(t)),un),this.lastRemoteSnapshotVersion=V.min(),this.highestTargetId=0,this.Ns=0,this.ks=new Qs,this.targetCount=0,this.Ms=Ts.kn()}forEachTarget(t,e){return this.xs.forEach(((t,n)=>e(n))),et.resolve()}getLastRemoteSnapshotVersion(t){return et.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return et.resolve(this.Ns)}allocateTargetId(t){return this.highestTargetId=this.Ms.next(),et.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Ns&&(this.Ns=e),et.resolve()}Fn(t){this.xs.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Ms=new Ts(e),this.highestTargetId=e),t.sequenceNumber>this.Ns&&(this.Ns=t.sequenceNumber)}addTargetData(t,e){return this.Fn(e),this.targetCount+=1,et.resolve()}updateTargetData(t,e){return this.Fn(e),et.resolve()}removeTargetData(t,e){return this.xs.delete(e.target),this.ks.Is(e.targetId),this.targetCount-=1,et.resolve()}removeTargets(t,e,n){let i=0;const r=[];return this.xs.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.xs.delete(s),r.push(this.removeMatchingKeysForTargetId(t,o.targetId)),i++)})),et.waitFor(r).next((()=>i))}getTargetCount(t){return et.resolve(this.targetCount)}getTargetData(t,e){const n=this.xs.get(e)||null;return et.resolve(n)}addMatchingKeys(t,e,n){return this.ks.gs(e,n),et.resolve()}removeMatchingKeys(t,e,n){this.ks.ps(e,n);const i=this.persistence.referenceDelegate,r=[];return i&&e.forEach((e=>{r.push(i.markPotentiallyOrphaned(t,e))})),et.waitFor(r)}removeMatchingKeysForTargetId(t,e){return this.ks.Is(e),et.resolve()}getMatchingKeysForTargetId(t,e){const n=this.ks.Es(e);return et.resolve(n)}containsKey(t,e){return et.resolve(this.ks.containsKey(e))}}class eo{constructor(t,e){this.$s={},this.overlays={},this.Os=new ft(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=t(this),this.Bs=new to(this),this.indexManager=new as,this.remoteDocumentCache=function(t){return new Js(t)}((t=>this.referenceDelegate.Ls(t))),this.serializer=new Er(e),this.qs=new Gs(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Ws,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.$s[t.toKey()];return n||(n=new Xs(e,this.referenceDelegate),this.$s[t.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(t,e,n){p("MemoryPersistence","Starting transaction:",t);const i=new no(this.Os.next());return this.referenceDelegate.Us(),n(i).next((t=>this.referenceDelegate.Ks(i).next((()=>t)))).toPromise().then((t=>(i.raiseOnCommittedEvent(),t)))}Gs(t,e){return et.or(Object.values(this.$s).map((n=>()=>n.containsKey(t,e))))}}class no extends Z{constructor(t){super(),this.currentSequenceNumber=t}}class io{constructor(t){this.persistence=t,this.Qs=new Qs,this.js=null}static zs(t){return new io(t)}get Ws(){if(this.js)return this.js;throw v()}addReference(t,e,n){return this.Qs.addReference(n,e),this.Ws.delete(n.toString()),et.resolve()}removeReference(t,e,n){return this.Qs.removeReference(n,e),this.Ws.add(n.toString()),et.resolve()}markPotentiallyOrphaned(t,e){return this.Ws.add(e.toString()),et.resolve()}removeTarget(t,e){this.Qs.Is(e.targetId).forEach((t=>this.Ws.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Ws.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Us(){this.js=new Set}Ks(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return et.forEach(this.Ws,(n=>{const i=q.fromPath(n);return this.Hs(t,i).next((t=>{t||e.removeEntry(i,V.min())}))})).next((()=>(this.js=null,e.apply(t))))}updateLimboDocument(t,e){return this.Hs(t,e).next((t=>{t?this.Ws.delete(e.toString()):this.Ws.add(e.toString())}))}Ls(t){return 0}Hs(t,e){return et.or([()=>et.resolve(this.Qs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gs(t,e)])}}class ro{constructor(t){this.serializer=t}O(t,e,n,i){const r=new nt("createOrUpgrade",e);n<1&&i>=1&&(function(t){t.createObjectStore("owner")}(t),function(t){t.createObjectStore("mutationQueues",{keyPath:"userId"}),t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",wt,{unique:!0}),t.createObjectStore("documentMutations")}(t),so(t),function(t){t.createObjectStore("remoteDocuments")}(t));let s=et.resolve();return n<3&&i>=3&&(0!==n&&(function(t){t.deleteObjectStore("targetDocuments"),t.deleteObjectStore("targets"),t.deleteObjectStore("targetGlobal")}(t),so(t)),s=s.next((()=>function(t){const e=t.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:V.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",n)}(r)))),n<4&&i>=4&&(0!==n&&(s=s.next((()=>function(t,e){return e.store("mutations").j().next((n=>{t.deleteObjectStore("mutations"),t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",wt,{unique:!0});const i=e.store("mutations"),r=n.map((t=>i.put(t)));return et.waitFor(r)}))}(t,r)))),s=s.next((()=>{!function(t){t.createObjectStore("clientMetadata",{keyPath:"clientId"})}(t)}))),n<5&&i>=5&&(s=s.next((()=>this.Ys(r)))),n<6&&i>=6&&(s=s.next((()=>(function(t){t.createObjectStore("remoteDocumentGlobal")}(t),this.Xs(r))))),n<7&&i>=7&&(s=s.next((()=>this.Zs(r)))),n<8&&i>=8&&(s=s.next((()=>this.ti(t,r)))),n<9&&i>=9&&(s=s.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t)}))),n<10&&i>=10&&(s=s.next((()=>this.ei(r)))),n<11&&i>=11&&(s=s.next((()=>{!function(t){t.createObjectStore("bundles",{keyPath:"bundleId"})}(t),function(t){t.createObjectStore("namedQueries",{keyPath:"name"})}(t)}))),n<12&&i>=12&&(s=s.next((()=>{!function(t){const e=t.createObjectStore("documentOverlays",{keyPath:Nt});e.createIndex("collectionPathOverlayIndex",Lt,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",Ft,{unique:!1})}(t)}))),n<13&&i>=13&&(s=s.next((()=>function(t){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:Et});e.createIndex("documentKeyIndex",Tt),e.createIndex("collectionGroupIndex",kt)}(t))).next((()=>this.ni(t,r))).next((()=>t.deleteObjectStore("remoteDocuments")))),n<14&&i>=14&&(s=s.next((()=>this.si(t,r)))),n<15&&i>=15&&(s=s.next((()=>function(t){t.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),t.createObjectStore("indexState",{keyPath:Mt}).createIndex("sequenceNumberIndex",Ot,{unique:!1}),t.createObjectStore("indexEntries",{keyPath:Pt}).createIndex("documentKeyIndex",Rt,{unique:!1})}(t)))),s}Xs(t){let e=0;return t.store("remoteDocuments").X(((t,n)=>{e+=bs(n)})).next((()=>{const n={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Ys(t){const e=t.store("mutationQueues"),n=t.store("mutations");return e.j().next((e=>et.forEach(e,(e=>{const i=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.j("userMutationsIndex",i).next((n=>et.forEach(n,(n=>{b(n.userId===e.userId);const i=Ar(this.serializer,n);return vs(t,e.userId,i).next((()=>{}))}))))}))))}Zs(t){const e=t.store("targetDocuments"),n=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next((t=>{const i=[];return n.X(((n,r)=>{const s=new U(n),o=function(t){return[0,mt(t)]}(s);i.push(e.get(o).next((n=>n?et.resolve():(n=>e.put({targetId:0,path:mt(n),sequenceNumber:t.highestListenSequenceNumber}))(s))))})).next((()=>et.waitFor(i)))}))}ti(t,e){t.createObjectStore("collectionParents",{keyPath:Dt});const n=e.store("collectionParents"),i=new cs,r=t=>{if(i.add(t)){const e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:mt(i)})}};return e.store("remoteDocuments").X({Y:!0},((t,e)=>{const n=new U(t);return r(n.popLast())})).next((()=>e.store("documentMutations").X({Y:!0},(([t,e,n],i)=>{const s=bt(e);return r(s.popLast())}))))}ei(t){const e=t.store("targets");return e.X(((t,n)=>{const i=Dr(n),r=Mr(this.serializer,i);return e.put(r)}))}ni(t,e){const n=e.store("remoteDocuments"),i=[];return n.X(((t,n)=>{const r=e.store("remoteDocumentsV14"),s=(o=n,o.document?new q(U.fromString(o.document.name).popFirst(5)):o.noDocument?q.fromSegments(o.noDocument.path):o.unknownDocument?q.fromSegments(o.unknownDocument.path):v()).path.toArray();var o;const a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};i.push(r.put(a))})).next((()=>et.waitFor(i)))}si(t,e){const n=e.store("mutations"),i=Vs(this.serializer),r=new eo(io.zs,this.serializer.fe);return n.j().next((t=>{const n=new Map;return t.forEach((t=>{var e;let i=null!==(e=n.get(t.userId))&&void 0!==e?e:zn();Ar(this.serializer,t).keys().forEach((t=>i=i.add(t))),n.set(t.userId,i)})),et.forEach(n,((t,n)=>{const s=new u(n),o=Br.de(this.serializer,s),a=r.getIndexManager(s),c=ws.de(s,this.serializer,a,r.referenceDelegate);return new Ks(i,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new qt(e,ft.ct),t).next()}))}))}}function so(t){t.createObjectStore("targetDocuments",{keyPath:Ct}).createIndex("documentTargetsIndex",At,{unique:!0}),t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",St,{unique:!0}),t.createObjectStore("targetGlobal")}const oo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class ao{constructor(t,e,n,i,r,s,o,a,c,l,u=15){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.ii=r,this.window=s,this.document=o,this.ri=c,this.oi=l,this.ui=u,this.Os=null,this.Fs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.ai=null,this.hi=null,this.li=Number.NEGATIVE_INFINITY,this.fi=t=>Promise.resolve(),!ao.D())throw new x(_.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Rs(this,i),this.di=e+"main",this.serializer=new Er(a),this.wi=new it(this.di,this.ui,new ro(this.serializer)),this.Bs=new ks(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Vs(this.serializer),this.qs=new Lr,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===l&&g("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(_.FAILED_PRECONDITION,oo);return this.gi(),this.yi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.Bs.getHighestSequenceNumber(t)))})).then((t=>{this.Os=new ft(t,this.ri)})).then((()=>{this.Fs=!0})).catch((t=>(this.wi&&this.wi.close(),Promise.reject(t))))}Ii(t){return this.fi=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.wi.B((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.ii.enqueueAndForget((async()=>{this.started&&await this.mi()})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>lo(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Ti(t).next((t=>{t||(this.isPrimary=!1,this.ii.enqueueRetryable((()=>this.fi(!1))))}))})).next((()=>this.Ei(t))).next((e=>this.isPrimary&&!e?this.Ai(t).next((()=>!1)):!!e&&this.vi(t).next((()=>!0)))))).catch((t=>{if(ot(t))return p("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return p("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.ii.enqueueRetryable((()=>this.fi(t))),this.isPrimary=t}))}Ti(t){return co(t).get("owner").next((t=>et.resolve(this.Ri(t))))}Pi(t){return lo(t).delete(this.clientId)}async bi(){if(this.isPrimary&&!this.Vi(this.li,18e5)){this.li=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=$t(t,"clientMetadata");return e.j().next((t=>{const n=this.Si(t,18e5),i=t.filter((t=>-1===n.indexOf(t)));return et.forEach(i,(t=>e.delete(t.clientId))).next((()=>i))}))})).catch((()=>[]));if(this._i)for(const e of t)this._i.removeItem(this.Di(e.clientId))}}pi(){this.hi=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.mi().then((()=>this.bi())).then((()=>this.pi()))))}Ri(t){return!!t&&t.ownerId===this.clientId}Ei(t){return this.oi?et.resolve(!0):co(t).get("owner").next((e=>{if(null!==e&&this.Vi(e.leaseTimestampMs,5e3)&&!this.Ci(e.ownerId)){if(this.Ri(e)&&this.networkEnabled)return!0;if(!this.Ri(e)){if(!e.allowTabSynchronization)throw new x(_.FAILED_PRECONDITION,oo);return!1}}return!(!this.networkEnabled||!this.inForeground)||lo(t).j().next((t=>void 0===this.Si(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,i=this.networkEnabled===t.networkEnabled;if(e||n&&i)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&p("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.Fs=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Ni(),this.ki(),await this.wi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(t=>{const e=new qt(t,ft.ct);return this.Ai(e).next((()=>this.Pi(e)))})),this.wi.close(),this.Mi()}Si(t,e){return t.filter((t=>this.Vi(t.updateTimeMs,e)&&!this.Ci(t.clientId)))}$i(){return this.runTransaction("getActiveClients","readonly",(t=>lo(t).j().next((t=>this.Si(t,18e5).map((t=>t.clientId))))))}get started(){return this.Fs}getMutationQueue(t,e){return ws.de(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new us(t,this.serializer.fe.databaseId)}getDocumentOverlayCache(t){return Br.de(this.serializer,t)}getBundleCache(){return this.qs}runTransaction(t,e,n){p("IndexedDbPersistence","Starting transaction:",t);const i="readonly"===e?"readonly":"readwrite",r=15===(s=this.ui)?zt:14===s?jt:13===s?Ut:12===s?Bt:11===s?Vt:void v();var s;let o;return this.wi.runTransaction(t,i,r,(i=>(o=new qt(i,this.Os?this.Os.next():ft.ct),"readwrite-primary"===e?this.Ti(o).next((t=>!!t||this.Ei(o))).next((e=>{if(!e)throw g(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.ii.enqueueRetryable((()=>this.fi(!1))),new x(_.FAILED_PRECONDITION,J);return n(o)})).next((t=>this.vi(o).next((()=>t)))):this.Oi(o).next((()=>n(o)))))).then((t=>(o.raiseOnCommittedEvent(),t)))}Oi(t){return co(t).get("owner").next((t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)&&!this.Ri(t)&&!(this.oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new x(_.FAILED_PRECONDITION,oo)}))}vi(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return co(t).put("owner",e)}static D(){return it.D()}Ai(t){const e=co(t);return e.get("owner").next((t=>this.Ri(t)?(p("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):et.resolve()))}Vi(t,e){const n=Date.now();return!(t<n-e||t>n&&(g(`Detected an update time that is in the future: ${t} > ${n}`),1))}gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ai=()=>{this.ii.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.mi())))},this.document.addEventListener("visibilitychange",this.ai),this.inForeground="visible"===this.document.visibilityState)}Ni(){this.ai&&(this.document.removeEventListener("visibilitychange",this.ai),this.ai=null)}yi(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ci=()=>{this.xi();const t=/(?:Version|Mobile)\/1[456]/;(0,o.nr)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ii.enterRestrictedMode(!0),this.ii.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ci))}ki(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Ci(t){var e;try{const n=null!==(null===(e=this._i)||void 0===e?void 0:e.getItem(this.Di(t)));return p("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return g("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}xi(){if(this._i)try{this._i.setItem(this.Di(this.clientId),String(Date.now()))}catch(t){g("Failed to set zombie client id.",t)}}Mi(){if(this._i)try{this._i.removeItem(this.Di(this.clientId))}catch(t){}}Di(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function co(t){return $t(t,"owner")}function lo(t){return $t(t,"clientMetadata")}class uo{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Fi=n,this.Bi=i}static Li(t,e){let n=zn(),i=zn();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:i=i.add(t.doc.key)}return new uo(t,e.fromCache,n,i)}}class ho{constructor(){this.qi=!1}initialize(t,e){this.Ui=t,this.indexManager=e,this.qi=!0}getDocumentsMatchingQuery(t,e,n,i){return this.Ki(t,e).next((r=>r||this.Gi(t,e,i,n))).next((n=>n||this.Qi(t,e)))}Ki(t,e){if(yn(e))return et.resolve(null);let n=xn(e);return this.indexManager.getIndexType(t,n).next((i=>0===i?null:(null!==e.limit&&1===i&&(e=En(e,null,"F"),n=xn(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((i=>{const r=zn(...i);return this.Ui.getDocuments(t,r).next((i=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.ji(e,i);return this.zi(e,s,r,n.readTime)?this.Ki(t,En(e,null,"F")):this.Wi(t,s,e,n)}))))})))))}Gi(t,e,n,i){return yn(e)||i.isEqual(V.min())?this.Qi(t,e):this.Ui.getDocuments(t,n).next((r=>{const o=this.ji(e,r);return this.zi(e,o,n,i)?this.Qi(t,e):(f()<=s.$b.DEBUG&&p("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Sn(e)),this.Wi(t,o,e,function(t,e){const n=t.toTimestamp().seconds,i=t.toTimestamp().nanoseconds+1,r=V.fromTimestamp(1e9===i?new F(n+1,0):new F(n,i));return new Y(r,q.empty(),e)}(i,-1)))}))}ji(t,e){let n=new Xt(An(t));return e.forEach(((e,i)=>{Cn(t,i)&&(n=n.add(i))})),n}zi(t,e,n,i){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const r="F"===t.limitType?e.last():e.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Qi(t,e){return f()<=s.$b.DEBUG&&p("QueryEngine","Using full collection scan to execute query:",Sn(e)),this.Ui.getDocumentsMatchingQuery(t,e,Y.min())}Wi(t,e,n,i){return this.Ui.getDocumentsMatchingQuery(t,n,i).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class fo{constructor(t,e,n,i){this.persistence=t,this.Hi=e,this.serializer=i,this.Ji=new Wt(R),this.Yi=new Mn((t=>ln(t)),un),this.Xi=new Map,this.Zi=t.getRemoteDocumentCache(),this.Bs=t.getTargetCache(),this.qs=t.getBundleCache(),this.tr(n)}tr(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Ks(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ji)))}}function po(t,e,n,i){return new fo(t,e,n,i)}async function go(t,e){const n=w(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let i;return n.mutationQueue.getAllMutationBatches(t).next((r=>(i=r,n.tr(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const r=[],s=[];let o=zn();for(const t of i){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({er:t,removedBatchIds:r,addedBatchIds:s})))}))}))}function mo(t){const e=w(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Bs.getLastRemoteSnapshotVersion(t)))}function yo(t,e){const n=w(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function vo(t,e,n){const i=w(t),r=i.Ji.get(e),s=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",s,(t=>i.persistence.referenceDelegate.removeTarget(t,r)))}catch(t){if(!ot(t))throw t;p("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}i.Ji=i.Ji.remove(e),i.Yi.delete(r.target)}function bo(t,e,n){const i=w(t);let r=V.min(),s=zn();return i.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const i=w(t),r=i.Yi.get(n);return void 0!==r?et.resolve(i.Ji.get(r)):i.Bs.getTargetData(e,n)}(i,t,xn(e)).next((e=>{if(e)return r=e.lastLimboFreeSnapshotVersion,i.Bs.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>i.Hi.getDocumentsMatchingQuery(t,e,n?r:V.min(),n?s:zn()))).next((t=>(function(t,e,n){let i=t.Xi.get(e)||V.min();n.forEach(((t,e)=>{e.readTime.compareTo(i)>0&&(i=e.readTime)})),t.Xi.set(e,i)}(i,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,ir:s})))))}class wo{constructor(){this.activeTargetIds=qn}lr(t){this.activeTargetIds=this.activeTargetIds.add(t)}dr(t){this.activeTargetIds=this.activeTargetIds.delete(t)}hr(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class _o{constructor(){this.Hr=new wo,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Hr.lr(t),this.Jr[t]||"not-current"}updateQueryState(t,e,n){this.Jr[t]=e}removeLocalQueryTarget(t){this.Hr.dr(t)}isLocalQueryTarget(t){return this.Hr.activeTargetIds.has(t)}clearQueryState(t){delete this.Jr[t]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(t){return this.Hr.activeTargetIds.has(t)}start(){return this.Hr=new wo,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class xo{Yr(t){}shutdown(){}}class Io{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(t){this.so.push(t)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){p("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.so)t(0)}no(){p("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.so)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Eo=null;function To(){return null===Eo?Eo=268435456+Math.round(2147483648*Math.random()):Eo++,"0x"+Eo.toString(16)}const ko={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class So{constructor(t){this.ro=t.ro,this.oo=t.oo}uo(t){this.co=t}ao(t){this.ho=t}onMessage(t){this.lo=t}close(){this.oo()}send(t){this.ro(t)}fo(){this.co()}wo(t){this.ho(t)}_o(t){this.lo(t)}}const Co="WebChannelConnection";class Ao extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.mo=e+"://"+t.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(t,e,n,i,r){const s=To(),o=this.To(t,e);p("RestConnection",`Sending RPC '${t}' ${s}:`,o,n);const a={};return this.Eo(a,i,r),this.Ao(t,o,a,n).then((e=>(p("RestConnection",`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw m("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}vo(t,e,n,i,r,s){return this.Io(t,e,n,i,r)}Eo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+h,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}To(t,e){const n=ko[t];return`${this.mo}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Ao(t,e,n,i){const r=To();return new Promise(((s,o)=>{const c=new a.ZS;c.setWithCredentials(!0),c.listenOnce(a.Bx.COMPLETE,(()=>{try{switch(c.getLastErrorCode()){case a.O4.NO_ERROR:const e=c.getResponseJson();p(Co,`XHR for RPC '${t}' ${r} received:`,JSON.stringify(e)),s(e);break;case a.O4.TIMEOUT:p(Co,`RPC '${t}' ${r} timed out`),o(new x(_.DEADLINE_EXCEEDED,"Request time out"));break;case a.O4.HTTP_ERROR:const n=c.getStatus();if(p(Co,`RPC '${t}' ${r} failed with status:`,n,"response text:",c.getResponseText()),n>0){let t=c.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(_).indexOf(e)>=0?e:_.UNKNOWN}(e.status);o(new x(t,e.message))}else o(new x(_.UNKNOWN,"Server responded with status "+c.getStatus()))}else o(new x(_.UNAVAILABLE,"Connection failed."));break;default:v()}}finally{p(Co,`RPC '${t}' ${r} completed.`)}}));const l=JSON.stringify(i);p(Co,`RPC '${t}' ${r} sending request:`,i),c.send(e,"POST",l,n,15)}))}Ro(t,e,n){const i=To(),r=[this.mo,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=(0,a.fF)(),o=(0,a.Ao)(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(c.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(c.xmlHttpFactory=new a._L({})),this.Eo(c.initMessageHeaders,e,n),c.encodeInitMessageHeaders=!0;const u=r.join("");p(Co,`Creating RPC '${t}' stream ${i}: ${u}`,c);const h=s.createWebChannel(u,c);let d=!1,f=!1;const g=new So({ro:e=>{f?p(Co,`Not sending because RPC '${t}' stream ${i} is closed:`,e):(d||(p(Co,`Opening RPC '${t}' stream ${i} transport.`),h.open(),d=!0),p(Co,`RPC '${t}' stream ${i} sending:`,e),h.send(e))},oo:()=>h.close()}),y=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return y(h,a.iO.EventType.OPEN,(()=>{f||p(Co,`RPC '${t}' stream ${i} transport opened.`)})),y(h,a.iO.EventType.CLOSE,(()=>{f||(f=!0,p(Co,`RPC '${t}' stream ${i} transport closed`),g.wo())})),y(h,a.iO.EventType.ERROR,(e=>{f||(f=!0,m(Co,`RPC '${t}' stream ${i} transport errored:`,e),g.wo(new x(_.UNAVAILABLE,"The operation could not be completed")))})),y(h,a.iO.EventType.MESSAGE,(e=>{var n;if(!f){const r=e.data[0];b(!!r);const s=r,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){p(Co,`RPC '${t}' stream ${i} received error:`,o);const e=o.status;let n=function(t){const e=ki[t];if(void 0!==e)return Ci(e)}(e),r=o.message;void 0===n&&(n=_.INTERNAL,r="Unknown error status: "+e+" with message "+o.message),f=!0,g.wo(new x(n,r)),h.close()}else p(Co,`RPC '${t}' stream ${i} received:`,r),g._o(r)}})),y(o,a.Jh.STAT_EVENT,(e=>{e.stat===a.ro.PROXY?p(Co,`RPC '${t}' stream ${i} detected buffering proxy`):e.stat===a.ro.NOPROXY&&p(Co,`RPC '${t}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{g.fo()}),0),g}}function Do(){return"undefined"!=typeof document?document:null}function Mo(t){return new Wi(t,!0)}class Oo{constructor(t,e,n=1e3,i=1.5,r=6e4){this.ii=t,this.timerId=e,this.Po=n,this.bo=i,this.Vo=r,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(t){this.cancel();const e=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),i=Math.max(0,e-n);i>0&&p("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.So} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,i,(()=>(this.Co=Date.now(),t()))),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class Po{constructor(t,e,n,i,r,s,o,a){this.ii=t,this.$o=n,this.Oo=i,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new Oo(t,e)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,(()=>this.zo())))}Wo(t){this.Ho(),this.stream.send(t)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(t,e){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==t?this.qo.reset():e&&e.code===_.RESOURCE_EXHAUSTED?(g(e.toString()),g("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):e&&e.code===_.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.ao(e)}Yo(){}auth(){this.state=1;const t=this.Xo(this.Fo),e=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Fo===e&&this.Zo(t,n)}),(e=>{t((()=>{const t=new x(_.UNKNOWN,"Fetching auth token failed: "+e.message);return this.tu(t)}))}))}Zo(t,e){const n=this.Xo(this.Fo);this.stream=this.eu(t,e),this.stream.uo((()=>{n((()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,(()=>(this.Ko()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.ao((t=>{n((()=>this.tu(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Go(){this.state=5,this.qo.No((async()=>{this.state=0,this.start()}))}tu(t){return p("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Xo(t){return e=>{this.ii.enqueueAndForget((()=>this.Fo===t?e():(p("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ro extends Po{constructor(t,e,n,i,r,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,s),this.serializer=r}eu(t,e){return this.connection.Ro("Listen",t,e)}onMessage(t){this.qo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const i=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:v()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(b(void 0===e||"string"==typeof e),ne.fromBase64String(e||"")):(b(void 0===e||e instanceof Uint8Array),ne.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?_.UNKNOWN:Ci(t.code);return new x(e,t.message||"")}(o);n=new Ui(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const r=ir(t,i.document.name),s=Zi(i.document.updateTime),o=i.document.createTime?Zi(i.document.createTime):V.min(),a=new Pe({mapValue:{fields:i.document.fields}}),c=Ne.newFoundDocument(r,s,o,a),l=i.targetIds||[],u=i.removedTargetIds||[];n=new Vi(l,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const r=ir(t,i.document),s=i.readTime?Zi(i.readTime):V.min(),o=Ne.newNoDocument(r,s),a=i.removedTargetIds||[];n=new Vi([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const r=ir(t,i.document),s=i.removedTargetIds||[];n=new Vi([],s,r,null)}else{if(!("filter"in e))return v();{e.filter;const t=e.filter;t.targetId;const{count:i=0,unchangedNames:r}=t,s=new Ti(i,r),o=t.targetId;n=new Bi(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return V.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?V.min():e.readTime?Zi(e.readTime):V.min()}(t);return this.listener.nu(e,n)}su(t){const e={};e.database=or(this.serializer),e.addTarget=function(t,e){let n;const i=e.target;if(n=hn(i)?{documents:hr(t,i)}:{query:dr(t,i)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=Xi(t,e.resumeToken);const i=Qi(t,e.expectedCount);null!==i&&(n.expectedCount=i)}else if(e.snapshotVersion.compareTo(V.min())>0){n.readTime=Yi(t,e.snapshotVersion.toTimestamp());const i=Qi(t,e.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return v()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.Wo(e)}iu(t){const e={};e.database=or(this.serializer),e.removeTarget=t,this.Wo(e)}}class No extends Po{constructor(t,e,n,i,r,s){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,s),this.serializer=r,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(t,e){return this.connection.Ro("Write",t,e)}onMessage(t){if(b(!!t.streamToken),this.lastStreamToken=t.streamToken,this.ru){this.qo.reset();const e=function(t,e){return t&&t.length>0?(b(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Zi(t.updateTime):Zi(e);return n.isEqual(V.min())&&(n=Zi(e)),new oi(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Zi(t.commitTime);return this.listener.cu(n,e)}return b(!t.writeResults||0===t.writeResults.length),this.ru=!0,this.listener.au()}hu(){const t={};t.database=or(this.serializer),this.Wo(t)}uu(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>lr(this.serializer,t)))};this.Wo(e)}}class Lo extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.lu=!1}fu(){if(this.lu)throw new x(_.FAILED_PRECONDITION,"The client has already been terminated.")}Io(t,e,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.connection.Io(t,e,n,i,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new x(_.UNKNOWN,t.toString())}))}vo(t,e,n,i){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,s])=>this.connection.vo(t,e,n,r,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new x(_.UNKNOWN,t.toString())}))}terminate(){this.lu=!0}}class Fo{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve()))))}Iu(t){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.yu("Offline")))}set(t){this.Tu(),this.wu=0,"Online"===t&&(this.mu=!1),this.yu(t)}yu(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}pu(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(g(e),this.mu=!1):p("OnlineStateTracker",e)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class Vo{constructor(t,e,n,i,r){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=r,this.Pu.Yr((t=>{n.enqueueAndForget((async()=>{Go(this)&&(p("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=w(t);e.vu.add(4),await Uo(e),e.bu.set("Unknown"),e.vu.delete(4),await Bo(e)}(this))}))})),this.bu=new Fo(n,i)}}async function Bo(t){if(Go(t))for(const e of t.Ru)await e(!0)}async function Uo(t){for(const e of t.Ru)await e(!1)}function jo(t,e){const n=w(t);n.Au.has(e.targetId)||(n.Au.set(e.targetId,e),Ko(n)?Ho(n):ua(n).Ko()&&qo(n,e))}function zo(t,e){const n=w(t),i=ua(n);n.Au.delete(e),i.Ko()&&$o(n,e),0===n.Au.size&&(i.Ko()?i.jo():Go(n)&&n.bu.set("Unknown"))}function qo(t,e){if(t.Vu.qt(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(V.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}ua(t).su(e)}function $o(t,e){t.Vu.qt(e),ua(t).iu(e)}function Ho(t){t.Vu=new zi({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),le:e=>t.Au.get(e)||null,ue:()=>t.datastore.serializer.databaseId}),ua(t).start(),t.bu.gu()}function Ko(t){return Go(t)&&!ua(t).Uo()&&t.Au.size>0}function Go(t){return 0===w(t).vu.size}function Wo(t){t.Vu=void 0}async function Qo(t){t.Au.forEach(((e,n)=>{qo(t,e)}))}async function Yo(t,e){Wo(t),Ko(t)?(t.bu.Iu(e),Ho(t)):t.bu.set("Unknown")}async function Xo(t,e,n){if(t.bu.set("Online"),e instanceof Ui&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const i of e.targetIds)t.Au.has(i)&&(await t.remoteSyncer.rejectListen(i,n),t.Au.delete(i),t.Vu.removeTarget(i))}(t,e)}catch(n){p("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Jo(t,n)}else if(e instanceof Vi?t.Vu.Ht(e):e instanceof Bi?t.Vu.ne(e):t.Vu.Xt(e),!n.isEqual(V.min()))try{const e=await mo(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Vu.ce(e);return n.targetChanges.forEach(((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const r=t.Au.get(i);r&&t.Au.set(i,r.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const i=t.Au.get(e);if(!i)return;t.Au.set(e,i.withResumeToken(ne.EMPTY_BYTE_STRING,i.snapshotVersion)),$o(t,e);const r=new Ir(i.target,e,n,i.sequenceNumber);qo(t,r)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){p("RemoteStore","Failed to raise snapshot:",e),await Jo(t,e)}}async function Jo(t,e,n){if(!ot(e))throw e;t.vu.add(1),await Uo(t),t.bu.set("Offline"),n||(n=()=>mo(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{p("RemoteStore","Retrying IndexedDB access"),await n(),t.vu.delete(1),await Bo(t)}))}function Zo(t,e){return e().catch((n=>Jo(t,n,e)))}async function ta(t){const e=w(t),n=ha(e);let i=e.Eu.length>0?e.Eu[e.Eu.length-1].batchId:-1;for(;ea(e);)try{const t=await yo(e.localStore,i);if(null===t){0===e.Eu.length&&n.jo();break}i=t.batchId,na(e,t)}catch(t){await Jo(e,t)}ia(e)&&ra(e)}function ea(t){return Go(t)&&t.Eu.length<10}function na(t,e){t.Eu.push(e);const n=ha(t);n.Ko()&&n.ou&&n.uu(e.mutations)}function ia(t){return Go(t)&&!ha(t).Uo()&&t.Eu.length>0}function ra(t){ha(t).start()}async function sa(t){ha(t).hu()}async function oa(t){const e=ha(t);for(const n of t.Eu)e.uu(n.mutations)}async function aa(t,e,n){const i=t.Eu.shift(),r=Ii.from(i,e,n);await Zo(t,(()=>t.remoteSyncer.applySuccessfulWrite(r))),await ta(t)}async function ca(t,e){e&&ha(t).ou&&await async function(t,e){if(function(t){switch(t){default:return v();case _.CANCELLED:case _.UNKNOWN:case _.DEADLINE_EXCEEDED:case _.RESOURCE_EXHAUSTED:case _.INTERNAL:case _.UNAVAILABLE:case _.UNAUTHENTICATED:return!1;case _.INVALID_ARGUMENT:case _.NOT_FOUND:case _.ALREADY_EXISTS:case _.PERMISSION_DENIED:case _.FAILED_PRECONDITION:case _.ABORTED:case _.OUT_OF_RANGE:case _.UNIMPLEMENTED:case _.DATA_LOSS:return!0}}(n=e.code)&&n!==_.ABORTED){const n=t.Eu.shift();ha(t).Qo(),await Zo(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await ta(t)}var n}(t,e),ia(t)&&ra(t)}async function la(t,e){const n=w(t);n.asyncQueue.verifyOperationInProgress(),p("RemoteStore","RemoteStore received new credentials");const i=Go(n);n.vu.add(3),await Uo(n),i&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.vu.delete(3),await Bo(n)}function ua(t){return t.Su||(t.Su=function(t,e,n){const i=w(t);return i.fu(),new Ro(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(t.datastore,t.asyncQueue,{uo:Qo.bind(null,t),ao:Yo.bind(null,t),nu:Xo.bind(null,t)}),t.Ru.push((async e=>{e?(t.Su.Qo(),Ko(t)?Ho(t):t.bu.set("Unknown")):(await t.Su.stop(),Wo(t))}))),t.Su}function ha(t){return t.Du||(t.Du=function(t,e,n){const i=w(t);return i.fu(),new No(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(t.datastore,t.asyncQueue,{uo:sa.bind(null,t),ao:ca.bind(null,t),au:oa.bind(null,t),cu:aa.bind(null,t)}),t.Ru.push((async e=>{e?(t.Du.Qo(),await ta(t)):(await t.Du.stop(),t.Eu.length>0&&(p("RemoteStore",`Stopping write stream with ${t.Eu.length} pending writes`),t.Eu=[]))}))),t.Du}class da{constructor(t,e,n,i,r){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new I,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,i,r){const s=Date.now()+n,o=new da(t,e,s,i,r);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new x(_.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function fa(t,e){if(g("AsyncQueue",`${e}: ${t}`),ot(t))return new x(_.UNAVAILABLE,`${e}: ${t}`);throw t}class pa{constructor(t){this.comparator=t?(e,n)=>t(e,n)||q.comparator(e.key,n.key):(t,e)=>q.comparator(t.key,e.key),this.keyedMap=Nn(),this.sortedSet=new Wt(this.comparator)}static emptySet(t){return new pa(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof pa))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(!t.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new pa;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class ga{constructor(){this.Cu=new Wt(q.comparator)}track(t){const e=t.doc.key,n=this.Cu.get(e);n?0!==t.type&&3===n.type?this.Cu=this.Cu.insert(e,t):3===t.type&&1!==n.type?this.Cu=this.Cu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Cu=this.Cu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Cu=this.Cu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Cu=this.Cu.remove(e):1===t.type&&2===n.type?this.Cu=this.Cu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Cu=this.Cu.insert(e,{type:2,doc:t.doc}):v():this.Cu=this.Cu.insert(e,t)}xu(){const t=[];return this.Cu.inorderTraversal(((e,n)=>{t.push(n)})),t}}class ma{constructor(t,e,n,i,r,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,i,r){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new ma(t,e,pa.emptySet(e),s,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Tn(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class ya{constructor(){this.Nu=void 0,this.listeners=[]}}class va{constructor(){this.queries=new Mn((t=>kn(t)),Tn),this.onlineState="Unknown",this.ku=new Set}}async function ba(t,e){const n=w(t),i=e.query;let r=!1,s=n.queries.get(i);if(s||(r=!0,s=new ya),r)try{s.Nu=await n.onListen(i)}catch(t){const n=fa(t,`Initialization of query '${Sn(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,s),s.listeners.push(e),e.Mu(n.onlineState),s.Nu&&e.$u(s.Nu)&&Ia(n)}async function wa(t,e){const n=w(t),i=e.query;let r=!1;const s=n.queries.get(i);if(s){const t=s.listeners.indexOf(e);t>=0&&(s.listeners.splice(t,1),r=0===s.listeners.length)}if(r)return n.queries.delete(i),n.onUnlisten(i)}function _a(t,e){const n=w(t);let i=!1;for(const t of e){const e=t.query,r=n.queries.get(e);if(r){for(const e of r.listeners)e.$u(t)&&(i=!0);r.Nu=t}}i&&Ia(n)}function xa(t,e,n){const i=w(t),r=i.queries.get(e);if(r)for(const t of r.listeners)t.onError(n);i.queries.delete(e)}function Ia(t){t.ku.forEach((t=>{t.next()}))}class Ea{constructor(t,e,n){this.query=t,this.Ou=e,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new ma(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Fu?this.Lu(t)&&(this.Ou.next(t),e=!0):this.qu(t,this.onlineState)&&(this.Uu(t),e=!0),this.Bu=t,e}onError(t){this.Ou.error(t)}Mu(t){this.onlineState=t;let e=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,t)&&(this.Uu(this.Bu),e=!0),e}qu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.Ku||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Lu(t){if(t.docChanges.length>0)return!0;const e=this.Bu&&this.Bu.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Uu(t){t=ma.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Fu=!0,this.Ou.next(t)}}class Ta{constructor(t){this.key=t}}class ka{constructor(t){this.key=t}}class Sa{constructor(t,e){this.query=t,this.Yu=e,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=zn(),this.mutatedKeys=zn(),this.tc=An(t),this.ec=new pa(this.tc)}get nc(){return this.Yu}sc(t,e){const n=e?e.ic:new ga,i=e?e.ec:this.ec;let r=e?e.mutatedKeys:this.mutatedKeys,s=i,o=!1;const a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(((t,e)=>{const l=i.get(t),u=Cn(this.query,e)?e:null,h=!!l&&this.mutatedKeys.has(l.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;l&&u?l.data.isEqual(u.data)?h!==d&&(n.track({type:3,doc:u}),f=!0):this.rc(l,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.tc(u,a)>0||c&&this.tc(u,c)<0)&&(o=!0)):!l&&u?(n.track({type:0,doc:u}),f=!0):l&&!u&&(n.track({type:1,doc:l}),f=!0,(a||c)&&(o=!0)),f&&(u?(s=s.add(u),r=d?r.add(t):r.delete(t)):(s=s.delete(t),r=r.delete(t)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),r=r.delete(t.key),n.track({type:1,doc:t})}return{ec:s,ic:n,zi:o,mutatedKeys:r}}rc(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const i=this.ec;this.ec=t.ec,this.mutatedKeys=t.mutatedKeys;const r=t.ic.xu();r.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return v()}};return n(t)-n(e)}(t.type,e.type)||this.tc(t.doc,e.doc))),this.oc(n);const s=e?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return this.Xu=o,0!==r.length||a?{snapshot:new ma(this.query,t.ec,i,r,t.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:s}:{cc:s}}Mu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({ec:this.ec,ic:new ga,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(t){return!this.Yu.has(t)&&!!this.ec.has(t)&&!this.ec.get(t).hasLocalMutations}oc(t){t&&(t.addedDocuments.forEach((t=>this.Yu=this.Yu.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Yu=this.Yu.delete(t))),this.current=t.current)}uc(){if(!this.current)return[];const t=this.Zu;this.Zu=zn(),this.ec.forEach((t=>{this.ac(t.key)&&(this.Zu=this.Zu.add(t.key))}));const e=[];return t.forEach((t=>{this.Zu.has(t)||e.push(new ka(t))})),this.Zu.forEach((n=>{t.has(n)||e.push(new Ta(n))})),e}hc(t){this.Yu=t.ir,this.Zu=zn();const e=this.sc(t.documents);return this.applyChanges(e,!0)}lc(){return ma.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class Ca{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Aa{constructor(t){this.key=t,this.fc=!1}}class Da{constructor(t,e,n,i,r,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.dc={},this.wc=new Mn((t=>kn(t)),Tn),this._c=new Map,this.mc=new Set,this.gc=new Wt(q.comparator),this.yc=new Map,this.Ic=new Qs,this.Tc={},this.Ec=new Map,this.Ac=Ts.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function Ma(t,e){const n=function(t){const e=w(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Pa.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ga.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Na.bind(null,e),e.dc.nu=_a.bind(null,e.eventManager),e.dc.Pc=xa.bind(null,e.eventManager),e}(t);let i,r;const s=n.wc.get(e);if(s)i=s.targetId,n.sharedClientState.addLocalQueryTarget(i),r=s.view.lc();else{const t=await function(t,e){const n=w(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let i;return n.Bs.getTargetData(t,e).next((r=>r?(i=r,et.resolve(i)):n.Bs.allocateTargetId(t).next((r=>(i=new Ir(e,r,"TargetPurposeListen",t.currentSequenceNumber),n.Bs.addTargetData(t,i).next((()=>i)))))))})).then((t=>{const i=n.Ji.get(t.targetId);return(null===i||t.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(t.targetId,t),n.Yi.set(e,t.targetId)),t}))}(n.localStore,xn(e)),s=n.sharedClientState.addLocalQueryTarget(t.targetId);i=t.targetId,r=await async function(t,e,n,i,r){t.Rc=(e,n,i)=>async function(t,e,n,i){let r=e.view.sc(n);r.zi&&(r=await bo(t.localStore,e.query,!1).then((({documents:t})=>e.view.sc(t,r))));const s=i&&i.targetChanges.get(e.targetId),o=e.view.applyChanges(r,t.isPrimaryClient,s);return za(t,e.targetId,o.cc),o.snapshot}(t,e,n,i);const s=await bo(t.localStore,e,!0),o=new Sa(e,s.ir),a=o.sc(s.documents),c=Fi.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==t.onlineState,r),l=o.applyChanges(a,t.isPrimaryClient,c);za(t,n,l.cc);const u=new Ca(e,n,o);return t.wc.set(e,u),t._c.has(n)?t._c.get(n).push(e):t._c.set(n,[e]),l.snapshot}(n,e,i,"current"===s,t.resumeToken),n.isPrimaryClient&&jo(n.remoteStore,t)}return r}async function Oa(t,e){const n=w(t),i=n.wc.get(e),r=n._c.get(i.targetId);if(r.length>1)return n._c.set(i.targetId,r.filter((t=>!Tn(t,e)))),void n.wc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await vo(n.localStore,i.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(i.targetId),zo(n.remoteStore,i.targetId),Ua(n,i.targetId)})).catch(tt)):(Ua(n,i.targetId),await vo(n.localStore,i.targetId,!0))}async function Pa(t,e){const n=w(t);try{const t=await function(t,e){const n=w(t),i=e.snapshotVersion;let r=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.Zi.newChangeBuffer({trackRemovals:!0});r=n.Ji;const o=[];e.targetChanges.forEach(((s,a)=>{const c=r.get(a);if(!c)return;o.push(n.Bs.removeMatchingKeys(t,s.removedDocuments,a).next((()=>n.Bs.addMatchingKeys(t,s.addedDocuments,a))));let l=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?l=l.withResumeToken(ne.EMPTY_BYTE_STRING,V.min()).withLastLimboFreeSnapshotVersion(V.min()):s.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(s.resumeToken,i)),r=r.insert(a,l),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,l,s)&&o.push(n.Bs.updateTargetData(t,l))}));let a=Pn(),c=zn();if(e.documentUpdates.forEach((i=>{e.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,i))})),o.push(function(t,e,n){let i=zn(),r=zn();return n.forEach((t=>i=i.add(t))),e.getEntries(t,i).next((t=>{let i=Pn();return n.forEach(((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(n)),s.isNoDocument()&&s.version.isEqual(V.min())?(e.removeEntry(n,s.readTime),i=i.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),i=i.insert(n,s)):p("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{nr:i,sr:r}}))}(t,s,e.documentUpdates).next((t=>{a=t.nr,c=t.sr}))),!i.isEqual(V.min())){const e=n.Bs.getLastRemoteSnapshotVersion(t).next((e=>n.Bs.setTargetsMetadata(t,t.currentSequenceNumber,i)));o.push(e)}return et.waitFor(o).next((()=>s.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.Ji=r,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const i=n.yc.get(e);i&&(b(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?i.fc=!0:t.modifiedDocuments.size>0?b(i.fc):t.removedDocuments.size>0&&(b(i.fc),i.fc=!1))})),await Ha(n,t,e)}catch(t){await tt(t)}}function Ra(t,e,n){const i=w(t);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const t=[];i.wc.forEach(((n,i)=>{const r=i.view.Mu(e);r.snapshot&&t.push(r.snapshot)})),function(t,e){const n=w(t);n.onlineState=e;let i=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.Mu(e)&&(i=!0)})),i&&Ia(n)}(i.eventManager,e),t.length&&i.dc.nu(t),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function Na(t,e,n){const i=w(t);i.sharedClientState.updateQueryState(e,"rejected",n);const r=i.yc.get(e),s=r&&r.key;if(s){let t=new Wt(q.comparator);t=t.insert(s,Ne.newNoDocument(s,V.min()));const n=zn().add(s),r=new Li(V.min(),new Map,new Wt(R),t,n);await Pa(i,r),i.gc=i.gc.remove(s),i.yc.delete(e),$a(i)}else await vo(i.localStore,e,!1).then((()=>Ua(i,e,n))).catch(tt)}async function La(t,e){const n=w(t),i=e.batch.batchId;try{const t=await function(t,e){const n=w(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const i=e.batch.keys(),r=n.Zi.newChangeBuffer({trackRemovals:!0});return function(t,e,n,i){const r=n.batch,s=r.keys();let o=et.resolve();return s.forEach((t=>{o=o.next((()=>i.getEntry(e,t))).next((e=>{const s=n.docVersions.get(t);b(null!==s),e.version.compareTo(s)<0&&(r.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),i.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,r)))}(n,t,e,r).next((()=>r.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=zn();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,i)))}))}(n.localStore,e);Ba(n,i,null),Va(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await Ha(n,t)}catch(t){await tt(t)}}async function Fa(t,e,n){const i=w(t);try{const t=await function(t,e){const n=w(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let i;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(b(null!==e),i=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,i,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,i))).next((()=>n.localDocuments.getDocuments(t,i)))}))}(i.localStore,e);Ba(i,e,n),Va(i,e),i.sharedClientState.updateMutationState(e,"rejected",n),await Ha(i,t)}catch(n){await tt(n)}}function Va(t,e){(t.Ec.get(e)||[]).forEach((t=>{t.resolve()})),t.Ec.delete(e)}function Ba(t,e,n){const i=w(t);let r=i.Tc[i.currentUser.toKey()];if(r){const t=r.get(e);t&&(n?t.reject(n):t.resolve(),r=r.remove(e)),i.Tc[i.currentUser.toKey()]=r}}function Ua(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const i of t._c.get(e))t.wc.delete(i),n&&t.dc.Pc(i,n);t._c.delete(e),t.isPrimaryClient&&t.Ic.Is(e).forEach((e=>{t.Ic.containsKey(e)||ja(t,e)}))}function ja(t,e){t.mc.delete(e.path.canonicalString());const n=t.gc.get(e);null!==n&&(zo(t.remoteStore,n),t.gc=t.gc.remove(e),t.yc.delete(n),$a(t))}function za(t,e,n){for(const i of n)i instanceof Ta?(t.Ic.addReference(i.key,e),qa(t,i)):i instanceof ka?(p("SyncEngine","Document no longer in limbo: "+i.key),t.Ic.removeReference(i.key,e),t.Ic.containsKey(i.key)||ja(t,i.key)):v()}function qa(t,e){const n=e.key,i=n.path.canonicalString();t.gc.get(n)||t.mc.has(i)||(p("SyncEngine","New document in limbo: "+n),t.mc.add(i),$a(t))}function $a(t){for(;t.mc.size>0&&t.gc.size<t.maxConcurrentLimboResolutions;){const e=t.mc.values().next().value;t.mc.delete(e);const n=new q(U.fromString(e)),i=t.Ac.next();t.yc.set(i,new Aa(n)),t.gc=t.gc.insert(n,i),jo(t.remoteStore,new Ir(xn(mn(n.path)),i,"TargetPurposeLimboResolution",ft.ct))}}async function Ha(t,e,n){const i=w(t),r=[],s=[],o=[];i.wc.isEmpty()||(i.wc.forEach(((t,a)=>{o.push(i.Rc(a,e,n).then((t=>{if((t||n)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){r.push(t);const e=uo.Li(a.targetId,t);s.push(e)}})))})),await Promise.all(o),i.dc.nu(r),await async function(t,e){const n=w(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>et.forEach(e,(e=>et.forEach(e.Fi,(i=>n.persistence.referenceDelegate.addReference(t,e.targetId,i))).next((()=>et.forEach(e.Bi,(i=>n.persistence.referenceDelegate.removeReference(t,e.targetId,i)))))))))}catch(t){if(!ot(t))throw t;p("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ji.get(e),i=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(i);n.Ji=n.Ji.insert(e,r)}}}(i.localStore,s))}async function Ka(t,e){const n=w(t);if(!n.currentUser.isEqual(e)){p("SyncEngine","User change. New user:",e.toKey());const t=await go(n.localStore,e);n.currentUser=e,function(t){t.Ec.forEach((t=>{t.forEach((t=>{t.reject(new x(_.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ec.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Ha(n,t.er)}}function Ga(t,e){const n=w(t),i=n.yc.get(e);if(i&&i.fc)return zn().add(i.key);{let t=zn();const i=n._c.get(e);if(!i)return t;for(const e of i){const i=n.wc.get(e);t=t.unionWith(i.view.nc)}return t}}function Wa(t){const e=w(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=La.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Fa.bind(null,e),e}class Qa{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=Mo(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return po(this.persistence,new ho,t.initialUser,this.serializer)}createPersistence(t){return new eo(io.zs,this.serializer)}createSharedClientState(t){return new _o}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Ya extends Qa{constructor(t,e,n){super(),this.Vc=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.Vc.initialize(this,t),await Wa(this.Vc.syncEngine),await ta(this.Vc.remoteStore),await this.persistence.Ii((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}createLocalStore(t){return po(this.persistence,new ho,t.initialUser,this.serializer)}createGarbageCollectionScheduler(t,e){const n=this.persistence.referenceDelegate.garbageCollector;return new Os(n,t.asyncQueue,e)}createIndexBackfillerScheduler(t,e){const n=new dt(e,this.persistence);return new ht(t.asyncQueue,n)}createPersistence(t){const e=function(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?ys.withCacheSize(this.cacheSizeBytes):ys.DEFAULT;return new ao(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,"undefined"!=typeof window?window:null,Do(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(t){return new _o}}class Xa{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Ra(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ka.bind(null,this.syncEngine),await async function(t,e){const n=w(t);e?(n.vu.delete(2),await Bo(n)):e||(n.vu.add(2),await Uo(n),n.bu.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new va}createDatastore(t){const e=Mo(t.databaseInfo.databaseId),n=(i=t.databaseInfo,new Ao(i));var i;return function(t,e,n,i){return new Lo(t,e,n,i)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,i=t.asyncQueue,r=t=>Ra(this.syncEngine,t,0),s=Io.D()?new Io:new xo,new Vo(e,n,i,r,s);var e,n,i,r,s}createSyncEngine(t,e){return function(t,e,n,i,r,s,o){const a=new Da(t,e,n,i,r,s);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=w(t);p("RemoteStore","RemoteStore shutting down."),e.vu.add(5),await Uo(e),e.Pu.shutdown(),e.bu.set("Unknown")}(this.remoteStore)}}class Ja{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Sc(this.observer.next,t)}error(t){this.observer.error?this.Sc(this.observer.error,t):g("Uncaught Error in snapshot listener:",t.toString())}Dc(){this.muted=!0}Sc(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Za{constructor(t,e,n,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=u.UNAUTHENTICATED,this.clientId=P.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{p("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(p("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new x(_.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new I;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=fa(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function tc(t,e){t.asyncQueue.verifyOperationInProgress(),p("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let i=n.initialUser;t.setCredentialChangeListener((async t=>{i.isEqual(t)||(await go(e.localStore,t),i=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function ec(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){p("FirestoreClient","Using user provided OfflineComponentProvider");try{await tc(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!nc(n))throw n;m("Error using user provided cache. Falling back to memory cache: "+n),await tc(t,new Qa)}}else p("FirestoreClient","Using default OfflineComponentProvider"),await tc(t,new Qa);return t._offlineComponents}(t);p("FirestoreClient","Initializing OnlineComponentProvider");const i=await t.getConfiguration();await e.initialize(n,i),t.setCredentialChangeListener((t=>la(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>la(e.remoteStore,n))),t._onlineComponents=e}function nc(t){return"FirebaseError"===t.name?t.code===_.FAILED_PRECONDITION||t.code===_.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}async function ic(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(p("FirestoreClient","Using user provided OnlineComponentProvider"),await ec(t,t._uninitializedComponentsProvider._online)):(p("FirestoreClient","Using default OnlineComponentProvider"),await ec(t,new Xa))),t._onlineComponents}async function rc(t){const e=await ic(t),n=e.eventManager;return n.onListen=Ma.bind(null,e.syncEngine),n.onUnlisten=Oa.bind(null,e.syncEngine),n}function sc(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const oc=new Map;function ac(t,e,n){if(!n)throw new x(_.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function cc(t){if(!q.isDocumentKey(t))throw new x(_.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function lc(t){if(q.isDocumentKey(t))throw new x(_.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function uc(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":v()}function hc(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new x(_.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=uc(t);throw new x(_.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class dc{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new x(_.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.cache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new x(_.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,i){if(!0===e&&!0===i)throw new x(_.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=sc(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new x(_.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new x(_.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new x(_.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(e=this.experimentalLongPollingOptions,n=t.experimentalLongPollingOptions,e.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams;var e,n}}class fc{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new dc({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new x(_.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new x(_.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new dc(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new T;switch(t.type){case"firstParty":return new A(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new x(_.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=oc.get(t);e&&(p("ComponentProvider","Removing Datastore"),oc.delete(t),e.terminate())}(this),Promise.resolve()}}class pc{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new mc(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new pc(this.firestore,t,this._key)}}class gc{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new gc(this.firestore,t,this._query)}}class mc extends gc{constructor(t,e,n){super(t,e,mn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new pc(this.firestore,null,new q(t))}withConverter(t){return new mc(this.firestore,t,this._path)}}function yc(t,e,...n){if(t=(0,o.Ku)(t),ac("collection","path",e),t instanceof fc){const i=U.fromString(e,...n);return lc(i),new mc(t,null,i)}{if(!(t instanceof pc||t instanceof mc))throw new x(_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(U.fromString(e,...n));return lc(i),new mc(t.firestore,null,i)}}function vc(t,e,...n){if(t=(0,o.Ku)(t),1===arguments.length&&(e=P.A()),ac("doc","path",e),t instanceof fc){const i=U.fromString(e,...n);return cc(i),new pc(t,null,new q(i))}{if(!(t instanceof pc||t instanceof mc))throw new x(_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(U.fromString(e,...n));return cc(i),new pc(t.firestore,t instanceof mc?t.converter:null,new q(i))}}class bc{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new Oo(this,"async_queue_retry"),this.Xc=()=>{const t=Do();t&&p("AsyncQueue","Visibility state changed to "+t.visibilityState),this.qo.Mo()};const t=Do();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Zc(),this.ta(t)}enterRestrictedMode(t){if(!this.jc){this.jc=!0,this.Jc=t||!1;const e=Do();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Xc)}}enqueue(t){if(this.Zc(),this.jc)return new Promise((()=>{}));const e=new I;return this.ta((()=>this.jc&&this.Jc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Qc.push(t),this.ea())))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(t){if(!ot(t))throw t;p("AsyncQueue","Operation failed with retryable error: "+t)}this.Qc.length>0&&this.qo.No((()=>this.ea()))}}ta(t){const e=this.Gc.then((()=>(this.Hc=!0,t().catch((t=>{this.Wc=t,this.Hc=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw g("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Hc=!1,t))))));return this.Gc=e,e}enqueueAfterDelay(t,e,n){this.Zc(),this.Yc.indexOf(t)>-1&&(e=0);const i=da.createAndSchedule(this,t,e,n,(t=>this.na(t)));return this.zc.push(i),i}Zc(){this.Wc&&v()}verifyOperationInProgress(){}async sa(){let t;do{t=this.Gc,await t}while(t!==this.Gc)}ia(t){for(const e of this.zc)if(e.timerId===t)return!0;return!1}ra(t){return this.sa().then((()=>{this.zc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.zc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.sa()}))}oa(t){this.Yc.push(t)}na(t){const e=this.zc.indexOf(t);this.zc.splice(e,1)}}class wc extends fc{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new bc,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Ic(this),this._firestoreClient.terminate()}}function _c(t,e){const n="object"==typeof t?t:(0,i.Sx)(),r="string"==typeof t?t:e||"(default)",s=(0,i.j6)(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const t=(0,o.yU)("firestore");t&&function(t,e,n,i={}){var r;const s=(t=hc(t,fc))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&m("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),i.mockUserToken){let e,n;if("string"==typeof i.mockUserToken)e=i.mockUserToken,n=u.MOCK_USER;else{e=(0,o.Fy)(i.mockUserToken,null===(r=t._app)||void 0===r?void 0:r.options.projectId);const s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new x(_.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new u(s)}t._authCredentials=new k(new E(e,n))}}(s,...t)}return s}function xc(t){return t._firestoreClient||Ic(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Ic(t){var e,n,i;const r=t._freezeSettings(),s=function(t,e,n,i){return new ue(t,e,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,sc(i.experimentalLongPollingOptions),i.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,r);t._firestoreClient=new Za(t._authCredentials,t._appCheckCredentials,t._queue,s),(null===(n=r.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=r.cache)||void 0===i?void 0:i._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.cache.kind,_offline:r.cache._offlineComponentProvider,_online:r.cache._onlineComponentProvider})}function Ec(t,e){!function(t){if(t._initialized||t._terminated)throw new x(_.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}(t=hc(t,wc));const n=xc(t);if(n._uninitializedComponentsProvider)throw new x(_.FAILED_PRECONDITION,"SDK cache is already specified.");m("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const i=t._freezeSettings(),r=new Xa;return function(t,e,n){const i=new I;return t.asyncQueue.enqueue((async()=>{try{await tc(t,n),await ec(t,e),i.resolve()}catch(t){const e=t;if(!nc(e))throw e;m("Error enabling indexeddb cache. Falling back to memory cache: "+e),i.reject(e)}})).then((()=>i.promise))}(n,r,new Ya(r,i.cacheSizeBytes,null==e?void 0:e.forceOwnership))}class Tc{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Tc(ne.fromBase64String(t))}catch(t){throw new x(_.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Tc(ne.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class kc{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new x(_.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new z(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Sc{constructor(t){this._methodName=t}}class Cc{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new x(_.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new x(_.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return R(this._lat,t._lat)||R(this._long,t._long)}}const Ac=/^__.*__$/;class Dc{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new mi(t,this.data,this.fieldMask,e,this.fieldTransforms):new gi(t,this.data,e,this.fieldTransforms)}}class Mc{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new mi(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Oc(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw v()}}class Pc{constructor(t,e,n,i,r,s){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===r&&this.ua(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(t){return new Pc(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.aa({path:n,la:!1});return i.fa(t),i}da(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.aa({path:n,la:!1});return i.ua(),i}wa(t){return this.aa({path:void 0,la:!0})}_a(t){return Gc(t,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}ua(){if(this.path)for(let t=0;t<this.path.length;t++)this.fa(this.path.get(t))}fa(t){if(0===t.length)throw this._a("Document fields must not be empty");if(Oc(this.ca)&&Ac.test(t))throw this._a('Document fields cannot begin and end with "__"')}}class Rc{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Mo(t)}ya(t,e,n,i=!1){return new Pc({ca:t,methodName:e,ga:n,path:z.emptyPath(),la:!1,ma:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Nc(t){const e=t._freezeSettings(),n=Mo(t._databaseId);return new Rc(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Lc(t,e,n,i,r,s={}){const o=t.ya(s.merge||s.mergeFields?2:0,e,n,r);qc("Data must be an object, but it was:",o,i);const a=jc(i,o);let c,l;if(s.merge)c=new te(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const i of s.mergeFields){const r=$c(e,i,n);if(!o.contains(r))throw new x(_.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);Wc(t,r)||t.push(r)}c=new te(t),l=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,l=o.fieldTransforms;return new Dc(new Pe(a),c,l)}class Fc extends Sc{_toFieldTransform(t){if(2!==t.ca)throw 1===t.ca?t._a(`${this._methodName}() can only appear at the top level of your update data`):t._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Fc}}class Vc extends Sc{_toFieldTransform(t){return new si(t.path,new Xn)}isEqual(t){return t instanceof Vc}}function Bc(t,e,n,i=!1){return Uc(n,t.ya(i?4:3,e))}function Uc(t,e){if(zc(t=(0,o.Ku)(t)))return qc("Unsupported field value:",e,t),jc(t,e);if(t instanceof Sc)return function(t,e){if(!Oc(e.ca))throw e._a(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e._a(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.la&&4!==e.ca)throw e._a("Nested arrays are not supported");return function(t,e){const n=[];let i=0;for(const r of t){let t=Uc(r,e.wa(i));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),i++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,o.Ku)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Kn(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=F.fromDate(t);return{timestampValue:Yi(e.serializer,n)}}if(t instanceof F){const n=new F(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Yi(e.serializer,n)}}if(t instanceof Cc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Tc)return{bytesValue:Xi(e.serializer,t._byteString)};if(t instanceof pc){const n=e.databaseId,i=t.firestore._databaseId;if(!i.isEqual(n))throw e._a(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:tr(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e._a(`Unsupported field value: ${uc(t)}`)}(t,e)}function jc(t,e){const n={};return Gt(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Kt(t,((t,i)=>{const r=Uc(i,e.ha(t));null!=r&&(n[t]=r)})),{mapValue:{fields:n}}}function zc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof F||t instanceof Cc||t instanceof Tc||t instanceof pc||t instanceof Sc)}function qc(t,e,n){if(!zc(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const i=uc(n);throw"an object"===i?e._a(t+" a custom object"):e._a(t+" "+i)}}function $c(t,e,n){if((e=(0,o.Ku)(e))instanceof kc)return e._internalPath;if("string"==typeof e)return Kc(t,e);throw Gc("Field path arguments must be of type string or ",t,!1,void 0,n)}const Hc=new RegExp("[~\\*/\\[\\]]");function Kc(t,e,n){if(e.search(Hc)>=0)throw Gc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new kc(...e.split("."))._internalPath}catch(i){throw Gc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Gc(t,e,n,i,r){const s=i&&!i.isEmpty(),o=void 0!==r;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new x(_.INVALID_ARGUMENT,a+t+c)}function Wc(t,e){return t.some((t=>t.isEqual(e)))}class Qc{constructor(t,e,n,i,r){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new pc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Yc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Xc("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Yc extends Qc{data(){return super.data()}}function Xc(t,e){return"string"==typeof e?Kc(t,e):e instanceof kc?e._internalPath:e._delegate._internalPath}class Jc{}class Zc extends Jc{}function tl(t,e,...n){let i=[];e instanceof Jc&&i.push(e),i=i.concat(n),function(t){const e=t.filter((t=>t instanceof il)).length,n=t.filter((t=>t instanceof el)).length;if(e>1||e>0&&n>0)throw new x(_.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const e of i)t=e._apply(t);return t}class el extends Zc{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new el(t,e,n)}_apply(t){const e=this._parse(t);return dl(t._query,e),new gc(t.firestore,t.converter,In(t._query,e))}_parse(t){const e=Nc(t.firestore),n=function(t,e,n,i,r,s,o){let a;if(r.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new x(_.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){hl(o,s);const e=[];for(const n of o)e.push(ul(i,t,n));a={arrayValue:{values:e}}}else a=ul(i,t,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||hl(o,s),a=Bc(n,"where",o,"in"===s||"not-in"===s);return ze.create(r,s,a)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return n}}function nl(t,e,n){const i=e,r=Xc("where",t);return el._create(r,i,n)}class il extends Jc{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new il(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:qe.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const i=e.getFlattenedFilters();for(const t of i)dl(n,t),n=In(n,t)}(t._query,e),new gc(t.firestore,t.converter,In(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class rl extends Zc{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new rl(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new x(_.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new x(_.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const i=new Be(e,n);return function(t,e){if(null===vn(t)){const n=bn(t);null!==n&&fl(0,n,e.field)}}(t,i),i}(t._query,this._field,this._direction);return new gc(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new gn(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function sl(t,e="asc"){const n=e,i=Xc("orderBy",t);return rl._create(i,n)}class ol extends Zc{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new ol(t,e,n)}_apply(t){return new gc(t.firestore,t.converter,En(t._query,this._limit,this._limitType))}}function al(t){return function(t,e){if(e<=0)throw new x(_.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}("limit",t),ol._create("limit",t,"F")}class cl extends Zc{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new cl(t,e,n)}_apply(t){const e=function(t,e,n,i){if(n[0]=(0,o.Ku)(n[0]),n[0]instanceof Qc)return function(t,e,n,i,r){if(!i)throw new x(_.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of _n(t))if(n.field.isKeyField())s.push(_e(e,i.key));else{const t=i.data.field(n.field);if(ae(t))throw new x(_.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new x(_.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}s.push(t)}return new Le(s,r)}(t._query,t.firestore._databaseId,e,n[0]._document,i);{const r=Nc(t.firestore);return function(t,e,n,i,r,s){const o=t.explicitOrderBy;if(r.length>o.length)throw new x(_.INVALID_ARGUMENT,`Too many arguments provided to ${i}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<r.length;s++){const c=r[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new x(_.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${i}(), but got a ${typeof c}`);if(!wn(t)&&-1!==c.indexOf("/"))throw new x(_.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${i}() must be a plain document ID, but '${c}' contains a slash.`);const n=t.path.child(U.fromString(c));if(!q.isDocumentKey(n))throw new x(_.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${i}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const r=new q(n);a.push(_e(e,r))}else{const t=Bc(n,i,c);a.push(t)}}return new Le(a,s)}(t._query,t.firestore._databaseId,r,e,n,i)}}(t,this.type,this._docOrFields,this._inclusive);return new gc(t.firestore,t.converter,function(t,e){return new gn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}function ll(...t){return cl._create("startAfter",t,!1)}function ul(t,e,n){if("string"==typeof(n=(0,o.Ku)(n))){if(""===n)throw new x(_.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!wn(e)&&-1!==n.indexOf("/"))throw new x(_.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const i=e.path.child(U.fromString(n));if(!q.isDocumentKey(i))throw new x(_.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return _e(t,new q(i))}if(n instanceof pc)return _e(t,n._key);throw new x(_.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${uc(n)}.`)}function hl(t,e){if(!Array.isArray(t)||0===t.length)throw new x(_.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function dl(t,e){if(e.isInequality()){const n=bn(t),i=e.field;if(null!==n&&!n.isEqual(i))throw new x(_.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${i.toString()}'`);const r=vn(t);null!==r&&fl(0,i,r)}const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new x(_.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new x(_.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}function fl(t,e,n){if(!n.isEqual(e))throw new x(_.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class pl{convertValue(t,e="none"){switch(pe(t)){case 0:return null;case 1:return t.booleanValue;case 2:return se(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(oe(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw v()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Kt(t,((t,i)=>{n[t]=this.convertValue(i,e)})),n}convertGeoPoint(t){return new Cc(se(t.latitude),se(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=ce(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(le(t));default:return null}}convertTimestamp(t){const e=re(t);return new F(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=U.fromString(t);b(xr(n));const i=new he(n.get(1),n.get(3)),r=new q(n.popFirst(5));return i.isEqual(e)||g(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),r}}function gl(t,e,n){let i;return i=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,i}class ml{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class yl extends Qc{constructor(t,e,n,i,r,s){super(t,e,n,i,s),this._firestore=t,this._firestoreImpl=t,this.metadata=r}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new vl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Xc("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class vl extends yl{data(t={}){return super.data(t)}}class bl{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new ml(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new vl(this._firestore,this._userDataWriter,n.key,n,new ml(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new x(_.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const i=new vl(t._firestore,t._userDataWriter,n.doc.key,n.doc,new ml(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const i=new vl(t._firestore,t._userDataWriter,e.doc.key,e.doc,new ml(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let r=-1,s=-1;return 0!==e.type&&(r=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:wl(e.type),doc:i,oldIndex:r,newIndex:s}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function wl(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return v()}}function _l(t){t=hc(t,pc);const e=hc(t.firestore,wc);return function(t,e,n={}){const i=new I;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,i,r){const s=new Ja({next:s=>{e.enqueueAndForget((()=>wa(t,o)));const a=s.docs.has(n);!a&&s.fromCache?r.reject(new x(_.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&i&&"server"===i.source?r.reject(new x(_.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(s)},error:t=>r.reject(t)}),o=new Ea(mn(n.path),s,{includeMetadataChanges:!0,Ku:!0});return ba(t,o)}(await rc(t),t.asyncQueue,e,n,i))),i.promise}(xc(e),t._key).then((n=>function(t,e,n){const i=n.docs.get(e._key),r=new xl(t);return new yl(t,r,e._key,i,new ml(n.hasPendingWrites,n.fromCache),e.converter)}(e,t,n)))}class xl extends pl{constructor(t){super(),this.firestore=t}convertBytes(t){return new Tc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new pc(this.firestore,null,e)}}function Il(t){t=hc(t,gc);const e=hc(t.firestore,wc),n=xc(e),i=new xl(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new x(_.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),function(t,e,n={}){const i=new I;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,i,r){const s=new Ja({next:n=>{e.enqueueAndForget((()=>wa(t,o))),n.fromCache&&"server"===i.source?r.reject(new x(_.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:t=>r.reject(t)}),o=new Ea(n,s,{includeMetadataChanges:!0,Ku:!0});return ba(t,o)}(await rc(t),t.asyncQueue,e,n,i))),i.promise}(n,t._query).then((n=>new bl(e,i,t,n)))}function El(t,e,n){t=hc(t,pc);const i=hc(t.firestore,wc),r=gl(t.converter,e,n);return Cl(i,[Lc(Nc(i),"setDoc",t._key,r,null!==t.converter,n).toMutation(t._key,ai.none())])}function Tl(t,e,n,...i){t=hc(t,pc);const r=hc(t.firestore,wc),s=Nc(r);let a;return a="string"==typeof(e=(0,o.Ku)(e))||e instanceof kc?function(t,e,n,i,r,s){const a=t.ya(1,e,n),c=[$c(e,i,n)],l=[r];if(s.length%2!=0)throw new x(_.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<s.length;t+=2)c.push($c(e,s[t])),l.push(s[t+1]);const u=[],h=Pe.empty();for(let t=c.length-1;t>=0;--t)if(!Wc(u,c[t])){const e=c[t];let n=l[t];n=(0,o.Ku)(n);const i=a.da(e);if(n instanceof Fc)u.push(e);else{const t=Uc(n,i);null!=t&&(u.push(e),h.set(e,t))}}const d=new te(u);return new Mc(h,d,a.fieldTransforms)}(s,"updateDoc",t._key,e,n,i):function(t,e,n,i){const r=t.ya(1,e,n);qc("Data must be an object, but it was:",r,i);const s=[],a=Pe.empty();Kt(i,((t,i)=>{const c=Kc(e,t,n);i=(0,o.Ku)(i);const l=r.da(c);if(i instanceof Fc)s.push(c);else{const t=Uc(i,l);null!=t&&(s.push(c),a.set(c,t))}}));const c=new te(s);return new Mc(a,c,r.fieldTransforms)}(s,"updateDoc",t._key,e),Cl(r,[a.toMutation(t._key,ai.exists(!0))])}function kl(t){return Cl(hc(t.firestore,wc),[new wi(t._key,ai.none())])}function Sl(t,e){const n=hc(t.firestore,wc),i=vc(t),r=gl(t.converter,e);return Cl(n,[Lc(Nc(t.firestore),"addDoc",i._key,r,null!==t.converter,{}).toMutation(i._key,ai.exists(!1))]).then((()=>i))}function Cl(t,e){return function(t,e){const n=new I;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const i=Wa(t);try{const t=await function(t,e){const n=w(t),i=F.now(),r=e.reduce(((t,e)=>t.add(e.key)),zn());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=Pn(),c=zn();return n.Zi.getEntries(t,r).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((r=>{s=r;const o=[];for(const t of e){const e=fi(t,s.get(t.key).overlayedDocument);null!=e&&o.push(new mi(t.key,e,Re(e.value.mapValue),ai.exists(!0)))}return n.mutationQueue.addMutationBatch(t,i,o,e)})).next((e=>{o=e;const i=e.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,i)}))})).then((()=>({batchId:o.batchId,changes:Ln(s)})))}(i.localStore,e);i.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let i=t.Tc[t.currentUser.toKey()];i||(i=new Wt(R)),i=i.insert(e,n),t.Tc[t.currentUser.toKey()]=i}(i,t.batchId,n),await Ha(i,t.changes),await ta(i.remoteStore)}catch(t){const e=fa(t,"Failed to persist write");n.reject(e)}}(await function(t){return ic(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(xc(t),e)}function Al(){return new Fc("deleteField")}function Dl(){return new Vc("serverTimestamp")}!function(t,e=!0){!function(t){h=t}(i.MF),(0,i.om)(new r.uA("firestore",((t,{instanceIdentifier:n,options:i})=>{const r=t.getProvider("app").getImmediate(),s=new wc(new S(t.getProvider("auth-internal")),new M(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new x(_.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new he(t.options.projectId,e)}(r,n),r);return i=Object.assign({useFetchStreams:e},i),s._setSettings(i),s}),"PUBLIC").setMultipleInstances(!0)),(0,i.KO)(l,"3.13.0",t),(0,i.KO)(l,"3.13.0","esm2017")}()},816:(t,e,n)=>{"use strict";n.d(e,{checkAndShowLicenseModal:()=>x});var i,r,s,o,a,c,l,u,h=n(848),d=n(756),f=n.n(d),p=n(908),g=n(580);function m(){i=document.getElementById("licenseModal"),r=document.getElementById("licenseForm"),s=document.getElementById("licenseKey"),o=document.getElementById("activateLicenseBtn"),a=document.getElementById("licenseError"),c=document.getElementById("licenseErrorMessage"),l=document.getElementById("licenseSuccess"),u=document.getElementById("licenseSuccessMessage"),document.getElementById("getLicenseLink")}function y(){o.addEventListener("click",v),i.addEventListener("show.bs.modal",(function(){r.reset(),a.classList.add("d-none"),l.classList.add("d-none"),o.disabled=!1})),i.addEventListener("hidden.bs.modal",(function(){l.classList.contains("d-none")||window.location.reload()})),s&&s.addEventListener("input",_)}function v(){return b.apply(this,arguments)}function b(){return(b=(0,h.A)(f().mark((function t(){var e,n,i;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.classList.add("d-none"),l.classList.add("d-none"),r.checkValidity()){t.next=5;break}return r.reportValidity(),t.abrupt("return");case 5:if(o.disabled=!0,o.innerHTML='<i class="fas fa-spinner fa-spin me-2"></i>Activation en cours...',t.prev=7,e=auth.currentUser){t.next=12;break}return w("Vous devez être connecté pour activer une licence."),t.abrupt("return");case 12:return n=s.value.trim(),t.next=15,(0,g.activateLicense)(e.uid,n);case 15:(i=t.sent).success?(c=i.message,l.classList.remove("d-none"),u.textContent=c):w(i.message),t.next=23;break;case 19:t.prev=19,t.t0=t.catch(7),console.error("Erreur lors de l'activation de la licence:",t.t0),w("Une erreur est survenue lors de l'activation de la licence.");case 23:return t.prev=23,o.disabled=!1,o.innerHTML='<i class="fas fa-key me-2"></i>Activer la licence',t.finish(23);case 27:case"end":return t.stop()}var c}),t,null,[[7,19,23,27]])})))).apply(this,arguments)}function w(t){a.classList.remove("d-none"),c.textContent=t}function _(t){var e=t.target.value.replace(/[^A-Z0-9]/gi,"").toUpperCase();e.length>16&&(e=e.substring(0,16));for(var n="",i=0;i<e.length;i++)i>0&&i%4==0&&i<16&&(n+="-"),n+=e[i];t.target.value=n}function x(){return I.apply(this,arguments)}function I(){return(I=(0,h.A)(f().mark((function t(){var e,n,i;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e=(0,p.xI)(),n=e.currentUser){t.next=5;break}return t.abrupt("return",!1);case 5:return t.next=7,(0,g.needsLicenseActivation)(n.uid);case 7:if(!t.sent){t.next=20;break}return t.next=11,new Promise((function(t){document.getElementById("licenseModal")?(m(),y()):fetch("license-modal.html").then((function(t){return t.text()})).then((function(t){document.body.insertAdjacentHTML("beforeend",t),m(),y()})).catch((function(t){console.error("Erreur lors du chargement du modal de licence:",t)}));var e=setInterval((function(){document.getElementById("licenseModal")&&(clearInterval(e),t())}),100);setTimeout((function(){clearInterval(e),t()}),3e3)}));case 11:if("undefined"!=typeof bootstrap&&bootstrap.Modal){t.next=14;break}return console.warn("Bootstrap n'est pas disponible. Impossible d'afficher le modal de licence."),t.abrupt("return",!0);case 14:if(i=document.getElementById("licenseModal")){t.next=18;break}return console.warn("Modal de licence introuvable dans le DOM."),t.abrupt("return",!0);case 18:try{new bootstrap.Modal(i,{backdrop:"static",keyboard:!1}).show()}catch(t){console.error("Erreur lors de l'initialisation du modal Bootstrap:",t)}return t.abrupt("return",!0);case 20:return t.abrupt("return",!1);case 23:return t.prev=23,t.t0=t.catch(0),console.error("Erreur lors de la vérification de la licence:",t.t0),t.abrupt("return",!1);case 27:case"end":return t.stop()}}),t,null,[[0,23]])})))).apply(this,arguments)}},848:(t,e,n)=>{"use strict";function i(t,e,n,i,r,s,o){try{var a=t[s](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function r(t){return function(){var e=this,n=arguments;return new Promise((function(r,s){var o=t.apply(e,n);function a(t){i(o,r,s,a,c,"next",t)}function c(t){i(o,r,s,a,c,"throw",t)}a(void 0)}))}}n.d(e,{A:()=>r})},908:(t,e,n)=>{"use strict";n.d(e,{CI:()=>i.CI,J1:()=>i.J1,eJ:()=>i.eJ,hg:()=>i.hg,x9:()=>i.x9,xI:()=>i.xI});var i=n(440)},922:(t,e,n)=>{"use strict";n.d(e,{A:()=>s});var i=n(284),r=n(327);function s(t){var e=(0,r.A)(t,"string");return"symbol"==(0,i.A)(e)?e:e+""}}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var s=e[i]={exports:{}};return t[i](s,s.exports,n),s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}var e=n(848),i=n(756),r=n.n(i),s=n(908),o=n(405);function a(){}const c=function(){let t=0;return function(){return t++}}();function l(t){return null==t}function u(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return"[object"===e.slice(0,7)&&"Array]"===e.slice(-6)}function h(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}const d=t=>("number"==typeof t||t instanceof Number)&&isFinite(+t);function f(t,e){return d(t)?t:e}function p(t,e){return void 0===t?e:t}const g=(t,e)=>"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100*e:+t;function m(t,e,n){if(t&&"function"==typeof t.call)return t.apply(n,e)}function y(t,e,n,i){let r,s,o;if(u(t))if(s=t.length,i)for(r=s-1;r>=0;r--)e.call(n,t[r],r);else for(r=0;r<s;r++)e.call(n,t[r],r);else if(h(t))for(o=Object.keys(t),s=o.length,r=0;r<s;r++)e.call(n,t[o[r]],o[r])}function v(t,e){let n,i,r,s;if(!t||!e||t.length!==e.length)return!1;for(n=0,i=t.length;n<i;++n)if(r=t[n],s=e[n],r.datasetIndex!==s.datasetIndex||r.index!==s.index)return!1;return!0}function b(t){if(u(t))return t.map(b);if(h(t)){const e=Object.create(null),n=Object.keys(t),i=n.length;let r=0;for(;r<i;++r)e[n[r]]=b(t[n[r]]);return e}return t}function w(t){return-1===["__proto__","prototype","constructor"].indexOf(t)}function _(t,e,n,i){if(!w(t))return;const r=e[t],s=n[t];h(r)&&h(s)?x(r,s,i):e[t]=b(s)}function x(t,e,n){const i=u(e)?e:[e],r=i.length;if(!h(t))return t;const s=(n=n||{}).merger||_;for(let o=0;o<r;++o){if(!h(e=i[o]))continue;const r=Object.keys(e);for(let i=0,o=r.length;i<o;++i)s(r[i],t,e,n)}return t}function I(t,e){return x(t,e,{merger:E})}function E(t,e,n){if(!w(t))return;const i=e[t],r=n[t];h(i)&&h(r)?I(i,r):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=b(r))}const T={"":t=>t,x:t=>t.x,y:t=>t.y};function k(t,e){const n=T[e]||(T[e]=function(t){const e=function(t){const e=t.split("."),n=[];let i="";for(const t of e)i+=t,i.endsWith("\\")?i=i.slice(0,-1)+".":(n.push(i),i="");return n}(t);return t=>{for(const n of e){if(""===n)break;t=t&&t[n]}return t}}(e));return n(t)}function S(t){return t.charAt(0).toUpperCase()+t.slice(1)}const C=t=>void 0!==t,A=t=>"function"==typeof t,D=(t,e)=>{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0},M=Math.PI,O=2*M,P=O+M,R=Number.POSITIVE_INFINITY,N=M/180,L=M/2,F=M/4,V=2*M/3,B=Math.log10,U=Math.sign;function j(t){const e=Math.round(t);t=q(t,e,t/1e3)?e:t;const n=Math.pow(10,Math.floor(B(t))),i=t/n;return(i<=1?1:i<=2?2:i<=5?5:10)*n}function z(t){return!isNaN(parseFloat(t))&&isFinite(t)}function q(t,e,n){return Math.abs(t-e)<n}function $(t,e,n){let i,r,s;for(i=0,r=t.length;i<r;i++)s=t[i][n],isNaN(s)||(e.min=Math.min(e.min,s),e.max=Math.max(e.max,s))}function H(t){return t*(M/180)}function K(t){return t*(180/M)}function G(t){if(!d(t))return;let e=1,n=0;for(;Math.round(t*e)/e!==t;)e*=10,n++;return n}function W(t,e){const n=e.x-t.x,i=e.y-t.y,r=Math.sqrt(n*n+i*i);let s=Math.atan2(i,n);return s<-.5*M&&(s+=O),{angle:s,distance:r}}function Q(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Y(t,e){return(t-e+P)%O-M}function X(t){return(t%O+O)%O}function J(t,e,n,i){const r=X(t),s=X(e),o=X(n),a=X(s-r),c=X(o-r),l=X(r-s),u=X(r-o);return r===s||r===o||i&&s===o||a>c&&l<u}function Z(t,e,n){return Math.max(e,Math.min(n,t))}function tt(t,e,n,i=1e-6){return t>=Math.min(e,n)-i&&t<=Math.max(e,n)+i}function et(t,e,n){n=n||(n=>t[n]<e);let i,r=t.length-1,s=0;for(;r-s>1;)i=s+r>>1,n(i)?s=i:r=i;return{lo:s,hi:r}}const nt=(t,e,n,i)=>et(t,n,i?i=>t[i][e]<=n:i=>t[i][e]<n),it=(t,e,n)=>et(t,n,(i=>t[i][e]>=n)),rt=["push","pop","shift","splice","unshift"];function st(t,e){const n=t._chartjs;if(!n)return;const i=n.listeners,r=i.indexOf(e);-1!==r&&i.splice(r,1),i.length>0||(rt.forEach((e=>{delete t[e]})),delete t._chartjs)}function ot(t){const e=new Set;let n,i;for(n=0,i=t.length;n<i;++n)e.add(t[n]);return e.size===i?t:Array.from(e)}const at="undefined"==typeof window?function(t){return t()}:window.requestAnimationFrame;function ct(t,e,n){const i=n||(t=>Array.prototype.slice.call(t));let r=!1,s=[];return function(...n){s=i(n),r||(r=!0,at.call(window,(()=>{r=!1,t.apply(e,s)})))}}const lt=t=>"start"===t?"left":"end"===t?"right":"center",ut=(t,e,n)=>"start"===t?e:"end"===t?n:(e+n)/2;function ht(t,e,n){const i=e.length;let r=0,s=i;if(t._sorted){const{iScale:o,_parsed:a}=t,c=o.axis,{min:l,max:u,minDefined:h,maxDefined:d}=o.getUserBounds();h&&(r=Z(Math.min(nt(a,o.axis,l).lo,n?i:nt(e,c,o.getPixelForValue(l)).lo),0,i-1)),s=d?Z(Math.max(nt(a,o.axis,u,!0).hi+1,n?0:nt(e,c,o.getPixelForValue(u),!0).hi+1),r,i)-r:i-r}return{start:r,count:s}}function dt(t){const{xScale:e,yScale:n,_scaleRanges:i}=t,r={xmin:e.min,xmax:e.max,ymin:n.min,ymax:n.max};if(!i)return t._scaleRanges=r,!0;const s=i.xmin!==e.min||i.xmax!==e.max||i.ymin!==n.min||i.ymax!==n.max;return Object.assign(i,r),s}const ft=t=>0===t||1===t,pt=(t,e,n)=>-Math.pow(2,10*(t-=1))*Math.sin((t-e)*O/n),gt=(t,e,n)=>Math.pow(2,-10*t)*Math.sin((t-e)*O/n)+1,mt={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>1-Math.cos(t*L),easeOutSine:t=>Math.sin(t*L),easeInOutSine:t=>-.5*(Math.cos(M*t)-1),easeInExpo:t=>0===t?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>ft(t)?t:t<.5?.5*Math.pow(2,10*(2*t-1)):.5*(2-Math.pow(2,-10*(2*t-1))),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>ft(t)?t:pt(t,.075,.3),easeOutElastic:t=>ft(t)?t:gt(t,.075,.3),easeInOutElastic(t){const e=.1125;return ft(t)?t:t<.5?.5*pt(2*t,e,.45):.5+.5*gt(2*t-1,e,.45)},easeInBack(t){const e=1.70158;return t*t*((e+1)*t-e)},easeOutBack(t){const e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},easeInBounce:t=>1-mt.easeOutBounce(1-t),easeOutBounce(t){const e=7.5625,n=2.75;return t<1/n?e*t*t:t<2/n?e*(t-=1.5/n)*t+.75:t<2.5/n?e*(t-=2.25/n)*t+.9375:e*(t-=2.625/n)*t+.984375},easeInOutBounce:t=>t<.5?.5*mt.easeInBounce(2*t):.5*mt.easeOutBounce(2*t-1)+.5};function yt(t){return t+.5|0}const vt=(t,e,n)=>Math.max(Math.min(t,n),e);function bt(t){return vt(yt(2.55*t),0,255)}function wt(t){return vt(yt(255*t),0,255)}function _t(t){return vt(yt(t/2.55)/100,0,1)}function xt(t){return vt(yt(100*t),0,100)}const It={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Et=[..."0123456789ABCDEF"],Tt=t=>Et[15&t],kt=t=>Et[(240&t)>>4]+Et[15&t],St=t=>(240&t)>>4==(15&t);const Ct=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function At(t,e,n){const i=e*Math.min(n,1-n),r=(e,r=(e+t/30)%12)=>n-i*Math.max(Math.min(r-3,9-r,1),-1);return[r(0),r(8),r(4)]}function Dt(t,e,n){const i=(i,r=(i+t/60)%6)=>n-n*e*Math.max(Math.min(r,4-r,1),0);return[i(5),i(3),i(1)]}function Mt(t,e,n){const i=At(t,1,.5);let r;for(e+n>1&&(r=1/(e+n),e*=r,n*=r),r=0;r<3;r++)i[r]*=1-e-n,i[r]+=e;return i}function Ot(t){const e=t.r/255,n=t.g/255,i=t.b/255,r=Math.max(e,n,i),s=Math.min(e,n,i),o=(r+s)/2;let a,c,l;return r!==s&&(l=r-s,c=o>.5?l/(2-r-s):l/(r+s),a=function(t,e,n,i,r){return t===r?(e-n)/i+(e<n?6:0):e===r?(n-t)/i+2:(t-e)/i+4}(e,n,i,l,r),a=60*a+.5),[0|a,c||0,o]}function Pt(t,e,n,i){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,n,i)).map(wt)}function Rt(t,e,n){return Pt(At,t,e,n)}function Nt(t){return(t%360+360)%360}const Lt={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Ft={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let Vt;const Bt=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/,Ut=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,jt=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function zt(t,e,n){if(t){let i=Ot(t);i[e]=Math.max(0,Math.min(i[e]+i[e]*n,0===e?360:1)),i=Rt(i),t.r=i[0],t.g=i[1],t.b=i[2]}}function qt(t,e){return t?Object.assign(e||{},t):t}function $t(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=wt(t[3]))):(e=qt(t,{r:0,g:0,b:0,a:1})).a=wt(e.a),e}function Ht(t){return"r"===t.charAt(0)?function(t){const e=Bt.exec(t);let n,i,r,s=255;if(e){if(e[7]!==n){const t=+e[7];s=e[8]?bt(t):vt(255*t,0,255)}return n=+e[1],i=+e[3],r=+e[5],n=255&(e[2]?bt(n):vt(n,0,255)),i=255&(e[4]?bt(i):vt(i,0,255)),r=255&(e[6]?bt(r):vt(r,0,255)),{r:n,g:i,b:r,a:s}}}(t):function(t){const e=Ct.exec(t);let n,i=255;if(!e)return;e[5]!==n&&(i=e[6]?bt(+e[5]):wt(+e[5]));const r=Nt(+e[2]),s=+e[3]/100,o=+e[4]/100;return n="hwb"===e[1]?function(t,e,n){return Pt(Mt,t,e,n)}(r,s,o):"hsv"===e[1]?function(t,e,n){return Pt(Dt,t,e,n)}(r,s,o):Rt(r,s,o),{r:n[0],g:n[1],b:n[2],a:i}}(t)}class Kt{constructor(t){if(t instanceof Kt)return t;const e=typeof t;let n;var i,r,s;"object"===e?n=$t(t):"string"===e&&(s=(i=t).length,"#"===i[0]&&(4===s||5===s?r={r:255&17*It[i[1]],g:255&17*It[i[2]],b:255&17*It[i[3]],a:5===s?17*It[i[4]]:255}:7!==s&&9!==s||(r={r:It[i[1]]<<4|It[i[2]],g:It[i[3]]<<4|It[i[4]],b:It[i[5]]<<4|It[i[6]],a:9===s?It[i[7]]<<4|It[i[8]]:255})),n=r||function(t){Vt||(Vt=function(){const t={},e=Object.keys(Ft),n=Object.keys(Lt);let i,r,s,o,a;for(i=0;i<e.length;i++){for(o=a=e[i],r=0;r<n.length;r++)s=n[r],a=a.replace(s,Lt[s]);s=parseInt(Ft[o],16),t[a]=[s>>16&255,s>>8&255,255&s]}return t}(),Vt.transparent=[0,0,0,0]);const e=Vt[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}(t)||Ht(t)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var t=qt(this._rgb);return t&&(t.a=_t(t.a)),t}set rgb(t){this._rgb=$t(t)}rgbString(){return this._valid?(t=this._rgb)&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${_t(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`):void 0;var t}hexString(){return this._valid?(t=this._rgb,e=(t=>St(t.r)&&St(t.g)&&St(t.b)&&St(t.a))(t)?Tt:kt,t?"#"+e(t.r)+e(t.g)+e(t.b)+((t,e)=>t<255?e(t):"")(t.a,e):void 0):void 0;var t,e}hslString(){return this._valid?function(t){if(!t)return;const e=Ot(t),n=e[0],i=xt(e[1]),r=xt(e[2]);return t.a<255?`hsla(${n}, ${i}%, ${r}%, ${_t(t.a)})`:`hsl(${n}, ${i}%, ${r}%)`}(this._rgb):void 0}mix(t,e){if(t){const n=this.rgb,i=t.rgb;let r;const s=e===r?.5:e,o=2*s-1,a=n.a-i.a,c=((o*a===-1?o:(o+a)/(1+o*a))+1)/2;r=1-c,n.r=255&c*n.r+r*i.r+.5,n.g=255&c*n.g+r*i.g+.5,n.b=255&c*n.b+r*i.b+.5,n.a=s*n.a+(1-s)*i.a,this.rgb=n}return this}interpolate(t,e){return t&&(this._rgb=function(t,e,n){const i=jt(_t(t.r)),r=jt(_t(t.g)),s=jt(_t(t.b));return{r:wt(Ut(i+n*(jt(_t(e.r))-i))),g:wt(Ut(r+n*(jt(_t(e.g))-r))),b:wt(Ut(s+n*(jt(_t(e.b))-s))),a:t.a+n*(e.a-t.a)}}(this._rgb,t._rgb,e)),this}clone(){return new Kt(this.rgb)}alpha(t){return this._rgb.a=wt(t),this}clearer(t){return this._rgb.a*=1-t,this}greyscale(){const t=this._rgb,e=yt(.3*t.r+.59*t.g+.11*t.b);return t.r=t.g=t.b=e,this}opaquer(t){return this._rgb.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return zt(this._rgb,2,t),this}darken(t){return zt(this._rgb,2,-t),this}saturate(t){return zt(this._rgb,1,t),this}desaturate(t){return zt(this._rgb,1,-t),this}rotate(t){return function(t,e){var n=Ot(t);n[0]=Nt(n[0]+e),n=Rt(n),t.r=n[0],t.g=n[1],t.b=n[2]}(this._rgb,t),this}}function Gt(t){return new Kt(t)}function Wt(t){if(t&&"object"==typeof t){const e=t.toString();return"[object CanvasPattern]"===e||"[object CanvasGradient]"===e}return!1}function Qt(t){return Wt(t)?t:Gt(t)}function Yt(t){return Wt(t)?t:Gt(t).saturate(.5).darken(.1).hexString()}const Xt=Object.create(null),Jt=Object.create(null);function Zt(t,e){if(!e)return t;const n=e.split(".");for(let e=0,i=n.length;e<i;++e){const i=n[e];t=t[i]||(t[i]=Object.create(null))}return t}function te(t,e,n){return"string"==typeof e?x(Zt(t,e),n):x(Zt(t,""),e)}var ee=new class{constructor(t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=t=>t.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(t,e)=>Yt(e.backgroundColor),this.hoverBorderColor=(t,e)=>Yt(e.borderColor),this.hoverColor=(t,e)=>Yt(e.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t)}set(t,e){return te(this,t,e)}get(t){return Zt(this,t)}describe(t,e){return te(Jt,t,e)}override(t,e){return te(Xt,t,e)}route(t,e,n,i){const r=Zt(this,t),s=Zt(this,n),o="_"+e;Object.defineProperties(r,{[o]:{value:r[e],writable:!0},[e]:{enumerable:!0,get(){const t=this[o],e=s[i];return h(t)?Object.assign({},e,t):p(t,e)},set(t){this[o]=t}}})}}({_scriptable:t=>!t.startsWith("on"),_indexable:t=>"events"!==t,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function ne(t,e,n,i,r){let s=e[r];return s||(s=e[r]=t.measureText(r).width,n.push(r)),s>i&&(i=s),i}function ie(t,e,n,i){let r=(i=i||{}).data=i.data||{},s=i.garbageCollect=i.garbageCollect||[];i.font!==e&&(r=i.data={},s=i.garbageCollect=[],i.font=e),t.save(),t.font=e;let o=0;const a=n.length;let c,l,h,d,f;for(c=0;c<a;c++)if(d=n[c],null!=d&&!0!==u(d))o=ne(t,r,s,o,d);else if(u(d))for(l=0,h=d.length;l<h;l++)f=d[l],null==f||u(f)||(o=ne(t,r,s,o,f));t.restore();const p=s.length/2;if(p>n.length){for(c=0;c<p;c++)delete r[s[c]];s.splice(0,p)}return o}function re(t,e,n){const i=t.currentDevicePixelRatio,r=0!==n?Math.max(n/2,.5):0;return Math.round((e-r)*i)/i+r}function se(t,e){(e=e||t.getContext("2d")).save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore()}function oe(t,e,n,i){ae(t,e,n,i,null)}function ae(t,e,n,i,r){let s,o,a,c,l,u;const h=e.pointStyle,d=e.rotation,f=e.radius;let p=(d||0)*N;if(h&&"object"==typeof h&&(s=h.toString(),"[object HTMLImageElement]"===s||"[object HTMLCanvasElement]"===s))return t.save(),t.translate(n,i),t.rotate(p),t.drawImage(h,-h.width/2,-h.height/2,h.width,h.height),void t.restore();if(!(isNaN(f)||f<=0)){switch(t.beginPath(),h){default:r?t.ellipse(n,i,r/2,f,0,0,O):t.arc(n,i,f,0,O),t.closePath();break;case"triangle":t.moveTo(n+Math.sin(p)*f,i-Math.cos(p)*f),p+=V,t.lineTo(n+Math.sin(p)*f,i-Math.cos(p)*f),p+=V,t.lineTo(n+Math.sin(p)*f,i-Math.cos(p)*f),t.closePath();break;case"rectRounded":l=.516*f,c=f-l,o=Math.cos(p+F)*c,a=Math.sin(p+F)*c,t.arc(n-o,i-a,l,p-M,p-L),t.arc(n+a,i-o,l,p-L,p),t.arc(n+o,i+a,l,p,p+L),t.arc(n-a,i+o,l,p+L,p+M),t.closePath();break;case"rect":if(!d){c=Math.SQRT1_2*f,u=r?r/2:c,t.rect(n-u,i-c,2*u,2*c);break}p+=F;case"rectRot":o=Math.cos(p)*f,a=Math.sin(p)*f,t.moveTo(n-o,i-a),t.lineTo(n+a,i-o),t.lineTo(n+o,i+a),t.lineTo(n-a,i+o),t.closePath();break;case"crossRot":p+=F;case"cross":o=Math.cos(p)*f,a=Math.sin(p)*f,t.moveTo(n-o,i-a),t.lineTo(n+o,i+a),t.moveTo(n+a,i-o),t.lineTo(n-a,i+o);break;case"star":o=Math.cos(p)*f,a=Math.sin(p)*f,t.moveTo(n-o,i-a),t.lineTo(n+o,i+a),t.moveTo(n+a,i-o),t.lineTo(n-a,i+o),p+=F,o=Math.cos(p)*f,a=Math.sin(p)*f,t.moveTo(n-o,i-a),t.lineTo(n+o,i+a),t.moveTo(n+a,i-o),t.lineTo(n-a,i+o);break;case"line":o=r?r/2:Math.cos(p)*f,a=Math.sin(p)*f,t.moveTo(n-o,i-a),t.lineTo(n+o,i+a);break;case"dash":t.moveTo(n,i),t.lineTo(n+Math.cos(p)*f,i+Math.sin(p)*f)}t.fill(),e.borderWidth>0&&t.stroke()}}function ce(t,e,n){return n=n||.5,!e||t&&t.x>e.left-n&&t.x<e.right+n&&t.y>e.top-n&&t.y<e.bottom+n}function le(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function ue(t){t.restore()}function he(t,e,n,i,r){if(!e)return t.lineTo(n.x,n.y);if("middle"===r){const i=(e.x+n.x)/2;t.lineTo(i,e.y),t.lineTo(i,n.y)}else"after"===r!=!!i?t.lineTo(e.x,n.y):t.lineTo(n.x,e.y);t.lineTo(n.x,n.y)}function de(t,e,n,i){if(!e)return t.lineTo(n.x,n.y);t.bezierCurveTo(i?e.cp1x:e.cp2x,i?e.cp1y:e.cp2y,i?n.cp2x:n.cp1x,i?n.cp2y:n.cp1y,n.x,n.y)}function fe(t,e,n,i,r,s={}){const o=u(e)?e:[e],a=s.strokeWidth>0&&""!==s.strokeColor;let c,h;for(t.save(),t.font=r.string,function(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),l(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}(t,s),c=0;c<o.length;++c)h=o[c],a&&(s.strokeColor&&(t.strokeStyle=s.strokeColor),l(s.strokeWidth)||(t.lineWidth=s.strokeWidth),t.strokeText(h,n,i,s.maxWidth)),t.fillText(h,n,i,s.maxWidth),pe(t,n,i,h,s),i+=r.lineHeight;t.restore()}function pe(t,e,n,i,r){if(r.strikethrough||r.underline){const s=t.measureText(i),o=e-s.actualBoundingBoxLeft,a=e+s.actualBoundingBoxRight,c=n-s.actualBoundingBoxAscent,l=n+s.actualBoundingBoxDescent,u=r.strikethrough?(c+l)/2:l;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=r.decorationWidth||2,t.moveTo(o,u),t.lineTo(a,u),t.stroke()}}function ge(t,e){const{x:n,y:i,w:r,h:s,radius:o}=e;t.arc(n+o.topLeft,i+o.topLeft,o.topLeft,-L,M,!0),t.lineTo(n,i+s-o.bottomLeft),t.arc(n+o.bottomLeft,i+s-o.bottomLeft,o.bottomLeft,M,L,!0),t.lineTo(n+r-o.bottomRight,i+s),t.arc(n+r-o.bottomRight,i+s-o.bottomRight,o.bottomRight,L,0,!0),t.lineTo(n+r,i+o.topRight),t.arc(n+r-o.topRight,i+o.topRight,o.topRight,0,-L,!0),t.lineTo(n+o.topLeft,i)}const me=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),ye=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function ve(t,e){const n=(""+t).match(me);if(!n||"normal"===n[1])return 1.2*e;switch(t=+n[2],n[3]){case"px":return t;case"%":t/=100}return e*t}function be(t,e){const n={},i=h(e),r=i?Object.keys(e):e,s=h(t)?i?n=>p(t[n],t[e[n]]):e=>t[e]:()=>t;for(const t of r)n[t]=+s(t)||0;return n}function we(t){return be(t,{top:"y",right:"x",bottom:"y",left:"x"})}function _e(t){return be(t,["topLeft","topRight","bottomLeft","bottomRight"])}function xe(t){const e=we(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function Ie(t,e){t=t||{},e=e||ee.font;let n=p(t.size,e.size);"string"==typeof n&&(n=parseInt(n,10));let i=p(t.style,e.style);i&&!(""+i).match(ye)&&(console.warn('Invalid font style specified: "'+i+'"'),i="");const r={family:p(t.family,e.family),lineHeight:ve(p(t.lineHeight,e.lineHeight),n),size:n,style:i,weight:p(t.weight,e.weight),string:""};return r.string=function(t){return!t||l(t.size)||l(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}(r),r}function Ee(t,e,n,i){let r,s,o,a=!0;for(r=0,s=t.length;r<s;++r)if(o=t[r],void 0!==o&&(void 0!==e&&"function"==typeof o&&(o=o(e),a=!1),void 0!==n&&u(o)&&(o=o[n%o.length],a=!1),void 0!==o))return i&&!a&&(i.cacheable=!1),o}function Te(t,e){return Object.assign(Object.create(t),e)}function ke(t,e=[""],n=t,i,r=()=>t[0]){C(i)||(i=Fe("_fallback",t));const s={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:n,_fallback:i,_getTarget:r,override:r=>ke([r,...t],e,n,i)};return new Proxy(s,{deleteProperty:(e,n)=>(delete e[n],delete e._keys,delete t[0][n],!0),get:(n,i)=>Me(n,i,(()=>function(t,e,n,i){let r;for(const s of e)if(r=Fe(Ae(s,t),n),C(r))return De(t,r)?Ne(n,i,t,r):r}(i,e,t,n))),getOwnPropertyDescriptor:(t,e)=>Reflect.getOwnPropertyDescriptor(t._scopes[0],e),getPrototypeOf:()=>Reflect.getPrototypeOf(t[0]),has:(t,e)=>Ve(t).includes(e),ownKeys:t=>Ve(t),set(t,e,n){const i=t._storage||(t._storage=r());return t[e]=i[e]=n,delete t._keys,!0}})}function Se(t,e,n,i){const r={_cacheable:!1,_proxy:t,_context:e,_subProxy:n,_stack:new Set,_descriptors:Ce(t,i),setContext:e=>Se(t,e,n,i),override:r=>Se(t.override(r),e,n,i)};return new Proxy(r,{deleteProperty:(e,n)=>(delete e[n],delete t[n],!0),get:(t,e,n)=>Me(t,e,(()=>function(t,e,n){const{_proxy:i,_context:r,_subProxy:s,_descriptors:o}=t;let a=i[e];return A(a)&&o.isScriptable(e)&&(a=function(t,e,n,i){const{_proxy:r,_context:s,_subProxy:o,_stack:a}=n;if(a.has(t))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+t);return a.add(t),e=e(s,o||i),a.delete(t),De(t,e)&&(e=Ne(r._scopes,r,t,e)),e}(e,a,t,n)),u(a)&&a.length&&(a=function(t,e,n,i){const{_proxy:r,_context:s,_subProxy:o,_descriptors:a}=n;if(C(s.index)&&i(t))e=e[s.index%e.length];else if(h(e[0])){const n=e,i=r._scopes.filter((t=>t!==n));e=[];for(const c of n){const n=Ne(i,r,t,c);e.push(Se(n,s,o&&o[t],a))}}return e}(e,a,t,o.isIndexable)),De(e,a)&&(a=Se(a,r,s&&s[e],o)),a}(t,e,n))),getOwnPropertyDescriptor:(e,n)=>e._descriptors.allKeys?Reflect.has(t,n)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,n),getPrototypeOf:()=>Reflect.getPrototypeOf(t),has:(e,n)=>Reflect.has(t,n),ownKeys:()=>Reflect.ownKeys(t),set:(e,n,i)=>(t[n]=i,delete e[n],!0)})}function Ce(t,e={scriptable:!0,indexable:!0}){const{_scriptable:n=e.scriptable,_indexable:i=e.indexable,_allKeys:r=e.allKeys}=t;return{allKeys:r,scriptable:n,indexable:i,isScriptable:A(n)?n:()=>n,isIndexable:A(i)?i:()=>i}}const Ae=(t,e)=>t?t+S(e):e,De=(t,e)=>h(e)&&"adapters"!==t&&(null===Object.getPrototypeOf(e)||e.constructor===Object);function Me(t,e,n){if(Object.prototype.hasOwnProperty.call(t,e))return t[e];const i=n();return t[e]=i,i}function Oe(t,e,n){return A(t)?t(e,n):t}const Pe=(t,e)=>!0===t?e:"string"==typeof t?k(e,t):void 0;function Re(t,e,n,i,r){for(const s of e){const e=Pe(n,s);if(e){t.add(e);const s=Oe(e._fallback,n,r);if(C(s)&&s!==n&&s!==i)return s}else if(!1===e&&C(i)&&n!==i)return null}return!1}function Ne(t,e,n,i){const r=e._rootScopes,s=Oe(e._fallback,n,i),o=[...t,...r],a=new Set;a.add(i);let c=Le(a,o,n,s||n,i);return null!==c&&(!C(s)||s===n||(c=Le(a,o,s,c,i),null!==c))&&ke(Array.from(a),[""],r,s,(()=>function(t,e,n){const i=t._getTarget();e in i||(i[e]={});const r=i[e];return u(r)&&h(n)?n:r}(e,n,i)))}function Le(t,e,n,i,r){for(;n;)n=Re(t,e,n,i,r);return n}function Fe(t,e){for(const n of e){if(!n)continue;const e=n[t];if(C(e))return e}}function Ve(t){let e=t._keys;return e||(e=t._keys=function(t){const e=new Set;for(const n of t)for(const t of Object.keys(n).filter((t=>!t.startsWith("_"))))e.add(t);return Array.from(e)}(t._scopes)),e}function Be(t,e,n,i){const{iScale:r}=t,{key:s="r"}=this._parsing,o=new Array(i);let a,c,l,u;for(a=0,c=i;a<c;++a)l=a+n,u=e[l],o[a]={r:r.parse(k(u,s),l)};return o}const Ue=Number.EPSILON||1e-14,je=(t,e)=>e<t.length&&!t[e].skip&&t[e],ze=t=>"x"===t?"y":"x";function qe(t,e,n,i){const r=t.skip?e:t,s=e,o=n.skip?e:n,a=Q(s,r),c=Q(o,s);let l=a/(a+c),u=c/(a+c);l=isNaN(l)?0:l,u=isNaN(u)?0:u;const h=i*l,d=i*u;return{previous:{x:s.x-h*(o.x-r.x),y:s.y-h*(o.y-r.y)},next:{x:s.x+d*(o.x-r.x),y:s.y+d*(o.y-r.y)}}}function $e(t,e,n){return Math.max(Math.min(t,n),e)}function He(t,e,n,i,r){let s,o,a,c;if(e.spanGaps&&(t=t.filter((t=>!t.skip))),"monotone"===e.cubicInterpolationMode)!function(t,e="x"){const n=ze(e),i=t.length,r=Array(i).fill(0),s=Array(i);let o,a,c,l=je(t,0);for(o=0;o<i;++o)if(a=c,c=l,l=je(t,o+1),c){if(l){const t=l[e]-c[e];r[o]=0!==t?(l[n]-c[n])/t:0}s[o]=a?l?U(r[o-1])!==U(r[o])?0:(r[o-1]+r[o])/2:r[o-1]:r[o]}!function(t,e,n){const i=t.length;let r,s,o,a,c,l=je(t,0);for(let u=0;u<i-1;++u)c=l,l=je(t,u+1),c&&l&&(q(e[u],0,Ue)?n[u]=n[u+1]=0:(r=n[u]/e[u],s=n[u+1]/e[u],a=Math.pow(r,2)+Math.pow(s,2),a<=9||(o=3/Math.sqrt(a),n[u]=r*o*e[u],n[u+1]=s*o*e[u])))}(t,r,s),function(t,e,n="x"){const i=ze(n),r=t.length;let s,o,a,c=je(t,0);for(let l=0;l<r;++l){if(o=a,a=c,c=je(t,l+1),!a)continue;const r=a[n],u=a[i];o&&(s=(r-o[n])/3,a[`cp1${n}`]=r-s,a[`cp1${i}`]=u-s*e[l]),c&&(s=(c[n]-r)/3,a[`cp2${n}`]=r+s,a[`cp2${i}`]=u+s*e[l])}}(t,s,e)}(t,r);else{let n=i?t[t.length-1]:t[0];for(s=0,o=t.length;s<o;++s)a=t[s],c=qe(n,a,t[Math.min(s+1,o-(i?0:1))%o],e.tension),a.cp1x=c.previous.x,a.cp1y=c.previous.y,a.cp2x=c.next.x,a.cp2y=c.next.y,n=a}e.capBezierPoints&&function(t,e){let n,i,r,s,o,a=ce(t[0],e);for(n=0,i=t.length;n<i;++n)o=s,s=a,a=n<i-1&&ce(t[n+1],e),s&&(r=t[n],o&&(r.cp1x=$e(r.cp1x,e.left,e.right),r.cp1y=$e(r.cp1y,e.top,e.bottom)),a&&(r.cp2x=$e(r.cp2x,e.left,e.right),r.cp2y=$e(r.cp2y,e.top,e.bottom)))}(t,n)}function Ke(){return"undefined"!=typeof window&&"undefined"!=typeof document}function Ge(t){let e=t.parentNode;return e&&"[object ShadowRoot]"===e.toString()&&(e=e.host),e}function We(t,e,n){let i;return"string"==typeof t?(i=parseInt(t,10),-1!==t.indexOf("%")&&(i=i/100*e.parentNode[n])):i=t,i}const Qe=t=>window.getComputedStyle(t,null),Ye=["top","right","bottom","left"];function Xe(t,e,n){const i={};n=n?"-"+n:"";for(let r=0;r<4;r++){const s=Ye[r];i[s]=parseFloat(t[e+"-"+s+n])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}function Je(t,e){if("native"in t)return t;const{canvas:n,currentDevicePixelRatio:i}=e,r=Qe(n),s="border-box"===r.boxSizing,o=Xe(r,"padding"),a=Xe(r,"border","width"),{x:c,y:l,box:u}=function(t,e){const n=t.touches,i=n&&n.length?n[0]:t,{offsetX:r,offsetY:s}=i;let o,a,c=!1;if(((t,e,n)=>(t>0||e>0)&&(!n||!n.shadowRoot))(r,s,t.target))o=r,a=s;else{const t=e.getBoundingClientRect();o=i.clientX-t.left,a=i.clientY-t.top,c=!0}return{x:o,y:a,box:c}}(t,n),h=o.left+(u&&a.left),d=o.top+(u&&a.top);let{width:f,height:p}=e;return s&&(f-=o.width+a.width,p-=o.height+a.height),{x:Math.round((c-h)/f*n.width/i),y:Math.round((l-d)/p*n.height/i)}}const Ze=t=>Math.round(10*t)/10;function tn(t,e,n){const i=e||1,r=Math.floor(t.height*i),s=Math.floor(t.width*i);t.height=r/i,t.width=s/i;const o=t.canvas;return o.style&&(n||!o.style.height&&!o.style.width)&&(o.style.height=`${t.height}px`,o.style.width=`${t.width}px`),(t.currentDevicePixelRatio!==i||o.height!==r||o.width!==s)&&(t.currentDevicePixelRatio=i,o.height=r,o.width=s,t.ctx.setTransform(i,0,0,i,0,0),!0)}const en=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(t){}return t}();function nn(t,e){const n=function(t,e){return Qe(t).getPropertyValue(e)}(t,e),i=n&&n.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function rn(t,e,n,i){return{x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)}}function sn(t,e,n,i){return{x:t.x+n*(e.x-t.x),y:"middle"===i?n<.5?t.y:e.y:"after"===i?n<1?t.y:e.y:n>0?e.y:t.y}}function on(t,e,n,i){const r={x:t.cp2x,y:t.cp2y},s={x:e.cp1x,y:e.cp1y},o=rn(t,r,n),a=rn(r,s,n),c=rn(s,e,n),l=rn(o,a,n),u=rn(a,c,n);return rn(l,u,n)}const an=new Map;function cn(t,e,n){return function(t,e){e=e||{};const n=t+JSON.stringify(e);let i=an.get(n);return i||(i=new Intl.NumberFormat(t,e),an.set(n,i)),i}(e,n).format(t)}function ln(t,e,n){return t?function(t,e){return{x:n=>t+t+e-n,setWidth(t){e=t},textAlign:t=>"center"===t?t:"right"===t?"left":"right",xPlus:(t,e)=>t-e,leftForLtr:(t,e)=>t-e}}(e,n):{x:t=>t,setWidth(t){},textAlign:t=>t,xPlus:(t,e)=>t+e,leftForLtr:(t,e)=>t}}function un(t,e){let n,i;"ltr"!==e&&"rtl"!==e||(n=t.canvas.style,i=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",e,"important"),t.prevTextDirection=i)}function hn(t,e){void 0!==e&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function dn(t){return"angle"===t?{between:J,compare:Y,normalize:X}:{between:tt,compare:(t,e)=>t-e,normalize:t=>t}}function fn({start:t,end:e,count:n,loop:i,style:r}){return{start:t%n,end:e%n,loop:i&&(e-t+1)%n==0,style:r}}function pn(t,e,n){if(!n)return[t];const{property:i,start:r,end:s}=n,o=e.length,{compare:a,between:c,normalize:l}=dn(i),{start:u,end:h,loop:d,style:f}=function(t,e,n){const{property:i,start:r,end:s}=n,{between:o,normalize:a}=dn(i),c=e.length;let l,u,{start:h,end:d,loop:f}=t;if(f){for(h+=c,d+=c,l=0,u=c;l<u&&o(a(e[h%c][i]),r,s);++l)h--,d--;h%=c,d%=c}return d<h&&(d+=c),{start:h,end:d,loop:f,style:t.style}}(t,e,n),p=[];let g,m,y,v=!1,b=null;for(let t=u,n=u;t<=h;++t)m=e[t%o],m.skip||(g=l(m[i]),g!==y&&(v=c(g,r,s),null===b&&(v||c(r,y,g)&&0!==a(r,y))&&(b=0===a(g,r)?t:n),null!==b&&(!v||0===a(s,g)||c(s,y,g))&&(p.push(fn({start:b,end:t,loop:d,count:o,style:f})),b=null),n=t,y=g));return null!==b&&p.push(fn({start:b,end:h,loop:d,count:o,style:f})),p}function gn(t,e){const n=[],i=t.segments;for(let r=0;r<i.length;r++){const s=pn(i[r],t.points,e);s.length&&n.push(...s)}return n}function mn(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function yn(t,e){return e&&JSON.stringify(t)!==JSON.stringify(e)}var vn=new class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,n,i){const r=e.listeners[i],s=e.duration;r.forEach((i=>i({chart:t,initial:e.initial,numSteps:s,currentStep:Math.min(n-e.start,s)})))}_refresh(){this._request||(this._running=!0,this._request=at.call(window,(()=>{this._update(),this._request=null,this._running&&this._refresh()})))}_update(t=Date.now()){let e=0;this._charts.forEach(((n,i)=>{if(!n.running||!n.items.length)return;const r=n.items;let s,o=r.length-1,a=!1;for(;o>=0;--o)s=r[o],s._active?(s._total>n.duration&&(n.duration=s._total),s.tick(t),a=!0):(r[o]=r[r.length-1],r.pop());a&&(i.draw(),this._notify(i,n,t,"progress")),r.length||(n.running=!1,this._notify(i,n,t,"complete"),n.initial=!1),e+=r.length})),this._lastDate=t,0===e&&(this._running=!1)}_getAnims(t){const e=this._charts;let n=e.get(t);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,n)),n}listen(t,e,n){this._getAnims(t).listeners[e].push(n)}add(t,e){e&&e.length&&this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce(((t,e)=>Math.max(t,e._duration)),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!!(e&&e.running&&e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const n=e.items;let i=n.length-1;for(;i>=0;--i)n[i].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}};const bn="transparent",wn={boolean:(t,e,n)=>n>.5?e:t,color(t,e,n){const i=Qt(t||bn),r=i.valid&&Qt(e||bn);return r&&r.valid?r.mix(i,n).hexString():e},number:(t,e,n)=>t+(e-t)*n};class _n{constructor(t,e,n,i){const r=e[n];i=Ee([t.to,i,r,t.from]);const s=Ee([t.from,r,i]);this._active=!0,this._fn=t.fn||wn[t.type||typeof s],this._easing=mt[t.easing]||mt.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=n,this._from=s,this._to=i,this._promises=void 0}active(){return this._active}update(t,e,n){if(this._active){this._notify(!1);const i=this._target[this._prop],r=n-this._start,s=this._duration-r;this._start=n,this._duration=Math.floor(Math.max(s,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=Ee([t.to,e,i,t.from]),this._from=Ee([t.from,i,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,n=this._duration,i=this._prop,r=this._from,s=this._loop,o=this._to;let a;if(this._active=r!==o&&(s||e<n),!this._active)return this._target[i]=o,void this._notify(!0);e<0?this._target[i]=r:(a=e/n%2,a=s&&a>1?2-a:a,a=this._easing(Math.min(1,Math.max(0,a))),this._target[i]=this._fn(r,o,a))}wait(){const t=this._promises||(this._promises=[]);return new Promise(((e,n)=>{t.push({res:e,rej:n})}))}_notify(t){const e=t?"res":"rej",n=this._promises||[];for(let t=0;t<n.length;t++)n[t][e]()}}ee.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});const xn=Object.keys(ee.animation);ee.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>"onProgress"!==t&&"onComplete"!==t&&"fn"!==t}),ee.set("animations",{colors:{type:"color",properties:["color","borderColor","backgroundColor"]},numbers:{type:"number",properties:["x","y","borderWidth","radius","tension"]}}),ee.describe("animations",{_fallback:"animation"}),ee.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>0|t}}}});class In{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!h(t))return;const e=this._properties;Object.getOwnPropertyNames(t).forEach((n=>{const i=t[n];if(!h(i))return;const r={};for(const t of xn)r[t]=i[t];(u(i.properties)&&i.properties||[n]).forEach((t=>{t!==n&&e.has(t)||e.set(t,r)}))}))}_animateOptions(t,e){const n=e.options,i=function(t,e){if(!e)return;let n=t.options;if(n)return n.$shared&&(t.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n;t.options=e}(t,n);if(!i)return[];const r=this._createAnimations(i,n);return n.$shared&&function(t,e){const n=[],i=Object.keys(e);for(let e=0;e<i.length;e++){const r=t[i[e]];r&&r.active()&&n.push(r.wait())}return Promise.all(n)}(t.options.$animations,n).then((()=>{t.options=n}),(()=>{})),r}_createAnimations(t,e){const n=this._properties,i=[],r=t.$animations||(t.$animations={}),s=Object.keys(e),o=Date.now();let a;for(a=s.length-1;a>=0;--a){const c=s[a];if("$"===c.charAt(0))continue;if("options"===c){i.push(...this._animateOptions(t,e));continue}const l=e[c];let u=r[c];const h=n.get(c);if(u){if(h&&u.active()){u.update(h,l,o);continue}u.cancel()}h&&h.duration?(r[c]=u=new _n(h,t,c,l),i.push(u)):t[c]=l}return i}update(t,e){if(0===this._properties.size)return void Object.assign(t,e);const n=this._createAnimations(t,e);return n.length?(vn.add(this._chart,n),!0):void 0}}function En(t,e){const n=t&&t.options||{},i=n.reverse,r=void 0===n.min?e:0,s=void 0===n.max?e:0;return{start:i?s:r,end:i?r:s}}function Tn(t,e){const n=[],i=t._getSortedDatasetMetas(e);let r,s;for(r=0,s=i.length;r<s;++r)n.push(i[r].index);return n}function kn(t,e,n,i={}){const r=t.keys,s="single"===i.mode;let o,a,c,l;if(null!==e){for(o=0,a=r.length;o<a;++o){if(c=+r[o],c===n){if(i.all)continue;break}l=t.values[c],d(l)&&(s||0===e||U(e)===U(l))&&(e+=l)}return e}}function Sn(t,e){const n=t&&t.options.stacked;return n||void 0===n&&void 0!==e.stack}function Cn(t,e,n){const i=t[e]||(t[e]={});return i[n]||(i[n]={})}function An(t,e,n,i){for(const r of e.getMatchingVisibleMetas(i).reverse()){const e=t[r.index];if(n&&e>0||!n&&e<0)return r.index}return null}function Dn(t,e){const{chart:n,_cachedMeta:i}=t,r=n._stacks||(n._stacks={}),{iScale:s,vScale:o,index:a}=i,c=s.axis,l=o.axis,u=function(t,e,n){return`${t.id}.${e.id}.${n.stack||n.type}`}(s,o,i),h=e.length;let d;for(let t=0;t<h;++t){const n=e[t],{[c]:s,[l]:h}=n;d=(n._stacks||(n._stacks={}))[l]=Cn(r,u,s),d[a]=h,d._top=An(d,o,!0,i.type),d._bottom=An(d,o,!1,i.type)}}function Mn(t,e){const n=t.scales;return Object.keys(n).filter((t=>n[t].axis===e)).shift()}function On(t,e){const n=t.controller.index,i=t.vScale&&t.vScale.axis;if(i){e=e||t._parsed;for(const t of e){const e=t._stacks;if(!e||void 0===e[i]||void 0===e[i][n])return;delete e[i][n]}}}const Pn=t=>"reset"===t||"none"===t,Rn=(t,e)=>e?t:Object.assign({},t);class Nn{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=Sn(t.vScale,t),this.addElements()}updateIndex(t){this.index!==t&&On(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,n=this.getDataset(),i=(t,e,n,i)=>"x"===t?e:"r"===t?i:n,r=e.xAxisID=p(n.xAxisID,Mn(t,"x")),s=e.yAxisID=p(n.yAxisID,Mn(t,"y")),o=e.rAxisID=p(n.rAxisID,Mn(t,"r")),a=e.indexAxis,c=e.iAxisID=i(a,r,s,o),l=e.vAxisID=i(a,s,r,o);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(s),e.rScale=this.getScaleForId(o),e.iScale=this.getScaleForId(c),e.vScale=this.getScaleForId(l)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&st(this._data,this),t._stacked&&On(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),n=this._data;if(h(e))this._data=function(t){const e=Object.keys(t),n=new Array(e.length);let i,r,s;for(i=0,r=e.length;i<r;++i)s=e[i],n[i]={x:s,y:t[s]};return n}(e);else if(n!==e){if(n){st(n,this);const t=this._cachedMeta;On(t),t._parsed=[]}e&&Object.isExtensible(e)&&((i=e)._chartjs?i._chartjs.listeners.push(this):(Object.defineProperty(i,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[this]}}),rt.forEach((t=>{const e="_onData"+S(t),n=i[t];Object.defineProperty(i,t,{configurable:!0,enumerable:!1,value(...t){const r=n.apply(this,t);return i._chartjs.listeners.forEach((n=>{"function"==typeof n[e]&&n[e](...t)})),r}})})))),this._syncList=[],this._data=e}var i}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,n=this.getDataset();let i=!1;this._dataCheck();const r=e._stacked;e._stacked=Sn(e.vScale,e),e.stack!==n.stack&&(i=!0,On(e),e.stack=n.stack),this._resyncElements(t),(i||r!==e._stacked)&&Dn(this,e._parsed)}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),n=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:n,_data:i}=this,{iScale:r,_stacked:s}=n,o=r.axis;let a,c,l,d=0===t&&e===i.length||n._sorted,f=t>0&&n._parsed[t-1];if(!1===this._parsing)n._parsed=i,n._sorted=!0,l=i;else{l=u(i[t])?this.parseArrayData(n,i,t,e):h(i[t])?this.parseObjectData(n,i,t,e):this.parsePrimitiveData(n,i,t,e);const r=()=>null===c[o]||f&&c[o]<f[o];for(a=0;a<e;++a)n._parsed[a+t]=c=l[a],d&&(r()&&(d=!1),f=c);n._sorted=d}s&&Dn(this,l)}parsePrimitiveData(t,e,n,i){const{iScale:r,vScale:s}=t,o=r.axis,a=s.axis,c=r.getLabels(),l=r===s,u=new Array(i);let h,d,f;for(h=0,d=i;h<d;++h)f=h+n,u[h]={[o]:l||r.parse(c[f],f),[a]:s.parse(e[f],f)};return u}parseArrayData(t,e,n,i){const{xScale:r,yScale:s}=t,o=new Array(i);let a,c,l,u;for(a=0,c=i;a<c;++a)l=a+n,u=e[l],o[a]={x:r.parse(u[0],l),y:s.parse(u[1],l)};return o}parseObjectData(t,e,n,i){const{xScale:r,yScale:s}=t,{xAxisKey:o="x",yAxisKey:a="y"}=this._parsing,c=new Array(i);let l,u,h,d;for(l=0,u=i;l<u;++l)h=l+n,d=e[h],c[l]={x:r.parse(k(d,o),h),y:s.parse(k(d,a),h)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,n){const i=this.chart,r=this._cachedMeta,s=e[t.axis];return kn({keys:Tn(i,!0),values:e._stacks[t.axis]},s,r.index,{mode:n})}updateRangeFromParsed(t,e,n,i){const r=n[e.axis];let s=null===r?NaN:r;const o=i&&n._stacks[e.axis];i&&o&&(i.values=o,s=kn(i,r,this._cachedMeta.index)),t.min=Math.min(t.min,s),t.max=Math.max(t.max,s)}getMinMax(t,e){const n=this._cachedMeta,i=n._parsed,r=n._sorted&&t===n.iScale,s=i.length,o=this._getOtherScale(t),a=((t,e,n)=>t&&!e.hidden&&e._stacked&&{keys:Tn(n,!0),values:null})(e,n,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:l,max:u}=function(t){const{min:e,max:n,minDefined:i,maxDefined:r}=t.getUserBounds();return{min:i?e:Number.NEGATIVE_INFINITY,max:r?n:Number.POSITIVE_INFINITY}}(o);let h,f;function p(){f=i[h];const e=f[o.axis];return!d(f[t.axis])||l>e||u<e}for(h=0;h<s&&(p()||(this.updateRangeFromParsed(c,t,f,a),!r));++h);if(r)for(h=s-1;h>=0;--h)if(!p()){this.updateRangeFromParsed(c,t,f,a);break}return c}getAllParsedValues(t){const e=this._cachedMeta._parsed,n=[];let i,r,s;for(i=0,r=e.length;i<r;++i)s=e[i][t.axis],d(s)&&n.push(s);return n}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,n=e.iScale,i=e.vScale,r=this.getParsed(t);return{label:n?""+n.getLabelForValue(r[n.axis]):"",value:i?""+i.getLabelForValue(r[i.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=function(t){let e,n,i,r;return h(t)?(e=t.top,n=t.right,i=t.bottom,r=t.left):e=n=i=r=t,{top:e,right:n,bottom:i,left:r,disabled:!1===t}}(p(this.options.clip,function(t,e,n){if(!1===n)return!1;const i=En(t,n),r=En(e,n);return{top:r.end,right:i.end,bottom:r.start,left:i.start}}(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,n=this._cachedMeta,i=n.data||[],r=e.chartArea,s=[],o=this._drawStart||0,a=this._drawCount||i.length-o,c=this.options.drawActiveElementsOnTop;let l;for(n.dataset&&n.dataset.draw(t,r,o,a),l=o;l<o+a;++l){const e=i[l];e.hidden||(e.active&&c?s.push(e):e.draw(t,r))}for(l=0;l<s.length;++l)s[l].draw(t,r)}getStyle(t,e){const n=e?"active":"default";return void 0===t&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(t||0,n)}getContext(t,e,n){const i=this.getDataset();let r;if(t>=0&&t<this._cachedMeta.data.length){const e=this._cachedMeta.data[t];r=e.$context||(e.$context=function(t,e,n){return Te(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:n,index:e,mode:"default",type:"data"})}(this.getContext(),t,e)),r.parsed=this.getParsed(t),r.raw=i.data[t],r.index=r.dataIndex=t}else r=this.$context||(this.$context=function(t,e){return Te(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),r.dataset=i,r.index=r.datasetIndex=this.index;return r.active=!!e,r.mode=n,r}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",n){const i="active"===e,r=this._cachedDataOpts,s=t+"-"+e,o=r[s],a=this.enableOptionSharing&&C(n);if(o)return Rn(o,a);const c=this.chart.config,l=c.datasetElementScopeKeys(this._type,t),u=i?[`${t}Hover`,"hover",t,""]:[t,""],h=c.getOptionScopes(this.getDataset(),l),d=Object.keys(ee.elements[t]),f=c.resolveNamedOptions(h,d,(()=>this.getContext(n,i)),u);return f.$shared&&(f.$shared=a,r[s]=Object.freeze(Rn(f,a))),f}_resolveAnimations(t,e,n){const i=this.chart,r=this._cachedDataOpts,s=`animation-${e}`,o=r[s];if(o)return o;let a;if(!1!==i.options.animation){const i=this.chart.config,r=i.datasetAnimationScopeKeys(this._type,e),s=i.getOptionScopes(this.getDataset(),r);a=i.createResolver(s,this.getContext(t,n,e))}const c=new In(i,a&&a.animations);return a&&a._cacheable&&(r[s]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||Pn(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const n=this.resolveDataElementOptions(t,e),i=this._sharedOptions,r=this.getSharedOptions(n),s=this.includeOptions(e,r)||r!==i;return this.updateSharedOptions(r,e,n),{sharedOptions:r,includeOptions:s}}updateElement(t,e,n,i){Pn(i)?Object.assign(t,n):this._resolveAnimations(e,i).update(t,n)}updateSharedOptions(t,e,n){t&&!Pn(e)&&this._resolveAnimations(void 0,e).update(t,n)}_setStyle(t,e,n,i){t.active=i;const r=this.getStyle(e,i);this._resolveAnimations(e,n,i).update(t,{options:!i&&this.getSharedOptions(r)||r})}removeHoverStyle(t,e,n){this._setStyle(t,n,"active",!1)}setHoverStyle(t,e,n){this._setStyle(t,n,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,n=this._cachedMeta.data;for(const[t,e,n]of this._syncList)this[t](e,n);this._syncList=[];const i=n.length,r=e.length,s=Math.min(r,i);s&&this.parse(0,s),r>i?this._insertElements(i,r-i,t):r<i&&this._removeElements(r,i-r)}_insertElements(t,e,n=!0){const i=this._cachedMeta,r=i.data,s=t+e;let o;const a=t=>{for(t.length+=e,o=t.length-1;o>=s;o--)t[o]=t[o-e]};for(a(r),o=t;o<s;++o)r[o]=new this.dataElementType;this._parsing&&a(i._parsed),this.parse(t,e),n&&this.updateElements(r,t,e,"reset")}updateElements(t,e,n,i){}_removeElements(t,e){const n=this._cachedMeta;if(this._parsing){const i=n._parsed.splice(t,e);n._stacked&&On(n,i)}n.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,n,i]=t;this[e](n,i)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const n=arguments.length-2;n&&this._sync(["_insertElements",t,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function Ln(t){const e=t.iScale,n=function(t,e){if(!t._cache.$bar){const n=t.getMatchingVisibleMetas(e);let i=[];for(let e=0,r=n.length;e<r;e++)i=i.concat(n[e].controller.getAllParsedValues(t));t._cache.$bar=ot(i.sort(((t,e)=>t-e)))}return t._cache.$bar}(e,t.type);let i,r,s,o,a=e._length;const c=()=>{32767!==s&&-32768!==s&&(C(o)&&(a=Math.min(a,Math.abs(s-o)||a)),o=s)};for(i=0,r=n.length;i<r;++i)s=e.getPixelForValue(n[i]),c();for(o=void 0,i=0,r=e.ticks.length;i<r;++i)s=e.getPixelForTick(i),c();return a}function Fn(t,e,n,i){return u(t)?function(t,e,n,i){const r=n.parse(t[0],i),s=n.parse(t[1],i),o=Math.min(r,s),a=Math.max(r,s);let c=o,l=a;Math.abs(o)>Math.abs(a)&&(c=a,l=o),e[n.axis]=l,e._custom={barStart:c,barEnd:l,start:r,end:s,min:o,max:a}}(t,e,n,i):e[n.axis]=n.parse(t,i),e}function Vn(t,e,n,i){const r=t.iScale,s=t.vScale,o=r.getLabels(),a=r===s,c=[];let l,u,h,d;for(l=n,u=n+i;l<u;++l)d=e[l],h={},h[r.axis]=a||r.parse(o[l],l),c.push(Fn(d,h,s,l));return c}function Bn(t){return t&&void 0!==t.barStart&&void 0!==t.barEnd}function Un(t,e,n,i){let r=e.borderSkipped;const s={};if(!r)return void(t.borderSkipped=s);if(!0===r)return void(t.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:o,end:a,reverse:c,top:l,bottom:u}=function(t){let e,n,i,r,s;return t.horizontal?(e=t.base>t.x,n="left",i="right"):(e=t.base<t.y,n="bottom",i="top"),e?(r="end",s="start"):(r="start",s="end"),{start:n,end:i,reverse:e,top:r,bottom:s}}(t);"middle"===r&&n&&(t.enableBorderRadius=!0,(n._top||0)===i?r=l:(n._bottom||0)===i?r=u:(s[jn(u,o,a,c)]=!0,r=l)),s[jn(r,o,a,c)]=!0,t.borderSkipped=s}function jn(t,e,n,i){var r,s,o;return i?(o=n,t=zn(t=(r=t)===(s=e)?o:r===o?s:r,n,e)):t=zn(t,e,n),t}function zn(t,e,n){return"start"===t?e:"end"===t?n:t}function qn(t,{inflateAmount:e},n){t.inflateAmount="auto"===e?1===n?.33:0:e}Nn.defaults={},Nn.prototype.datasetElementType=null,Nn.prototype.dataElementType=null;class $n extends Nn{parsePrimitiveData(t,e,n,i){return Vn(t,e,n,i)}parseArrayData(t,e,n,i){return Vn(t,e,n,i)}parseObjectData(t,e,n,i){const{iScale:r,vScale:s}=t,{xAxisKey:o="x",yAxisKey:a="y"}=this._parsing,c="x"===r.axis?o:a,l="x"===s.axis?o:a,u=[];let h,d,f,p;for(h=n,d=n+i;h<d;++h)p=e[h],f={},f[r.axis]=r.parse(k(p,c),h),u.push(Fn(k(p,l),f,s,h));return u}updateRangeFromParsed(t,e,n,i){super.updateRangeFromParsed(t,e,n,i);const r=n._custom;r&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:n,vScale:i}=e,r=this.getParsed(t),s=r._custom,o=Bn(s)?"["+s.start+", "+s.end+"]":""+i.getLabelForValue(r[i.axis]);return{label:""+n.getLabelForValue(r[n.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize(),this._cachedMeta.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,n,i){const r="reset"===i,{index:s,_cachedMeta:{vScale:o}}=this,a=o.getBasePixel(),c=o.isHorizontal(),u=this._getRuler(),{sharedOptions:h,includeOptions:d}=this._getSharedOptions(e,i);for(let f=e;f<e+n;f++){const e=this.getParsed(f),n=r||l(e[o.axis])?{base:a,head:a}:this._calculateBarValuePixels(f),p=this._calculateBarIndexPixels(f,u),g=(e._stacks||{})[o.axis],m={horizontal:c,base:n.base,enableBorderRadius:!g||Bn(e._custom)||s===g._top||s===g._bottom,x:c?n.head:p.center,y:c?p.center:n.head,height:c?p.size:Math.abs(n.size),width:c?Math.abs(n.size):p.size};d&&(m.options=h||this.resolveDataElementOptions(f,t[f].active?"active":i));const y=m.options||t[f].options;Un(m,y,g,s),qn(m,y,u.ratio),this.updateElement(t[f],f,m,i)}}_getStacks(t,e){const{iScale:n}=this._cachedMeta,i=n.getMatchingVisibleMetas(this._type).filter((t=>t.controller.options.grouped)),r=n.options.stacked,s=[],o=t=>{const n=t.controller.getParsed(e),i=n&&n[t.vScale.axis];if(l(i)||isNaN(i))return!0};for(const n of i)if((void 0===e||!o(n))&&((!1===r||-1===s.indexOf(n.stack)||void 0===r&&void 0===n.stack)&&s.push(n.stack),n.index===t))break;return s.length||s.push(void 0),s}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,e,n){const i=this._getStacks(t,n),r=void 0!==e?i.indexOf(e):-1;return-1===r?i.length-1:r}_getRuler(){const t=this.options,e=this._cachedMeta,n=e.iScale,i=[];let r,s;for(r=0,s=e.data.length;r<s;++r)i.push(n.getPixelForValue(this.getParsed(r)[n.axis],r));const o=t.barThickness;return{min:o||Ln(e),pixels:i,start:n._startPixel,end:n._endPixel,stackCount:this._getStackCount(),scale:n,grouped:t.grouped,ratio:o?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:n},options:{base:i,minBarLength:r}}=this,s=i||0,o=this.getParsed(t),a=o._custom,c=Bn(a);let u,h,d=o[e.axis],f=0,p=n?this.applyStack(e,o,n):d;p!==d&&(f=p-d,p=d),c&&(d=a.barStart,p=a.barEnd-a.barStart,0!==d&&U(d)!==U(a.barEnd)&&(f=0),f+=d);const g=l(i)||c?f:i;let m=e.getPixelForValue(g);if(u=this.chart.getDataVisibility(t)?e.getPixelForValue(f+p):m,h=u-m,Math.abs(h)<r){h=function(t,e,n){return 0!==t?U(t):(e.isHorizontal()?1:-1)*(e.min>=n?1:-1)}(h,e,s)*r,d===s&&(m-=h/2);const t=e.getPixelForDecimal(0),n=e.getPixelForDecimal(1),i=Math.min(t,n),o=Math.max(t,n);m=Math.max(Math.min(m,o),i),u=m+h}if(m===e.getPixelForValue(s)){const t=U(h)*e.getLineWidthForValue(s)/2;m+=t,h-=t}return{size:h,base:m,head:u,center:u+h/2}}_calculateBarIndexPixels(t,e){const n=e.scale,i=this.options,r=i.skipNull,s=p(i.maxBarThickness,1/0);let o,a;if(e.grouped){const n=r?this._getStackCount(t):e.stackCount,c="flex"===i.barThickness?function(t,e,n,i){const r=e.pixels,s=r[t];let o=t>0?r[t-1]:null,a=t<r.length-1?r[t+1]:null;const c=n.categoryPercentage;null===o&&(o=s-(null===a?e.end-e.start:a-s)),null===a&&(a=s+s-o);const l=s-(s-Math.min(o,a))/2*c;return{chunk:Math.abs(a-o)/2*c/i,ratio:n.barPercentage,start:l}}(t,e,i,n):function(t,e,n,i){const r=n.barThickness;let s,o;return l(r)?(s=e.min*n.categoryPercentage,o=n.barPercentage):(s=r*i,o=1),{chunk:s/i,ratio:o,start:e.pixels[t]-s/2}}(t,e,i,n),u=this._getStackIndex(this.index,this._cachedMeta.stack,r?t:void 0);o=c.start+c.chunk*u+c.chunk/2,a=Math.min(s,c.chunk*c.ratio)}else o=n.getPixelForValue(this.getParsed(t)[n.axis],t),a=Math.min(s,e.min*e.ratio);return{base:o-a/2,head:o+a/2,center:o,size:a}}draw(){const t=this._cachedMeta,e=t.vScale,n=t.data,i=n.length;let r=0;for(;r<i;++r)null!==this.getParsed(r)[e.axis]&&n[r].draw(this._ctx)}}$n.id="bar",$n.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}},$n.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};class Hn extends Nn{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,n,i){const r=super.parsePrimitiveData(t,e,n,i);for(let t=0;t<r.length;t++)r[t]._custom=this.resolveDataElementOptions(t+n).radius;return r}parseArrayData(t,e,n,i){const r=super.parseArrayData(t,e,n,i);for(let t=0;t<r.length;t++){const i=e[n+t];r[t]._custom=p(i[2],this.resolveDataElementOptions(t+n).radius)}return r}parseObjectData(t,e,n,i){const r=super.parseObjectData(t,e,n,i);for(let t=0;t<r.length;t++){const i=e[n+t];r[t]._custom=p(i&&i.r&&+i.r,this.resolveDataElementOptions(t+n).radius)}return r}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let n=t.length-1;n>=0;--n)e=Math.max(e,t[n].size(this.resolveDataElementOptions(n))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,{xScale:n,yScale:i}=e,r=this.getParsed(t),s=n.getLabelForValue(r.x),o=i.getLabelForValue(r.y),a=r._custom;return{label:e.label,value:"("+s+", "+o+(a?", "+a:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,n,i){const r="reset"===i,{iScale:s,vScale:o}=this._cachedMeta,{sharedOptions:a,includeOptions:c}=this._getSharedOptions(e,i),l=s.axis,u=o.axis;for(let h=e;h<e+n;h++){const e=t[h],n=!r&&this.getParsed(h),d={},f=d[l]=r?s.getPixelForDecimal(.5):s.getPixelForValue(n[l]),p=d[u]=r?o.getBasePixel():o.getPixelForValue(n[u]);d.skip=isNaN(f)||isNaN(p),c&&(d.options=a||this.resolveDataElementOptions(h,e.active?"active":i),r&&(d.options.radius=0)),this.updateElement(e,h,d,i)}}resolveDataElementOptions(t,e){const n=this.getParsed(t);let i=super.resolveDataElementOptions(t,e);i.$shared&&(i=Object.assign({},i,{$shared:!1}));const r=i.radius;return"active"!==e&&(i.radius=0),i.radius+=p(n&&n._custom,r),i}}Hn.id="bubble",Hn.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}},Hn.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title:()=>""}}}};class Kn extends Nn{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const n=this.getDataset().data,i=this._cachedMeta;if(!1===this._parsing)i._parsed=n;else{let r,s,o=t=>+n[t];if(h(n[t])){const{key:t="value"}=this._parsing;o=e=>+k(n[e],t)}for(r=t,s=t+e;r<s;++r)i._parsed[r]=o(r)}}_getRotation(){return H(this.options.rotation-90)}_getCircumference(){return H(this.options.circumference)}_getRotationExtents(){let t=O,e=-O;for(let n=0;n<this.chart.data.datasets.length;++n)if(this.chart.isDatasetVisible(n)){const i=this.chart.getDatasetMeta(n).controller,r=i._getRotation(),s=i._getCircumference();t=Math.min(t,r),e=Math.max(e,r+s)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:n}=e,i=this._cachedMeta,r=i.data,s=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,o=Math.max((Math.min(n.width,n.height)-s)/2,0),a=Math.min((l=o,"string"==typeof(c=this.options.cutout)&&c.endsWith("%")?parseFloat(c)/100:c/l),1);var c,l;const u=this._getRingWeight(this.index),{circumference:h,rotation:d}=this._getRotationExtents(),{ratioX:f,ratioY:p,offsetX:m,offsetY:y}=function(t,e,n){let i=1,r=1,s=0,o=0;if(e<O){const a=t,c=a+e,l=Math.cos(a),u=Math.sin(a),h=Math.cos(c),d=Math.sin(c),f=(t,e,i)=>J(t,a,c,!0)?1:Math.max(e,e*n,i,i*n),p=(t,e,i)=>J(t,a,c,!0)?-1:Math.min(e,e*n,i,i*n),g=f(0,l,h),m=f(L,u,d),y=p(M,l,h),v=p(M+L,u,d);i=(g-y)/2,r=(m-v)/2,s=-(g+y)/2,o=-(m+v)/2}return{ratioX:i,ratioY:r,offsetX:s,offsetY:o}}(d,h,a),v=(n.width-s)/f,b=(n.height-s)/p,w=Math.max(Math.min(v,b)/2,0),_=g(this.options.radius,w),x=(_-Math.max(_*a,0))/this._getVisibleDatasetWeightTotal();this.offsetX=m*_,this.offsetY=y*_,i.total=this.calculateTotal(),this.outerRadius=_-x*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-x*u,0),this.updateElements(r,0,r.length,t)}_circumference(t,e){const n=this.options,i=this._cachedMeta,r=this._getCircumference();return e&&n.animation.animateRotate||!this.chart.getDataVisibility(t)||null===i._parsed[t]||i.data[t].hidden?0:this.calculateCircumference(i._parsed[t]*r/O)}updateElements(t,e,n,i){const r="reset"===i,s=this.chart,o=s.chartArea,a=s.options.animation,c=(o.left+o.right)/2,l=(o.top+o.bottom)/2,u=r&&a.animateScale,h=u?0:this.innerRadius,d=u?0:this.outerRadius,{sharedOptions:f,includeOptions:p}=this._getSharedOptions(e,i);let g,m=this._getRotation();for(g=0;g<e;++g)m+=this._circumference(g,r);for(g=e;g<e+n;++g){const e=this._circumference(g,r),n=t[g],s={x:c+this.offsetX,y:l+this.offsetY,startAngle:m,endAngle:m+e,circumference:e,outerRadius:d,innerRadius:h};p&&(s.options=f||this.resolveDataElementOptions(g,n.active?"active":i)),m+=e,this.updateElement(n,g,s,i)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let n,i=0;for(n=0;n<e.length;n++){const r=t._parsed[n];null===r||isNaN(r)||!this.chart.getDataVisibility(n)||e[n].hidden||(i+=Math.abs(r))}return i}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?O*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,n=this.chart,i=n.data.labels||[],r=cn(e._parsed[t],n.options.locale);return{label:i[t]||"",value:r}}getMaxBorderWidth(t){let e=0;const n=this.chart;let i,r,s,o,a;if(!t)for(i=0,r=n.data.datasets.length;i<r;++i)if(n.isDatasetVisible(i)){s=n.getDatasetMeta(i),t=s.data,o=s.controller;break}if(!t)return 0;for(i=0,r=t.length;i<r;++i)a=o.resolveDataElementOptions(i),"inner"!==a.borderAlign&&(e=Math.max(e,a.borderWidth||0,a.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let n=0,i=t.length;n<i;++n){const t=this.resolveDataElementOptions(n);e=Math.max(e,t.offset||0,t.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let n=0;n<t;++n)this.chart.isDatasetVisible(n)&&(e+=this._getRingWeight(n));return e}_getRingWeight(t){return Math.max(p(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Kn.id="doughnut",Kn.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"},Kn.descriptors={_scriptable:t=>"spacing"!==t,_indexable:t=>"spacing"!==t},Kn.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:n}}=t.legend.options;return e.labels.map(((e,i)=>{const r=t.getDatasetMeta(0).controller.getStyle(i);return{text:e,fillStyle:r.backgroundColor,strokeStyle:r.borderColor,lineWidth:r.borderWidth,pointStyle:n,hidden:!t.getDataVisibility(i),index:i}}))}return[]}},onClick(t,e,n){n.chart.toggleDataVisibility(e.index),n.chart.update()}},tooltip:{callbacks:{title:()=>"",label(t){let e=t.label;const n=": "+t.formattedValue;return u(e)?(e=e.slice(),e[0]+=n):e+=n,e}}}}};class Gn extends Nn{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:n,data:i=[],_dataset:r}=e,s=this.chart._animationsDisabled;let{start:o,count:a}=ht(e,i,s);this._drawStart=o,this._drawCount=a,dt(e)&&(o=0,a=i.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!r._decimated,n.points=i;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(n,void 0,{animated:!s,options:c},t),this.updateElements(i,o,a,t)}updateElements(t,e,n,i){const r="reset"===i,{iScale:s,vScale:o,_stacked:a,_dataset:c}=this._cachedMeta,{sharedOptions:u,includeOptions:h}=this._getSharedOptions(e,i),d=s.axis,f=o.axis,{spanGaps:p,segment:g}=this.options,m=z(p)?p:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||r||"none"===i;let v=e>0&&this.getParsed(e-1);for(let p=e;p<e+n;++p){const e=t[p],n=this.getParsed(p),b=y?e:{},w=l(n[f]),_=b[d]=s.getPixelForValue(n[d],p),x=b[f]=r||w?o.getBasePixel():o.getPixelForValue(a?this.applyStack(o,n,a):n[f],p);b.skip=isNaN(_)||isNaN(x)||w,b.stop=p>0&&Math.abs(n[d]-v[d])>m,g&&(b.parsed=n,b.raw=c.data[p]),h&&(b.options=u||this.resolveDataElementOptions(p,e.active?"active":i)),y||this.updateElement(e,p,b,i),v=n}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,n=e.options&&e.options.borderWidth||0,i=t.data||[];if(!i.length)return n;const r=i[0].size(this.resolveDataElementOptions(0)),s=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(n,r,s)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}Gn.id="line",Gn.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1},Gn.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};class Wn extends Nn{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,n=this.chart,i=n.data.labels||[],r=cn(e._parsed[t].r,n.options.locale);return{label:i[t]||"",value:r}}parseObjectData(t,e,n,i){return Be.bind(this)(t,e,n,i)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach(((t,n)=>{const i=this.getParsed(n).r;!isNaN(i)&&this.chart.getDataVisibility(n)&&(i<e.min&&(e.min=i),i>e.max&&(e.max=i))})),e}_updateRadius(){const t=this.chart,e=t.chartArea,n=t.options,i=Math.min(e.right-e.left,e.bottom-e.top),r=Math.max(i/2,0),s=(r-Math.max(n.cutoutPercentage?r/100*n.cutoutPercentage:1,0))/t.getVisibleDatasetCount();this.outerRadius=r-s*this.index,this.innerRadius=this.outerRadius-s}updateElements(t,e,n,i){const r="reset"===i,s=this.chart,o=s.options.animation,a=this._cachedMeta.rScale,c=a.xCenter,l=a.yCenter,u=a.getIndexAngle(0)-.5*M;let h,d=u;const f=360/this.countVisibleElements();for(h=0;h<e;++h)d+=this._computeAngle(h,i,f);for(h=e;h<e+n;h++){const e=t[h];let n=d,p=d+this._computeAngle(h,i,f),g=s.getDataVisibility(h)?a.getDistanceFromCenterForValue(this.getParsed(h).r):0;d=p,r&&(o.animateScale&&(g=0),o.animateRotate&&(n=p=u));const m={x:c,y:l,innerRadius:0,outerRadius:g,startAngle:n,endAngle:p,options:this.resolveDataElementOptions(h,e.active?"active":i)};this.updateElement(e,h,m,i)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach(((t,n)=>{!isNaN(this.getParsed(n).r)&&this.chart.getDataVisibility(n)&&e++})),e}_computeAngle(t,e,n){return this.chart.getDataVisibility(t)?H(this.resolveDataElementOptions(t,e).angle||n):0}}Wn.id="polarArea",Wn.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0},Wn.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:n}}=t.legend.options;return e.labels.map(((e,i)=>{const r=t.getDatasetMeta(0).controller.getStyle(i);return{text:e,fillStyle:r.backgroundColor,strokeStyle:r.borderColor,lineWidth:r.borderWidth,pointStyle:n,hidden:!t.getDataVisibility(i),index:i}}))}return[]}},onClick(t,e,n){n.chart.toggleDataVisibility(e.index),n.chart.update()}},tooltip:{callbacks:{title:()=>"",label:t=>t.chart.data.labels[t.dataIndex]+": "+t.formattedValue}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};class Qn extends Kn{}Qn.id="pie",Qn.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"};class Yn extends Nn{getLabelAndValue(t){const e=this._cachedMeta.vScale,n=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(n[e.axis])}}parseObjectData(t,e,n,i){return Be.bind(this)(t,e,n,i)}update(t){const e=this._cachedMeta,n=e.dataset,i=e.data||[],r=e.iScale.getLabels();if(n.points=i,"resize"!==t){const e=this.resolveDatasetElementOptions(t);this.options.showLine||(e.borderWidth=0);const s={_loop:!0,_fullLoop:r.length===i.length,options:e};this.updateElement(n,void 0,s,t)}this.updateElements(i,0,i.length,t)}updateElements(t,e,n,i){const r=this._cachedMeta.rScale,s="reset"===i;for(let o=e;o<e+n;o++){const e=t[o],n=this.resolveDataElementOptions(o,e.active?"active":i),a=r.getPointPositionForValue(o,this.getParsed(o).r),c=s?r.xCenter:a.x,l=s?r.yCenter:a.y,u={x:c,y:l,angle:a.angle,skip:isNaN(c)||isNaN(l),options:n};this.updateElement(e,o,u,i)}}}Yn.id="radar",Yn.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}},Yn.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};class Xn{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(t){const{x:e,y:n}=this.getProps(["x","y"],t);return{x:e,y:n}}hasValue(){return z(this.x)&&z(this.y)}getProps(t,e){const n=this.$animations;if(!e||!n)return this;const i={};return t.forEach((t=>{i[t]=n[t]&&n[t].active()?n[t]._to:this[t]})),i}}Xn.defaults={},Xn.defaultRoutes=void 0;const Jn={values:t=>u(t)?t:""+t,numeric(t,e,n){if(0===t)return"0";const i=this.chart.options.locale;let r,s=t;if(n.length>1){const e=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(e<1e-4||e>1e15)&&(r="scientific"),s=function(t,e){let n=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(n)>=1&&t!==Math.floor(t)&&(n=t-Math.floor(t)),n}(t,n)}const o=B(Math.abs(s)),a=Math.max(Math.min(-1*Math.floor(o),20),0),c={notation:r,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(c,this.options.ticks.format),cn(t,i,c)},logarithmic(t,e,n){if(0===t)return"0";const i=t/Math.pow(10,Math.floor(B(t)));return 1===i||2===i||5===i?Jn.numeric.call(this,t,e,n):""}};var Zn={formatters:Jn};function ti(t,e,n,i,r){const s=p(i,0),o=Math.min(p(r,t.length),t.length);let a,c,l,u=0;for(n=Math.ceil(n),r&&(a=r-i,n=a/Math.floor(a/n)),l=s;l<0;)u++,l=Math.round(s+u*n);for(c=Math.max(s,0);c<o;c++)c===l&&(e.push(t[c]),u++,l=Math.round(s+u*n))}ee.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Zn.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),ee.route("scale.ticks","color","","color"),ee.route("scale.grid","color","","borderColor"),ee.route("scale.grid","borderColor","","borderColor"),ee.route("scale.title","color","","color"),ee.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&"callback"!==t&&"parser"!==t,_indexable:t=>"borderDash"!==t&&"tickBorderDash"!==t}),ee.describe("scales",{_fallback:"scale"}),ee.describe("scale.ticks",{_scriptable:t=>"backdropPadding"!==t&&"callback"!==t,_indexable:t=>"backdropPadding"!==t});const ei=(t,e,n)=>"top"===e||"left"===e?t[e]+n:t[e]-n;function ni(t,e){const n=[],i=t.length/e,r=t.length;let s=0;for(;s<r;s+=i)n.push(t[Math.floor(s)]);return n}function ii(t,e,n){const i=t.ticks.length,r=Math.min(e,i-1),s=t._startPixel,o=t._endPixel,a=1e-6;let c,l=t.getPixelForTick(r);if(!(n&&(c=1===i?Math.max(l-s,o-l):0===e?(t.getPixelForTick(1)-l)/2:(l-t.getPixelForTick(r-1))/2,l+=r<e?c:-c,l<s-a||l>o+a)))return l}function ri(t){return t.drawTicks?t.tickLength:0}function si(t,e){if(!t.display)return 0;const n=Ie(t.font,e),i=xe(t.padding);return(u(t.text)?t.text.length:1)*n.lineHeight+i.height}function oi(t,e,n){let i=lt(t);return(n&&"right"!==e||!n&&"right"===e)&&(i=(t=>"left"===t?"right":"right"===t?"left":t)(i)),i}class ai extends Xn{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:n,_suggestedMax:i}=this;return t=f(t,Number.POSITIVE_INFINITY),e=f(e,Number.NEGATIVE_INFINITY),n=f(n,Number.POSITIVE_INFINITY),i=f(i,Number.NEGATIVE_INFINITY),{min:f(t,n),max:f(e,i),minDefined:d(t),maxDefined:d(e)}}getMinMax(t){let e,{min:n,max:i,minDefined:r,maxDefined:s}=this.getUserBounds();if(r&&s)return{min:n,max:i};const o=this.getMatchingVisibleMetas();for(let a=0,c=o.length;a<c;++a)e=o[a].controller.getMinMax(this,t),r||(n=Math.min(n,e.min)),s||(i=Math.max(i,e.max));return n=s&&n>i?i:n,i=r&&n>i?n:i,{min:f(n,f(i,n)),max:f(i,f(n,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){m(this.options.beforeUpdate,[this])}update(t,e,n){const{beginAtZero:i,grace:r,ticks:s}=this.options,o=s.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(t,e,n){const{min:i,max:r}=t,s=g(e,(r-i)/2),o=(t,e)=>n&&0===t?0:t+e;return{min:o(i,-Math.abs(s)),max:o(r,s)}}(this,r,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const a=o<this.ticks.length;this._convertTicksToLabels(a?ni(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),s.display&&(s.autoSkip||"auto"===s.source)&&(this.ticks=function(t,e){const n=t.options.ticks,i=n.maxTicksLimit||function(t){const e=t.options.offset,n=t._tickSize(),i=t._length/n+(e?0:1),r=t._maxLength/n;return Math.floor(Math.min(i,r))}(t),r=n.major.enabled?function(t){const e=[];let n,i;for(n=0,i=t.length;n<i;n++)t[n].major&&e.push(n);return e}(e):[],s=r.length,o=r[0],a=r[s-1],c=[];if(s>i)return function(t,e,n,i){let r,s=0,o=n[0];for(i=Math.ceil(i),r=0;r<t.length;r++)r===o&&(e.push(t[r]),s++,o=n[s*i])}(e,c,r,s/i),c;const u=function(t,e,n){const i=function(t){const e=t.length;let n,i;if(e<2)return!1;for(i=t[0],n=1;n<e;++n)if(t[n]-t[n-1]!==i)return!1;return i}(t),r=e.length/n;if(!i)return Math.max(r,1);const s=function(t){const e=[],n=Math.sqrt(t);let i;for(i=1;i<n;i++)t%i===0&&(e.push(i),e.push(t/i));return n===(0|n)&&e.push(n),e.sort(((t,e)=>t-e)).pop(),e}(i);for(let t=0,e=s.length-1;t<e;t++){const e=s[t];if(e>r)return e}return Math.max(r,1)}(r,e,i);if(s>0){let t,n;const i=s>1?Math.round((a-o)/(s-1)):null;for(ti(e,c,u,l(i)?0:o-i,o),t=0,n=s-1;t<n;t++)ti(e,c,u,r[t],r[t+1]);return ti(e,c,u,a,l(i)?e.length:a+i),c}return ti(e,c,u),c}(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),a&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t,e,n=this.options.reverse;this.isHorizontal()?(t=this.left,e=this.right):(t=this.top,e=this.bottom,n=!n),this._startPixel=t,this._endPixel=e,this._reversePixels=n,this._length=e-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){m(this.options.afterUpdate,[this])}beforeSetDimensions(){m(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){m(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),m(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){m(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let n,i,r;for(n=0,i=t.length;n<i;n++)r=t[n],r.label=m(e.callback,[r.value,n,t],this)}afterTickToLabelConversion(){m(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){m(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,n=this.ticks.length,i=e.minRotation||0,r=e.maxRotation;let s,o,a,c=i;if(!this._isVisible()||!e.display||i>=r||n<=1||!this.isHorizontal())return void(this.labelRotation=i);const l=this._getLabelSizes(),u=l.widest.width,h=l.highest.height,d=Z(this.chart.width-u,0,this.maxWidth);s=t.offset?this.maxWidth/n:d/(n-1),u+6>s&&(s=d/(n-(t.offset?.5:1)),o=this.maxHeight-ri(t.grid)-e.padding-si(t.title,this.chart.options.font),a=Math.sqrt(u*u+h*h),c=K(Math.min(Math.asin(Z((l.highest.height+6)/s,-1,1)),Math.asin(Z(o/a,-1,1))-Math.asin(Z(h/a,-1,1)))),c=Math.max(i,Math.min(r,c))),this.labelRotation=c}afterCalculateLabelRotation(){m(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){m(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:n,title:i,grid:r}}=this,s=this._isVisible(),o=this.isHorizontal();if(s){const s=si(i,e.options.font);if(o?(t.width=this.maxWidth,t.height=ri(r)+s):(t.height=this.maxHeight,t.width=ri(r)+s),n.display&&this.ticks.length){const{first:e,last:i,widest:r,highest:s}=this._getLabelSizes(),a=2*n.padding,c=H(this.labelRotation),l=Math.cos(c),u=Math.sin(c);if(o){const e=n.mirror?0:u*r.width+l*s.height;t.height=Math.min(this.maxHeight,t.height+e+a)}else{const e=n.mirror?0:l*r.width+u*s.height;t.width=Math.min(this.maxWidth,t.width+e+a)}this._calculatePadding(e,i,u,l)}}this._handleMargins(),o?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,n,i){const{ticks:{align:r,padding:s},position:o}=this.options,a=0!==this.labelRotation,c="top"!==o&&"x"===this.axis;if(this.isHorizontal()){const o=this.getPixelForTick(0)-this.left,l=this.right-this.getPixelForTick(this.ticks.length-1);let u=0,h=0;a?c?(u=i*t.width,h=n*e.height):(u=n*t.height,h=i*e.width):"start"===r?h=e.width:"end"===r?u=t.width:"inner"!==r&&(u=t.width/2,h=e.width/2),this.paddingLeft=Math.max((u-o+s)*this.width/(this.width-o),0),this.paddingRight=Math.max((h-l+s)*this.width/(this.width-l),0)}else{let n=e.height/2,i=t.height/2;"start"===r?(n=0,i=t.height):"end"===r&&(n=e.height,i=0),this.paddingTop=n+s,this.paddingBottom=i+s}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){m(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return"top"===e||"bottom"===e||"x"===t}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){let e,n;for(this.beforeTickToLabelConversion(),this.generateTickLabels(t),e=0,n=t.length;e<n;e++)l(t[e].label)&&(t.splice(e,1),n--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let n=this.ticks;e<n.length&&(n=ni(n,e)),this._labelSizes=t=this._computeLabelSizes(n,n.length)}return t}_computeLabelSizes(t,e){const{ctx:n,_longestTextCache:i}=this,r=[],s=[];let o,a,c,h,d,f,p,g,m,v,b,w=0,_=0;for(o=0;o<e;++o){if(h=t[o].label,d=this._resolveTickFontOptions(o),n.font=f=d.string,p=i[f]=i[f]||{data:{},gc:[]},g=d.lineHeight,m=v=0,l(h)||u(h)){if(u(h))for(a=0,c=h.length;a<c;++a)b=h[a],l(b)||u(b)||(m=ne(n,p.data,p.gc,m,b),v+=g)}else m=ne(n,p.data,p.gc,m,h),v=g;r.push(m),s.push(v),w=Math.max(m,w),_=Math.max(v,_)}!function(t,e){y(t,(t=>{const n=t.gc,i=n.length/2;let r;if(i>e){for(r=0;r<i;++r)delete t.data[n[r]];n.splice(0,i)}}))}(i,e);const x=r.indexOf(w),I=s.indexOf(_),E=t=>({width:r[t]||0,height:s[t]||0});return{first:E(0),last:E(e-1),widest:E(x),highest:E(I),widths:r,heights:s}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return Z(this._alignToPixels?re(this.chart,e,0):e,-32768,32767)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const n=e[t];return n.$context||(n.$context=function(t,e,n){return Te(t,{tick:n,index:e,type:"tick"})}(this.getContext(),t,n))}return this.$context||(this.$context=Te(this.chart.getContext(),{scale:this,type:"scale"}))}_tickSize(){const t=this.options.ticks,e=H(this.labelRotation),n=Math.abs(Math.cos(e)),i=Math.abs(Math.sin(e)),r=this._getLabelSizes(),s=t.autoSkipPadding||0,o=r?r.widest.width+s:0,a=r?r.highest.height+s:0;return this.isHorizontal()?a*n>o*i?o/n:a/i:a*i<o*n?a/n:o/i}_isVisible(){const t=this.options.display;return"auto"!==t?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,n=this.chart,i=this.options,{grid:r,position:s}=i,o=r.offset,a=this.isHorizontal(),c=this.ticks.length+(o?1:0),l=ri(r),u=[],d=r.setContext(this.getContext()),f=d.drawBorder?d.borderWidth:0,g=f/2,m=function(t){return re(n,t,f)};let y,v,b,w,_,x,I,E,T,k,S,C;if("top"===s)y=m(this.bottom),x=this.bottom-l,E=y-g,k=m(t.top)+g,C=t.bottom;else if("bottom"===s)y=m(this.top),k=t.top,C=m(t.bottom)-g,x=y+g,E=this.top+l;else if("left"===s)y=m(this.right),_=this.right-l,I=y-g,T=m(t.left)+g,S=t.right;else if("right"===s)y=m(this.left),T=t.left,S=m(t.right)-g,_=y+g,I=this.left+l;else if("x"===e){if("center"===s)y=m((t.top+t.bottom)/2+.5);else if(h(s)){const t=Object.keys(s)[0],e=s[t];y=m(this.chart.scales[t].getPixelForValue(e))}k=t.top,C=t.bottom,x=y+g,E=x+l}else if("y"===e){if("center"===s)y=m((t.left+t.right)/2);else if(h(s)){const t=Object.keys(s)[0],e=s[t];y=m(this.chart.scales[t].getPixelForValue(e))}_=y-g,I=_-l,T=t.left,S=t.right}const A=p(i.ticks.maxTicksLimit,c),D=Math.max(1,Math.ceil(c/A));for(v=0;v<c;v+=D){const t=r.setContext(this.getContext(v)),e=t.lineWidth,i=t.color,s=t.borderDash||[],c=t.borderDashOffset,l=t.tickWidth,h=t.tickColor,d=t.tickBorderDash||[],f=t.tickBorderDashOffset;b=ii(this,v,o),void 0!==b&&(w=re(n,b,e),a?_=I=T=S=w:x=E=k=C=w,u.push({tx1:_,ty1:x,tx2:I,ty2:E,x1:T,y1:k,x2:S,y2:C,width:e,color:i,borderDash:s,borderDashOffset:c,tickWidth:l,tickColor:h,tickBorderDash:d,tickBorderDashOffset:f}))}return this._ticksLength=c,this._borderValue=y,u}_computeLabelItems(t){const e=this.axis,n=this.options,{position:i,ticks:r}=n,s=this.isHorizontal(),o=this.ticks,{align:a,crossAlign:c,padding:l,mirror:d}=r,f=ri(n.grid),p=f+l,g=d?-l:p,m=-H(this.labelRotation),y=[];let v,b,w,_,x,I,E,T,k,S,C,A,D="middle";if("top"===i)I=this.bottom-g,E=this._getXAxisLabelAlignment();else if("bottom"===i)I=this.top+g,E=this._getXAxisLabelAlignment();else if("left"===i){const t=this._getYAxisLabelAlignment(f);E=t.textAlign,x=t.x}else if("right"===i){const t=this._getYAxisLabelAlignment(f);E=t.textAlign,x=t.x}else if("x"===e){if("center"===i)I=(t.top+t.bottom)/2+p;else if(h(i)){const t=Object.keys(i)[0],e=i[t];I=this.chart.scales[t].getPixelForValue(e)+p}E=this._getXAxisLabelAlignment()}else if("y"===e){if("center"===i)x=(t.left+t.right)/2-p;else if(h(i)){const t=Object.keys(i)[0],e=i[t];x=this.chart.scales[t].getPixelForValue(e)}E=this._getYAxisLabelAlignment(f).textAlign}"y"===e&&("start"===a?D="top":"end"===a&&(D="bottom"));const M=this._getLabelSizes();for(v=0,b=o.length;v<b;++v){w=o[v],_=w.label;const t=r.setContext(this.getContext(v));T=this.getPixelForTick(v)+r.labelOffset,k=this._resolveTickFontOptions(v),S=k.lineHeight,C=u(_)?_.length:1;const e=C/2,n=t.color,a=t.textStrokeColor,l=t.textStrokeWidth;let h,f=E;if(s?(x=T,"inner"===E&&(f=v===b-1?this.options.reverse?"left":"right":0===v?this.options.reverse?"right":"left":"center"),A="top"===i?"near"===c||0!==m?-C*S+S/2:"center"===c?-M.highest.height/2-e*S+S:-M.highest.height+S/2:"near"===c||0!==m?S/2:"center"===c?M.highest.height/2-e*S:M.highest.height-C*S,d&&(A*=-1)):(I=T,A=(1-C)*S/2),t.showLabelBackdrop){const e=xe(t.backdropPadding),n=M.heights[v],i=M.widths[v];let r=I+A-e.top,s=x-e.left;switch(D){case"middle":r-=n/2;break;case"bottom":r-=n}switch(E){case"center":s-=i/2;break;case"right":s-=i}h={left:s,top:r,width:i+e.width,height:n+e.height,color:t.backdropColor}}y.push({rotation:m,label:_,font:k,color:n,strokeColor:a,strokeWidth:l,textOffset:A,textAlign:f,textBaseline:D,translation:[x,I],backdrop:h})}return y}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-H(this.labelRotation))return"top"===t?"left":"right";let n="center";return"start"===e.align?n="left":"end"===e.align?n="right":"inner"===e.align&&(n="inner"),n}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:n,mirror:i,padding:r}}=this.options,s=t+r,o=this._getLabelSizes().widest.width;let a,c;return"left"===e?i?(c=this.right+r,"near"===n?a="left":"center"===n?(a="center",c+=o/2):(a="right",c+=o)):(c=this.right-s,"near"===n?a="right":"center"===n?(a="center",c-=o/2):(a="left",c=this.left)):"right"===e?i?(c=this.left+r,"near"===n?a="right":"center"===n?(a="center",c-=o/2):(a="left",c-=o)):(c=this.left+s,"near"===n?a="left":"center"===n?(a="center",c+=o/2):(a="right",c=this.right)):a="right",{textAlign:a,x:c}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;return"left"===e||"right"===e?{top:0,left:this.left,bottom:t.height,right:this.right}:"top"===e||"bottom"===e?{top:this.top,left:0,bottom:this.bottom,right:t.width}:void 0}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:n,top:i,width:r,height:s}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(n,i,r,s),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const n=this.ticks.findIndex((e=>e.value===t));return n>=0?e.setContext(this.getContext(n)).lineWidth:0}drawGrid(t){const e=this.options.grid,n=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let r,s;const o=(t,e,i)=>{i.width&&i.color&&(n.save(),n.lineWidth=i.width,n.strokeStyle=i.color,n.setLineDash(i.borderDash||[]),n.lineDashOffset=i.borderDashOffset,n.beginPath(),n.moveTo(t.x,t.y),n.lineTo(e.x,e.y),n.stroke(),n.restore())};if(e.display)for(r=0,s=i.length;r<s;++r){const t=i[r];e.drawOnChartArea&&o({x:t.x1,y:t.y1},{x:t.x2,y:t.y2},t),e.drawTicks&&o({x:t.tx1,y:t.ty1},{x:t.tx2,y:t.ty2},{color:t.tickColor,width:t.tickWidth,borderDash:t.tickBorderDash,borderDashOffset:t.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{grid:n}}=this,i=n.setContext(this.getContext()),r=n.drawBorder?i.borderWidth:0;if(!r)return;const s=n.setContext(this.getContext(0)).lineWidth,o=this._borderValue;let a,c,l,u;this.isHorizontal()?(a=re(t,this.left,r)-r/2,c=re(t,this.right,s)+s/2,l=u=o):(l=re(t,this.top,r)-r/2,u=re(t,this.bottom,s)+s/2,a=c=o),e.save(),e.lineWidth=i.borderWidth,e.strokeStyle=i.borderColor,e.beginPath(),e.moveTo(a,l),e.lineTo(c,u),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const e=this.ctx,n=this._computeLabelArea();n&&le(e,n);const i=this._labelItems||(this._labelItems=this._computeLabelItems(t));let r,s;for(r=0,s=i.length;r<s;++r){const t=i[r],n=t.font,s=t.label;t.backdrop&&(e.fillStyle=t.backdrop.color,e.fillRect(t.backdrop.left,t.backdrop.top,t.backdrop.width,t.backdrop.height)),fe(e,s,0,t.textOffset,n,t)}n&&ue(e)}drawTitle(){const{ctx:t,options:{position:e,title:n,reverse:i}}=this;if(!n.display)return;const r=Ie(n.font),s=xe(n.padding),o=n.align;let a=r.lineHeight/2;"bottom"===e||"center"===e||h(e)?(a+=s.bottom,u(n.text)&&(a+=r.lineHeight*(n.text.length-1))):a+=s.top;const{titleX:c,titleY:l,maxWidth:d,rotation:f}=function(t,e,n,i){const{top:r,left:s,bottom:o,right:a,chart:c}=t,{chartArea:l,scales:u}=c;let d,f,p,g=0;const m=o-r,y=a-s;if(t.isHorizontal()){if(f=ut(i,s,a),h(n)){const t=Object.keys(n)[0],i=n[t];p=u[t].getPixelForValue(i)+m-e}else p="center"===n?(l.bottom+l.top)/2+m-e:ei(t,n,e);d=a-s}else{if(h(n)){const t=Object.keys(n)[0],i=n[t];f=u[t].getPixelForValue(i)-y+e}else f="center"===n?(l.left+l.right)/2-y+e:ei(t,n,e);p=ut(i,o,r),g="left"===n?-L:L}return{titleX:f,titleY:p,maxWidth:d,rotation:g}}(this,a,e,o);fe(t,n.text,0,0,r,{color:n.color,maxWidth:d,rotation:f,textAlign:oi(o,e,i),textBaseline:"middle",translation:[c,l]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,n=p(t.grid&&t.grid.z,-1);return this._isVisible()&&this.draw===ai.prototype.draw?[{z:n,draw:t=>{this.drawBackground(),this.drawGrid(t),this.drawTitle()}},{z:n+1,draw:()=>{this.drawBorder()}},{z:e,draw:t=>{this.drawLabels(t)}}]:[{z:e,draw:t=>{this.draw(t)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",i=[];let r,s;for(r=0,s=e.length;r<s;++r){const s=e[r];s[n]!==this.id||t&&s.type!==t||i.push(s)}return i}_resolveTickFontOptions(t){return Ie(this.options.ticks.setContext(this.getContext(t)).font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class ci{constructor(t,e,n){this.type=t,this.scope=e,this.override=n,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let n;(function(t){return"id"in t&&"defaults"in t})(e)&&(n=this.register(e));const i=this.items,r=t.id,s=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in i||(i[r]=t,function(t,e,n){const i=x(Object.create(null),[n?ee.get(n):{},ee.get(e),t.defaults]);ee.set(e,i),t.defaultRoutes&&function(t,e){Object.keys(e).forEach((n=>{const i=n.split("."),r=i.pop(),s=[t].concat(i).join("."),o=e[n].split("."),a=o.pop(),c=o.join(".");ee.route(s,r,c,a)}))}(e,t.defaultRoutes),t.descriptors&&ee.describe(e,t.descriptors)}(t,s,n),this.override&&ee.override(t.id,t.overrides)),s}get(t){return this.items[t]}unregister(t){const e=this.items,n=t.id,i=this.scope;n in e&&delete e[n],i&&n in ee[i]&&(delete ee[i][n],this.override&&delete Xt[n])}}var li=new class{constructor(){this.controllers=new ci(Nn,"datasets",!0),this.elements=new ci(Xn,"elements"),this.plugins=new ci(Object,"plugins"),this.scales=new ci(ai,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,n){[...e].forEach((e=>{const i=n||this._getRegistryForType(e);n||i.isForType(e)||i===this.plugins&&e.id?this._exec(t,i,e):y(e,(e=>{const i=n||this._getRegistryForType(e);this._exec(t,i,e)}))}))}_exec(t,e,n){const i=S(t);m(n["before"+i],[],n),e[t](n),m(n["after"+i],[],n)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const n=this._typedRegistries[e];if(n.isForType(t))return n}return this.plugins}_get(t,e,n){const i=e.get(t);if(void 0===i)throw new Error('"'+t+'" is not a registered '+n+".");return i}};class ui extends Nn{update(t){const e=this._cachedMeta,{data:n=[]}=e,i=this.chart._animationsDisabled;let{start:r,count:s}=ht(e,n,i);if(this._drawStart=r,this._drawCount=s,dt(e)&&(r=0,s=n.length),this.options.showLine){const{dataset:r,_dataset:s}=e;r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!s._decimated,r.points=n;const o=this.resolveDatasetElementOptions(t);o.segment=this.options.segment,this.updateElement(r,void 0,{animated:!i,options:o},t)}this.updateElements(n,r,s,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=li.getElement("line")),super.addElements()}updateElements(t,e,n,i){const r="reset"===i,{iScale:s,vScale:o,_stacked:a,_dataset:c}=this._cachedMeta,u=this.resolveDataElementOptions(e,i),h=this.getSharedOptions(u),d=this.includeOptions(i,h),f=s.axis,p=o.axis,{spanGaps:g,segment:m}=this.options,y=z(g)?g:Number.POSITIVE_INFINITY,v=this.chart._animationsDisabled||r||"none"===i;let b=e>0&&this.getParsed(e-1);for(let u=e;u<e+n;++u){const e=t[u],n=this.getParsed(u),g=v?e:{},w=l(n[p]),_=g[f]=s.getPixelForValue(n[f],u),x=g[p]=r||w?o.getBasePixel():o.getPixelForValue(a?this.applyStack(o,n,a):n[p],u);g.skip=isNaN(_)||isNaN(x)||w,g.stop=u>0&&Math.abs(n[f]-b[f])>y,m&&(g.parsed=n,g.raw=c.data[u]),d&&(g.options=h||this.resolveDataElementOptions(u,e.active?"active":i)),v||this.updateElement(e,u,g,i),b=n}this.updateSharedOptions(h,i,u)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let t=0;for(let n=e.length-1;n>=0;--n)t=Math.max(t,e[n].size(this.resolveDataElementOptions(n))/2);return t>0&&t}const n=t.dataset,i=n.options&&n.options.borderWidth||0;if(!e.length)return i;const r=e[0].size(this.resolveDataElementOptions(0)),s=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(i,r,s)/2}}ui.id="scatter",ui.defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1},ui.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title:()=>"",label:t=>"("+t.label+", "+t.formattedValue+")"}}},scales:{x:{type:"linear"},y:{type:"linear"}}};var hi=Object.freeze({__proto__:null,BarController:$n,BubbleController:Hn,DoughnutController:Kn,LineController:Gn,PolarAreaController:Wn,PieController:Qn,RadarController:Yn,ScatterController:ui});function di(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class fi{constructor(t){this.options=t||{}}init(t){}formats(){return di()}parse(t,e){return di()}format(t,e){return di()}add(t,e,n){return di()}diff(t,e,n){return di()}startOf(t,e,n){return di()}endOf(t,e){return di()}}fi.override=function(t){Object.assign(fi.prototype,t)};var pi={_date:fi};function gi(t,e,n,i){const{controller:r,data:s,_sorted:o}=t,a=r._cachedMeta.iScale;if(a&&e===a.axis&&"r"!==e&&o&&s.length){const t=a._reversePixels?it:nt;if(!i)return t(s,e,n);if(r._sharedOptions){const i=s[0],r="function"==typeof i.getRange&&i.getRange(e);if(r){const i=t(s,e,n-r),o=t(s,e,n+r);return{lo:i.lo,hi:o.hi}}}}return{lo:0,hi:s.length-1}}function mi(t,e,n,i,r){const s=t.getSortedVisibleDatasetMetas(),o=n[e];for(let t=0,n=s.length;t<n;++t){const{index:n,data:a}=s[t],{lo:c,hi:l}=gi(s[t],e,o,r);for(let t=c;t<=l;++t){const e=a[t];e.skip||i(e,n,t)}}}function yi(t,e,n,i,r){const s=[];return r||t.isPointInArea(e)?(mi(t,n,e,(function(n,o,a){(r||ce(n,t.chartArea,0))&&n.inRange(e.x,e.y,i)&&s.push({element:n,datasetIndex:o,index:a})}),!0),s):s}function vi(t,e,n,i,r,s){return s||t.isPointInArea(e)?"r"!==n||i?function(t,e,n,i,r,s){let o=[];const a=function(t){const e=-1!==t.indexOf("x"),n=-1!==t.indexOf("y");return function(t,i){const r=e?Math.abs(t.x-i.x):0,s=n?Math.abs(t.y-i.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(s,2))}}(n);let c=Number.POSITIVE_INFINITY;return mi(t,n,e,(function(n,l,u){const h=n.inRange(e.x,e.y,r);if(i&&!h)return;const d=n.getCenterPoint(r);if(!s&&!t.isPointInArea(d)&&!h)return;const f=a(e,d);f<c?(o=[{element:n,datasetIndex:l,index:u}],c=f):f===c&&o.push({element:n,datasetIndex:l,index:u})})),o}(t,e,n,i,r,s):function(t,e,n,i){let r=[];return mi(t,n,e,(function(t,n,s){const{startAngle:o,endAngle:a}=t.getProps(["startAngle","endAngle"],i),{angle:c}=W(t,{x:e.x,y:e.y});J(c,o,a)&&r.push({element:t,datasetIndex:n,index:s})})),r}(t,e,n,r):[]}function bi(t,e,n,i,r){const s=[],o="x"===n?"inXRange":"inYRange";let a=!1;return mi(t,n,e,((t,i,c)=>{t[o](e[n],r)&&(s.push({element:t,datasetIndex:i,index:c}),a=a||t.inRange(e.x,e.y,r))})),i&&!a?[]:s}var wi={evaluateInteractionItems:mi,modes:{index(t,e,n,i){const r=Je(e,t),s=n.axis||"x",o=n.includeInvisible||!1,a=n.intersect?yi(t,r,s,i,o):vi(t,r,s,!1,i,o),c=[];return a.length?(t.getSortedVisibleDatasetMetas().forEach((t=>{const e=a[0].index,n=t.data[e];n&&!n.skip&&c.push({element:n,datasetIndex:t.index,index:e})})),c):[]},dataset(t,e,n,i){const r=Je(e,t),s=n.axis||"xy",o=n.includeInvisible||!1;let a=n.intersect?yi(t,r,s,i,o):vi(t,r,s,!1,i,o);if(a.length>0){const e=a[0].datasetIndex,n=t.getDatasetMeta(e).data;a=[];for(let t=0;t<n.length;++t)a.push({element:n[t],datasetIndex:e,index:t})}return a},point:(t,e,n,i)=>yi(t,Je(e,t),n.axis||"xy",i,n.includeInvisible||!1),nearest(t,e,n,i){const r=Je(e,t),s=n.axis||"xy",o=n.includeInvisible||!1;return vi(t,r,s,n.intersect,i,o)},x:(t,e,n,i)=>bi(t,Je(e,t),"x",n.intersect,i),y:(t,e,n,i)=>bi(t,Je(e,t),"y",n.intersect,i)}};const _i=["left","top","right","bottom"];function xi(t,e){return t.filter((t=>t.pos===e))}function Ii(t,e){return t.filter((t=>-1===_i.indexOf(t.pos)&&t.box.axis===e))}function Ei(t,e){return t.sort(((t,n)=>{const i=e?n:t,r=e?t:n;return i.weight===r.weight?i.index-r.index:i.weight-r.weight}))}function Ti(t,e,n,i){return Math.max(t[n],e[n])+Math.max(t[i],e[i])}function ki(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function Si(t,e,n,i){const{pos:r,box:s}=n,o=t.maxPadding;if(!h(r)){n.size&&(t[r]-=n.size);const e=i[n.stack]||{size:0,count:1};e.size=Math.max(e.size,n.horizontal?s.height:s.width),n.size=e.size/e.count,t[r]+=n.size}s.getPadding&&ki(o,s.getPadding());const a=Math.max(0,e.outerWidth-Ti(o,t,"left","right")),c=Math.max(0,e.outerHeight-Ti(o,t,"top","bottom")),l=a!==t.w,u=c!==t.h;return t.w=a,t.h=c,n.horizontal?{same:l,other:u}:{same:u,other:l}}function Ci(t,e){const n=e.maxPadding;return function(t){const i={left:0,top:0,right:0,bottom:0};return t.forEach((t=>{i[t]=Math.max(e[t],n[t])})),i}(t?["left","right"]:["top","bottom"])}function Ai(t,e,n,i){const r=[];let s,o,a,c,l,u;for(s=0,o=t.length,l=0;s<o;++s){a=t[s],c=a.box,c.update(a.width||e.w,a.height||e.h,Ci(a.horizontal,e));const{same:o,other:h}=Si(e,n,a,i);l|=o&&r.length,u=u||h,c.fullSize||r.push(a)}return l&&Ai(r,e,n,i)||u}function Di(t,e,n,i,r){t.top=n,t.left=e,t.right=e+i,t.bottom=n+r,t.width=i,t.height=r}function Mi(t,e,n,i){const r=n.padding;let{x:s,y:o}=e;for(const a of t){const t=a.box,c=i[a.stack]||{count:1,placed:0,weight:1},l=a.stackWeight/c.weight||1;if(a.horizontal){const i=e.w*l,s=c.size||t.height;C(c.start)&&(o=c.start),t.fullSize?Di(t,r.left,o,n.outerWidth-r.right-r.left,s):Di(t,e.left+c.placed,o,i,s),c.start=o,c.placed+=i,o=t.bottom}else{const i=e.h*l,o=c.size||t.width;C(c.start)&&(s=c.start),t.fullSize?Di(t,s,r.top,o,n.outerHeight-r.bottom-r.top):Di(t,s,e.top+c.placed,o,i),c.start=s,c.placed+=i,s=t.right}}e.x=s,e.y=o}ee.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var Oi={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},t.boxes.push(e)},removeBox(t,e){const n=t.boxes?t.boxes.indexOf(e):-1;-1!==n&&t.boxes.splice(n,1)},configure(t,e,n){e.fullSize=n.fullSize,e.position=n.position,e.weight=n.weight},update(t,e,n,i){if(!t)return;const r=xe(t.options.layout.padding),s=Math.max(e-r.width,0),o=Math.max(n-r.height,0),a=function(t){const e=function(t){const e=[];let n,i,r,s,o,a;for(n=0,i=(t||[]).length;n<i;++n)r=t[n],({position:s,options:{stack:o,stackWeight:a=1}}=r),e.push({index:n,box:r,pos:s,horizontal:r.isHorizontal(),weight:r.weight,stack:o&&s+o,stackWeight:a});return e}(t),n=Ei(e.filter((t=>t.box.fullSize)),!0),i=Ei(xi(e,"left"),!0),r=Ei(xi(e,"right")),s=Ei(xi(e,"top"),!0),o=Ei(xi(e,"bottom")),a=Ii(e,"x"),c=Ii(e,"y");return{fullSize:n,leftAndTop:i.concat(s),rightAndBottom:r.concat(c).concat(o).concat(a),chartArea:xi(e,"chartArea"),vertical:i.concat(r).concat(c),horizontal:s.concat(o).concat(a)}}(t.boxes),c=a.vertical,l=a.horizontal;y(t.boxes,(t=>{"function"==typeof t.beforeLayout&&t.beforeLayout()}));const u=c.reduce(((t,e)=>e.box.options&&!1===e.box.options.display?t:t+1),0)||1,h=Object.freeze({outerWidth:e,outerHeight:n,padding:r,availableWidth:s,availableHeight:o,vBoxMaxWidth:s/2/u,hBoxMaxHeight:o/2}),d=Object.assign({},r);ki(d,xe(i));const f=Object.assign({maxPadding:d,w:s,h:o,x:r.left,y:r.top},r),p=function(t,e){const n=function(t){const e={};for(const n of t){const{stack:t,pos:i,stackWeight:r}=n;if(!t||!_i.includes(i))continue;const s=e[t]||(e[t]={count:0,placed:0,weight:0,size:0});s.count++,s.weight+=r}return e}(t),{vBoxMaxWidth:i,hBoxMaxHeight:r}=e;let s,o,a;for(s=0,o=t.length;s<o;++s){a=t[s];const{fullSize:o}=a.box,c=n[a.stack],l=c&&a.stackWeight/c.weight;a.horizontal?(a.width=l?l*i:o&&e.availableWidth,a.height=r):(a.width=i,a.height=l?l*r:o&&e.availableHeight)}return n}(c.concat(l),h);Ai(a.fullSize,f,h,p),Ai(c,f,h,p),Ai(l,f,h,p)&&Ai(c,f,h,p),function(t){const e=t.maxPadding;function n(n){const i=Math.max(e[n]-t[n],0);return t[n]+=i,i}t.y+=n("top"),t.x+=n("left"),n("right"),n("bottom")}(f),Mi(a.leftAndTop,f,h,p),f.x+=f.w,f.y+=f.h,Mi(a.rightAndBottom,f,h,p),t.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},y(a.chartArea,(e=>{const n=e.box;Object.assign(n,t.chartArea),n.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})}))}};class Pi{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,n){}removeEventListener(t,e,n){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,n,i){return e=Math.max(0,e||t.width),n=n||t.height,{width:e,height:Math.max(0,i?Math.floor(e/i):n)}}isAttached(t){return!0}updateConfig(t){}}class Ri extends Pi{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Ni="$chartjs",Li={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Fi=t=>null===t||""===t,Vi=!!en&&{passive:!0};function Bi(t,e,n){t.canvas.removeEventListener(e,n,Vi)}function Ui(t,e){for(const n of t)if(n===e||n.contains(e))return!0}function ji(t,e,n){const i=t.canvas,r=new MutationObserver((t=>{let e=!1;for(const n of t)e=e||Ui(n.addedNodes,i),e=e&&!Ui(n.removedNodes,i);e&&n()}));return r.observe(document,{childList:!0,subtree:!0}),r}function zi(t,e,n){const i=t.canvas,r=new MutationObserver((t=>{let e=!1;for(const n of t)e=e||Ui(n.removedNodes,i),e=e&&!Ui(n.addedNodes,i);e&&n()}));return r.observe(document,{childList:!0,subtree:!0}),r}const qi=new Map;let $i=0;function Hi(){const t=window.devicePixelRatio;t!==$i&&($i=t,qi.forEach(((e,n)=>{n.currentDevicePixelRatio!==t&&e()})))}function Ki(t,e,n){const i=t.canvas,r=i&&Ge(i);if(!r)return;const s=ct(((t,e)=>{const i=r.clientWidth;n(t,e),i<r.clientWidth&&n()}),window),o=new ResizeObserver((t=>{const e=t[0],n=e.contentRect.width,i=e.contentRect.height;0===n&&0===i||s(n,i)}));return o.observe(r),function(t,e){qi.size||window.addEventListener("resize",Hi),qi.set(t,e)}(t,s),o}function Gi(t,e,n){n&&n.disconnect(),"resize"===e&&function(t){qi.delete(t),qi.size||window.removeEventListener("resize",Hi)}(t)}function Wi(t,e,n){const i=t.canvas,r=ct((e=>{null!==t.ctx&&n(function(t,e){const n=Li[t.type]||t.type,{x:i,y:r}=Je(t,e);return{type:n,chart:e,native:t,x:void 0!==i?i:null,y:void 0!==r?r:null}}(e,t))}),t,(t=>{const e=t[0];return[e,e.offsetX,e.offsetY]}));return function(t,e,n){t.addEventListener(e,n,Vi)}(i,e,r),r}class Qi extends Pi{acquireContext(t,e){const n=t&&t.getContext&&t.getContext("2d");return n&&n.canvas===t?(function(t,e){const n=t.style,i=t.getAttribute("height"),r=t.getAttribute("width");if(t[Ni]={initial:{height:i,width:r,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",Fi(r)){const e=nn(t,"width");void 0!==e&&(t.width=e)}if(Fi(i))if(""===t.style.height)t.height=t.width/(e||2);else{const e=nn(t,"height");void 0!==e&&(t.height=e)}}(t,e),n):null}releaseContext(t){const e=t.canvas;if(!e[Ni])return!1;const n=e[Ni].initial;["height","width"].forEach((t=>{const i=n[t];l(i)?e.removeAttribute(t):e.setAttribute(t,i)}));const i=n.style||{};return Object.keys(i).forEach((t=>{e.style[t]=i[t]})),e.width=e.width,delete e[Ni],!0}addEventListener(t,e,n){this.removeEventListener(t,e);const i=t.$proxies||(t.$proxies={}),r={attach:ji,detach:zi,resize:Ki}[e]||Wi;i[e]=r(t,e,n)}removeEventListener(t,e){const n=t.$proxies||(t.$proxies={}),i=n[e];i&&(({attach:Gi,detach:Gi,resize:Gi}[e]||Bi)(t,e,i),n[e]=void 0)}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,n,i){return function(t,e,n,i){const r=Qe(t),s=Xe(r,"margin"),o=We(r.maxWidth,t,"clientWidth")||R,a=We(r.maxHeight,t,"clientHeight")||R,c=function(t,e,n){let i,r;if(void 0===e||void 0===n){const s=Ge(t);if(s){const t=s.getBoundingClientRect(),o=Qe(s),a=Xe(o,"border","width"),c=Xe(o,"padding");e=t.width-c.width-a.width,n=t.height-c.height-a.height,i=We(o.maxWidth,s,"clientWidth"),r=We(o.maxHeight,s,"clientHeight")}else e=t.clientWidth,n=t.clientHeight}return{width:e,height:n,maxWidth:i||R,maxHeight:r||R}}(t,e,n);let{width:l,height:u}=c;if("content-box"===r.boxSizing){const t=Xe(r,"border","width"),e=Xe(r,"padding");l-=e.width+t.width,u-=e.height+t.height}return l=Math.max(0,l-s.width),u=Math.max(0,i?Math.floor(l/i):u-s.height),l=Ze(Math.min(l,o,c.maxWidth)),u=Ze(Math.min(u,a,c.maxHeight)),l&&!u&&(u=Ze(l/2)),{width:l,height:u}}(t,e,n,i)}isAttached(t){const e=Ge(t);return!(!e||!e.isConnected)}}class Yi{constructor(){this._init=[]}notify(t,e,n,i){"beforeInit"===e&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const r=i?this._descriptors(t).filter(i):this._descriptors(t),s=this._notify(r,t,e,n);return"afterDestroy"===e&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall")),s}_notify(t,e,n,i){i=i||{};for(const r of t){const t=r.plugin;if(!1===m(t[n],[e,i,r.options],t)&&i.cancelable)return!1}return!0}invalidate(){l(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const n=t&&t.config,i=p(n.options&&n.options.plugins,{}),r=function(t){const e={},n=[],i=Object.keys(li.plugins.items);for(let t=0;t<i.length;t++)n.push(li.getPlugin(i[t]));const r=t.plugins||[];for(let t=0;t<r.length;t++){const i=r[t];-1===n.indexOf(i)&&(n.push(i),e[i.id]=!0)}return{plugins:n,localIds:e}}(n);return!1!==i||e?function(t,{plugins:e,localIds:n},i,r){const s=[],o=t.getContext();for(const a of e){const e=a.id,c=Xi(i[e],r);null!==c&&s.push({plugin:a,options:Ji(t.config,{plugin:a,local:n[e]},c,o)})}return s}(t,r,i,e):[]}_notifyStateChanges(t){const e=this._oldCache||[],n=this._cache,i=(t,e)=>t.filter((t=>!e.some((e=>t.plugin.id===e.plugin.id))));this._notify(i(e,n),t,"stop"),this._notify(i(n,e),t,"start")}}function Xi(t,e){return e||!1!==t?!0===t?{}:t:null}function Ji(t,{plugin:e,local:n},i,r){const s=t.pluginScopeKeys(e),o=t.getOptionScopes(i,s);return n&&e.defaults&&o.push(e.defaults),t.createResolver(o,r,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Zi(t,e){const n=ee.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||n.indexAxis||"x"}function tr(t,e){return"x"===t||"y"===t?t:e.axis||("top"===(n=e.position)||"bottom"===n?"x":"left"===n||"right"===n?"y":void 0)||t.charAt(0).toLowerCase();var n}function er(t){const e=t.options||(t.options={});e.plugins=p(e.plugins,{}),e.scales=function(t,e){const n=Xt[t.type]||{scales:{}},i=e.scales||{},r=Zi(t.type,e),s=Object.create(null),o=Object.create(null);return Object.keys(i).forEach((t=>{const e=i[t];if(!h(e))return console.error(`Invalid scale configuration for scale: ${t}`);if(e._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${t}`);const a=tr(t,e),c=function(t,e){return t===e?"_index_":"_value_"}(a,r),l=n.scales||{};s[a]=s[a]||t,o[t]=I(Object.create(null),[{axis:a},e,l[a],l[c]])})),t.data.datasets.forEach((n=>{const r=n.type||t.type,a=n.indexAxis||Zi(r,e),c=(Xt[r]||{}).scales||{};Object.keys(c).forEach((t=>{const e=function(t,e){let n=t;return"_index_"===t?n=e:"_value_"===t&&(n="x"===e?"y":"x"),n}(t,a),r=n[e+"AxisID"]||s[e]||e;o[r]=o[r]||Object.create(null),I(o[r],[{axis:e},i[r],c[t]])}))})),Object.keys(o).forEach((t=>{const e=o[t];I(e,[ee.scales[e.type],ee.scale])})),o}(t,e)}function nr(t){return(t=t||{}).datasets=t.datasets||[],t.labels=t.labels||[],t}const ir=new Map,rr=new Set;function sr(t,e){let n=ir.get(t);return n||(n=e(),ir.set(t,n),rr.add(n)),n}const or=(t,e,n)=>{const i=k(e,n);void 0!==i&&t.add(i)};class ar{constructor(t){this._config=function(t){return(t=t||{}).data=nr(t.data),er(t),t}(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=nr(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),er(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return sr(t,(()=>[[`datasets.${t}`,""]]))}datasetAnimationScopeKeys(t,e){return sr(`${t}.transition.${e}`,(()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]]))}datasetElementScopeKeys(t,e){return sr(`${t}-${e}`,(()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]]))}pluginScopeKeys(t){const e=t.id;return sr(`${this.type}-plugin-${e}`,(()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]]))}_cachedScopes(t,e){const n=this._scopeCache;let i=n.get(t);return i&&!e||(i=new Map,n.set(t,i)),i}getOptionScopes(t,e,n){const{options:i,type:r}=this,s=this._cachedScopes(t,n),o=s.get(e);if(o)return o;const a=new Set;e.forEach((e=>{t&&(a.add(t),e.forEach((e=>or(a,t,e)))),e.forEach((t=>or(a,i,t))),e.forEach((t=>or(a,Xt[r]||{},t))),e.forEach((t=>or(a,ee,t))),e.forEach((t=>or(a,Jt,t)))}));const c=Array.from(a);return 0===c.length&&c.push(Object.create(null)),rr.has(e)&&s.set(e,c),c}chartOptionScopes(){const{options:t,type:e}=this;return[t,Xt[e]||{},ee.datasets[e]||{},{type:e},ee,Jt]}resolveNamedOptions(t,e,n,i=[""]){const r={$shared:!0},{resolver:s,subPrefixes:o}=cr(this._resolverCache,t,i);let a=s;(function(t,e){const{isScriptable:n,isIndexable:i}=Ce(t);for(const r of e){const e=n(r),s=i(r),o=(s||e)&&t[r];if(e&&(A(o)||lr(o))||s&&u(o))return!0}return!1})(s,e)&&(r.$shared=!1,a=Se(s,n=A(n)?n():n,this.createResolver(t,n,o)));for(const t of e)r[t]=a[t];return r}createResolver(t,e,n=[""],i){const{resolver:r}=cr(this._resolverCache,t,n);return h(e)?Se(r,e,void 0,i):r}}function cr(t,e,n){let i=t.get(e);i||(i=new Map,t.set(e,i));const r=n.join();let s=i.get(r);return s||(s={resolver:ke(e,n),subPrefixes:n.filter((t=>!t.toLowerCase().includes("hover")))},i.set(r,s)),s}const lr=t=>h(t)&&Object.getOwnPropertyNames(t).reduce(((e,n)=>e||A(t[n])),!1),ur=["top","bottom","left","right","chartArea"];function hr(t,e){return"top"===t||"bottom"===t||-1===ur.indexOf(t)&&"x"===e}function dr(t,e){return function(n,i){return n[t]===i[t]?n[e]-i[e]:n[t]-i[t]}}function fr(t){const e=t.chart,n=e.options.animation;e.notifyPlugins("afterRender"),m(n&&n.onComplete,[t],e)}function pr(t){const e=t.chart,n=e.options.animation;m(n&&n.onProgress,[t],e)}function gr(t){return Ke()&&"string"==typeof t?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const mr={},yr=t=>{const e=gr(t);return Object.values(mr).filter((t=>t.canvas===e)).pop()};function vr(t,e,n){const i=Object.keys(t);for(const r of i){const i=+r;if(i>=e){const s=t[r];delete t[r],(n>0||i>e)&&(t[i+n]=s)}}}class br{constructor(t,e){const n=this.config=new ar(e),i=gr(t),r=yr(i);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const s=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||function(t){return!Ke()||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas?Ri:Qi}(i)),this.platform.updateConfig(n);const o=this.platform.acquireContext(i,s.aspectRatio),a=o&&o.canvas,l=a&&a.height,u=a&&a.width;this.id=c(),this.ctx=o,this.canvas=a,this.width=u,this.height=l,this._options=s,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Yi,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(t,e){let n;return function(...i){return e?(clearTimeout(n),n=setTimeout(t,e,i)):t.apply(this,i),e}}((t=>this.update(t)),s.resizeDelay||0),this._dataChanges=[],mr[this.id]=this,o&&a?(vn.listen(this,"complete",fr),vn.listen(this,"progress",pr),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:n,height:i,_aspectRatio:r}=this;return l(t)?e&&r?r:i?n/i:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():tn(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return se(this.canvas,this.ctx),this}stop(){return vn.stop(this),this}resize(t,e){vn.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const n=this.options,i=this.canvas,r=n.maintainAspectRatio&&this.aspectRatio,s=this.platform.getMaximumSize(i,t,e,r),o=n.devicePixelRatio||this.platform.getDevicePixelRatio(),a=this.width?"resize":"attach";this.width=s.width,this.height=s.height,this._aspectRatio=this.aspectRatio,tn(this,o,!0)&&(this.notifyPlugins("resize",{size:s}),m(n.onResize,[this,s],this),this.attached&&this._doResize(a)&&this.render())}ensureScalesHaveIDs(){y(this.options.scales||{},((t,e)=>{t.id=e}))}buildOrUpdateScales(){const t=this.options,e=t.scales,n=this.scales,i=Object.keys(n).reduce(((t,e)=>(t[e]=!1,t)),{});let r=[];e&&(r=r.concat(Object.keys(e).map((t=>{const n=e[t],i=tr(t,n),r="r"===i,s="x"===i;return{options:n,dposition:r?"chartArea":s?"bottom":"left",dtype:r?"radialLinear":s?"category":"linear"}})))),y(r,(e=>{const r=e.options,s=r.id,o=tr(s,r),a=p(r.type,e.dtype);void 0!==r.position&&hr(r.position,o)===hr(e.dposition)||(r.position=e.dposition),i[s]=!0;let c=null;s in n&&n[s].type===a?c=n[s]:(c=new(li.getScale(a))({id:s,type:a,ctx:this.ctx,chart:this}),n[c.id]=c),c.init(r,t)})),y(i,((t,e)=>{t||delete n[e]})),y(n,(t=>{Oi.configure(this,t,t.options),Oi.addBox(this,t)}))}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,n=t.length;if(t.sort(((t,e)=>t.index-e.index)),n>e){for(let t=e;t<n;++t)this._destroyDatasetMeta(t);t.splice(e,n-e)}this._sortedMetasets=t.slice(0).sort(dr("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach(((t,n)=>{0===e.filter((e=>e===t._dataset)).length&&this._destroyDatasetMeta(n)}))}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let n,i;for(this._removeUnreferencedMetasets(),n=0,i=e.length;n<i;n++){const i=e[n];let r=this.getDatasetMeta(n);const s=i.type||this.config.type;if(r.type&&r.type!==s&&(this._destroyDatasetMeta(n),r=this.getDatasetMeta(n)),r.type=s,r.indexAxis=i.indexAxis||Zi(s,this.options),r.order=i.order||0,r.index=n,r.label=""+i.label,r.visible=this.isDatasetVisible(n),r.controller)r.controller.updateIndex(n),r.controller.linkScales();else{const e=li.getController(s),{datasetElementType:i,dataElementType:o}=ee.datasets[s];Object.assign(e.prototype,{dataElementType:li.getElement(o),datasetElementType:i&&li.getElement(i)}),r.controller=new e(this,n),t.push(r.controller)}}return this._updateMetasets(),t}_resetElements(){y(this.data.datasets,((t,e)=>{this.getDatasetMeta(e).controller.reset()}),this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const n=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0}))return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let s=0;for(let t=0,e=this.data.datasets.length;t<e;t++){const{controller:e}=this.getDatasetMeta(t),n=!i&&-1===r.indexOf(e);e.buildOrUpdateElements(n),s=Math.max(+e.getMaxOverflow(),s)}s=this._minPadding=n.layout.autoPadding?s:0,this._updateLayout(s),i||y(r,(t=>{t.reset()})),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(dr("z","_idx"));const{_active:o,_lastEvent:a}=this;a?this._eventHandler(a,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){y(this.scales,(t=>{Oi.removeBox(this,t)})),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),n=new Set(t.events);D(e,n)&&!!this._responsiveListeners===t.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:n,start:i,count:r}of e)vr(t,i,"_removeElements"===n?-r:r)}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,n=e=>new Set(t.filter((t=>t[0]===e)).map(((t,e)=>e+","+t.splice(1).join(",")))),i=n(0);for(let t=1;t<e;t++)if(!D(i,n(t)))return;return Array.from(i).map((t=>t.split(","))).map((t=>({method:t[1],start:+t[2],count:+t[3]})))}_updateLayout(t){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;Oi.update(this,this.width,this.height,t);const e=this.chartArea,n=e.width<=0||e.height<=0;this._layers=[],y(this.boxes,(t=>{n&&"chartArea"===t.position||(t.configure&&t.configure(),this._layers.push(...t._layers()))}),this),this._layers.forEach(((t,e)=>{t._idx=e})),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})){for(let t=0,e=this.data.datasets.length;t<e;++t)this.getDatasetMeta(t).controller.configure();for(let e=0,n=this.data.datasets.length;e<n;++e)this._updateDataset(e,A(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const n=this.getDatasetMeta(t),i={meta:n,index:t,mode:e,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",i)&&(n.controller._update(e),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(vn.has(this)?this.attached&&!vn.running(this)&&vn.start(this):(this.draw(),fr({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:t,height:e}=this._resizeBeforeDraw;this._resize(t,e),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,n=[];let i,r;for(i=0,r=e.length;i<r;++i){const r=e[i];t&&!r.visible||n.push(r)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,n=t._clip,i=!n.disabled,r=this.chartArea,s={meta:t,index:t.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",s)&&(i&&le(e,{left:!1===n.left?0:r.left-n.left,right:!1===n.right?this.width:r.right+n.right,top:!1===n.top?0:r.top-n.top,bottom:!1===n.bottom?this.height:r.bottom+n.bottom}),t.controller.draw(),i&&ue(e),s.cancelable=!1,this.notifyPlugins("afterDatasetDraw",s))}isPointInArea(t){return ce(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,n,i){const r=wi.modes[e];return"function"==typeof r?r(this,t,n,i):[]}getDatasetMeta(t){const e=this.data.datasets[t],n=this._metasets;let i=n.filter((t=>t&&t._dataset===e)).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},n.push(i)),i}getContext(){return this.$context||(this.$context=Te(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const n=this.getDatasetMeta(t);return"boolean"==typeof n.hidden?!n.hidden:!e.hidden}setDatasetVisibility(t,e){this.getDatasetMeta(t).hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,n){const i=n?"show":"hide",r=this.getDatasetMeta(t),s=r.controller._resolveAnimations(void 0,i);C(e)?(r.data[e].hidden=!n,this.update()):(this.setDatasetVisibility(t,n),s.update(r,{visible:n}),this.update((e=>e.datasetIndex===t?i:void 0)))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),vn.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),se(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete mr[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,n=(n,i)=>{e.addEventListener(this,n,i),t[n]=i},i=(t,e,n)=>{t.offsetX=e,t.offsetY=n,this._eventHandler(t)};y(this.options.events,(t=>n(t,i)))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,n=(n,i)=>{e.addEventListener(this,n,i),t[n]=i},i=(n,i)=>{t[n]&&(e.removeEventListener(this,n,i),delete t[n])},r=(t,e)=>{this.canvas&&this.resize(t,e)};let s;const o=()=>{i("attach",o),this.attached=!0,this.resize(),n("resize",r),n("detach",s)};s=()=>{this.attached=!1,i("resize",r),this._stop(),this._resize(0,0),n("attach",o)},e.isAttached(this.canvas)?o():s()}unbindEvents(){y(this._listeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._listeners={},y(this._responsiveListeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._responsiveListeners=void 0}updateHoverStyle(t,e,n){const i=n?"set":"remove";let r,s,o,a;for("dataset"===e&&(r=this.getDatasetMeta(t[0].datasetIndex),r.controller["_"+i+"DatasetHoverStyle"]()),o=0,a=t.length;o<a;++o){s=t[o];const e=s&&this.getDatasetMeta(s.datasetIndex).controller;e&&e[i+"HoverStyle"](s.element,s.datasetIndex,s.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],n=t.map((({datasetIndex:t,index:e})=>{const n=this.getDatasetMeta(t);if(!n)throw new Error("No dataset found at index "+t);return{datasetIndex:t,element:n.data[e],index:e}}));!v(n,e)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,e))}notifyPlugins(t,e,n){return this._plugins.notify(this,t,e,n)}_updateHoverStyles(t,e,n){const i=this.options.hover,r=(t,e)=>t.filter((t=>!e.some((e=>t.datasetIndex===e.datasetIndex&&t.index===e.index)))),s=r(e,t),o=n?t:r(t,e);s.length&&this.updateHoverStyle(s,i.mode,!1),o.length&&i.mode&&this.updateHoverStyle(o,i.mode,!0)}_eventHandler(t,e){const n={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},i=e=>(e.options.events||this.options.events).includes(t.native.type);if(!1===this.notifyPlugins("beforeEvent",n,i))return;const r=this._handleEvent(t,e,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,i),(r||n.changed)&&this.render(),this}_handleEvent(t,e,n){const{_active:i=[],options:r}=this,s=e,o=this._getActiveElements(t,i,n,s),a=function(t){return"mouseup"===t.type||"click"===t.type||"contextmenu"===t.type}(t),c=function(t,e,n,i){return n&&"mouseout"!==t.type?i?e:t:null}(t,this._lastEvent,n,a);n&&(this._lastEvent=null,m(r.onHover,[t,o,this],this),a&&m(r.onClick,[t,o,this],this));const l=!v(o,i);return(l||e)&&(this._active=o,this._updateHoverStyles(o,i,e)),this._lastEvent=c,l}_getActiveElements(t,e,n,i){if("mouseout"===t.type)return[];if(!n)return e;const r=this.options.hover;return this.getElementsAtEventForMode(t,r.mode,r,i)}}const wr=()=>y(br.instances,(t=>t._plugins.invalidate())),_r=!0;function xr(t,e,n){const{startAngle:i,pixelMargin:r,x:s,y:o,outerRadius:a,innerRadius:c}=e;let l=r/a;t.beginPath(),t.arc(s,o,a,i-l,n+l),c>r?(l=r/c,t.arc(s,o,c,n+l,i-l,!0)):t.arc(s,o,r,n+L,i-L),t.closePath(),t.clip()}function Ir(t,e,n,i){return{x:n+t*Math.cos(e),y:i+t*Math.sin(e)}}function Er(t,e,n,i,r,s){const{x:o,y:a,startAngle:c,pixelMargin:l,innerRadius:u}=e,h=Math.max(e.outerRadius+i+n-l,0),d=u>0?u+i+n+l:0;let f=0;const p=r-c;if(i){const t=((u>0?u-i:0)+(h>0?h-i:0))/2;f=(p-(0!==t?p*t/(t+i):p))/2}const g=(p-Math.max(.001,p*h-n/M)/h)/2,m=c+g+f,y=r-g-f,{outerStart:v,outerEnd:b,innerStart:w,innerEnd:_}=function(t,e,n,i){const r=be(t.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]),s=(n-e)/2,o=Math.min(s,i*e/2),a=t=>{const e=(n-Math.min(s,t))*i/2;return Z(t,0,Math.min(s,e))};return{outerStart:a(r.outerStart),outerEnd:a(r.outerEnd),innerStart:Z(r.innerStart,0,o),innerEnd:Z(r.innerEnd,0,o)}}(e,d,h,y-m),x=h-v,I=h-b,E=m+v/x,T=y-b/I,k=d+w,S=d+_,C=m+w/k,A=y-_/S;if(t.beginPath(),s){if(t.arc(o,a,h,E,T),b>0){const e=Ir(I,T,o,a);t.arc(e.x,e.y,b,T,y+L)}const e=Ir(S,y,o,a);if(t.lineTo(e.x,e.y),_>0){const e=Ir(S,A,o,a);t.arc(e.x,e.y,_,y+L,A+Math.PI)}if(t.arc(o,a,d,y-_/d,m+w/d,!0),w>0){const e=Ir(k,C,o,a);t.arc(e.x,e.y,w,C+Math.PI,m-L)}const n=Ir(x,m,o,a);if(t.lineTo(n.x,n.y),v>0){const e=Ir(x,E,o,a);t.arc(e.x,e.y,v,m-L,E)}}else{t.moveTo(o,a);const e=Math.cos(E)*h+o,n=Math.sin(E)*h+a;t.lineTo(e,n);const i=Math.cos(T)*h+o,r=Math.sin(T)*h+a;t.lineTo(i,r)}t.closePath()}Object.defineProperties(br,{defaults:{enumerable:_r,value:ee},instances:{enumerable:_r,value:mr},overrides:{enumerable:_r,value:Xt},registry:{enumerable:_r,value:li},version:{enumerable:_r,value:"3.9.1"},getChart:{enumerable:_r,value:yr},register:{enumerable:_r,value:(...t)=>{li.add(...t),wr()}},unregister:{enumerable:_r,value:(...t)=>{li.remove(...t),wr()}}});class Tr extends Xn{constructor(t){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,n){const i=this.getProps(["x","y"],n),{angle:r,distance:s}=W(i,{x:t,y:e}),{startAngle:o,endAngle:a,innerRadius:c,outerRadius:l,circumference:u}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),h=this.options.spacing/2,d=p(u,a-o)>=O||J(r,o,a),f=tt(s,c+h,l+h);return d&&f}getCenterPoint(t){const{x:e,y:n,startAngle:i,endAngle:r,innerRadius:s,outerRadius:o}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],t),{offset:a,spacing:c}=this.options,l=(i+r)/2,u=(s+o+c+a)/2;return{x:e+Math.cos(l)*u,y:n+Math.sin(l)*u}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:n}=this,i=(e.offset||0)/2,r=(e.spacing||0)/2,s=e.circular;if(this.pixelMargin="inner"===e.borderAlign?.33:0,this.fullCircles=n>O?Math.floor(n/O):0,0===n||this.innerRadius<0||this.outerRadius<0)return;t.save();let o=0;if(i){o=i/2;const e=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(e)*o,Math.sin(e)*o),this.circumference>=M&&(o=i)}t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor;const a=function(t,e,n,i,r){const{fullCircles:s,startAngle:o,circumference:a}=e;let c=e.endAngle;if(s){Er(t,e,n,i,o+O,r);for(let e=0;e<s;++e)t.fill();isNaN(a)||(c=o+a%O,a%O===0&&(c+=O))}return Er(t,e,n,i,c,r),t.fill(),c}(t,this,o,r,s);(function(t,e,n,i,r,s){const{options:o}=e,{borderWidth:a,borderJoinStyle:c}=o,l="inner"===o.borderAlign;a&&(l?(t.lineWidth=2*a,t.lineJoin=c||"round"):(t.lineWidth=a,t.lineJoin=c||"bevel"),e.fullCircles&&function(t,e,n){const{x:i,y:r,startAngle:s,pixelMargin:o,fullCircles:a}=e,c=Math.max(e.outerRadius-o,0),l=e.innerRadius+o;let u;for(n&&xr(t,e,s+O),t.beginPath(),t.arc(i,r,l,s+O,s,!0),u=0;u<a;++u)t.stroke();for(t.beginPath(),t.arc(i,r,c,s,s+O),u=0;u<a;++u)t.stroke()}(t,e,l),l&&xr(t,e,r),Er(t,e,n,i,r,s),t.stroke())})(t,this,o,r,a,s),t.restore()}}function kr(t,e,n=e){t.lineCap=p(n.borderCapStyle,e.borderCapStyle),t.setLineDash(p(n.borderDash,e.borderDash)),t.lineDashOffset=p(n.borderDashOffset,e.borderDashOffset),t.lineJoin=p(n.borderJoinStyle,e.borderJoinStyle),t.lineWidth=p(n.borderWidth,e.borderWidth),t.strokeStyle=p(n.borderColor,e.borderColor)}function Sr(t,e,n){t.lineTo(n.x,n.y)}function Cr(t,e,n={}){const i=t.length,{start:r=0,end:s=i-1}=n,{start:o,end:a}=e,c=Math.max(r,o),l=Math.min(s,a),u=r<o&&s<o||r>a&&s>a;return{count:i,start:c,loop:e.loop,ilen:l<c&&!u?i+l-c:l-c}}function Ar(t,e,n,i){const{points:r,options:s}=e,{count:o,start:a,loop:c,ilen:l}=Cr(r,n,i),u=function(t){return t.stepped?he:t.tension||"monotone"===t.cubicInterpolationMode?de:Sr}(s);let h,d,f,{move:p=!0,reverse:g}=i||{};for(h=0;h<=l;++h)d=r[(a+(g?l-h:h))%o],d.skip||(p?(t.moveTo(d.x,d.y),p=!1):u(t,f,d,g,s.stepped),f=d);return c&&(d=r[(a+(g?l:0))%o],u(t,f,d,g,s.stepped)),!!c}function Dr(t,e,n,i){const r=e.points,{count:s,start:o,ilen:a}=Cr(r,n,i),{move:c=!0,reverse:l}=i||{};let u,h,d,f,p,g,m=0,y=0;const v=t=>(o+(l?a-t:t))%s,b=()=>{f!==p&&(t.lineTo(m,p),t.lineTo(m,f),t.lineTo(m,g))};for(c&&(h=r[v(0)],t.moveTo(h.x,h.y)),u=0;u<=a;++u){if(h=r[v(u)],h.skip)continue;const e=h.x,n=h.y,i=0|e;i===d?(n<f?f=n:n>p&&(p=n),m=(y*m+e)/++y):(b(),t.lineTo(e,n),d=i,y=0,f=p=n),g=n}b()}function Mr(t){const e=t.options,n=e.borderDash&&e.borderDash.length;return t._decimated||t._loop||e.tension||"monotone"===e.cubicInterpolationMode||e.stepped||n?Ar:Dr}Tr.id="arc",Tr.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0},Tr.defaultRoutes={backgroundColor:"backgroundColor"};const Or="function"==typeof Path2D;class Pr extends Xn{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const n=this.options;if((n.tension||"monotone"===n.cubicInterpolationMode)&&!n.stepped&&!this._pointsUpdated){const i=n.spanGaps?this._loop:this._fullLoop;He(this._points,n,t,i,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(t,e){const n=t.points,i=t.options.spanGaps,r=n.length;if(!r)return[];const s=!!t._loop,{start:o,end:a}=function(t,e,n,i){let r=0,s=e-1;if(n&&!i)for(;r<e&&!t[r].skip;)r++;for(;r<e&&t[r].skip;)r++;for(r%=e,n&&(s+=r);s>r&&t[s%e].skip;)s--;return s%=e,{start:r,end:s}}(n,r,s,i);return function(t,e,n,i){return i&&i.setContext&&n?function(t,e,n,i){const r=t._chart.getContext(),s=mn(t.options),{_datasetIndex:o,options:{spanGaps:a}}=t,c=n.length,l=[];let u=s,h=e[0].start,d=h;function f(t,e,i,r){const s=a?-1:1;if(t!==e){for(t+=c;n[t%c].skip;)t-=s;for(;n[e%c].skip;)e+=s;t%c!==e%c&&(l.push({start:t%c,end:e%c,loop:i,style:r}),u=r,h=e%c)}}for(const t of e){h=a?h:t.start;let e,s=n[h%c];for(d=h+1;d<=t.end;d++){const a=n[d%c];e=mn(i.setContext(Te(r,{type:"segment",p0:s,p1:a,p0DataIndex:(d-1)%c,p1DataIndex:d%c,datasetIndex:o}))),yn(e,u)&&f(h,d-1,t.loop,u),s=a,u=e}h<d-1&&f(h,d-1,t.loop,u)}return l}(t,e,n,i):e}(t,!0===i?[{start:o,end:a,loop:s}]:function(t,e,n,i){const r=t.length,s=[];let o,a=e,c=t[e];for(o=e+1;o<=n;++o){const n=t[o%r];n.skip||n.stop?c.skip||(i=!1,s.push({start:e%r,end:(o-1)%r,loop:i}),e=a=n.stop?o:null):(a=o,c.skip&&(e=o)),c=n}return null!==a&&s.push({start:e%r,end:a%r,loop:i}),s}(n,o,a<o?a+r:a,!!t._fullLoop&&0===o&&a===r-1),n,e)}(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,n=t.length;return n&&e[t[n-1].end]}interpolate(t,e){const n=this.options,i=t[e],r=this.points,s=gn(this,{property:e,start:i,end:i});if(!s.length)return;const o=[],a=function(t){return t.stepped?sn:t.tension||"monotone"===t.cubicInterpolationMode?on:rn}(n);let c,l;for(c=0,l=s.length;c<l;++c){const{start:l,end:u}=s[c],h=r[l],d=r[u];if(h===d){o.push(h);continue}const f=a(h,d,Math.abs((i-h[e])/(d[e]-h[e])),n.stepped);f[e]=t[e],o.push(f)}return 1===o.length?o[0]:o}pathSegment(t,e,n){return Mr(this)(t,this,e,n)}path(t,e,n){const i=this.segments,r=Mr(this);let s=this._loop;e=e||0,n=n||this.points.length-e;for(const o of i)s&=r(t,this,o,{start:e,end:e+n-1});return!!s}draw(t,e,n,i){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),function(t,e,n,i){Or&&!e.options.segment?function(t,e,n,i){let r=e._path;r||(r=e._path=new Path2D,e.path(r,n,i)&&r.closePath()),kr(t,e.options),t.stroke(r)}(t,e,n,i):function(t,e,n,i){const{segments:r,options:s}=e,o=Mr(e);for(const a of r)kr(t,s,a.style),t.beginPath(),o(t,e,a,{start:n,end:n+i-1})&&t.closePath(),t.stroke()}(t,e,n,i)}(t,this,n,i),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function Rr(t,e,n,i){const r=t.options,{[n]:s}=t.getProps([n],i);return Math.abs(e-s)<r.radius+r.hitRadius}Pr.id="line",Pr.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0},Pr.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},Pr.descriptors={_scriptable:!0,_indexable:t=>"borderDash"!==t&&"fill"!==t};class Nr extends Xn{constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,n){const i=this.options,{x:r,y:s}=this.getProps(["x","y"],n);return Math.pow(t-r,2)+Math.pow(e-s,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(t,e){return Rr(this,t,"x",e)}inYRange(t,e){return Rr(this,t,"y",e)}getCenterPoint(t){const{x:e,y:n}=this.getProps(["x","y"],t);return{x:e,y:n}}size(t){let e=(t=t||this.options||{}).radius||0;return e=Math.max(e,e&&t.hoverRadius||0),2*(e+(e&&t.borderWidth||0))}draw(t,e){const n=this.options;this.skip||n.radius<.1||!ce(this,e,this.size(n)/2)||(t.strokeStyle=n.borderColor,t.lineWidth=n.borderWidth,t.fillStyle=n.backgroundColor,oe(t,n,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}function Lr(t,e){const{x:n,y:i,base:r,width:s,height:o}=t.getProps(["x","y","base","width","height"],e);let a,c,l,u,h;return t.horizontal?(h=o/2,a=Math.min(n,r),c=Math.max(n,r),l=i-h,u=i+h):(h=s/2,a=n-h,c=n+h,l=Math.min(i,r),u=Math.max(i,r)),{left:a,top:l,right:c,bottom:u}}function Fr(t,e,n,i){return t?0:Z(e,n,i)}function Vr(t,e,n,i){const r=null===e,s=null===n,o=t&&!(r&&s)&&Lr(t,i);return o&&(r||tt(e,o.left,o.right))&&(s||tt(n,o.top,o.bottom))}function Br(t,e){t.rect(e.x,e.y,e.w,e.h)}function Ur(t,e,n={}){const i=t.x!==n.x?-e:0,r=t.y!==n.y?-e:0,s=(t.x+t.w!==n.x+n.w?e:0)-i,o=(t.y+t.h!==n.y+n.h?e:0)-r;return{x:t.x+i,y:t.y+r,w:t.w+s,h:t.h+o,radius:t.radius}}Nr.id="point",Nr.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0},Nr.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};class jr extends Xn{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:n,backgroundColor:i}}=this,{inner:r,outer:s}=function(t){const e=Lr(t),n=e.right-e.left,i=e.bottom-e.top,r=function(t,e,n){const i=t.options.borderWidth,r=t.borderSkipped,s=we(i);return{t:Fr(r.top,s.top,0,n),r:Fr(r.right,s.right,0,e),b:Fr(r.bottom,s.bottom,0,n),l:Fr(r.left,s.left,0,e)}}(t,n/2,i/2),s=function(t,e,n){const{enableBorderRadius:i}=t.getProps(["enableBorderRadius"]),r=t.options.borderRadius,s=_e(r),o=Math.min(e,n),a=t.borderSkipped,c=i||h(r);return{topLeft:Fr(!c||a.top||a.left,s.topLeft,0,o),topRight:Fr(!c||a.top||a.right,s.topRight,0,o),bottomLeft:Fr(!c||a.bottom||a.left,s.bottomLeft,0,o),bottomRight:Fr(!c||a.bottom||a.right,s.bottomRight,0,o)}}(t,n/2,i/2);return{outer:{x:e.left,y:e.top,w:n,h:i,radius:s},inner:{x:e.left+r.l,y:e.top+r.t,w:n-r.l-r.r,h:i-r.t-r.b,radius:{topLeft:Math.max(0,s.topLeft-Math.max(r.t,r.l)),topRight:Math.max(0,s.topRight-Math.max(r.t,r.r)),bottomLeft:Math.max(0,s.bottomLeft-Math.max(r.b,r.l)),bottomRight:Math.max(0,s.bottomRight-Math.max(r.b,r.r))}}}}(this),o=(a=s.radius).topLeft||a.topRight||a.bottomLeft||a.bottomRight?ge:Br;var a;t.save(),s.w===r.w&&s.h===r.h||(t.beginPath(),o(t,Ur(s,e,r)),t.clip(),o(t,Ur(r,-e,s)),t.fillStyle=n,t.fill("evenodd")),t.beginPath(),o(t,Ur(r,e)),t.fillStyle=i,t.fill(),t.restore()}inRange(t,e,n){return Vr(this,t,e,n)}inXRange(t,e){return Vr(this,t,null,e)}inYRange(t,e){return Vr(this,null,t,e)}getCenterPoint(t){const{x:e,y:n,base:i,horizontal:r}=this.getProps(["x","y","base","horizontal"],t);return{x:r?(e+i)/2:e,y:r?n:(n+i)/2}}getRange(t){return"x"===t?this.width/2:this.height/2}}jr.id="bar",jr.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0},jr.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};var zr=Object.freeze({__proto__:null,ArcElement:Tr,LineElement:Pr,PointElement:Nr,BarElement:jr});function qr(t){if(t._decimated){const e=t._data;delete t._decimated,delete t._data,Object.defineProperty(t,"data",{value:e})}}function $r(t){t.data.datasets.forEach((t=>{qr(t)}))}var Hr={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(t,e,n)=>{if(!n.enabled)return void $r(t);const i=t.width;t.data.datasets.forEach(((e,r)=>{const{_data:s,indexAxis:o}=e,a=t.getDatasetMeta(r),c=s||e.data;if("y"===Ee([o,t.options.indexAxis]))return;if(!a.controller.supportsDecimation)return;const u=t.scales[a.xAxisID];if("linear"!==u.type&&"time"!==u.type)return;if(t.options.parsing)return;let h,{start:d,count:f}=function(t,e){const n=e.length;let i,r=0;const{iScale:s}=t,{min:o,max:a,minDefined:c,maxDefined:l}=s.getUserBounds();return c&&(r=Z(nt(e,s.axis,o).lo,0,n-1)),i=l?Z(nt(e,s.axis,a).hi+1,r,n)-r:n-r,{start:r,count:i}}(a,c);if(f<=(n.threshold||4*i))qr(e);else{switch(l(s)&&(e._data=c,delete e.data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(t){this._data=t}})),n.algorithm){case"lttb":h=function(t,e,n,i,r){const s=r.samples||i;if(s>=n)return t.slice(e,e+n);const o=[],a=(n-2)/(s-2);let c=0;const l=e+n-1;let u,h,d,f,p,g=e;for(o[c++]=t[g],u=0;u<s-2;u++){let i,r=0,s=0;const l=Math.floor((u+1)*a)+1+e,m=Math.min(Math.floor((u+2)*a)+1,n)+e,y=m-l;for(i=l;i<m;i++)r+=t[i].x,s+=t[i].y;r/=y,s/=y;const v=Math.floor(u*a)+1+e,b=Math.min(Math.floor((u+1)*a)+1,n)+e,{x:w,y:_}=t[g];for(d=f=-1,i=v;i<b;i++)f=.5*Math.abs((w-r)*(t[i].y-_)-(w-t[i].x)*(s-_)),f>d&&(d=f,h=t[i],p=i);o[c++]=h,g=p}return o[c++]=t[l],o}(c,d,f,i,n);break;case"min-max":h=function(t,e,n,i){let r,s,o,a,c,u,h,d,f,p,g=0,m=0;const y=[],v=e+n-1,b=t[e].x,w=t[v].x-b;for(r=e;r<e+n;++r){s=t[r],o=(s.x-b)/w*i,a=s.y;const e=0|o;if(e===c)a<f?(f=a,u=r):a>p&&(p=a,h=r),g=(m*g+s.x)/++m;else{const n=r-1;if(!l(u)&&!l(h)){const e=Math.min(u,h),i=Math.max(u,h);e!==d&&e!==n&&y.push({...t[e],x:g}),i!==d&&i!==n&&y.push({...t[i],x:g})}r>0&&n!==d&&y.push(t[n]),y.push(s),c=e,m=0,f=p=a,u=h=d=r}}return y}(c,d,f,i);break;default:throw new Error(`Unsupported decimation algorithm '${n.algorithm}'`)}e._decimated=h}}))},destroy(t){$r(t)}};function Kr(t,e,n,i){if(i)return;let r=e[t],s=n[t];return"angle"===t&&(r=X(r),s=X(s)),{property:t,start:r,end:s}}function Gr(t,e,n){for(;e>t;e--){const t=n[e];if(!isNaN(t.x)&&!isNaN(t.y))break}return e}function Wr(t,e,n,i){return t&&e?i(t[n],e[n]):t?t[n]:e?e[n]:0}function Qr(t,e){let n=[],i=!1;return u(t)?(i=!0,n=t):n=function(t,e){const{x:n=null,y:i=null}=t||{},r=e.points,s=[];return e.segments.forEach((({start:t,end:e})=>{e=Gr(t,e,r);const o=r[t],a=r[e];null!==i?(s.push({x:o.x,y:i}),s.push({x:a.x,y:i})):null!==n&&(s.push({x:n,y:o.y}),s.push({x:n,y:a.y}))})),s}(t,e),n.length?new Pr({points:n,options:{tension:0},_loop:i,_fullLoop:i}):null}function Yr(t){return t&&!1!==t.fill}function Xr(t,e,n){let i=t[e].fill;const r=[e];let s;if(!n)return i;for(;!1!==i&&-1===r.indexOf(i);){if(!d(i))return i;if(s=t[i],!s)return!1;if(s.visible)return i;r.push(i),i=s.fill}return!1}function Jr(t,e,n){const i=function(t){const e=t.options,n=e.fill;let i=p(n&&n.target,n);return void 0===i&&(i=!!e.backgroundColor),!1!==i&&null!==i&&(!0===i?"origin":i)}(t);if(h(i))return!isNaN(i.value)&&i;let r=parseFloat(i);return d(r)&&Math.floor(r)===r?function(t,e,n,i){return"-"!==t&&"+"!==t||(n=e+n),!(n===e||n<0||n>=i)&&n}(i[0],e,r,n):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function Zr(t,e,n){const i=[];for(let r=0;r<n.length;r++){const s=n[r],{first:o,last:a,point:c}=ts(s,e,"x");if(!(!c||o&&a))if(o)i.unshift(c);else if(t.push(c),!a)break}t.push(...i)}function ts(t,e,n){const i=t.interpolate(e,n);if(!i)return{};const r=i[n],s=t.segments,o=t.points;let a=!1,c=!1;for(let t=0;t<s.length;t++){const e=s[t],i=o[e.start][n],l=o[e.end][n];if(tt(r,i,l)){a=r===i,c=r===l;break}}return{first:a,last:c,point:i}}class es{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,n){const{x:i,y:r,radius:s}=this;return e=e||{start:0,end:O},t.arc(i,r,s,e.end,e.start,!0),!n.bounds}interpolate(t){const{x:e,y:n,radius:i}=this,r=t.angle;return{x:e+Math.cos(r)*i,y:n+Math.sin(r)*i,angle:r}}}function ns(t,e,n){const i=function(t){const{chart:e,fill:n,line:i}=t;if(d(n))return function(t,e){const n=t.getDatasetMeta(e);return n&&t.isDatasetVisible(e)?n.dataset:null}(e,n);if("stack"===n)return function(t){const{scale:e,index:n,line:i}=t,r=[],s=i.segments,o=i.points,a=function(t,e){const n=[],i=t.getMatchingVisibleMetas("line");for(let t=0;t<i.length;t++){const r=i[t];if(r.index===e)break;r.hidden||n.unshift(r.dataset)}return n}(e,n);a.push(Qr({x:null,y:e.bottom},i));for(let t=0;t<s.length;t++){const e=s[t];for(let t=e.start;t<=e.end;t++)Zr(r,o[t],a)}return new Pr({points:r,options:{}})}(t);if("shape"===n)return!0;const r=function(t){return(t.scale||{}).getPointPositionForValue?function(t){const{scale:e,fill:n}=t,i=e.options,r=e.getLabels().length,s=i.reverse?e.max:e.min,o=function(t,e,n){let i;return i="start"===t?n:"end"===t?e.options.reverse?e.min:e.max:h(t)?t.value:e.getBaseValue(),i}(n,e,s),a=[];if(i.grid.circular){const t=e.getPointPositionForValue(0,s);return new es({x:t.x,y:t.y,radius:e.getDistanceFromCenterForValue(o)})}for(let t=0;t<r;++t)a.push(e.getPointPositionForValue(t,o));return a}(t):function(t){const{scale:e={},fill:n}=t,i=function(t,e){let n=null;return"start"===t?n=e.bottom:"end"===t?n=e.top:h(t)?n=e.getPixelForValue(t.value):e.getBasePixel&&(n=e.getBasePixel()),n}(n,e);if(d(i)){const t=e.isHorizontal();return{x:t?i:null,y:t?null:i}}return null}(t)}(t);return r instanceof es?r:Qr(r,i)}(e),{line:r,scale:s,axis:o}=e,a=r.options,c=a.fill,l=a.backgroundColor,{above:u=l,below:f=l}=c||{};i&&r.points.length&&(le(t,n),function(t,e){const{line:n,target:i,above:r,below:s,area:o,scale:a}=e,c=n._loop?"angle":e.axis;t.save(),"x"===c&&s!==r&&(is(t,i,o.top),rs(t,{line:n,target:i,color:r,scale:a,property:c}),t.restore(),t.save(),is(t,i,o.bottom)),rs(t,{line:n,target:i,color:s,scale:a,property:c}),t.restore()}(t,{line:r,target:i,above:u,below:f,area:n,scale:s,axis:o}),ue(t))}function is(t,e,n){const{segments:i,points:r}=e;let s=!0,o=!1;t.beginPath();for(const a of i){const{start:i,end:c}=a,l=r[i],u=r[Gr(i,c,r)];s?(t.moveTo(l.x,l.y),s=!1):(t.lineTo(l.x,n),t.lineTo(l.x,l.y)),o=!!e.pathSegment(t,a,{move:o}),o?t.closePath():t.lineTo(u.x,n)}t.lineTo(e.first().x,n),t.closePath(),t.clip()}function rs(t,e){const{line:n,target:i,property:r,color:s,scale:o}=e,a=function(t,e,n){const i=t.segments,r=t.points,s=e.points,o=[];for(const t of i){let{start:i,end:a}=t;a=Gr(i,a,r);const c=Kr(n,r[i],r[a],t.loop);if(!e.segments){o.push({source:t,target:c,start:r[i],end:r[a]});continue}const l=gn(e,c);for(const e of l){const i=Kr(n,s[e.start],s[e.end],e.loop),a=pn(t,r,i);for(const t of a)o.push({source:t,target:e,start:{[n]:Wr(c,i,"start",Math.max)},end:{[n]:Wr(c,i,"end",Math.min)}})}}return o}(n,i,r);for(const{source:e,target:c,start:l,end:u}of a){const{style:{backgroundColor:a=s}={}}=e,h=!0!==i;t.save(),t.fillStyle=a,ss(t,o,h&&Kr(r,l,u)),t.beginPath();const d=!!n.pathSegment(t,e);let f;if(h){d?t.closePath():os(t,i,u,r);const e=!!i.pathSegment(t,c,{move:d,reverse:!0});f=d&&e,f||os(t,i,l,r)}t.closePath(),t.fill(f?"evenodd":"nonzero"),t.restore()}}function ss(t,e,n){const{top:i,bottom:r}=e.chart.chartArea,{property:s,start:o,end:a}=n||{};"x"===s&&(t.beginPath(),t.rect(o,i,a-o,r-i),t.clip())}function os(t,e,n,i){const r=e.interpolate(n,i);r&&t.lineTo(r.x,r.y)}var as={id:"filler",afterDatasetsUpdate(t,e,n){const i=(t.data.datasets||[]).length,r=[];let s,o,a,c;for(o=0;o<i;++o)s=t.getDatasetMeta(o),a=s.dataset,c=null,a&&a.options&&a instanceof Pr&&(c={visible:t.isDatasetVisible(o),index:o,fill:Jr(a,o,i),chart:t,axis:s.controller.options.indexAxis,scale:s.vScale,line:a}),s.$filler=c,r.push(c);for(o=0;o<i;++o)c=r[o],c&&!1!==c.fill&&(c.fill=Xr(r,o,n.propagate))},beforeDraw(t,e,n){const i="beforeDraw"===n.drawTime,r=t.getSortedVisibleDatasetMetas(),s=t.chartArea;for(let e=r.length-1;e>=0;--e){const n=r[e].$filler;n&&(n.line.updateControlPoints(s,n.axis),i&&n.fill&&ns(t.ctx,n,s))}},beforeDatasetsDraw(t,e,n){if("beforeDatasetsDraw"!==n.drawTime)return;const i=t.getSortedVisibleDatasetMetas();for(let e=i.length-1;e>=0;--e){const n=i[e].$filler;Yr(n)&&ns(t.ctx,n,t.chartArea)}},beforeDatasetDraw(t,e,n){const i=e.meta.$filler;Yr(i)&&"beforeDatasetDraw"===n.drawTime&&ns(t.ctx,i,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const cs=(t,e)=>{let{boxHeight:n=e,boxWidth:i=e}=t;return t.usePointStyle&&(n=Math.min(n,e),i=t.pointStyleWidth||Math.min(i,e)),{boxWidth:i,boxHeight:n,itemHeight:Math.max(e,n)}};class ls extends Xn{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,n){this.maxWidth=t,this.maxHeight=e,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=m(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter((e=>t.filter(e,this.chart.data)))),t.sort&&(e=e.sort(((e,n)=>t.sort(e,n,this.chart.data)))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display)return void(this.width=this.height=0);const n=t.labels,i=Ie(n.font),r=i.size,s=this._computeTitleHeight(),{boxWidth:o,itemHeight:a}=cs(n,r);let c,l;e.font=i.string,this.isHorizontal()?(c=this.maxWidth,l=this._fitRows(s,r,o,a)+10):(l=this.maxHeight,c=this._fitCols(s,r,o,a)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(l,t.maxHeight||this.maxHeight)}_fitRows(t,e,n,i){const{ctx:r,maxWidth:s,options:{labels:{padding:o}}}=this,a=this.legendHitBoxes=[],c=this.lineWidths=[0],l=i+o;let u=t;r.textAlign="left",r.textBaseline="middle";let h=-1,d=-l;return this.legendItems.forEach(((t,f)=>{const p=n+e/2+r.measureText(t.text).width;(0===f||c[c.length-1]+p+2*o>s)&&(u+=l,c[c.length-(f>0?0:1)]=0,d+=l,h++),a[f]={left:0,top:d,row:h,width:p,height:i},c[c.length-1]+=p+o})),u}_fitCols(t,e,n,i){const{ctx:r,maxHeight:s,options:{labels:{padding:o}}}=this,a=this.legendHitBoxes=[],c=this.columnSizes=[],l=s-t;let u=o,h=0,d=0,f=0,p=0;return this.legendItems.forEach(((t,s)=>{const g=n+e/2+r.measureText(t.text).width;s>0&&d+i+2*o>l&&(u+=h+o,c.push({width:h,height:d}),f+=h+o,p++,h=d=0),a[s]={left:f,top:d,col:p,width:g,height:i},h=Math.max(h,g),d+=i+o})),u+=h,c.push({width:h,height:d}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:n,labels:{padding:i},rtl:r}}=this,s=ln(r,this.left,this.width);if(this.isHorizontal()){let r=0,o=ut(n,this.left+i,this.right-this.lineWidths[r]);for(const a of e)r!==a.row&&(r=a.row,o=ut(n,this.left+i,this.right-this.lineWidths[r])),a.top+=this.top+t+i,a.left=s.leftForLtr(s.x(o),a.width),o+=a.width+i}else{let r=0,o=ut(n,this.top+t+i,this.bottom-this.columnSizes[r].height);for(const a of e)a.col!==r&&(r=a.col,o=ut(n,this.top+t+i,this.bottom-this.columnSizes[r].height)),a.top=o,a.left+=this.left+i,a.left=s.leftForLtr(s.x(a.left),a.width),o+=a.height+i}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const t=this.ctx;le(t,this),this._draw(),ue(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:n,ctx:i}=this,{align:r,labels:s}=t,o=ee.color,a=ln(t.rtl,this.left,this.width),c=Ie(s.font),{color:l,padding:u}=s,h=c.size,d=h/2;let f;this.drawTitle(),i.textAlign=a.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=c.string;const{boxWidth:g,boxHeight:m,itemHeight:y}=cs(s,h),v=this.isHorizontal(),b=this._computeTitleHeight();f=v?{x:ut(r,this.left+u,this.right-n[0]),y:this.top+u+b,line:0}:{x:this.left+u,y:ut(r,this.top+b+u,this.bottom-e[0].height),line:0},un(this.ctx,t.textDirection);const w=y+u;this.legendItems.forEach(((_,x)=>{i.strokeStyle=_.fontColor||l,i.fillStyle=_.fontColor||l;const I=i.measureText(_.text).width,E=a.textAlign(_.textAlign||(_.textAlign=s.textAlign)),T=g+d+I;let k=f.x,S=f.y;a.setWidth(this.width),v?x>0&&k+T+u>this.right&&(S=f.y+=w,f.line++,k=f.x=ut(r,this.left+u,this.right-n[f.line])):x>0&&S+w>this.bottom&&(k=f.x=k+e[f.line].width+u,f.line++,S=f.y=ut(r,this.top+b+u,this.bottom-e[f.line].height)),function(t,e,n){if(isNaN(g)||g<=0||isNaN(m)||m<0)return;i.save();const r=p(n.lineWidth,1);if(i.fillStyle=p(n.fillStyle,o),i.lineCap=p(n.lineCap,"butt"),i.lineDashOffset=p(n.lineDashOffset,0),i.lineJoin=p(n.lineJoin,"miter"),i.lineWidth=r,i.strokeStyle=p(n.strokeStyle,o),i.setLineDash(p(n.lineDash,[])),s.usePointStyle){const o={radius:m*Math.SQRT2/2,pointStyle:n.pointStyle,rotation:n.rotation,borderWidth:r},c=a.xPlus(t,g/2);ae(i,o,c,e+d,s.pointStyleWidth&&g)}else{const s=e+Math.max((h-m)/2,0),o=a.leftForLtr(t,g),c=_e(n.borderRadius);i.beginPath(),Object.values(c).some((t=>0!==t))?ge(i,{x:o,y:s,w:g,h:m,radius:c}):i.rect(o,s,g,m),i.fill(),0!==r&&i.stroke()}i.restore()}(a.x(k),S,_),k=((t,e,n,i)=>t===(i?"left":"right")?n:"center"===t?(e+n)/2:e)(E,k+g+d,v?k+T:this.right,t.rtl),function(t,e,n){fe(i,n.text,t,e+y/2,c,{strikethrough:n.hidden,textAlign:a.textAlign(n.textAlign)})}(a.x(k),S,_),v?f.x+=T+u:f.y+=w})),hn(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,n=Ie(e.font),i=xe(e.padding);if(!e.display)return;const r=ln(t.rtl,this.left,this.width),s=this.ctx,o=e.position,a=n.size/2,c=i.top+a;let l,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),l=this.top+c,u=ut(t.align,u,this.right-h);else{const e=this.columnSizes.reduce(((t,e)=>Math.max(t,e.height)),0);l=c+ut(t.align,this.top,this.bottom-e-t.labels.padding-this._computeTitleHeight())}const d=ut(o,u,u+h);s.textAlign=r.textAlign(lt(o)),s.textBaseline="middle",s.strokeStyle=e.color,s.fillStyle=e.color,s.font=n.string,fe(s,e.text,d,l,n)}_computeTitleHeight(){const t=this.options.title,e=Ie(t.font),n=xe(t.padding);return t.display?e.lineHeight+n.height:0}_getLegendItemAt(t,e){let n,i,r;if(tt(t,this.left,this.right)&&tt(e,this.top,this.bottom))for(r=this.legendHitBoxes,n=0;n<r.length;++n)if(i=r[n],tt(t,i.left,i.left+i.width)&&tt(e,i.top,i.top+i.height))return this.legendItems[n];return null}handleEvent(t){const e=this.options;if(!function(t,e){return!("mousemove"!==t&&"mouseout"!==t||!e.onHover&&!e.onLeave)||!(!e.onClick||"click"!==t&&"mouseup"!==t)}(t.type,e))return;const n=this._getLegendItemAt(t.x,t.y);if("mousemove"===t.type||"mouseout"===t.type){const s=this._hoveredItem,o=(r=n,null!==(i=s)&&null!==r&&i.datasetIndex===r.datasetIndex&&i.index===r.index);s&&!o&&m(e.onLeave,[t,s,this],this),this._hoveredItem=n,n&&!o&&m(e.onHover,[t,n,this],this)}else n&&m(e.onClick,[t,n,this],this);var i,r}}var us={id:"legend",_element:ls,start(t,e,n){const i=t.legend=new ls({ctx:t.ctx,options:n,chart:t});Oi.configure(t,i,n),Oi.addBox(t,i)},stop(t){Oi.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,n){const i=t.legend;Oi.configure(t,i,n),i.options=n},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,n){const i=e.datasetIndex,r=n.chart;r.isDatasetVisible(i)?(r.hide(i),e.hidden=!0):(r.show(i),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:n,pointStyle:i,textAlign:r,color:s}}=t.legend.options;return t._getSortedDatasetMetas().map((t=>{const o=t.controller.getStyle(n?0:void 0),a=xe(o.borderWidth);return{text:e[t.index].label,fillStyle:o.backgroundColor,fontColor:s,hidden:!t.visible,lineCap:o.borderCapStyle,lineDash:o.borderDash,lineDashOffset:o.borderDashOffset,lineJoin:o.borderJoinStyle,lineWidth:(a.width+a.height)/4,strokeStyle:o.borderColor,pointStyle:i||o.pointStyle,rotation:o.rotation,textAlign:r||o.textAlign,borderRadius:0,datasetIndex:t.index}}),this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class hs extends Xn{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const n=this.options;if(this.left=0,this.top=0,!n.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=t,this.height=this.bottom=e;const i=u(n.text)?n.text.length:1;this._padding=xe(n.padding);const r=i*Ie(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const t=this.options.position;return"top"===t||"bottom"===t}_drawArgs(t){const{top:e,left:n,bottom:i,right:r,options:s}=this,o=s.align;let a,c,l,u=0;return this.isHorizontal()?(c=ut(o,n,r),l=e+t,a=r-n):("left"===s.position?(c=n+t,l=ut(o,i,e),u=-.5*M):(c=r-t,l=ut(o,e,i),u=.5*M),a=i-e),{titleX:c,titleY:l,maxWidth:a,rotation:u}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const n=Ie(e.font),i=n.lineHeight/2+this._padding.top,{titleX:r,titleY:s,maxWidth:o,rotation:a}=this._drawArgs(i);fe(t,e.text,0,0,n,{color:e.color,maxWidth:o,rotation:a,textAlign:lt(e.align),textBaseline:"middle",translation:[r,s]})}}var ds={id:"title",_element:hs,start(t,e,n){!function(t,e){const n=new hs({ctx:t.ctx,options:e,chart:t});Oi.configure(t,n,e),Oi.addBox(t,n),t.titleBlock=n}(t,n)},stop(t){const e=t.titleBlock;Oi.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,n){const i=t.titleBlock;Oi.configure(t,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const fs=new WeakMap;var ps={id:"subtitle",start(t,e,n){const i=new hs({ctx:t.ctx,options:n,chart:t});Oi.configure(t,i,n),Oi.addBox(t,i),fs.set(t,i)},stop(t){Oi.removeBox(t,fs.get(t)),fs.delete(t)},beforeUpdate(t,e,n){const i=fs.get(t);Oi.configure(t,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const gs={average(t){if(!t.length)return!1;let e,n,i=0,r=0,s=0;for(e=0,n=t.length;e<n;++e){const n=t[e].element;if(n&&n.hasValue()){const t=n.tooltipPosition();i+=t.x,r+=t.y,++s}}return{x:i/s,y:r/s}},nearest(t,e){if(!t.length)return!1;let n,i,r,s=e.x,o=e.y,a=Number.POSITIVE_INFINITY;for(n=0,i=t.length;n<i;++n){const i=t[n].element;if(i&&i.hasValue()){const t=Q(e,i.getCenterPoint());t<a&&(a=t,r=i)}}if(r){const t=r.tooltipPosition();s=t.x,o=t.y}return{x:s,y:o}}};function ms(t,e){return e&&(u(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function ys(t){return("string"==typeof t||t instanceof String)&&t.indexOf("\n")>-1?t.split("\n"):t}function vs(t,e){const{element:n,datasetIndex:i,index:r}=e,s=t.getDatasetMeta(i).controller,{label:o,value:a}=s.getLabelAndValue(r);return{chart:t,label:o,parsed:s.getParsed(r),raw:t.data.datasets[i].data[r],formattedValue:a,dataset:s.getDataset(),dataIndex:r,datasetIndex:i,element:n}}function bs(t,e){const n=t.chart.ctx,{body:i,footer:r,title:s}=t,{boxWidth:o,boxHeight:a}=e,c=Ie(e.bodyFont),l=Ie(e.titleFont),u=Ie(e.footerFont),h=s.length,d=r.length,f=i.length,p=xe(e.padding);let g=p.height,m=0,v=i.reduce(((t,e)=>t+e.before.length+e.lines.length+e.after.length),0);v+=t.beforeBody.length+t.afterBody.length,h&&(g+=h*l.lineHeight+(h-1)*e.titleSpacing+e.titleMarginBottom),v&&(g+=f*(e.displayColors?Math.max(a,c.lineHeight):c.lineHeight)+(v-f)*c.lineHeight+(v-1)*e.bodySpacing),d&&(g+=e.footerMarginTop+d*u.lineHeight+(d-1)*e.footerSpacing);let b=0;const w=function(t){m=Math.max(m,n.measureText(t).width+b)};return n.save(),n.font=l.string,y(t.title,w),n.font=c.string,y(t.beforeBody.concat(t.afterBody),w),b=e.displayColors?o+2+e.boxPadding:0,y(i,(t=>{y(t.before,w),y(t.lines,w),y(t.after,w)})),b=0,n.font=u.string,y(t.footer,w),n.restore(),m+=p.width,{width:m,height:g}}function ws(t,e,n,i){const{x:r,width:s}=n,{width:o,chartArea:{left:a,right:c}}=t;let l="center";return"center"===i?l=r<=(a+c)/2?"left":"right":r<=s/2?l="left":r>=o-s/2&&(l="right"),function(t,e,n,i){const{x:r,width:s}=i,o=n.caretSize+n.caretPadding;return"left"===t&&r+s+o>e.width||"right"===t&&r-s-o<0||void 0}(l,t,e,n)&&(l="center"),l}function _s(t,e,n){const i=n.yAlign||e.yAlign||function(t,e){const{y:n,height:i}=e;return n<i/2?"top":n>t.height-i/2?"bottom":"center"}(t,n);return{xAlign:n.xAlign||e.xAlign||ws(t,e,n,i),yAlign:i}}function xs(t,e,n,i){const{caretSize:r,caretPadding:s,cornerRadius:o}=t,{xAlign:a,yAlign:c}=n,l=r+s,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:f}=_e(o);let p=function(t,e){let{x:n,width:i}=t;return"right"===e?n-=i:"center"===e&&(n-=i/2),n}(e,a);const g=function(t,e,n){let{y:i,height:r}=t;return"top"===e?i+=n:i-="bottom"===e?r+n:r/2,i}(e,c,l);return"center"===c?"left"===a?p+=l:"right"===a&&(p-=l):"left"===a?p-=Math.max(u,d)+r:"right"===a&&(p+=Math.max(h,f)+r),{x:Z(p,0,i.width-e.width),y:Z(g,0,i.height-e.height)}}function Is(t,e,n){const i=xe(n.padding);return"center"===e?t.x+t.width/2:"right"===e?t.x+t.width-i.right:t.x+i.left}function Es(t){return ms([],ys(t))}function Ts(t,e){const n=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return n?t.override(n):t}class ks extends Xn{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart||t._chart,this._chart=this.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,n=this.options.setContext(this.getContext()),i=n.enabled&&e.options.animation&&n.animations,r=new In(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=Te(this.chart.getContext(),{tooltip:this,tooltipItems:this._tooltipItems,type:"tooltip"}))}getTitle(t,e){const{callbacks:n}=e,i=n.beforeTitle.apply(this,[t]),r=n.title.apply(this,[t]),s=n.afterTitle.apply(this,[t]);let o=[];return o=ms(o,ys(i)),o=ms(o,ys(r)),o=ms(o,ys(s)),o}getBeforeBody(t,e){return Es(e.callbacks.beforeBody.apply(this,[t]))}getBody(t,e){const{callbacks:n}=e,i=[];return y(t,(t=>{const e={before:[],lines:[],after:[]},r=Ts(n,t);ms(e.before,ys(r.beforeLabel.call(this,t))),ms(e.lines,r.label.call(this,t)),ms(e.after,ys(r.afterLabel.call(this,t))),i.push(e)})),i}getAfterBody(t,e){return Es(e.callbacks.afterBody.apply(this,[t]))}getFooter(t,e){const{callbacks:n}=e,i=n.beforeFooter.apply(this,[t]),r=n.footer.apply(this,[t]),s=n.afterFooter.apply(this,[t]);let o=[];return o=ms(o,ys(i)),o=ms(o,ys(r)),o=ms(o,ys(s)),o}_createItems(t){const e=this._active,n=this.chart.data,i=[],r=[],s=[];let o,a,c=[];for(o=0,a=e.length;o<a;++o)c.push(vs(this.chart,e[o]));return t.filter&&(c=c.filter(((e,i,r)=>t.filter(e,i,r,n)))),t.itemSort&&(c=c.sort(((e,i)=>t.itemSort(e,i,n)))),y(c,(e=>{const n=Ts(t.callbacks,e);i.push(n.labelColor.call(this,e)),r.push(n.labelPointStyle.call(this,e)),s.push(n.labelTextColor.call(this,e))})),this.labelColors=i,this.labelPointStyles=r,this.labelTextColors=s,this.dataPoints=c,c}update(t,e){const n=this.options.setContext(this.getContext()),i=this._active;let r,s=[];if(i.length){const t=gs[n.position].call(this,i,this._eventPosition);s=this._createItems(n),this.title=this.getTitle(s,n),this.beforeBody=this.getBeforeBody(s,n),this.body=this.getBody(s,n),this.afterBody=this.getAfterBody(s,n),this.footer=this.getFooter(s,n);const e=this._size=bs(this,n),o=Object.assign({},t,e),a=_s(this.chart,n,o),c=xs(n,o,a,this.chart);this.xAlign=a.xAlign,this.yAlign=a.yAlign,r={opacity:1,x:c.x,y:c.y,width:e.width,height:e.height,caretX:t.x,caretY:t.y}}else 0!==this.opacity&&(r={opacity:0});this._tooltipItems=s,this.$context=void 0,r&&this._resolveAnimations().update(this,r),t&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,n,i){const r=this.getCaretPosition(t,n,i);e.lineTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineTo(r.x3,r.y3)}getCaretPosition(t,e,n){const{xAlign:i,yAlign:r}=this,{caretSize:s,cornerRadius:o}=n,{topLeft:a,topRight:c,bottomLeft:l,bottomRight:u}=_e(o),{x:h,y:d}=t,{width:f,height:p}=e;let g,m,y,v,b,w;return"center"===r?(b=d+p/2,"left"===i?(g=h,m=g-s,v=b+s,w=b-s):(g=h+f,m=g+s,v=b-s,w=b+s),y=g):(m="left"===i?h+Math.max(a,l)+s:"right"===i?h+f-Math.max(c,u)-s:this.caretX,"top"===r?(v=d,b=v-s,g=m-s,y=m+s):(v=d+p,b=v+s,g=m+s,y=m-s),w=v),{x1:g,x2:m,x3:y,y1:v,y2:b,y3:w}}drawTitle(t,e,n){const i=this.title,r=i.length;let s,o,a;if(r){const c=ln(n.rtl,this.x,this.width);for(t.x=Is(this,n.titleAlign,n),e.textAlign=c.textAlign(n.titleAlign),e.textBaseline="middle",s=Ie(n.titleFont),o=n.titleSpacing,e.fillStyle=n.titleColor,e.font=s.string,a=0;a<r;++a)e.fillText(i[a],c.x(t.x),t.y+s.lineHeight/2),t.y+=s.lineHeight+o,a+1===r&&(t.y+=n.titleMarginBottom-o)}}_drawColorBox(t,e,n,i,r){const s=this.labelColors[n],o=this.labelPointStyles[n],{boxHeight:a,boxWidth:c,boxPadding:l}=r,u=Ie(r.bodyFont),d=Is(this,"left",r),f=i.x(d),p=a<u.lineHeight?(u.lineHeight-a)/2:0,g=e.y+p;if(r.usePointStyle){const e={radius:Math.min(c,a)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},n=i.leftForLtr(f,c)+c/2,l=g+a/2;t.strokeStyle=r.multiKeyBackground,t.fillStyle=r.multiKeyBackground,oe(t,e,n,l),t.strokeStyle=s.borderColor,t.fillStyle=s.backgroundColor,oe(t,e,n,l)}else{t.lineWidth=h(s.borderWidth)?Math.max(...Object.values(s.borderWidth)):s.borderWidth||1,t.strokeStyle=s.borderColor,t.setLineDash(s.borderDash||[]),t.lineDashOffset=s.borderDashOffset||0;const e=i.leftForLtr(f,c-l),n=i.leftForLtr(i.xPlus(f,1),c-l-2),o=_e(s.borderRadius);Object.values(o).some((t=>0!==t))?(t.beginPath(),t.fillStyle=r.multiKeyBackground,ge(t,{x:e,y:g,w:c,h:a,radius:o}),t.fill(),t.stroke(),t.fillStyle=s.backgroundColor,t.beginPath(),ge(t,{x:n,y:g+1,w:c-2,h:a-2,radius:o}),t.fill()):(t.fillStyle=r.multiKeyBackground,t.fillRect(e,g,c,a),t.strokeRect(e,g,c,a),t.fillStyle=s.backgroundColor,t.fillRect(n,g+1,c-2,a-2))}t.fillStyle=this.labelTextColors[n]}drawBody(t,e,n){const{body:i}=this,{bodySpacing:r,bodyAlign:s,displayColors:o,boxHeight:a,boxWidth:c,boxPadding:l}=n,u=Ie(n.bodyFont);let h=u.lineHeight,d=0;const f=ln(n.rtl,this.x,this.width),p=function(n){e.fillText(n,f.x(t.x+d),t.y+h/2),t.y+=h+r},g=f.textAlign(s);let m,v,b,w,_,x,I;for(e.textAlign=s,e.textBaseline="middle",e.font=u.string,t.x=Is(this,g,n),e.fillStyle=n.bodyColor,y(this.beforeBody,p),d=o&&"right"!==g?"center"===s?c/2+l:c+2+l:0,w=0,x=i.length;w<x;++w){for(m=i[w],v=this.labelTextColors[w],e.fillStyle=v,y(m.before,p),b=m.lines,o&&b.length&&(this._drawColorBox(e,t,w,f,n),h=Math.max(u.lineHeight,a)),_=0,I=b.length;_<I;++_)p(b[_]),h=u.lineHeight;y(m.after,p)}d=0,h=u.lineHeight,y(this.afterBody,p),t.y-=r}drawFooter(t,e,n){const i=this.footer,r=i.length;let s,o;if(r){const a=ln(n.rtl,this.x,this.width);for(t.x=Is(this,n.footerAlign,n),t.y+=n.footerMarginTop,e.textAlign=a.textAlign(n.footerAlign),e.textBaseline="middle",s=Ie(n.footerFont),e.fillStyle=n.footerColor,e.font=s.string,o=0;o<r;++o)e.fillText(i[o],a.x(t.x),t.y+s.lineHeight/2),t.y+=s.lineHeight+n.footerSpacing}}drawBackground(t,e,n,i){const{xAlign:r,yAlign:s}=this,{x:o,y:a}=t,{width:c,height:l}=n,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:f}=_e(i.cornerRadius);e.fillStyle=i.backgroundColor,e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.beginPath(),e.moveTo(o+u,a),"top"===s&&this.drawCaret(t,e,n,i),e.lineTo(o+c-h,a),e.quadraticCurveTo(o+c,a,o+c,a+h),"center"===s&&"right"===r&&this.drawCaret(t,e,n,i),e.lineTo(o+c,a+l-f),e.quadraticCurveTo(o+c,a+l,o+c-f,a+l),"bottom"===s&&this.drawCaret(t,e,n,i),e.lineTo(o+d,a+l),e.quadraticCurveTo(o,a+l,o,a+l-d),"center"===s&&"left"===r&&this.drawCaret(t,e,n,i),e.lineTo(o,a+u),e.quadraticCurveTo(o,a,o+u,a),e.closePath(),e.fill(),i.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,n=this.$animations,i=n&&n.x,r=n&&n.y;if(i||r){const n=gs[t.position].call(this,this._active,this._eventPosition);if(!n)return;const s=this._size=bs(this,t),o=Object.assign({},n,this._size),a=_s(e,t,o),c=xs(t,o,a,e);i._to===c.x&&r._to===c.y||(this.xAlign=a.xAlign,this.yAlign=a.yAlign,this.width=s.width,this.height=s.height,this.caretX=n.x,this.caretY=n.y,this._resolveAnimations().update(this,c))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let n=this.opacity;if(!n)return;this._updateAnimationTarget(e);const i={width:this.width,height:this.height},r={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;const s=xe(e.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&o&&(t.save(),t.globalAlpha=n,this.drawBackground(r,t,i,e),un(t,e.textDirection),r.y+=s.top,this.drawTitle(r,t,e),this.drawBody(r,t,e),this.drawFooter(r,t,e),hn(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const n=this._active,i=t.map((({datasetIndex:t,index:e})=>{const n=this.chart.getDatasetMeta(t);if(!n)throw new Error("Cannot find a dataset at index "+t);return{datasetIndex:t,element:n.data[e],index:e}})),r=!v(n,i),s=this._positionChanged(i,e);(r||s)&&(this._active=i,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,n=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,r=this._active||[],s=this._getActiveElements(t,r,e,n),o=this._positionChanged(s,t),a=e||!v(s,r)||o;return a&&(this._active=s,(i.enabled||i.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),a}_getActiveElements(t,e,n,i){const r=this.options;if("mouseout"===t.type)return[];if(!i)return e;const s=this.chart.getElementsAtEventForMode(t,r.mode,r,n);return r.reverse&&s.reverse(),s}_positionChanged(t,e){const{caretX:n,caretY:i,options:r}=this,s=gs[r.position].call(this,t,e);return!1!==s&&(n!==s.x||i!==s.y)}}ks.positioners=gs;var Ss={id:"tooltip",_element:ks,positioners:gs,afterInit(t,e,n){n&&(t.tooltip=new ks({chart:t,options:n}))},beforeUpdate(t,e,n){t.tooltip&&t.tooltip.initialize(n)},reset(t,e,n){t.tooltip&&t.tooltip.initialize(n)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const n={tooltip:e};if(!1===t.notifyPlugins("beforeTooltipDraw",n))return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",n)}},afterEvent(t,e){if(t.tooltip){const n=e.replay;t.tooltip.handleEvent(e.event,n,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:a,title(t){if(t.length>0){const e=t[0],n=e.chart.data.labels,i=n?n.length:0;if(this&&this.options&&"dataset"===this.options.mode)return e.dataset.label||"";if(e.label)return e.label;if(i>0&&e.dataIndex<i)return n[e.dataIndex]}return""},afterTitle:a,beforeBody:a,beforeLabel:a,label(t){if(this&&this.options&&"dataset"===this.options.mode)return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const n=t.formattedValue;return l(n)||(e+=n),e},labelColor(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:a,afterBody:a,beforeFooter:a,footer:a,afterFooter:a}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>"filter"!==t&&"itemSort"!==t&&"external"!==t,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Cs=Object.freeze({__proto__:null,Decimation:Hr,Filler:as,Legend:us,SubTitle:ps,Title:ds,Tooltip:Ss});class As extends ai{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const t=this.getLabels();for(const{index:n,label:i}of e)t[n]===i&&t.splice(n,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(l(t))return null;const n=this.getLabels();return((t,e)=>null===t?null:Z(Math.round(t),0,e))(e=isFinite(e)&&n[e]===t?e:function(t,e,n,i){const r=t.indexOf(e);return-1===r?((t,e,n,i)=>("string"==typeof e?(n=t.push(e)-1,i.unshift({index:n,label:e})):isNaN(e)&&(n=null),n))(t,e,n,i):r!==t.lastIndexOf(e)?n:r}(n,t,p(e,t),this._addedLabels),n.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:n,max:i}=this.getMinMax(!0);"ticks"===this.options.bounds&&(t||(n=0),e||(i=this.getLabels().length-1)),this.min=n,this.max=i}buildTicks(){const t=this.min,e=this.max,n=this.options.offset,i=[];let r=this.getLabels();r=0===t&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let n=t;n<=e;n++)i.push({value:n});return i}getLabelForValue(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return"number"!=typeof t&&(t=this.parse(t)),null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}function Ds(t,e,{horizontal:n,minRotation:i}){const r=H(i),s=(n?Math.sin(r):Math.cos(r))||.001,o=.75*e*(""+t).length;return Math.min(e/s,o)}As.id="category",As.defaults={ticks:{callback:As.prototype.getLabelForValue}};class Ms extends ai{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return l(t)||("number"==typeof t||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:n}=this.getUserBounds();let{min:i,max:r}=this;const s=t=>i=e?i:t,o=t=>r=n?r:t;if(t){const t=U(i),e=U(r);t<0&&e<0?o(0):t>0&&e>0&&s(0)}if(i===r){let e=1;(r>=Number.MAX_SAFE_INTEGER||i<=Number.MIN_SAFE_INTEGER)&&(e=Math.abs(.05*r)),o(r+e),t||s(i-e)}this.min=i,this.max=r}getTickLimit(){const t=this.options.ticks;let e,{maxTicksLimit:n,stepSize:i}=t;return i?(e=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,e>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${e} ticks. Limiting to 1000.`),e=1e3)):(e=this.computeTickLimit(),n=n||11),n&&(e=Math.min(n,e)),e}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let n=this.getTickLimit();n=Math.max(2,n);const i=function(t,e){const n=[],{bounds:i,step:r,min:s,max:o,precision:a,count:c,maxTicks:u,maxDigits:h,includeBounds:d}=t,f=r||1,p=u-1,{min:g,max:m}=e,y=!l(s),v=!l(o),b=!l(c),w=(m-g)/(h+1);let _,x,I,E,T=j((m-g)/p/f)*f;if(T<1e-14&&!y&&!v)return[{value:g},{value:m}];E=Math.ceil(m/T)-Math.floor(g/T),E>p&&(T=j(E*T/p/f)*f),l(a)||(_=Math.pow(10,a),T=Math.ceil(T*_)/_),"ticks"===i?(x=Math.floor(g/T)*T,I=Math.ceil(m/T)*T):(x=g,I=m),y&&v&&r&&function(t,e){const n=Math.round(t);return n-e<=t&&n+e>=t}((o-s)/r,T/1e3)?(E=Math.round(Math.min((o-s)/T,u)),T=(o-s)/E,x=s,I=o):b?(x=y?s:x,I=v?o:I,E=c-1,T=(I-x)/E):(E=(I-x)/T,E=q(E,Math.round(E),T/1e3)?Math.round(E):Math.ceil(E));const k=Math.max(G(T),G(x));_=Math.pow(10,l(a)?k:a),x=Math.round(x*_)/_,I=Math.round(I*_)/_;let S=0;for(y&&(d&&x!==s?(n.push({value:s}),x<s&&S++,q(Math.round((x+S*T)*_)/_,s,Ds(s,w,t))&&S++):x<s&&S++);S<E;++S)n.push({value:Math.round((x+S*T)*_)/_});return v&&d&&I!==o?n.length&&q(n[n.length-1].value,o,Ds(o,w,t))?n[n.length-1].value=o:n.push({value:o}):v&&I!==o||n.push({value:I}),n}({maxTicks:n,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:!1!==e.includeBounds},this._range||this);return"ticks"===t.bounds&&$(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}configure(){const t=this.ticks;let e=this.min,n=this.max;if(super.configure(),this.options.offset&&t.length){const i=(n-e)/Math.max(t.length-1,1)/2;e-=i,n+=i}this._startValue=e,this._endValue=n,this._valueRange=n-e}getLabelForValue(t){return cn(t,this.chart.options.locale,this.options.ticks.format)}}class Os extends Ms{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=d(t)?t:0,this.max=d(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,n=H(this.options.ticks.minRotation),i=(t?Math.sin(n):Math.cos(n))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/i))}getPixelForValue(t){return null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}function Ps(t){return 1===t/Math.pow(10,Math.floor(B(t)))}Os.id="linear",Os.defaults={ticks:{callback:Zn.formatters.numeric}};class Rs extends ai{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const n=Ms.prototype.parse.apply(this,[t,e]);if(0!==n)return d(n)&&n>0?n:null;this._zero=!0}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=d(t)?Math.max(0,t):null,this.max=d(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let n=this.min,i=this.max;const r=e=>n=t?n:e,s=t=>i=e?i:t,o=(t,e)=>Math.pow(10,Math.floor(B(t))+e);n===i&&(n<=0?(r(1),s(10)):(r(o(n,-1)),s(o(i,1)))),n<=0&&r(o(i,-1)),i<=0&&s(o(n,1)),this._zero&&this.min!==this._suggestedMin&&n===o(this.min,0)&&r(o(n,-1)),this.min=n,this.max=i}buildTicks(){const t=this.options,e=function(t,e){const n=Math.floor(B(e.max)),i=Math.ceil(e.max/Math.pow(10,n)),r=[];let s=f(t.min,Math.pow(10,Math.floor(B(e.min)))),o=Math.floor(B(s)),a=Math.floor(s/Math.pow(10,o)),c=o<0?Math.pow(10,Math.abs(o)):1;do{r.push({value:s,major:Ps(s)}),++a,10===a&&(a=1,++o,c=o>=0?1:c),s=Math.round(a*Math.pow(10,o)*c)/c}while(o<n||o===n&&a<i);const l=f(t.max,s);return r.push({value:l,major:Ps(s)}),r}({min:this._userMin,max:this._userMax},this);return"ticks"===t.bounds&&$(e,this,"value"),t.reverse?(e.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),e}getLabelForValue(t){return void 0===t?"0":cn(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=B(t),this._valueRange=B(this.max)-B(t)}getPixelForValue(t){return void 0!==t&&0!==t||(t=this.min),null===t||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(B(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}function Ns(t){const e=t.ticks;if(e.display&&t.display){const t=xe(e.backdropPadding);return p(e.font&&e.font.size,ee.font.size)+t.height}return 0}function Ls(t,e,n,i,r){return t===i||t===r?{start:e-n/2,end:e+n/2}:t<i||t>r?{start:e-n,end:e}:{start:e,end:e+n}}function Fs(t,e,n,i,r){const s=Math.abs(Math.sin(n)),o=Math.abs(Math.cos(n));let a=0,c=0;i.start<e.l?(a=(e.l-i.start)/s,t.l=Math.min(t.l,e.l-a)):i.end>e.r&&(a=(i.end-e.r)/s,t.r=Math.max(t.r,e.r+a)),r.start<e.t?(c=(e.t-r.start)/o,t.t=Math.min(t.t,e.t-c)):r.end>e.b&&(c=(r.end-e.b)/o,t.b=Math.max(t.b,e.b+c))}function Vs(t){return 0===t||180===t?"center":t<180?"left":"right"}function Bs(t,e,n){return 90===n||270===n?t-=e/2:(n>270||n<90)&&(t-=e),t}function Us(t,e,n,i){const{ctx:r}=t;if(n)r.arc(t.xCenter,t.yCenter,e,0,O);else{let n=t.getPointPosition(0,e);r.moveTo(n.x,n.y);for(let s=1;s<i;s++)n=t.getPointPosition(s,e),r.lineTo(n.x,n.y)}}Rs.id="logarithmic",Rs.defaults={ticks:{callback:Zn.formatters.logarithmic,major:{enabled:!0}}};class js extends Ms{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=xe(Ns(this.options)/2),e=this.width=this.maxWidth-t.width,n=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+n/2+t.top),this.drawingArea=Math.floor(Math.min(e,n)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=d(t)&&!isNaN(t)?t:0,this.max=d(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Ns(this.options))}generateTickLabels(t){Ms.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map(((t,e)=>{const n=m(this.options.pointLabels.callback,[t,e],this);return n||0===n?n:""})).filter(((t,e)=>this.chart.getDataVisibility(e)))}fit(){const t=this.options;t.display&&t.pointLabels.display?function(t){const e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},n=Object.assign({},e),i=[],r=[],s=t._pointLabels.length,o=t.options.pointLabels,a=o.centerPointLabels?M/s:0;for(let d=0;d<s;d++){const s=o.setContext(t.getPointLabelContext(d));r[d]=s.padding;const f=t.getPointPosition(d,t.drawingArea+r[d],a),p=Ie(s.font),g=(c=t.ctx,l=p,h=u(h=t._pointLabels[d])?h:[h],{w:ie(c,l.string,h),h:h.length*l.lineHeight});i[d]=g;const m=X(t.getIndexAngle(d)+a),y=Math.round(K(m));Fs(n,e,m,Ls(y,f.x,g.w,0,180),Ls(y,f.y,g.h,90,270))}var c,l,h;t.setCenterPoint(e.l-n.l,n.r-e.r,e.t-n.t,n.b-e.b),t._pointLabelItems=function(t,e,n){const i=[],r=t._pointLabels.length,s=t.options,o=Ns(s)/2,a=t.drawingArea,c=s.pointLabels.centerPointLabels?M/r:0;for(let s=0;s<r;s++){const r=t.getPointPosition(s,a+o+n[s],c),d=Math.round(K(X(r.angle+L))),f=e[s],p=Bs(r.y,f.h,d),g=Vs(d),m=(l=r.x,u=f.w,"right"===(h=g)?l-=u:"center"===h&&(l-=u/2),l);i.push({x:r.x,y:p,textAlign:g,left:m,top:p,right:m+f.w,bottom:p+f.h})}var l,u,h;return i}(t,i,r)}(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,n,i){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((n-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,n,i))}getIndexAngle(t){return X(t*(O/(this._pointLabels.length||1))+H(this.options.startAngle||0))}getDistanceFromCenterForValue(t){if(l(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(l(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const n=e[t];return function(t,e,n){return Te(t,{label:n,index:e,type:"pointLabel"})}(this.getContext(),t,n)}}getPointPosition(t,e,n=0){const i=this.getIndexAngle(t)-L+n;return{x:Math.cos(i)*e+this.xCenter,y:Math.sin(i)*e+this.yCenter,angle:i}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:n,right:i,bottom:r}=this._pointLabelItems[t];return{left:e,top:n,right:i,bottom:r}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const n=this.ctx;n.save(),n.beginPath(),Us(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),n.closePath(),n.fillStyle=t,n.fill(),n.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:n,grid:i}=e,r=this._pointLabels.length;let s,o,a;if(e.pointLabels.display&&function(t,e){const{ctx:n,options:{pointLabels:i}}=t;for(let r=e-1;r>=0;r--){const e=i.setContext(t.getPointLabelContext(r)),s=Ie(e.font),{x:o,y:a,textAlign:c,left:u,top:h,right:d,bottom:f}=t._pointLabelItems[r],{backdropColor:p}=e;if(!l(p)){const t=_e(e.borderRadius),i=xe(e.backdropPadding);n.fillStyle=p;const r=u-i.left,s=h-i.top,o=d-u+i.width,a=f-h+i.height;Object.values(t).some((t=>0!==t))?(n.beginPath(),ge(n,{x:r,y:s,w:o,h:a,radius:t}),n.fill()):n.fillRect(r,s,o,a)}fe(n,t._pointLabels[r],o,a+s.lineHeight/2,s,{color:e.color,textAlign:c,textBaseline:"middle"})}}(this,r),i.display&&this.ticks.forEach(((t,e)=>{0!==e&&(o=this.getDistanceFromCenterForValue(t.value),function(t,e,n,i){const r=t.ctx,s=e.circular,{color:o,lineWidth:a}=e;!s&&!i||!o||!a||n<0||(r.save(),r.strokeStyle=o,r.lineWidth=a,r.setLineDash(e.borderDash),r.lineDashOffset=e.borderDashOffset,r.beginPath(),Us(t,n,s,i),r.closePath(),r.stroke(),r.restore())}(this,i.setContext(this.getContext(e-1)),o,r))})),n.display){for(t.save(),s=r-1;s>=0;s--){const i=n.setContext(this.getPointLabelContext(s)),{color:r,lineWidth:c}=i;c&&r&&(t.lineWidth=c,t.strokeStyle=r,t.setLineDash(i.borderDash),t.lineDashOffset=i.borderDashOffset,o=this.getDistanceFromCenterForValue(e.ticks.reverse?this.min:this.max),a=this.getPointPosition(s,o),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(a.x,a.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,n=e.ticks;if(!n.display)return;const i=this.getIndexAngle(0);let r,s;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(i),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach(((i,o)=>{if(0===o&&!e.reverse)return;const a=n.setContext(this.getContext(o)),c=Ie(a.font);if(r=this.getDistanceFromCenterForValue(this.ticks[o].value),a.showLabelBackdrop){t.font=c.string,s=t.measureText(i.label).width,t.fillStyle=a.backdropColor;const e=xe(a.backdropPadding);t.fillRect(-s/2-e.left,-r-c.size/2-e.top,s+e.width,c.size+e.height)}fe(t,i.label,0,-r,c,{color:a.color})})),t.restore()}drawTitle(){}}js.id="radialLinear",js.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Zn.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:t=>t,padding:5,centerPointLabels:!1}},js.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"},js.descriptors={angleLines:{_fallback:"grid"}};const zs={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},qs=Object.keys(zs);function $s(t,e){return t-e}function Hs(t,e){if(l(e))return null;const n=t._adapter,{parser:i,round:r,isoWeekday:s}=t._parseOpts;let o=e;return"function"==typeof i&&(o=i(o)),d(o)||(o="string"==typeof i?n.parse(o,i):n.parse(o)),null===o?null:(r&&(o="week"!==r||!z(s)&&!0!==s?n.startOf(o,r):n.startOf(o,"isoWeek",s)),+o)}function Ks(t,e,n,i){const r=qs.length;for(let s=qs.indexOf(t);s<r-1;++s){const t=zs[qs[s]],r=t.steps?t.steps:Number.MAX_SAFE_INTEGER;if(t.common&&Math.ceil((n-e)/(r*t.size))<=i)return qs[s]}return qs[r-1]}function Gs(t,e,n){if(n){if(n.length){const{lo:i,hi:r}=et(n,e);t[n[i]>=e?n[i]:n[r]]=!0}}else t[e]=!0}function Ws(t,e,n){const i=[],r={},s=e.length;let o,a;for(o=0;o<s;++o)a=e[o],r[a]=o,i.push({value:a,major:!1});return 0!==s&&n?function(t,e,n,i){const r=t._adapter,s=+r.startOf(e[0].value,i),o=e[e.length-1].value;let a,c;for(a=s;a<=o;a=+r.add(a,1,i))c=n[a],c>=0&&(e[c].major=!0);return e}(t,i,r,n):i}class Qs extends ai{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e){const n=t.time||(t.time={}),i=this._adapter=new pi._date(t.adapters.date);i.init(e),I(n.displayFormats,i.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return void 0===t?null:Hs(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,n=t.time.unit||"day";let{min:i,max:r,minDefined:s,maxDefined:o}=this.getUserBounds();function a(t){s||isNaN(t.min)||(i=Math.min(i,t.min)),o||isNaN(t.max)||(r=Math.max(r,t.max))}s&&o||(a(this._getLabelBounds()),"ticks"===t.bounds&&"labels"===t.ticks.source||a(this.getMinMax(!1))),i=d(i)&&!isNaN(i)?i:+e.startOf(Date.now(),n),r=d(r)&&!isNaN(r)?r:+e.endOf(Date.now(),n)+1,this.min=Math.min(i,r-1),this.max=Math.max(i+1,r)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],n=t[t.length-1]),{min:e,max:n}}buildTicks(){const t=this.options,e=t.time,n=t.ticks,i="labels"===n.source?this.getLabelTimestamps():this._generate();"ticks"===t.bounds&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const r=this.min,s=function(t,e,n){let i=0,r=t.length;for(;i<r&&t[i]<e;)i++;for(;r>i&&t[r-1]>n;)r--;return i>0||r<t.length?t.slice(i,r):t}(i,r,this.max);return this._unit=e.unit||(n.autoSkip?Ks(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):function(t,e,n,i,r){for(let s=qs.length-1;s>=qs.indexOf(n);s--){const n=qs[s];if(zs[n].common&&t._adapter.diff(r,i,n)>=e-1)return n}return qs[n?qs.indexOf(n):0]}(this,s.length,e.minUnit,this.min,this.max)),this._majorUnit=n.major.enabled&&"year"!==this._unit?function(t){for(let e=qs.indexOf(t)+1,n=qs.length;e<n;++e)if(zs[qs[e]].common)return qs[e]}(this._unit):void 0,this.initOffsets(i),t.reverse&&s.reverse(),Ws(this,s,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map((t=>+t.value)))}initOffsets(t){let e,n,i=0,r=0;this.options.offset&&t.length&&(e=this.getDecimalForValue(t[0]),i=1===t.length?1-e:(this.getDecimalForValue(t[1])-e)/2,n=this.getDecimalForValue(t[t.length-1]),r=1===t.length?n:(n-this.getDecimalForValue(t[t.length-2]))/2);const s=t.length<3?.5:.25;i=Z(i,0,s),r=Z(r,0,s),this._offsets={start:i,end:r,factor:1/(i+1+r)}}_generate(){const t=this._adapter,e=this.min,n=this.max,i=this.options,r=i.time,s=r.unit||Ks(r.minUnit,e,n,this._getLabelCapacity(e)),o=p(r.stepSize,1),a="week"===s&&r.isoWeekday,c=z(a)||!0===a,l={};let u,h,d=e;if(c&&(d=+t.startOf(d,"isoWeek",a)),d=+t.startOf(d,c?"day":s),t.diff(n,e,s)>1e5*o)throw new Error(e+" and "+n+" are too far apart with stepSize of "+o+" "+s);const f="data"===i.ticks.source&&this.getDataTimestamps();for(u=d,h=0;u<n;u=+t.add(u,o,s),h++)Gs(l,u,f);return u!==n&&"ticks"!==i.bounds&&1!==h||Gs(l,u,f),Object.keys(l).sort(((t,e)=>t-e)).map((t=>+t))}getLabelForValue(t){const e=this._adapter,n=this.options.time;return n.tooltipFormat?e.format(t,n.tooltipFormat):e.format(t,n.displayFormats.datetime)}_tickFormatFunction(t,e,n,i){const r=this.options,s=r.time.displayFormats,o=this._unit,a=this._majorUnit,c=o&&s[o],l=a&&s[a],u=n[e],h=a&&l&&u&&u.major,d=this._adapter.format(t,i||(h?l:c)),f=r.ticks.callback;return f?m(f,[d,e,n],this):d}generateTickLabels(t){let e,n,i;for(e=0,n=t.length;e<n;++e)i=t[e],i.label=this._tickFormatFunction(i.value,e,t)}getDecimalForValue(t){return null===t?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,n=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+n)*e.factor)}getValueForPixel(t){const e=this._offsets,n=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+n*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,n=this.ctx.measureText(t).width,i=H(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(i),s=Math.sin(i),o=this._resolveTickFontOptions(0).size;return{w:n*r+o*s,h:n*s+o*r}}_getLabelCapacity(t){const e=this.options.time,n=e.displayFormats,i=n[e.unit]||n.millisecond,r=this._tickFormatFunction(t,0,Ws(this,[t],this._majorUnit),i),s=this._getLabelSize(r),o=Math.floor(this.isHorizontal()?this.width/s.w:this.height/s.h)-1;return o>0?o:1}getDataTimestamps(){let t,e,n=this._cache.data||[];if(n.length)return n;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(t=0,e=i.length;t<e;++t)n=n.concat(i[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(n)}getLabelTimestamps(){const t=this._cache.labels||[];let e,n;if(t.length)return t;const i=this.getLabels();for(e=0,n=i.length;e<n;++e)t.push(Hs(this,i[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return ot(t.sort($s))}}function Ys(t,e,n){let i,r,s,o,a=0,c=t.length-1;n?(e>=t[a].pos&&e<=t[c].pos&&({lo:a,hi:c}=nt(t,"pos",e)),({pos:i,time:s}=t[a]),({pos:r,time:o}=t[c])):(e>=t[a].time&&e<=t[c].time&&({lo:a,hi:c}=nt(t,"time",e)),({time:i,pos:s}=t[a]),({time:r,pos:o}=t[c]));const l=r-i;return l?s+(o-s)*(e-i)/l:s}Qs.id="time",Qs.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}};class Xs extends Qs{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=Ys(e,this.min),this._tableRange=Ys(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:n}=this,i=[],r=[];let s,o,a,c,l;for(s=0,o=t.length;s<o;++s)c=t[s],c>=e&&c<=n&&i.push(c);if(i.length<2)return[{time:e,pos:0},{time:n,pos:1}];for(s=0,o=i.length;s<o;++s)l=i[s+1],a=i[s-1],c=i[s],Math.round((l+a)/2)!==c&&r.push({time:c,pos:s/(o-1)});return r}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),n=this.getLabelTimestamps();return t=e.length&&n.length?this.normalize(e.concat(n)):e.length?e:n,t=this._cache.all=t,t}getDecimalForValue(t){return(Ys(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,n=this.getDecimalForPixel(t)/e.factor-e.end;return Ys(this._table,n*this._tableRange+this._minPos,!0)}}Xs.id="timeseries",Xs.defaults=Qs.defaults;const Js=[hi,zr,Cs,Object.freeze({__proto__:null,CategoryScale:As,LinearScale:Os,LogarithmicScale:Rs,RadialLinearScale:js,TimeScale:Qs,TimeSeriesScale:Xs})];br.register(...Js);const Zs=br;n(56);var to=n(118),eo=n(816),no=(0,s.xI)(),io=(0,o.aU)(),ro=null;function so(t){return oo.apply(this,arguments)}function oo(){return(oo=(0,e.A)(r().mark((function t(e){var n,i,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("Chargement des données du tableau de bord pour l'utilisateur:",e),e){t.next=4;break}return console.error("ID utilisateur non valide"),t.abrupt("return");case 4:return t.prev=4,console.log("Initialisation des collections pour le dashboard..."),t.next=8,(0,to.initializeCollections)(e);case 8:return n=(0,o.H9)(io,"users",e),t.next=11,(0,o.x7)(n);case 11:if(!(i=t.sent).exists()){t.next=18;break}s=i.data(),console.log("Données utilisateur trouvées:",s),s.name&&document.querySelectorAll("#userName").forEach((function(t){t.textContent=s.name})),t.next=28;break;case 18:return console.log("Aucune donnée trouvée pour cet utilisateur, création d'un profil par défaut"),t.prev=19,t.next=22,(0,o.BN)(n,{name:"Utilisateur",email:no.currentUser?no.currentUser.email:"utilisateur@exemple.com",createdAt:(0,o.O5)()});case 22:console.log("Profil utilisateur créé avec succès"),t.next=28;break;case 25:t.prev=25,t.t0=t.catch(19),console.error("Erreur lors de la création du profil utilisateur:",t.t0);case 28:return console.log("Chargement des statistiques globales..."),t.next=31,po(e);case 31:return console.log("Chargement de la liste des routeurs..."),t.next=34,ao(e);case 34:return console.log("Chargement de l'activité récente..."),t.next=37,go(e);case 37:t.next=42;break;case 39:t.prev=39,t.t1=t.catch(4),console.error("Erreur lors du chargement des données:",t.t1);case 42:case"end":return t.stop()}}),t,null,[[4,39],[19,25]])})))).apply(this,arguments)}function ao(t){return co.apply(this,arguments)}function co(){return co=(0,e.A)(r().mark((function t(i){var s,a,c,l,u,h,d,f,p,g,m,y,v,b,w,_,x,I,E,T,k;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("Chargement des routeurs pour l'utilisateur:",i),i){t.next=4;break}return console.error("ID utilisateur non valide"),t.abrupt("return");case 4:return(s=document.getElementById("loadingRouters"))&&s.classList.remove("d-none"),(a=document.getElementById("noRouters"))&&a.classList.add("d-none"),(c=document.getElementById("routersIndexError"))&&c.classList.add("d-none"),t.prev=10,t.next=13,Promise.resolve().then(n.bind(n,118));case 13:return l=t.sent,u=l.executeWithIndexErrorHandling,h=l.initializeCollections,t.next=18,h(i);case 18:return d=(0,o.rJ)(io,"routers"),t.next=21,u((0,e.A)(r().mark((function t(){var e;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=(0,o.P)(d,(0,o._M)("userId","==",i),(0,o.My)("name","asc")),t.next=3,(0,o.GG)(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)}))),(function(t){return console.log("Requête avec tri réussie, ".concat(t.size," routeurs trouvés")),t}),function(){var t=(0,e.A)(r().mark((function t(e){var s,a,c;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.warn("Erreur d'index lors de la requête avec tri, utilisation d'une requête simple"),!(s=document.getElementById("routersList"))){t.next=10;break}return(a=document.getElementById("routersIndexError"))||((a=document.createElement("div")).id="routersIndexError",s.parentNode.insertBefore(a,s)),t.next=7,Promise.resolve().then(n.bind(n,118));case 7:(0,t.sent.displayIndexError)("routersIndexError",e);case 10:return c=(0,o.P)(d,(0,o._M)("userId","==",i)),t.next=13,(0,o.GG)(c);case 13:return t.abrupt("return",t.sent);case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),(function(t){throw console.error("Erreur lors de la requête des routeurs:",t),t}));case 21:if(f=t.sent,p=f.size,console.log("".concat(p," routeurs trouvés")),(g=document.getElementById("routersCount"))&&(g.textContent=p),s&&s.classList.add("d-none"),0!==p){t.next=30;break}return a&&(a.classList.remove("d-none"),(m=document.createElement("button")).className="btn btn-primary mt-3",m.textContent="Créer un routeur par défaut",m.onclick=(0,e.A)(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,lo(i);case 2:location.reload();case 3:case"end":return t.stop()}}),t)}))),a.appendChild(m)),t.abrupt("return");case 30:if(y=document.getElementById("routersList")){t.next=34;break}return console.error("Elément routersList non trouvé dans le DOM"),t.abrupt("return");case 34:return y.innerHTML="",(v=document.createElement("table")).className="table table-hover align-middle",(b=document.createElement("thead")).innerHTML="\n            <tr>\n                <th>Nom</th>\n                <th>Statut</th>\n                <th>Codes</th>\n                <th>Clients</th>\n                <th>Ventes</th>\n                <th>Revenus</th>\n                <th>Actions</th>\n            </tr>\n        ",v.appendChild(b),w=document.createElement("tbody"),v.appendChild(w),y.appendChild(v),_=0,x=[],f.forEach((function(t){var n=t.data(),s=t.id;if(n._dummy)console.log("Document factice ignoré:",s);else{console.log("Ajout du routeur à la file de traitement:",n.name,"(ID:",s,")");var o=(0,e.A)(r().mark((function t(){var e,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,h(i,s);case 3:return t.next=5,ho(s);case 5:return e=t.sent,(o=document.createElement("tr")).innerHTML='\n                        <td>\n                            <a href="router-dashboard.html?id='.concat(s,'" class="text-decoration-none">\n                                <strong>').concat(n.name||"Routeur sans nom",'</strong>\n                            </a>\n                            <br>\n                            <small class="text-muted">').concat(n.description||"Aucune description",'</small>\n                        </td>\n                        <td>\n                            <span class="badge bg-').concat("active"===n.status?"success":"danger",'">\n                                ').concat("active"===n.status?"Actif":"Inactif","\n                            </span>\n                        </td>\n                        <td>").concat(e.codesCount||0,"</td>\n                        <td>").concat(e.clientsCount||0,"</td>\n                        <td>").concat(e.salesCount||0,"</td>\n                        <td>").concat((e.revenue||0).toLocaleString(),' FCFA</td>\n                        <td>\n                            <div class="dropdown">\n                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">\n                                    Actions\n                                </button>\n                                <ul class="dropdown-menu dropdown-menu-end">\n                                    <li><a class="dropdown-item" href="router-dashboard.html?id=').concat(s,'"><i class="fas fa-tachometer-alt me-1"></i> Tableau de bord</a></li>\n                                    <li><a class="dropdown-item" href="wifi-codes.html?id=').concat(s,'"><i class="fas fa-key me-1"></i> Codes WiFi</a></li>\n                                    <li><a class="dropdown-item" href="clients.html?id=').concat(s,'"><i class="fas fa-users me-1"></i> Clients</a></li>\n                                    <li><a class="dropdown-item" href="payments.html?id=').concat(s,'"><i class="fas fa-money-bill-wave me-1"></i> Paiements</a></li>\n                                    <li><hr class="dropdown-divider"></li>\n                                    <li><a class="dropdown-item" href="router-settings.html?id=').concat(s,'"><i class="fas fa-cog me-1"></i> Paramètres</a></li>\n                                </ul>\n                            </div>\n                        </td>\n                    '),w.appendChild(o),_++,console.log("Routeur ".concat(s," traité (").concat(_,"/").concat(p,")")),t.abrupt("return",{success:!0,routerId:s});case 14:return t.prev=14,t.t0=t.catch(0),console.error("Erreur lors du chargement des statistiques pour le routeur ".concat(s,":"),t.t0),_++,t.abrupt("return",{success:!1,routerId:s,error:t.t0});case 19:case"end":return t.stop()}}),t,null,[[0,14]])})))();x.push(o)}})),t.prev=46,t.next=49,Promise.all(x);case 49:console.log("Tous les routeurs ont été traités avec succès"),t.next=57;break;case 52:t.prev=52,t.t0=t.catch(46),console.error("Erreur lors du traitement des routeurs:",t.t0),(I=document.getElementById("routersList"))&&(I.innerHTML+='\n                    <div class="alert alert-danger">\n                        <p><strong>Erreur lors du chargement des routeurs:</strong> '.concat(t.t0.message,'</p>\n                        <p class="mb-0">Si l\'erreur mentionne un index manquant, suivez le lien fourni dans la console pour le créer.</p>\n                    </div>\n                    <button class="btn btn-outline-primary" onclick="location.reload();">Actualiser</button>\n                '));case 57:t.next=75;break;case 59:return t.prev=59,t.t1=t.catch(10),console.error("Erreur lors du chargement des routeurs:",t.t1),s&&s.classList.add("d-none"),E=(0,to.handleFirebaseError)(t.t1),(T=document.getElementById("routersList"))&&(E.isIndexError?((k=document.getElementById("routersIndexError"))||((k=document.createElement("div")).id="routersIndexError",T.parentNode.insertBefore(k,T)),(0,to.displayIndexError)("routersIndexError",E),T.innerHTML='\n                    <div class="mt-3">\n                        <button class="btn btn-outline-primary" onclick="location.reload();">Actualiser</button>\n                    </div>\n                '):T.innerHTML='\n                    <div class="alert alert-danger">\n                        <p><strong>Erreur lors du chargement des routeurs:</strong> '.concat(t.t1.message,'</p>\n                        <p class="mb-0">Veuillez réessayer ou contacter le support si le problème persiste.</p>\n                    </div>\n                    <button class="btn btn-outline-primary" onclick="location.reload();">Actualiser</button>\n                ')),t.prev=66,t.next=69,(0,to.checkAndCreateCollection)("routers");case 69:console.log("Collection routers vérifiée/créée avec succès"),t.next=75;break;case 72:t.prev=72,t.t2=t.catch(66),console.error("Erreur lors de la vérification/création de la collection routers:",t.t2);case 75:case"end":return t.stop()}}),t,null,[[10,59],[46,52],[66,72]])}))),co.apply(this,arguments)}function lo(t){return uo.apply(this,arguments)}function uo(){return(uo=(0,e.A)(r().mark((function t(e){var n,i,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Création d'un routeur par défaut pour l'utilisateur:",e),t.prev=1,t.next=4,(0,to.checkAndCreateCollection)("routers");case 4:return n=(0,o.rJ)(io,"routers"),i=(0,o.H9)(n),s={userId:e,name:"Mon Premier Routeur",description:"Routeur créé automatiquement",status:"active",address:"",createdAt:(0,o.O5)(),updatedAt:(0,o.O5)()},t.next=9,(0,o.BN)(i,s);case 9:return console.log("Routeur par défaut créé avec succès, ID:",i.id),t.next=12,(0,to.initializeCollections)(e,i.id);case 12:return t.abrupt("return",i.id);case 15:throw t.prev=15,t.t0=t.catch(1),console.error("Erreur lors de la création du routeur par défaut:",t.t0),t.t0;case 19:case"end":return t.stop()}}),t,null,[[1,15]])})))).apply(this,arguments)}function ho(t){return fo.apply(this,arguments)}function fo(){return(fo=(0,e.A)(r().mark((function t(e){var n,i,s,a,c,l,u,h,d;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Récupération des statistiques pour le routeur ID:",e),n={codesCount:0,availableCodesCount:0,clientsCount:0,salesCount:0,revenue:0},t.prev=2,t.next=5,Promise.all([(0,to.checkAndCreateCollection)("wifiCodes"),(0,to.checkAndCreateCollection)("clients"),(0,to.checkAndCreateCollection)("payments")]);case 5:return t.prev=5,t.next=8,(0,o.GG)((0,o.P)((0,o.rJ)(io,"wifiCodes"),(0,o._M)("routerId","==",e)));case 8:i=t.sent,n.codesCount=i.size,console.log("Nombre total de codes pour le routeur ".concat(e,": ").concat(n.codesCount)),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(5),(0,to.handleFirebaseError)(t.t0),console.error("Erreur lors de la récupération du nombre total de codes:",t.t0.message);case 17:return t.prev=17,t.next=20,(0,o.GG)((0,o.P)((0,o.rJ)(io,"wifiCodes"),(0,o._M)("routerId","==",e),(0,o._M)("status","==","available")));case 20:s=t.sent,n.availableCodesCount=s.size,console.log("Nombre de codes disponibles pour le routeur ".concat(e,": ").concat(n.availableCodesCount)),t.next=29;break;case 25:t.prev=25,t.t1=t.catch(17),(0,to.handleFirebaseError)(t.t1),console.error("Erreur lors de la récupération du nombre de codes disponibles:",t.t1.message);case 29:return t.prev=29,t.next=32,(0,o.GG)((0,o.P)((0,o.rJ)(io,"clients"),(0,o._M)("routerId","==",e)));case 32:a=t.sent,n.clientsCount=a.size,console.log("Nombre de clients pour le routeur ".concat(e,": ").concat(n.clientsCount)),t.next=41;break;case 37:t.prev=37,t.t2=t.catch(29),(0,to.handleFirebaseError)(t.t2),console.error("Erreur lors de la récupération du nombre de clients:",t.t2.message);case 41:return t.prev=41,t.next=44,(0,o.GG)((0,o.P)((0,o.rJ)(io,"payments"),(0,o._M)("routerId","==",e),(0,o._M)("status","==","completed")));case 44:c=t.sent,n.salesCount=c.size,l=0,c.forEach((function(t){var e=t.data();l+=e.amount||0})),n.revenue=l,console.log("Nombre de ventes pour le routeur ".concat(e,": ").concat(n.salesCount,", Revenus: ").concat(n.revenue)),t.next=72;break;case 52:if(t.prev=52,t.t3=t.catch(41),u=(0,to.handleFirebaseError)(t.t3),console.error("Erreur lors de la récupération des ventes et revenus:",t.t3.message),!u.isIndexError){t.next=72;break}return t.prev=57,console.log("Tentative de récupération des paiements sans filtre de statut..."),t.next=61,(0,o.GG)((0,o.P)((0,o.rJ)(io,"payments"),(0,o._M)("routerId","==",e)));case 61:h=t.sent,n.salesCount=h.size,d=0,h.forEach((function(t){var e=t.data();"completed"===e.status&&(d+=e.amount||0)})),n.revenue=d,console.log("Récupération simplifiée - Ventes: ".concat(n.salesCount,", Revenus: ").concat(n.revenue)),t.next=72;break;case 69:t.prev=69,t.t4=t.catch(57),console.error("Erreur lors de la récupération simplifiée des paiements:",t.t4.message);case 72:return console.log("Statistiques récupérées pour le routeur ID:",e,n),t.abrupt("return",n);case 76:return t.prev=76,t.t5=t.catch(2),console.error("Erreur générale lors de la récupération des statistiques:",t.t5.message),t.abrupt("return",n);case 80:case"end":return t.stop()}}),t,null,[[2,76],[5,13],[17,25],[29,37],[41,52],[57,69]])})))).apply(this,arguments)}function po(e){console.log("Chargement des statistiques globales pour l'utilisateur:",e),document.querySelectorAll(".stats-loader").forEach((function(t){t.classList.remove("d-none")})),document.getElementById("codesCount").textContent="...",document.getElementById("clientsCount").textContent="...",document.getElementById("revenueAmount").textContent="...";var n=(0,o.rJ)(io,"routers"),i=(0,o.P)(n,(0,o._M)("userId","==",e));(0,o.GG)(i).then((function(e){if(console.log("Nombre de routeurs trouvés:",e.size),0===e.size)return document.getElementById("codesCount").textContent="0",document.getElementById("clientsCount").textContent="0",document.getElementById("revenueAmount").textContent="0 FCFA",void document.querySelectorAll(".stats-loader").forEach((function(t){t.classList.add("d-none")}));var n=[];e.forEach((function(t){n.push(t.id)})),Promise.all([Promise.all(n.map((function(t){var e=(0,o.rJ)(io,"wifiCodes"),n=(0,o.P)(e,(0,o._M)("routerId","==",t),(0,o._M)("status","==","available"));return(0,o.GG)(n)}))),Promise.all(n.map((function(t){var e=(0,o.rJ)(io,"clients"),n=(0,o.P)(e,(0,o._M)("routerId","==",t));return(0,o.GG)(n)}))),Promise.all(n.map((function(t){var e=(0,o.rJ)(io,"payments"),n=(0,o.P)(e,(0,o._M)("routerId","==",t),(0,o._M)("status","==","completed"));return(0,o.GG)(n)})))]).then((function(e){var n,i,r=(i=3,function(t){if(Array.isArray(t))return t}(n=e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,o,a=[],c=!0,l=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=s.call(n)).done)&&(a.push(i.value),a.length!==e);c=!0);}catch(t){l=!0,r=t}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw r}}return a}}(n,i)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var i={}.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?t(e,n):void 0}}(n,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=r[0],o=r[1],a=r[2],c=0;s.forEach((function(t){c+=t.size}));var l=0;o.forEach((function(t){l+=t.size}));var u=0;a.forEach((function(t){t.forEach((function(t){var e=t.data();u+=e.amount||0}))})),document.getElementById("codesCount").textContent=c,document.getElementById("clientsCount").textContent=l,document.getElementById("revenueAmount").textContent=u.toLocaleString()+" FCFA",document.querySelectorAll(".stats-loader").forEach((function(t){t.classList.add("d-none")})),console.log("Statistiques globales chargées avec succès")})).catch((function(t){console.error("Erreur lors de la récupération des statistiques globales:",t),document.getElementById("codesCount").textContent="0",document.getElementById("clientsCount").textContent="0",document.getElementById("revenueAmount").textContent="0 FCFA",document.querySelectorAll(".stats-loader").forEach((function(t){t.classList.add("d-none")}))}))})).catch((function(t){console.error("Erreur lors de la récupération des routeurs:",t),document.getElementById("codesCount").textContent="0",document.getElementById("clientsCount").textContent="0",document.getElementById("revenueAmount").textContent="0 FCFA",document.querySelectorAll(".stats-loader").forEach((function(t){t.classList.add("d-none")}))}))}function go(t){var e=(0,o.rJ)(io,"payments"),n=(0,o.P)(e,(0,o._M)("userId","==",t),(0,o.My)("createdAt","desc"),(0,o.AB)(5));(0,o.GG)(n).then((function(t){var e=document.getElementById("recentActivity");t.empty?e.innerHTML='\n                    <li class="list-group-item text-center">\n                        <div class="text-muted">Aucune activité récente</div>\n                    </li>\n                ':(e.innerHTML="",t.forEach((function(t){var n=t.data(),i=(n.createdAt?new Date(n.createdAt.toDate()):new Date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),r="completed"===n.status?"text-success":"pending"===n.status?"text-warning":"failed"===n.status?"text-danger":"text-secondary",s=document.createElement("li");s.className="list-group-item",s.innerHTML='\n                    <div class="d-flex justify-content-between align-items-center">\n                        <div>\n                            <strong>'.concat(n.clientName||"Client",'</strong>\n                            <div class="text-muted small">').concat(i,'</div>\n                        </div>\n                        <div>\n                            <span class="badge ').concat(r,'">').concat(n.amount," FCFA</span>\n                        </div>\n                    </div>\n                "),e.appendChild(s)})))})).catch((function(t){console.error("Erreur lors de la récupération de l'activité récente:",t)}))}function mo(t){return yo.apply(this,arguments)}function yo(){return yo=(0,e.A)(r().mark((function t(e){var n,i,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,ro&&ro.destroy(),n=document.getElementById("salesChart")){t.next=6;break}return console.error("Canvas salesChart non trouvé"),t.abrupt("return");case 6:return i=n.getContext("2d"),t.next=9,vo(e);case 9:s=t.sent,ro=new Zs(i,{type:"line",data:s,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:"Ventes des 7 derniers jours"}},scales:{y:{beginAtZero:!0,ticks:{callback:function(t){return t+" FCFA"}}}}}}),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(0),console.error("Erreur lors de l'initialisation du graphique:",t.t0);case 16:case"end":return t.stop()}}),t,null,[[0,13]])}))),yo.apply(this,arguments)}function vo(t){return bo.apply(this,arguments)}function bo(){return bo=(0,e.A)(r().mark((function t(n){var i,s,a,c,l,u,h,d,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(t.prev=0,i=new Date,s=[],a=6;a>=0;a--)(c=new Date(i)).setDate(i.getDate()-a),s.push(c);return t.next=6,Promise.all(s.map(function(){var t=(0,e.A)(r().mark((function t(e){var i,s,a,c,l,u;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(i=new Date(e)).setHours(0,0,0,0),(s=new Date(e)).setHours(23,59,59,999),a=(0,o.rJ)(io,"payments"),c=(0,o.P)(a,(0,o._M)("userId","==",n),(0,o._M)("status","==","completed"),(0,o._M)("createdAt",">=",o.Dc.fromDate(i)),(0,o._M)("createdAt","<=",o.Dc.fromDate(s))),t.next=8,(0,o.GG)(c);case 8:return l=t.sent,u=0,l.forEach((function(t){var e=t.data();u+=e.amount||0})),t.abrupt("return",u);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 6:return l=t.sent,u=s.map((function(t){return t.toLocaleDateString("fr-FR",{weekday:"short"})})),t.abrupt("return",{labels:u,datasets:[{label:"Ventes (FCFA)",data:l,backgroundColor:"rgba(13, 110, 253, 0.2)",borderColor:"rgba(13, 110, 253, 1)",borderWidth:2,tension:.4}]});case 11:return t.prev=11,t.t0=t.catch(0),console.error("Erreur lors du chargement des données des ventes:",t.t0),t.t0.message&&t.t0.message.includes("index")&&(h=t.t0.message.match(/https:\/\/console\.firebase\.google\.com[^\s"']+/),d=h?h[0]:null,(f=document.getElementById("salesChartError"))&&(f.classList.remove("d-none"),f.innerHTML='\n                    <div class="alert alert-warning">\n                        <p><strong>Erreur d\'index Firebase :</strong> Cette requête nécessite un index composé.</p>\n                        '.concat(d?'<p>Cliquez sur <a href="'.concat(d,'" target="_blank">ce lien</a> pour créer l\'index nécessaire.</p>'):"",'\n                        <p class="mb-0">Après avoir créé l\'index, actualisez la page.</p>\n                    </div>\n                '))),t.abrupt("return",{labels:[],datasets:[{label:"Ventes (FCFA)",data:[],backgroundColor:"rgba(13, 110, 253, 0.2)",borderColor:"rgba(13, 110, 253, 1)",borderWidth:2,tension:.4}]});case 16:case"end":return t.stop()}}),t,null,[[0,11]])}))),bo.apply(this,arguments)}window.dashboardJsInitialized=window.dashboardJsInitialized||!1,document.addEventListener("DOMContentLoaded",(function(){window.dashboardJsInitialized?console.log("dashboard.js déjà initialisé, initialisation ignorée"):(window.dashboardJsInitialized=!0,console.log("Initialisation de dashboard.js"),(0,s.hg)(no,function(){var t=(0,e.A)(r().mark((function t(e){var n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=19;break}return console.log("Utilisateur connecté:",e.displayName),document.querySelectorAll("#userName").forEach((function(t){t.textContent=e.displayName||e.email})),t.prev=4,t.next=7,(0,eo.checkAndShowLicenseModal)();case 7:return t.sent,t.next=10,so(e.uid);case 10:return t.next=12,mo(e.uid);case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(4),console.error("Erreur lors du chargement des données:",t.t0);case 17:t.next=22;break;case 19:(n=window.location.pathname).includes("index.html")||"/"===n||n.endsWith("/")||(console.log("Utilisateur non connecté, redirection vers index"),window.location.href="index.html");case 22:case"end":return t.stop()}}),t,null,[[4,14]])})));return function(e){return t.apply(this,arguments)}}()),document.querySelectorAll("#logoutBtn, #logoutBtnDropdown").forEach((function(t){t.addEventListener("click",function(){var t=(0,e.A)(r().mark((function t(e){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),t.prev=1,t.next=4,(0,s.CI)(no);case 4:window.location.href="index.html",t.next=11;break;case 7:t.prev=7,t.t0=t.catch(1),console.error("Erreur lors de la déconnexion:",t.t0),alert("Erreur lors de la déconnexion. Veuillez réessayer.");case 11:case"end":return t.stop()}}),t,null,[[1,7]])})));return function(e){return t.apply(this,arguments)}}())})))}))})()})();