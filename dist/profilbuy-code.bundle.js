/*! For license information please see profilbuy-code.bundle.js.LICENSE.txt */
(()=>{var e={606:e=>{var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var a,c=[],u=!1,l=-1;function h(){u&&a&&(u=!1,a.length?c=a.concat(c):l=-1,c.length&&d())}function d(){if(!u){var e=o(h);u=!0;for(var t=c.length;t;){for(a=c,c=[];++l<t;)a&&a[l].run();l=-1,t=c.length}a=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||u||o(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},633:(e,t,n)=>{var r=n(738).default;function i(){"use strict";e.exports=i=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},s=Object.prototype,o=s.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function h(e,t,n,r){return Object.defineProperty(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r})}try{h({},"")}catch(t){h=function(e,t,n){return e[t]=n}}function d(e,n,r,i){var s=n&&n.prototype instanceof m?n:m,o=Object.create(s.prototype);return h(o,"_invoke",function(e,n,r){var i=1;return function(s,o){if(3===i)throw Error("Generator is already running");if(4===i){if("throw"===s)throw o;return{value:t,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=_(a,r);if(c){if(c===p)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(1===i)throw i=4,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=3;var u=f(e,n,r);if("normal"===u.type){if(i=r.done?4:2,u.arg===p)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=4,r.method="throw",r.arg=u.arg)}}}(e,r,new k(i||[])),!0),o}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=d;var p={};function m(){}function g(){}function y(){}var v={};h(v,c,(function(){return this}));var w=Object.getPrototypeOf,b=w&&w(w(A([])));b&&b!==s&&o.call(b,c)&&(v=b);var I=y.prototype=m.prototype=Object.create(v);function E(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(i,s,a,c){var u=f(e[i],e,s);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==r(h)&&o.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,c)}),(function(e){n("throw",e,a,c)})):t.resolve(h).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,c)}))}c(u.arg)}var i;h(this,"_invoke",(function(e,r){function s(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(s,s):s()}),!0)}function _(e,n){var r=n.method,i=e.i[r];if(i===t)return n.delegate=null,"throw"===r&&e.i.return&&(n.method="return",n.arg=t,_(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var s=f(i,e.i,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,p;var o=s.arg;return o?o.done?(n[e.r]=o.value,n.next=e.n,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,p):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function S(e){this.tryEntries.push(e)}function C(e){var n=e[4]||{};n.type="normal",n.arg=t,e[4]=n}function k(e){this.tryEntries=[[-1]],e.forEach(S,this),this.reset(!0)}function A(e){if(null!=e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function n(){for(;++i<e.length;)if(o.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}throw new TypeError(r(e)+" is not iterable")}return g.prototype=y,h(I,"constructor",y),h(y,"constructor",g),g.displayName=h(y,l,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,h(e,l,"GeneratorFunction")),e.prototype=Object.create(I),e},n.awrap=function(e){return{__await:e}},E(T.prototype),h(T.prototype,u,(function(){return this})),n.AsyncIterator=T,n.async=function(e,t,r,i,s){void 0===s&&(s=Promise);var o=new T(d(e,t,r,i),s);return n.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},E(I),h(I,l,"Generator"),h(I,c,(function(){return this})),h(I,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}},n.values=A,k.prototype={constructor:k,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(t){o.type="throw",o.arg=e,n.next=t}for(var i=n.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],o=s[4],a=this.prev,c=s[1],u=s[2];if(-1===s[0])return r("end"),!1;if(!c&&!u)throw Error("try statement without catch or finally");if(null!=s[0]&&s[0]<=a){if(a<c)return this.method="next",this.arg=t,r(c),!0;if(a<u)return r(u),!1}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r[0]>-1&&r[0]<=this.prev&&this.prev<r[2]){var i=r;break}}i&&("break"===e||"continue"===e)&&i[0]<=t&&t<=i[2]&&(i=null);var s=i?i[4]:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i[2],p):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n[2]===e)return this.complete(n[4],n[3]),C(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n[0]===e){var r=n[4];if("throw"===r.type){var i=r.arg;C(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={i:A(e),r:n,n:r},"next"===this.method&&(this.arg=t),p}},n}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},738:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},756:(e,t,n)=>{var r=n(633)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t,n,r){return(n=function(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function r(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,s){var o=e.apply(t,n);function a(e){r(o,i,s,a,c,"next",e)}function c(e){r(o,i,s,a,c,"throw",e)}a(void 0)}))}}var s=n(756),o=n.n(s),a=n(606);const c=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},u={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(c(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw new l;const c=i<<2|s>>4;if(r.push(c),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class l extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const h=function(e){return function(e){const t=c(e);return u.encodeByteArray(t,!0)}(e).replace(/\./g,"")},d=function(e){try{return u.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},f=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(void 0===a||void 0===a.env)return;const e=a.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&d(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},p=e=>{var t,n;return null===(n=null===(t=f())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},m=e=>{const t=p(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},g=()=>{var e;return null===(e=f())||void 0===e?void 0:e.config},y=e=>{var t;return null===(t=f())||void 0===t?void 0:t[`_${e}`]};class v{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function w(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[h(JSON.stringify({alg:"none",type:"JWT"})),h(JSON.stringify(s)),""].join(".")}function b(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function I(){var e;const t=null===(e=f())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function E(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function T(){try{return"object"==typeof indexedDB}catch(e){return!1}}function _(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class S extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,S.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,C.prototype.create)}}class C{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(k,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new S(r,o,n)}}const k=/\{\$([^}]+)}/g;function A(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(D(n)&&D(s)){if(!A(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function D(e){return null!==e&&"object"==typeof e}function x(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function N(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function R(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class O{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=P),void 0===r.error&&(r.error=P),void 0===r.complete&&(r.complete=P);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function P(){}function L(e,t=1e3,n=2){const r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+i)}function M(e){return e&&e._delegate?e._delegate:e}class F{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const V="[DEFAULT]";class U{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new v;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:V})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=V){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=V){return this.instances.has(e)}getOptions(e=V){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===V?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=V){return this.component?this.component.multipleInstances?e:V:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class B{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new U(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const j=[];var q;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(q||(q={}));const z={debug:q.DEBUG,verbose:q.VERBOSE,info:q.INFO,warn:q.WARN,error:q.ERROR,silent:q.SILENT},$=q.INFO,K={[q.DEBUG]:"log",[q.VERBOSE]:"log",[q.INFO]:"info",[q.WARN]:"warn",[q.ERROR]:"error"},G=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=K[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class H{constructor(e){this.name=e,this._logLevel=$,this._logHandler=G,this._userLogHandler=null,j.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in q))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?z[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,q.DEBUG,...e),this._logHandler(this,q.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,q.VERBOSE,...e),this._logHandler(this,q.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,q.INFO,...e),this._logHandler(this,q.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,q.WARN,...e),this._logHandler(this,q.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,q.ERROR,...e),this._logHandler(this,q.ERROR,...e)}}let W,Q;const X=new WeakMap,Y=new WeakMap,J=new WeakMap,Z=new WeakMap,ee=new WeakMap;let te={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Y.get(e);if("objectStoreNames"===t)return e.objectStoreNames||J.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return re(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ne(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Q||(Q=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(ie(this),e),re(X.get(this))}:function(...e){return re(t.apply(ie(this),e))}:function(e,...n){const r=t.call(ie(this),e,...n);return J.set(r,e.sort?e.sort():[e]),re(r)}:(e instanceof IDBTransaction&&function(e){if(Y.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));Y.set(e,t)}(e),n=e,(W||(W=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,te):e);var t,n}function re(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(re(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&X.set(t,e)})).catch((()=>{})),ee.set(t,e),t}(e);if(Z.has(e))return Z.get(e);const t=ne(e);return t!==e&&(Z.set(e,t),ee.set(t,e)),t}const ie=e=>ee.get(e),se=["get","getKey","getAll","getAllKeys","count"],oe=["put","add","delete","clear"],ae=new Map;function ce(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(ae.get(t))return ae.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=oe.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!se.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return ae.set(t,s),s}var ue;ue=te,te={...ue,get:(e,t,n)=>ce(e,t)||ue.get(e,t,n),has:(e,t)=>!!ce(e,t)||ue.has(e,t)};class le{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const he="@firebase/app",de="0.9.13",fe=new H("@firebase/app"),pe="@firebase/app-compat",me="@firebase/analytics-compat",ge="@firebase/analytics",ye="@firebase/app-check-compat",ve="@firebase/app-check",we="@firebase/auth",be="@firebase/auth-compat",Ie="@firebase/database",Ee="@firebase/database-compat",Te="@firebase/functions",_e="@firebase/functions-compat",Se="@firebase/installations",Ce="@firebase/installations-compat",ke="@firebase/messaging",Ae="@firebase/messaging-compat",De="@firebase/performance",xe="@firebase/performance-compat",Ne="@firebase/remote-config",Re="@firebase/remote-config-compat",Oe="@firebase/storage",Pe="@firebase/storage-compat",Le="@firebase/firestore",Me="@firebase/firestore-compat",Fe="firebase",Ve="[DEFAULT]",Ue={[he]:"fire-core",[pe]:"fire-core-compat",[ge]:"fire-analytics",[me]:"fire-analytics-compat",[ve]:"fire-app-check",[ye]:"fire-app-check-compat",[we]:"fire-auth",[be]:"fire-auth-compat",[Ie]:"fire-rtdb",[Ee]:"fire-rtdb-compat",[Te]:"fire-fn",[_e]:"fire-fn-compat",[Se]:"fire-iid",[Ce]:"fire-iid-compat",[ke]:"fire-fcm",[Ae]:"fire-fcm-compat",[De]:"fire-perf",[xe]:"fire-perf-compat",[Ne]:"fire-rc",[Re]:"fire-rc-compat",[Oe]:"fire-gcs",[Pe]:"fire-gcs-compat",[Le]:"fire-fst",[Me]:"fire-fst-compat","fire-js":"fire-js",[Fe]:"fire-js-all"},Be=new Map,je=new Map;function qe(e,t){try{e.container.addComponent(t)}catch(n){fe.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function ze(e){const t=e.name;if(je.has(t))return fe.debug(`There were multiple attempts to register component ${t}.`),!1;je.set(t,e);for(const t of Be.values())qe(t,e);return!0}function $e(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const Ke=new C("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Ge{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new F("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ke.create("app-deleted",{appName:this._name})}}const He="9.23.0";function We(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:Ve,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw Ke.create("bad-app-name",{appName:String(i)});if(n||(n=g()),!n)throw Ke.create("no-options");const s=Be.get(i);if(s){if(A(n,s.options)&&A(r,s.config))return s;throw Ke.create("duplicate-app",{appName:i})}const o=new B(i);for(const e of je.values())o.addComponent(e);const a=new Ge(n,r,o);return Be.set(i,a),a}function Qe(e=Ve){const t=Be.get(e);if(!t&&e===Ve&&g())return We();if(!t)throw Ke.create("no-app",{appName:e});return t}function Xe(e,t,n){var r;let i=null!==(r=Ue[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void fe.warn(e.join(" "))}ze(new F(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const Ye="firebase-heartbeat-store";let Je=null;function Ze(){return Je||(Je=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=re(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(re(o.result),e.oldVersion,e.newVersion,re(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Ye)}}).catch((e=>{throw Ke.create("idb-open",{originalErrorMessage:e.message})}))),Je}async function et(e,t){try{const n=(await Ze()).transaction(Ye,"readwrite"),r=n.objectStore(Ye);await r.put(t,tt(e)),await n.done}catch(e){if(e instanceof S)fe.warn(e.message);else{const t=Ke.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});fe.warn(t.message)}}}function tt(e){return`${e.name}!${e.options.appId}`}class nt{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new it(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=rt();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=rt(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),st(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),st(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=h(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function rt(){return(new Date).toISOString().substring(0,10)}class it{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!T()&&_().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=await Ze();return await t.transaction(Ye).objectStore(Ye).get(tt(e))}catch(e){if(e instanceof S)fe.warn(e.message);else{const t=Ke.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});fe.warn(t.message)}}}(this.app);return e||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return et(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return et(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function st(e){return h(JSON.stringify({version:2,heartbeats:e})).length}ze(new F("platform-logger",(e=>new le(e)),"PRIVATE")),ze(new F("heartbeat",(e=>new nt(e)),"PRIVATE")),Xe(he,de,""),Xe(he,de,"esm2017"),Xe("fire-js","");var ot,at="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ct={},ut=ut||{},lt=at||self;function ht(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function dt(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var ft="closure_uid_"+(1e9*Math.random()>>>0),pt=0;function mt(e,t,n){return e.call.apply(e.bind,arguments)}function gt(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function yt(e,t,n){return(yt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?mt:gt).apply(null,arguments)}function vt(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function wt(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function bt(){this.s=this.s,this.o=this.o}bt.prototype.s=!1,bt.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,ft)&&e[ft]||(e[ft]=++pt))},bt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const It=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function Et(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function Tt(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(ht(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function _t(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}_t.prototype.h=function(){this.defaultPrevented=!0};var St=function(){if(!lt.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{lt.addEventListener("test",(()=>{}),t),lt.removeEventListener("test",(()=>{}),t)}catch(e){}return e}();function Ct(e){return/^[\s\xa0]*$/.test(e)}function kt(){var e=lt.navigator;return e&&(e=e.userAgent)?e:""}function At(e){return-1!=kt().indexOf(e)}function Dt(e){return Dt[" "](e),e}Dt[" "]=function(){};var xt,Nt,Rt,Ot=At("Opera"),Pt=At("Trident")||At("MSIE"),Lt=At("Edge"),Mt=Lt||Pt,Ft=At("Gecko")&&!(-1!=kt().toLowerCase().indexOf("webkit")&&!At("Edge"))&&!(At("Trident")||At("MSIE"))&&!At("Edge"),Vt=-1!=kt().toLowerCase().indexOf("webkit")&&!At("Edge");function Ut(){var e=lt.document;return e?e.documentMode:void 0}e:{var Bt="",jt=(Nt=kt(),Ft?/rv:([^\);]+)(\)|;)/.exec(Nt):Lt?/Edge\/([\d\.]+)/.exec(Nt):Pt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Nt):Vt?/WebKit\/(\S+)/.exec(Nt):Ot?/(?:Version)[ \/]?(\S+)/.exec(Nt):void 0);if(jt&&(Bt=jt?jt[1]:""),Pt){var qt=Ut();if(null!=qt&&qt>parseFloat(Bt)){xt=String(qt);break e}}xt=Bt}lt.document&&Pt?Rt=Ut()||parseInt(xt,10)||void 0:Rt=void 0;var zt=Rt;function $t(e,t){if(_t.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Ft){e:{try{Dt(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Kt[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&$t.$.h.call(this)}}wt($t,_t);var Kt={2:"touch",3:"pen",4:"mouse"};$t.prototype.h=function(){$t.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Gt="closure_listenable_"+(1e6*Math.random()|0),Ht=0;function Wt(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++Ht,this.fa=this.ia=!1}function Qt(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function Xt(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function Yt(e){const t={};for(const n in e)t[n]=e[n];return t}const Jt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Zt(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<Jt.length;t++)n=Jt[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function en(e){this.src=e,this.g={},this.h=0}function tn(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=It(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(Qt(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function nn(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==r)return i}return-1}en.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=nn(e,t,r,i);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new Wt(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var rn="closure_lm_"+(1e6*Math.random()|0),sn={};function on(e,t,n,r,i){if(r&&r.once)return cn(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)on(e,t[s],n,r,i);return null}return n=mn(n),e&&e[Gt]?e.O(t,n,dt(r)?!!r.capture:!!r,i):an(e,t,n,!1,r,i)}function an(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=dt(i)?!!i.capture:!!i,a=fn(e);if(a||(e[rn]=a=new en(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){const e=dn;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)St||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(hn(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function cn(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)cn(e,t[s],n,r,i);return null}return n=mn(n),e&&e[Gt]?e.P(t,n,dt(r)?!!r.capture:!!r,i):an(e,t,n,!0,r,i)}function un(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)un(e,t[s],n,r,i);else r=dt(r)?!!r.capture:!!r,n=mn(n),e&&e[Gt]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=nn(s=e.g[t],n,r,i))&&(Qt(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=fn(e))&&(t=e.g[t.toString()],e=-1,t&&(e=nn(t,n,r,i)),(n=-1<e?t[e]:null)&&ln(n))}function ln(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[Gt])tn(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(hn(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=fn(t))?(tn(n,e),0==n.h&&(n.src=null,t[rn]=null)):Qt(e)}}}function hn(e){return e in sn?sn[e]:sn[e]="on"+e}function dn(e,t){if(e.fa)e=!0;else{t=new $t(t,this);var n=e.listener,r=e.la||e.src;e.ia&&ln(e),e=n.call(r,t)}return e}function fn(e){return(e=e[rn])instanceof en?e:null}var pn="__closure_events_fn_"+(1e9*Math.random()>>>0);function mn(e){return"function"==typeof e?e:(e[pn]||(e[pn]=function(t){return e.handleEvent(t)}),e[pn])}function gn(){bt.call(this),this.i=new en(this),this.S=this,this.J=null}function yn(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new _t(t,e);else if(t instanceof _t)t.target=t.target||e;else{var i=t;Zt(t=new _t(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=vn(o,r,!0,t)&&i}if(i=vn(o=t.g=e,r,!0,t)&&i,i=vn(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=vn(o=t.g=n[s],r,!1,t)&&i}function vn(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&tn(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}wt(gn,bt),gn.prototype[Gt]=!0,gn.prototype.removeEventListener=function(e,t,n,r){un(this,e,t,n,r)},gn.prototype.N=function(){if(gn.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Qt(n[r]);delete t.g[e],t.h--}}this.J=null},gn.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},gn.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var wn=lt.JSON.stringify;function bn(){var e=kn;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var In=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new En),(e=>e.reset()));class En{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Tn(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function _n(e){lt.setTimeout((()=>{throw e}),0)}let Sn,Cn=!1,kn=new class{constructor(){this.h=this.g=null}add(e,t){const n=In.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},An=()=>{const e=lt.Promise.resolve(void 0);Sn=()=>{e.then(Dn)}};var Dn=()=>{for(var e;e=bn();){try{e.h.call(e.g)}catch(e){_n(e)}var t=In;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Cn=!1};function xn(e,t){gn.call(this),this.h=e||1,this.g=t||lt,this.j=yt(this.qb,this),this.l=Date.now()}function Nn(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function Rn(e,t,n){if("function"==typeof e)n&&(e=yt(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=yt(e.handleEvent,e)}return 2147483647<Number(t)?-1:lt.setTimeout(e,t||0)}function On(e){e.g=Rn((()=>{e.g=null,e.i&&(e.i=!1,On(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}wt(xn,gn),(ot=xn.prototype).ga=!1,ot.T=null,ot.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),yn(this,"tick"),this.ga&&(Nn(this),this.start()))}},ot.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},ot.N=function(){xn.$.N.call(this),Nn(this),delete this.g};class Pn extends bt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:On(this)}N(){super.N(),this.g&&(lt.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ln(e){bt.call(this),this.h=e,this.g={}}wt(Ln,bt);var Mn=[];function Fn(e,t,n,r){Array.isArray(n)||(n&&(Mn[0]=n.toString()),n=Mn);for(var i=0;i<n.length;i++){var s=on(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Vn(e){Xt(e.g,(function(e,t){this.g.hasOwnProperty(t)&&ln(e)}),e),e.g={}}function Un(){this.g=!0}function Bn(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return wn(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}Ln.prototype.N=function(){Ln.$.N.call(this),Vn(this)},Ln.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Un.prototype.Ea=function(){this.g=!1},Un.prototype.info=function(){};var jn={},qn=null;function zn(){return qn=qn||new gn}function $n(e){_t.call(this,jn.Ta,e)}function Kn(e){const t=zn();yn(t,new $n(t))}function Gn(e,t){_t.call(this,jn.STAT_EVENT,e),this.stat=t}function Hn(e){const t=zn();yn(t,new Gn(t,e))}function Wn(e,t){_t.call(this,jn.Ua,e),this.size=t}function Qn(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return lt.setTimeout((function(){e()}),t)}jn.Ta="serverreachability",wt($n,_t),jn.STAT_EVENT="statevent",wt(Gn,_t),jn.Ua="timingevent",wt(Wn,_t);var Xn={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Yn={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Jn(){}function Zn(e){return e.h||(e.h=e.i())}function er(){}Jn.prototype.h=null;var tr,nr={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function rr(){_t.call(this,"d")}function ir(){_t.call(this,"c")}function sr(){}function or(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new Ln(this),this.P=cr,e=Mt?125:void 0,this.V=new xn(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ar}function ar(){this.i=null,this.g="",this.h=!1}wt(rr,_t),wt(ir,_t),wt(sr,Jn),sr.prototype.g=function(){return new XMLHttpRequest},sr.prototype.i=function(){return{}},tr=new sr;var cr=45e3,ur={},lr={};function hr(e,t,n){e.L=1,e.v=xr(Sr(t)),e.s=n,e.S=!0,dr(e,null)}function dr(e,t){e.G=Date.now(),gr(e),e.A=Sr(e.v);var n=e.A,r=e.W;Array.isArray(r)||(r=[String(r)]),zr(n.i,"t",r),e.C=0,n=e.l.J,e.h=new ar,e.g=zi(e.l,n?t:null,!e.s),0<e.O&&(e.M=new Pn(yt(e.Pa,e,e.g),e.O)),Fn(e.U,e.g,"readystatechange",e.nb),t=e.I?Yt(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),Kn(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.W,e.s)}function fr(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.l.Ha}function pr(e,t,n){let r,i=!0;for(;!e.J&&e.C<n.length;){if(r=mr(e,n),r==lr){4==t&&(e.o=4,Hn(14),i=!1),Bn(e.j,e.m,null,"[Incomplete Response]");break}if(r==ur){e.o=4,Hn(15),Bn(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}Bn(e.j,e.m,r,null),Ir(e,r)}fr(e)&&r!=lr&&r!=ur&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,Hn(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Li(t),t.M=!0,Hn(11))):(Bn(e.j,e.m,n,"[Invalid Chunked Response]"),br(e),wr(e))}function mr(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?lr:(n=Number(t.substring(n,r)),isNaN(n)?ur:(r+=1)+n>t.length?lr:(t=t.slice(r,r+n),e.C=r+n,t))}function gr(e){e.Y=Date.now()+e.P,yr(e,e.P)}function yr(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Qn(yt(e.lb,e),t)}function vr(e){e.B&&(lt.clearTimeout(e.B),e.B=null)}function wr(e){0==e.l.H||e.J||Vi(e.l,e)}function br(e){vr(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,Nn(e.V),Vn(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function Ir(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||Xr(n.i,e)))if(!e.K&&Xr(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;Fi(n),ki(n)}Pi(n),Hn(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=Qn(yt(n.ib,n),6e3));if(1>=Qr(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else Bi(n,11)}else if((e.K||n.g==e)&&Fi(n),!Ct(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Yr(s,s.h),s.h=null))}if(r.F){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,Dr(r.I,r.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((r=n).wa=qi(r,r.J?r.pa:null,r.Y),o.K){Jr(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.B&&(vr(a),gr(a)),r.g=o}else Oi(r);0<n.j.length&&Di(n)}else"stop"!=u[0]&&"close"!=u[0]||Bi(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Bi(n,7):Ci(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}Kn()}catch(e){}}function Er(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(ht(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(ht(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(ht(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(ot=or.prototype).setTimeout=function(e){this.P=e},ot.nb=function(e){e=e.target;const t=this.M;t&&3==bi(e)?t.l():this.Pa(e)},ot.Pa=function(e){try{if(e==this.g)e:{const l=bi(this.g);var t=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||Mt||this.g&&(this.h.h||this.g.ja()||Ii(this.g)))){this.J||4!=l||7==t||Kn(),vr(this);var n=this.g.da();this.ca=n;t:if(fr(this)){var r=Ii(this.g);e="";var i=r.length,s=4==bi(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){br(this),wr(this);var o="";break t}this.h.i=new lt.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ct(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,Hn(12),br(this),wr(this);break e}Bn(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ir(this,n)}this.S?(pr(this,l,o),Mt&&this.i&&3==l&&(Fn(this.U,this.V,"tick",this.mb),this.V.start())):(Bn(this.j,this.m,o,null),Ir(this,o)),4==l&&br(this),this.i&&!this.J&&(4==l?Vi(this.l,this):(this.i=!1,gr(this)))}else(function(e){const t={};e=(e.g&&2<=bi(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(Ct(e[r]))continue;var n=Tn(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Hn(12)):(this.o=0,Hn(13)),br(this),wr(this)}}}catch(e){}},ot.mb=function(){if(this.g){var e=bi(this.g),t=this.g.ja();this.C<t.length&&(vr(this),pr(this,e,t),this.i&&4!=e&&gr(this))}},ot.cancel=function(){this.J=!0,br(this)},ot.lb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.L&&(Kn(),Hn(17)),br(this),this.o=2,wr(this)):yr(this,this.Y-e)};var Tr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function _r(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof _r){this.h=e.h,Cr(this,e.j),this.s=e.s,this.g=e.g,kr(this,e.m),this.l=e.l;var t=e.i,n=new Ur;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Ar(this,n),this.o=e.o}else e&&(t=String(e).match(Tr))?(this.h=!1,Cr(this,t[1]||"",!0),this.s=Nr(t[2]||""),this.g=Nr(t[3]||"",!0),kr(this,t[4]),this.l=Nr(t[5]||"",!0),Ar(this,t[6]||"",!0),this.o=Nr(t[7]||"")):(this.h=!1,this.i=new Ur(null,this.h))}function Sr(e){return new _r(e)}function Cr(e,t,n){e.j=n?Nr(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function kr(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Ar(e,t,n){t instanceof Ur?(e.i=t,function(e,t){t&&!e.j&&(Br(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(jr(this,t),zr(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=Rr(t,Fr)),e.i=new Ur(t,e.h))}function Dr(e,t,n){e.i.set(t,n)}function xr(e){return Dr(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Nr(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Rr(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Or),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Or(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}_r.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Rr(t,Pr,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Rr(t,Pr,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Rr(n,"/"==n.charAt(0)?Mr:Lr,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Rr(n,Vr)),e.join("")};var Pr=/[#\/\?@]/g,Lr=/[#\?:]/g,Mr=/[#\?]/g,Fr=/[#\?@]/g,Vr=/#/g;function Ur(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Br(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function jr(e,t){Br(e),t=$r(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function qr(e,t){return Br(e),t=$r(e,t),e.g.has(t)}function zr(e,t,n){jr(e,t),0<n.length&&(e.i=null,e.g.set($r(e,t),Et(n)),e.h+=n.length)}function $r(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(ot=Ur.prototype).add=function(e,t){Br(this),this.i=null,e=$r(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},ot.forEach=function(e,t){Br(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},ot.ta=function(){Br(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},ot.Z=function(e){Br(this);let t=[];if("string"==typeof e)qr(this,e)&&(t=t.concat(this.g.get($r(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},ot.set=function(e,t){return Br(this),this.i=null,qr(this,e=$r(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},ot.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},ot.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};var Kr=class{constructor(e,t){this.g=e,this.map=t}};function Gr(e){this.l=e||Hr,e=lt.PerformanceNavigationTiming?0<(e=lt.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(lt.g&&lt.g.Ka&&lt.g.Ka()&&lt.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Hr=10;function Wr(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Qr(e){return e.h?1:e.g?e.g.size:0}function Xr(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Yr(e,t){e.g?e.g.add(t):e.h=t}function Jr(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Zr(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return Et(e.i)}Gr.prototype.cancel=function(){if(this.i=Zr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var ei=class{stringify(e){return lt.JSON.stringify(e,void 0)}parse(e){return lt.JSON.parse(e,void 0)}};function ti(){this.g=new ei}function ni(e,t,n){const r=n||"";try{Er(e,(function(e,n){let i=e;dt(e)&&(i=wn(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function ri(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function ii(e){this.l=e.fc||null,this.j=e.ob||!1}function si(e,t){gn.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=oi,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}wt(ii,Jn),ii.prototype.g=function(){return new si(this.l,this.j)},ii.prototype.i=function(e){return function(){return e}}({}),wt(si,gn);var oi=0;function ai(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function ci(e){e.readyState=4,e.l=null,e.j=null,e.A=null,ui(e)}function ui(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(ot=si.prototype).open=function(e,t){if(this.readyState!=oi)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,ui(this)},ot.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||lt).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},ot.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ci(this)),this.readyState=oi},ot.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,ui(this)),this.g&&(this.readyState=3,ui(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==lt.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ai(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},ot.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ci(this):ui(this),3==this.readyState&&ai(this)}},ot.Za=function(e){this.g&&(this.response=this.responseText=e,ci(this))},ot.Ya=function(e){this.g&&(this.response=e,ci(this))},ot.ka=function(){this.g&&ci(this)},ot.setRequestHeader=function(e,t){this.v.append(e,t)},ot.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},ot.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(si.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var li=lt.JSON.parse;function hi(e){gn.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=di,this.L=this.M=!1}wt(hi,gn);var di="",fi=/^https?$/i,pi=["POST","PUT"];function mi(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,gi(e),vi(e)}function gi(e){e.F||(e.F=!0,yn(e,"complete"),yn(e,"error"))}function yi(e){if(e.h&&void 0!==ut&&(!e.C[1]||4!=bi(e)||2!=e.da()))if(e.v&&4==bi(e))Rn(e.La,0,e);else if(yn(e,"readystatechange"),4==bi(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===o){var i=String(e.I).match(Tr)[1]||null;!i&&lt.self&&lt.self.location&&(i=lt.self.location.protocol.slice(0,-1)),r=!fi.test(i?i.toLowerCase():"")}n=r}if(n)yn(e,"complete"),yn(e,"success");else{e.m=6;try{var s=2<bi(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",gi(e)}}finally{vi(e)}}}function vi(e,t){if(e.g){wi(e);const n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||yn(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function wi(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(lt.clearTimeout(e.A),e.A=null)}function bi(e){return e.g?e.g.readyState:0}function Ii(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case di:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Ei(e){let t="";return Xt(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Ti(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Ei(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Dr(e,t,n))}function _i(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Si(e){this.Ga=0,this.j=[],this.l=new Un,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=_i("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=_i("baseRetryDelayMs",5e3,e),this.hb=_i("retryDelaySeedMs",1e4,e),this.eb=_i("forwardChannelMaxRetries",2,e),this.xa=_i("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new Gr(e&&e.concurrentRequestLimit),this.Ja=new ti,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Ci(e){if(Ai(e),3==e.H){var t=e.W++,n=Sr(e.I);if(Dr(n,"SID",e.K),Dr(n,"RID",t),Dr(n,"TYPE","terminate"),Ni(e,n),(t=new or(e,e.l,t)).L=2,t.v=xr(Sr(n)),n=!1,lt.navigator&&lt.navigator.sendBeacon)try{n=lt.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&lt.Image&&((new Image).src=t.v,n=!0),n||(t.g=zi(t.l,null),t.g.ha(t.v)),t.G=Date.now(),gr(t)}ji(e)}function ki(e){e.g&&(Li(e),e.g.cancel(),e.g=null)}function Ai(e){ki(e),e.u&&(lt.clearTimeout(e.u),e.u=null),Fi(e),e.i.cancel(),e.m&&("number"==typeof e.m&&lt.clearTimeout(e.m),e.m=null)}function Di(e){if(!Wr(e.i)&&!e.m){e.m=!0;var t=e.Na;Sn||An(),Cn||(Sn(),Cn=!0),kn.add(t,e),e.C=0}}function xi(e,t){var n;n=t?t.m:e.W++;const r=Sr(e.I);Dr(r,"SID",e.K),Dr(r,"RID",n),Dr(r,"AID",e.V),Ni(e,r),e.o&&e.s&&Ti(r,e.o,e.s),n=new or(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=Ri(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),Yr(e.i,n),hr(n,r,t)}function Ni(e,t){e.na&&Xt(e.na,(function(e,n){Dr(t,n,e)})),e.h&&Er({},(function(e,n){Dr(t,n,e)}))}function Ri(e,t,n){n=Math.min(e.j.length,n);var r=e.h?yt(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{ni(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function Oi(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;Sn||An(),Cn||(Sn(),Cn=!0),kn.add(t,e),e.A=0}}function Pi(e){return!(e.g||e.u||3<=e.A||(e.ba++,e.u=Qn(yt(e.Ma,e),Ui(e,e.A)),e.A++,0))}function Li(e){null!=e.B&&(lt.clearTimeout(e.B),e.B=null)}function Mi(e){e.g=new or(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=Sr(e.wa);Dr(t,"RID","rpc"),Dr(t,"SID",e.K),Dr(t,"AID",e.V),Dr(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&Dr(t,"TO",e.qa),Dr(t,"TYPE","xmlhttp"),Ni(e,t),e.o&&e.s&&Ti(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=xr(Sr(t)),n.s=null,n.S=!0,dr(n,e)}function Fi(e){null!=e.v&&(lt.clearTimeout(e.v),e.v=null)}function Vi(e,t){var n=null;if(e.g==t){Fi(e),Li(e),e.g=null;var r=2}else{if(!Xr(e.i,t))return;n=t.F,Jr(e.i,t),r=1}if(0!=e.H)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.G;var i=e.C;yn(r=zn(),new Wn(r,n)),Di(e)}else Oi(e);else if(3==(i=t.o)||0==i&&0<t.ca||!(1==r&&function(e,t){return!(Qr(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=Qn(yt(e.Na,e,t),Ui(e,e.C)),e.C++,0)))}(e,t)||2==r&&Pi(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:Bi(e,5);break;case 4:Bi(e,10);break;case 3:Bi(e,6);break;default:Bi(e,2)}}function Ui(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function Bi(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=yt(e.pb,e);n||(n=new _r("//www.google.com/images/cleardot.gif"),lt.location&&"http"==lt.location.protocol||Cr(n,"https"),xr(n)),function(e,t){const n=new Un;if(lt.Image){const r=new Image;r.onload=vt(ri,n,r,"TestLoadImage: loaded",!0,t),r.onerror=vt(ri,n,r,"TestLoadImage: error",!1,t),r.onabort=vt(ri,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=vt(ri,n,r,"TestLoadImage: timeout",!1,t),lt.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else Hn(2);e.H=0,e.h&&e.h.za(t),ji(e),Ai(e)}function ji(e){if(e.H=0,e.ma=[],e.h){const t=Zr(e.i);0==t.length&&0==e.j.length||(Tt(e.ma,t),Tt(e.ma,e.j),e.i.i.length=0,Et(e.j),e.j.length=0),e.h.ya()}}function qi(e,t,n){var r=n instanceof _r?Sr(n):new _r(n);if(""!=r.g)t&&(r.g=t+"."+r.g),kr(r,r.m);else{var i=lt.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new _r(null);r&&Cr(s,r),t&&(s.g=t),i&&kr(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&Dr(r,n,t),Dr(r,"VER",e.ra),Ni(e,r),r}function zi(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ha&&!e.va?new hi(new ii({ob:!0})):new hi(e.va)).Oa(e.J),t}function $i(){}function Ki(){if(Pt&&!(10<=Number(zt)))throw Error("Environmental error: no available transport.")}function Gi(e,t){gn.call(this),this.g=new Si(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!Ct(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Ct(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Qi(this)}function Hi(e){rr.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Wi(){ir.call(this),this.status=1}function Qi(e){this.g=e}function Xi(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Yi(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function Ji(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(ot=hi.prototype).Oa=function(e){this.M=e},ot.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():tr.g(),this.C=this.u?Zn(this.u):Zn(tr),this.g.onreadystatechange=yt(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void mi(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=lt.FormData&&e instanceof lt.FormData,!(0<=It(pi,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{wi(this),0<this.B&&((this.L=function(e){return Pt&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=yt(this.ua,this)):this.A=Rn(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){mi(this,e)}},ot.ua=function(){void 0!==ut&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,yn(this,"timeout"),this.abort(8))},ot.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,yn(this,"complete"),yn(this,"abort"),vi(this))},ot.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),vi(this,!0)),hi.$.N.call(this)},ot.La=function(){this.s||(this.G||this.v||this.l?yi(this):this.kb())},ot.kb=function(){yi(this)},ot.isActive=function(){return!!this.g},ot.da=function(){try{return 2<bi(this)?this.g.status:-1}catch(e){return-1}},ot.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},ot.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),li(t)}},ot.Ia=function(){return this.m},ot.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(ot=Si.prototype).ra=8,ot.H=1,ot.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const i=new or(this,this.l,e);let s=this.s;if(this.U&&(s?(s=Yt(s),Zt(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Ri(this,i,t),Dr(n=Sr(this.I),"RID",e),Dr(n,"CVER",22),this.F&&Dr(n,"X-HTTP-Session-Id",this.F),Ni(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Ei(s)))+"&"+t:this.o&&Ti(n,this.o,s)),Yr(this.i,i),this.bb&&Dr(n,"TYPE","init"),this.P?(Dr(n,"$req",t),Dr(n,"SID","null"),i.aa=!0,hr(i,n,null)):hr(i,n,t),this.H=2}}else 3==this.H&&(e?xi(this,e):0==this.j.length||Wr(this.i)||xi(this))},ot.Ma=function(){if(this.u=null,Mi(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=Qn(yt(this.jb,this),e)}},ot.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Hn(10),ki(this),Mi(this))},ot.ib=function(){null!=this.v&&(this.v=null,ki(this),Pi(this),Hn(19))},ot.pb=function(e){e?(this.l.info("Successfully pinged google.com"),Hn(2)):(this.l.info("Failed to ping google.com"),Hn(1))},ot.isActive=function(){return!!this.h&&this.h.isActive(this)},(ot=$i.prototype).Ba=function(){},ot.Aa=function(){},ot.za=function(){},ot.ya=function(){},ot.isActive=function(){return!0},ot.Va=function(){},Ki.prototype.g=function(e,t){return new Gi(e,t)},wt(Gi,gn),Gi.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;Hn(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=qi(e,null,e.Y),Di(e)},Gi.prototype.close=function(){Ci(this.g)},Gi.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=wn(e),e=n);t.j.push(new Kr(t.fb++,e)),3==t.H&&Di(t)},Gi.prototype.N=function(){this.g.h=null,delete this.j,Ci(this.g),delete this.g,Gi.$.N.call(this)},wt(Hi,rr),wt(Wi,ir),wt(Qi,$i),Qi.prototype.Ba=function(){yn(this.g,"a")},Qi.prototype.Aa=function(e){yn(this.g,new Hi(e))},Qi.prototype.za=function(e){yn(this.g,new Wi)},Qi.prototype.ya=function(){yn(this.g,"b")},wt(Xi,(function(){this.blockSize=-1})),Xi.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Xi.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)Yi(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){Yi(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){Yi(this,r),i=0;break}}this.h=i,this.i+=t},Xi.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var Zi={};function es(e){return-128<=e&&128>e?function(e){var t=Zi;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new Ji([0|e],0>e?-1:0)}(e)}(e):new Ji([0|e],0>e?-1:0)}function ts(e){if(isNaN(e)||!isFinite(e))return rs;if(0>e)return cs(ts(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=ns;return new Ji(t,0)}var ns=4294967296,rs=es(0),is=es(1),ss=es(16777216);function os(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function as(e){return-1==e.h}function cs(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new Ji(n,~e.h).add(is)}function us(e,t){return e.add(cs(t))}function ls(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function hs(e,t){this.g=e,this.h=t}function ds(e,t){if(os(t))throw Error("division by zero");if(os(e))return new hs(rs,rs);if(as(e))return t=ds(cs(e),t),new hs(cs(t.g),cs(t.h));if(as(t))return t=ds(e,cs(t)),new hs(cs(t.g),t.h);if(30<e.g.length){if(as(e)||as(t))throw Error("slowDivide_ only works with positive integers.");for(var n=is,r=t;0>=r.X(e);)n=fs(n),r=fs(r);var i=ps(n,1),s=ps(r,1);for(r=ps(r,2),n=ps(n,2);!os(r);){var o=s.add(r);0>=o.X(e)&&(i=i.add(n),s=o),r=ps(r,1),n=ps(n,1)}return t=us(e,i.R(t)),new hs(i,t)}for(i=rs;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=ts(n)).R(t);as(o)||0<o.X(e);)o=(s=ts(n-=r)).R(t);os(s)&&(s=is),i=i.add(s),e=us(e,o)}return new hs(i,e)}function fs(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new Ji(n,e.h)}function ps(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new Ji(i,e.h)}(ot=Ji.prototype).ea=function(){if(as(this))return-cs(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:ns+r)*t,t*=ns}return e},ot.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(os(this))return"0";if(as(this))return"-"+cs(this).toString(e);for(var t=ts(Math.pow(e,6)),n=this,r="";;){var i=ds(n,t).g,s=((0<(n=us(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(os(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},ot.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},ot.X=function(e){return as(e=us(this,e))?-1:os(e)?0:1},ot.abs=function(){return as(this)?cs(this):this},ot.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new Ji(n,-2147483648&n[n.length-1]?-1:0)},ot.R=function(e){if(os(this)||os(e))return rs;if(as(this))return as(e)?cs(this).R(cs(e)):cs(cs(this).R(e));if(as(e))return cs(this.R(cs(e)));if(0>this.X(ss)&&0>e.X(ss))return ts(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=e.D(i)>>>16,c=65535&e.D(i);n[2*r+2*i]+=o*c,ls(n,2*r+2*i),n[2*r+2*i+1]+=s*c,ls(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,ls(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,ls(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new Ji(n,0)},ot.gb=function(e){return ds(this,e).h},ot.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new Ji(n,this.h&e.h)},ot.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new Ji(n,this.h|e.h)},ot.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new Ji(n,this.h^e.h)},Ki.prototype.createWebChannel=Ki.prototype.g,Gi.prototype.send=Gi.prototype.u,Gi.prototype.open=Gi.prototype.m,Gi.prototype.close=Gi.prototype.close,Xn.NO_ERROR=0,Xn.TIMEOUT=8,Xn.HTTP_ERROR=6,Yn.COMPLETE="complete",er.EventType=nr,nr.OPEN="a",nr.CLOSE="b",nr.ERROR="c",nr.MESSAGE="d",gn.prototype.listen=gn.prototype.O,hi.prototype.listenOnce=hi.prototype.P,hi.prototype.getLastError=hi.prototype.Sa,hi.prototype.getLastErrorCode=hi.prototype.Ia,hi.prototype.getStatus=hi.prototype.da,hi.prototype.getResponseJson=hi.prototype.Wa,hi.prototype.getResponseText=hi.prototype.ja,hi.prototype.send=hi.prototype.ha,hi.prototype.setWithCredentials=hi.prototype.Oa,Xi.prototype.digest=Xi.prototype.l,Xi.prototype.reset=Xi.prototype.reset,Xi.prototype.update=Xi.prototype.j,Ji.prototype.add=Ji.prototype.add,Ji.prototype.multiply=Ji.prototype.R,Ji.prototype.modulo=Ji.prototype.gb,Ji.prototype.compare=Ji.prototype.X,Ji.prototype.toNumber=Ji.prototype.ea,Ji.prototype.toString=Ji.prototype.toString,Ji.prototype.getBits=Ji.prototype.D,Ji.fromNumber=ts,Ji.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return cs(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=ts(Math.pow(n,8)),i=rs,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=ts(Math.pow(n,o)),i=i.R(o).add(ts(a))):i=(i=i.R(r)).add(ts(a))}return i};var ms=ct.createWebChannelTransport=function(){return new Ki},gs=ct.getStatEventTarget=function(){return zn()},ys=ct.ErrorCode=Xn,vs=ct.EventType=Yn,ws=ct.Event=jn,bs=ct.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Is=ct.FetchXmlHttpFactory=ii,Es=ct.WebChannel=er,Ts=ct.XhrIo=hi,_s=ct.Md5=Xi,Ss=ct.Integer=Ji,Cs=n(606);const ks="@firebase/firestore";class As{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}As.UNAUTHENTICATED=new As(null),As.GOOGLE_CREDENTIALS=new As("google-credentials-uid"),As.FIRST_PARTY=new As("first-party-uid"),As.MOCK_USER=new As("mock-user");let Ds="9.23.0";const xs=new H("@firebase/firestore");function Ns(){return xs.logLevel}function Rs(e,...t){if(xs.logLevel<=q.DEBUG){const n=t.map(Ls);xs.debug(`Firestore (${Ds}): ${e}`,...n)}}function Os(e,...t){if(xs.logLevel<=q.ERROR){const n=t.map(Ls);xs.error(`Firestore (${Ds}): ${e}`,...n)}}function Ps(e,...t){if(xs.logLevel<=q.WARN){const n=t.map(Ls);xs.warn(`Firestore (${Ds}): ${e}`,...n)}}function Ls(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Ms(e="Unexpected state"){const t=`FIRESTORE (${Ds}) INTERNAL ASSERTION FAILED: `+e;throw Os(t),new Error(t)}function Fs(e,t){e||Ms()}function Vs(e,t){return e}const Us={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Bs extends S{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class js{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class qs{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class zs{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(As.UNAUTHENTICATED)))}shutdown(){}}class $s{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Ks{constructor(e){this.t=e,this.currentUser=As.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new js;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new js,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{Rs("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Rs("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new js)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Rs("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Fs("string"==typeof t.accessToken),new qs(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Fs(null===e||"string"==typeof e),new As(e)}}class Gs{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=As.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class Hs{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Gs(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(As.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ws{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Qs{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){const n=e=>{null!=e.error&&Rs("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.T;return this.T=e.token,Rs("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{Rs("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.I.getImmediate({optional:!0});e?r(e):Rs("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Fs("string"==typeof e.token),this.T=e.token,new Ws(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Xs(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class Ys{static A(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=Xs(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function Js(e,t){return e<t?-1:e>t?1:0}function Zs(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function eo(e){return e+"\0"}class to{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Bs(Us.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Bs(Us.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Bs(Us.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Bs(Us.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return to.fromMillis(Date.now())}static fromDate(e){return to.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new to(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Js(this.nanoseconds,e.nanoseconds):Js(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class no{constructor(e){this.timestamp=e}static fromTimestamp(e){return new no(e)}static min(){return new no(new to(0,0))}static max(){return new no(new to(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ro{constructor(e,t,n){void 0===t?t=0:t>e.length&&Ms(),void 0===n?n=e.length-t:n>e.length-t&&Ms(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ro.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ro?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class io extends ro{construct(e,t,n){return new io(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Bs(Us.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new io(t)}static emptyPath(){return new io([])}}const so=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class oo extends ro{construct(e,t,n){return new oo(e,t,n)}static isValidIdentifier(e){return so.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),oo.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new oo(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Bs(Us.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Bs(Us.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Bs(Us.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new Bs(Us.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new oo(t)}static emptyPath(){return new oo([])}}class ao{constructor(e){this.path=e}static fromPath(e){return new ao(io.fromString(e))}static fromName(e){return new ao(io.fromString(e).popFirst(5))}static empty(){return new ao(io.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===io.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return io.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ao(new io(e.slice()))}}class co{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function uo(e){return e.fields.find((e=>2===e.kind))}function lo(e){return e.fields.filter((e=>2!==e.kind))}co.UNKNOWN_ID=-1;class ho{constructor(e,t){this.fieldPath=e,this.kind=t}}class fo{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new fo(0,mo.min())}}function po(e){return new mo(e.readTime,e.key,-1)}class mo{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new mo(no.min(),ao.empty(),-1)}static max(){return new mo(no.max(),ao.empty(),-1)}}function go(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ao.comparator(e.documentKey,t.documentKey),0!==n?n:Js(e.largestBatchId,t.largestBatchId))}const yo="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class vo{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function wo(e){if(e.code!==Us.FAILED_PRECONDITION||e.message!==yo)throw e;Rs("LocalStore","Unexpectedly lost primary lease")}class bo{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ms(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new bo(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof bo?t:bo.resolve(t)}catch(e){return bo.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):bo.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):bo.reject(t)}static resolve(e){return new bo(((t,n)=>{t(e)}))}static reject(e){return new bo(((t,n)=>{n(e)}))}static waitFor(e){return new bo(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=bo.resolve(!1);for(const n of e)t=t.next((e=>e?bo.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new bo(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new bo(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}class Io{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.v=new js,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{t.error?this.v.reject(new _o(e,t.error)):this.v.resolve()},this.transaction.onerror=t=>{const n=Do(t.target.error);this.v.reject(new _o(e,n))}}static open(e,t,n,r){try{return new Io(t,e.transaction(r,n))}catch(e){throw new _o(t,e)}}get R(){return this.v.promise}abort(e){e&&this.v.reject(e),this.aborted||(Rs("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Co(t)}}class Eo{constructor(e,t,n){this.name=e,this.version=t,this.V=n,12.2===Eo.S(b())&&Os("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Rs("SimpleDb","Removing database:",e),ko(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!T())return!1;if(Eo.C())return!0;const e=b(),t=Eo.S(e),n=0<t&&t<10,r=Eo.N(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static C(){var e;return void 0!==Cs&&"YES"===(null===(e=Cs.env)||void 0===e?void 0:e.k)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static N(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async $(e){return this.db||(Rs("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new _o(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new Bs(Us.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Bs(Us.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new _o(e,r))},r.onupgradeneeded=e=>{Rs("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.V.O(t,r.transaction,e.oldVersion,this.version).next((()=>{Rs("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.F&&(this.db.onversionchange=e=>this.F(e)),this.db}B(e){this.F=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.$(e);const t=Io.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.P(),e))).catch((e=>(t.abort(e),bo.reject(e)))).toPromise();return s.catch((()=>{})),await t.R,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(Rs("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class To{constructor(e){this.L=e,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(e){this.L=e}done(){this.q=!0}G(e){this.U=e}delete(){return ko(this.L.delete())}}class _o extends Bs{constructor(e,t){super(Us.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function So(e){return"IndexedDbTransactionError"===e.name}class Co{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(Rs("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(Rs("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),ko(n)}add(e){return Rs("SimpleDb","ADD",this.store.name,e,e),ko(this.store.add(e))}get(e){return ko(this.store.get(e)).next((t=>(void 0===t&&(t=null),Rs("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return Rs("SimpleDb","DELETE",this.store.name,e),ko(this.store.delete(e))}count(){return Rs("SimpleDb","COUNT",this.store.name),ko(this.store.count())}j(e,t){const n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){const e=this.cursor(n),t=[];return this.W(e,((e,n)=>{t.push(n)})).next((()=>t))}{const e=this.store.getAll(n.range);return new bo(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}}H(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new bo(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}J(e,t){Rs("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Y=!1;const r=this.cursor(n);return this.W(r,((e,t,n)=>n.delete()))}X(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.W(r,t)}Z(e){const t=this.cursor({});return new bo(((n,r)=>{t.onerror=e=>{const t=Do(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}W(e,t){const n=[];return new bo(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new To(i),o=t(i.primaryKey,i.value,s);if(o instanceof bo){const e=o.catch((e=>(s.done(),bo.reject(e))));n.push(e)}s.isDone?r():null===s.K?i.continue():i.continue(s.K)}})).next((()=>bo.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ko(e){return new bo(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=Do(e.target.error);n(t)}}))}let Ao=!1;function Do(e){const t=Eo.S(b());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new Bs("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ao||(Ao=!0,setTimeout((()=>{throw e}),0)),e}}return e}class xo{constructor(e,t){this.asyncQueue=e,this.tt=t,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(e){Rs("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{Rs("IndexBackiller",`Documents written: ${await this.tt.nt()}`)}catch(e){So(e)?Rs("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await wo(e)}await this.et(6e4)}))}}class No{constructor(e,t){this.localStore=e,this.persistence=t}async nt(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.st(t,e)))}st(e,t){const n=new Set;let r=t,i=!0;return bo.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return Rs("IndexBackiller",`Processing collection: ${t}`),this.it(e,t,r).next((e=>{r-=e,n.add(t)}));i=!1})))).next((()=>t-r))}it(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.rt(r,n))).next((n=>(Rs("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}rt(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=po(t);go(r,n)>0&&(n=r)})),new mo(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Ro{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ut&&this.ut(e),e}}function Oo(e){return null==e}function Po(e){return 0===e&&1/e==-1/0}function Lo(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Fo(t)),t=Mo(e.get(n),t);return Fo(t)}function Mo(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Fo(e){return e+""}function Vo(e){const t=e.length;if(Fs(t>=2),2===t)return Fs(""===e.charAt(0)&&""===e.charAt(1)),io.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("",s);switch((t<0||t>n)&&Ms(),e.charAt(t+1)){case"":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:Ms()}s=t+2}return new io(r)}Ro.ct=-1;const Uo=["userId","batchId"];function Bo(e,t){return[e,Lo(t)]}function jo(e,t,n){return[e,Lo(t),n]}const qo={},zo=["prefixPath","collectionGroup","readTime","documentId"],$o=["prefixPath","collectionGroup","documentId"],Ko=["collectionGroup","readTime","prefixPath","documentId"],Go=["canonicalId","targetId"],Ho=["targetId","path"],Wo=["path","targetId"],Qo=["collectionId","parent"],Xo=["indexId","uid"],Yo=["uid","sequenceNumber"],Jo=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Zo=["indexId","uid","orderedDocumentKey"],ea=["userId","collectionPath","documentId"],ta=["userId","collectionPath","largestBatchId"],na=["userId","collectionGroup","largestBatchId"],ra=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ia=[...ra,"documentOverlays"],sa=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],oa=sa,aa=[...oa,"indexConfiguration","indexState","indexEntries"];class ca extends vo{constructor(e,t){super(),this.ht=e,this.currentSequenceNumber=t}}function ua(e,t){const n=Vs(e);return Eo.M(n.ht,t)}function la(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ha(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function da(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class fa{constructor(e,t){this.comparator=e,this.root=t||ma.EMPTY}insert(e,t){return new fa(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ma.BLACK,null,null))}remove(e){return new fa(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ma.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new pa(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new pa(this.root,e,this.comparator,!1)}getReverseIterator(){return new pa(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new pa(this.root,e,this.comparator,!0)}}class pa{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ma{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:ma.RED,this.left=null!=r?r:ma.EMPTY,this.right=null!=i?i:ma.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new ma(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ma.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return ma.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ma.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ma.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ms();if(this.right.isRed())throw Ms();const e=this.left.check();if(e!==this.right.check())throw Ms();return e+(this.isRed()?0:1)}}ma.EMPTY=null,ma.RED=!0,ma.BLACK=!1,ma.EMPTY=new class{constructor(){this.size=0}get key(){throw Ms()}get value(){throw Ms()}get color(){throw Ms()}get left(){throw Ms()}get right(){throw Ms()}copy(e,t,n,r,i){return this}insert(e,t,n){return new ma(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ga{constructor(e){this.comparator=e,this.data=new fa(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ya(this.data.getIterator())}getIteratorFrom(e){return new ya(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof ga))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ga(this.comparator);return t.data=e,t}}class ya{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function va(e){return e.hasNext()?e.getNext():void 0}class wa{constructor(e){this.fields=e,e.sort(oo.comparator)}static empty(){return new wa([])}unionWith(e){let t=new ga(oo.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new wa(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Zs(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class ba extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ia{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new ba("Invalid base64 string: "+e):e}}(e);return new Ia(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Ia(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Js(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ia.EMPTY_BYTE_STRING=new Ia("");const Ea=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ta(e){if(Fs(!!e),"string"==typeof e){let t=0;const n=Ea.exec(e);if(Fs(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:_a(e.seconds),nanos:_a(e.nanos)}}function _a(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Sa(e){return"string"==typeof e?Ia.fromBase64String(e):Ia.fromUint8Array(e)}function Ca(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ka(e){const t=e.mapValue.fields.__previous_value__;return Ca(t)?ka(t):t}function Aa(e){const t=Ta(e.mapValue.fields.__local_write_time__.timestampValue);return new to(t.seconds,t.nanos)}class Da{constructor(e,t,n,r,i,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class xa{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new xa("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof xa&&e.projectId===this.projectId&&e.database===this.database}}const Na={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ra={nullValue:"NULL_VALUE"};function Oa(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ca(e)?4:Ha(e)?9007199254740991:10:Ms()}function Pa(e,t){if(e===t)return!0;const n=Oa(e);if(n!==Oa(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Aa(e).isEqual(Aa(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Ta(e.timestampValue),r=Ta(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Sa(e.bytesValue).isEqual(Sa(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return _a(e.geoPointValue.latitude)===_a(t.geoPointValue.latitude)&&_a(e.geoPointValue.longitude)===_a(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return _a(e.integerValue)===_a(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=_a(e.doubleValue),r=_a(t.doubleValue);return n===r?Po(n)===Po(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Zs(e.arrayValue.values||[],t.arrayValue.values||[],Pa);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(la(n)!==la(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Pa(n[e],r[e])))return!1;return!0}(e,t);default:return Ms()}}function La(e,t){return void 0!==(e.values||[]).find((e=>Pa(e,t)))}function Ma(e,t){if(e===t)return 0;const n=Oa(e),r=Oa(t);if(n!==r)return Js(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Js(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=_a(e.integerValue||e.doubleValue),r=_a(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Fa(e.timestampValue,t.timestampValue);case 4:return Fa(Aa(e),Aa(t));case 5:return Js(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Sa(e),r=Sa(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=Js(n[e],r[e]);if(0!==t)return t}return Js(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Js(_a(e.latitude),_a(t.latitude));return 0!==n?n:Js(_a(e.longitude),_a(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Ma(n[e],r[e]);if(t)return t}return Js(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Na.mapValue&&t===Na.mapValue)return 0;if(e===Na.mapValue)return 1;if(t===Na.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=Js(r[e],s[e]);if(0!==t)return t;const o=Ma(n[r[e]],i[s[e]]);if(0!==o)return o}return Js(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Ms()}}function Fa(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Js(e,t);const n=Ta(e),r=Ta(t),i=Js(n.seconds,r.seconds);return 0!==i?i:Js(n.nanos,r.nanos)}function Va(e){return Ua(e)}function Ua(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Ta(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Sa(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,ao.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Ua(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Ua(e.fields[i])}`;return n+"}"}(e.mapValue):Ms();var t,n}function Ba(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function ja(e){return!!e&&"integerValue"in e}function qa(e){return!!e&&"arrayValue"in e}function za(e){return!!e&&"nullValue"in e}function $a(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Ka(e){return!!e&&"mapValue"in e}function Ga(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return ha(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Ga(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Ga(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Ha(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Wa(e){return"nullValue"in e?Ra:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Ba(xa.empty(),ao.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:Ms()}function Qa(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Ba(xa.empty(),ao.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?Na:Ms()}function Xa(e,t){const n=Ma(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Ya(e,t){const n=Ma(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Ja{constructor(e){this.value=e}static empty(){return new Ja({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ka(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ga(t)}setAll(e){let t=oo.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Ga(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Ka(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Pa(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Ka(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){ha(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Ja(Ga(this.value))}}function Za(e){const t=[];return ha(e.fields,((e,n)=>{const r=new oo([e]);if(Ka(n)){const e=Za(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new wa(t)}class ec{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new ec(e,0,no.min(),no.min(),no.min(),Ja.empty(),0)}static newFoundDocument(e,t,n,r){return new ec(e,1,t,no.min(),n,r,0)}static newNoDocument(e,t){return new ec(e,2,t,no.min(),no.min(),Ja.empty(),0)}static newUnknownDocument(e,t){return new ec(e,3,t,no.min(),no.min(),Ja.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(no.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ja.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ja.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=no.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ec&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ec(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class tc{constructor(e,t){this.position=e,this.inclusive=t}}function nc(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?ao.comparator(ao.fromName(o.referenceValue),n.key):Ma(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function rc(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Pa(e.position[n],t.position[n]))return!1;return!0}class ic{constructor(e,t="asc"){this.field=e,this.dir=t}}function sc(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class oc{}class ac extends oc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new yc(e,t,n):"array-contains"===t?new Ic(e,n):"in"===t?new Ec(e,n):"not-in"===t?new Tc(e,n):"array-contains-any"===t?new _c(e,n):new ac(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new vc(e,n):new wc(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ma(t,this.value)):null!==t&&Oa(this.value)===Oa(t)&&this.matchesComparison(Ma(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Ms()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class cc extends oc{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new cc(e,t)}matches(e){return uc(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft((e=>e.isInequality()));return null!==e?e.field:null}ft(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function uc(e){return"and"===e.op}function lc(e){return"or"===e.op}function hc(e){return dc(e)&&uc(e)}function dc(e){for(const t of e.filters)if(t instanceof cc)return!1;return!0}function fc(e){if(e instanceof ac)return e.field.canonicalString()+e.op.toString()+Va(e.value);if(hc(e))return e.filters.map((e=>fc(e))).join(",");{const t=e.filters.map((e=>fc(e))).join(",");return`${e.op}(${t})`}}function pc(e,t){return e instanceof ac?function(e,t){return t instanceof ac&&e.op===t.op&&e.field.isEqual(t.field)&&Pa(e.value,t.value)}(e,t):e instanceof cc?function(e,t){return t instanceof cc&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&pc(n,t.filters[r])),!0)}(e,t):void Ms()}function mc(e,t){const n=e.filters.concat(t);return cc.create(n,e.op)}function gc(e){return e instanceof ac?function(e){return`${e.field.canonicalString()} ${e.op} ${Va(e.value)}`}(e):e instanceof cc?function(e){return e.op.toString()+" {"+e.getFilters().map(gc).join(" ,")+"}"}(e):"Filter"}class yc extends ac{constructor(e,t,n){super(e,t,n),this.key=ao.fromName(n.referenceValue)}matches(e){const t=ao.comparator(e.key,this.key);return this.matchesComparison(t)}}class vc extends ac{constructor(e,t){super(e,"in",t),this.keys=bc(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class wc extends ac{constructor(e,t){super(e,"not-in",t),this.keys=bc(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function bc(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>ao.fromName(e.referenceValue)))}class Ic extends ac{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return qa(t)&&La(t.arrayValue,this.value)}}class Ec extends ac{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&La(this.value.arrayValue,t)}}class Tc extends ac{constructor(e,t){super(e,"not-in",t)}matches(e){if(La(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!La(this.value.arrayValue,t)}}class _c extends ac{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!qa(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>La(this.value.arrayValue,e)))}}class Sc{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.dt=null}}function Cc(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Sc(e,t,n,r,i,s,o)}function kc(e){const t=Vs(e);if(null===t.dt){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>fc(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Oo(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Va(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Va(e))).join(",")),t.dt=e}return t.dt}function Ac(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!sc(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!pc(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!rc(e.startAt,t.startAt)&&rc(e.endAt,t.endAt)}function Dc(e){return ao.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function xc(e,t){return e.filters.filter((e=>e instanceof ac&&e.field.isEqual(t)))}function Nc(e,t,n){let r=Ra,i=!0;for(const n of xc(e,t)){let e=Ra,t=!0;switch(n.op){case"<":case"<=":e=Wa(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=Ra}Xa({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Xa({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function Rc(e,t,n){let r=Na,i=!0;for(const n of xc(e,t)){let e=Na,t=!0;switch(n.op){case">=":case">":e=Qa(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=Na}Ya({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Ya({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class Oc{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function Pc(e){return new Oc(e)}function Lc(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Mc(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function Fc(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function Vc(e){return null!==e.collectionGroup}function Uc(e){const t=Vs(e);if(null===t.wt){t.wt=[];const e=Fc(t),n=Mc(t);if(null!==e&&null===n)e.isKeyField()||t.wt.push(new ic(e)),t.wt.push(new ic(oo.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.wt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.wt.push(new ic(oo.keyField(),e))}}}return t.wt}function Bc(e){const t=Vs(e);if(!t._t)if("F"===t.limitType)t._t=Cc(t.path,t.collectionGroup,Uc(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of Uc(t)){const t="desc"===n.dir?"asc":"desc";e.push(new ic(n.field,t))}const n=t.endAt?new tc(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new tc(t.startAt.position,t.startAt.inclusive):null;t._t=Cc(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t._t}function jc(e,t){t.getFirstInequalityField(),Fc(e);const n=e.filters.concat([t]);return new Oc(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function qc(e,t,n){return new Oc(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function zc(e,t){return Ac(Bc(e),Bc(t))&&e.limitType===t.limitType}function $c(e){return`${kc(Bc(e))}|lt:${e.limitType}`}function Kc(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>gc(e))).join(", ")}]`),Oo(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Va(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Va(e))).join(",")),`Target(${t})`}(Bc(e))}; limitType=${e.limitType})`}function Gc(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ao.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Uc(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=nc(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Uc(e),t)||e.endAt&&!function(e,t,n){const r=nc(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Uc(e),t))}(e,t)}function Hc(e){return(t,n)=>{let r=!1;for(const i of Uc(e)){const e=Wc(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Wc(e,t,n){const r=e.field.isKeyField()?ao.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Ma(r,i):Ms()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Ms()}}class Qc{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ha(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return da(this.inner)}size(){return this.innerSize}}const Xc=new fa(ao.comparator);function Yc(){return Xc}const Jc=new fa(ao.comparator);function Zc(...e){let t=Jc;for(const n of e)t=t.insert(n.key,n);return t}function eu(e){let t=Jc;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function tu(){return ru()}function nu(){return ru()}function ru(){return new Qc((e=>e.toString()),((e,t)=>e.isEqual(t)))}const iu=new fa(ao.comparator),su=new ga(ao.comparator);function ou(...e){let t=su;for(const n of e)t=t.add(n);return t}const au=new ga(Js);function cu(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Po(t)?"-0":t}}function uu(e){return{integerValue:""+e}}function lu(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!Po(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?uu(t):cu(e,t)}class hu{constructor(){this._=void 0}}function du(e,t,n){return e instanceof mu?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Ca(t)&&(t=ka(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof gu?yu(e,t):e instanceof vu?wu(e,t):function(e,t){const n=pu(e,t),r=Iu(n)+Iu(e.gt);return ja(n)&&ja(e.gt)?uu(r):cu(e.serializer,r)}(e,t)}function fu(e,t,n){return e instanceof gu?yu(e,t):e instanceof vu?wu(e,t):n}function pu(e,t){return e instanceof bu?ja(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class mu extends hu{}class gu extends hu{constructor(e){super(),this.elements=e}}function yu(e,t){const n=Eu(t);for(const t of e.elements)n.some((e=>Pa(e,t)))||n.push(t);return{arrayValue:{values:n}}}class vu extends hu{constructor(e){super(),this.elements=e}}function wu(e,t){let n=Eu(t);for(const t of e.elements)n=n.filter((e=>!Pa(e,t)));return{arrayValue:{values:n}}}class bu extends hu{constructor(e,t){super(),this.serializer=e,this.gt=t}}function Iu(e){return _a(e.integerValue||e.doubleValue)}function Eu(e){return qa(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Tu{constructor(e,t){this.field=e,this.transform=t}}class _u{constructor(e,t){this.version=e,this.transformResults=t}}class Su{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Su}static exists(e){return new Su(void 0,e)}static updateTime(e){return new Su(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Cu(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ku{}function Au(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Vu(e.key,Su.none()):new Ou(e.key,e.data,Su.none());{const n=e.data,r=Ja.empty();let i=new ga(oo.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Pu(e.key,r,new wa(i.toArray()),Su.none())}}function Du(e,t,n){e instanceof Ou?function(e,t,n){const r=e.value.clone(),i=Mu(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Pu?function(e,t,n){if(!Cu(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Mu(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Lu(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function xu(e,t,n,r){return e instanceof Ou?function(e,t,n,r){if(!Cu(e.precondition,t))return n;const i=e.value.clone(),s=Fu(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Pu?function(e,t,n,r){if(!Cu(e.precondition,t))return n;const i=Fu(e.fieldTransforms,r,t),s=t.data;return s.setAll(Lu(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return Cu(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Nu(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=pu(r.transform,e||null);null!=i&&(null===n&&(n=Ja.empty()),n.set(r.field,i))}return n||null}function Ru(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Zs(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof gu&&t instanceof gu||e instanceof vu&&t instanceof vu?Zs(e.elements,t.elements,Pa):e instanceof bu&&t instanceof bu?Pa(e.gt,t.gt):e instanceof mu&&t instanceof mu}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Ou extends ku{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Pu extends ku{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Lu(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Mu(e,t,n){const r=new Map;Fs(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,fu(o,a,n[i]))}return r}function Fu(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,du(e,s,t))}return r}class Vu extends ku{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Uu extends ku{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Bu{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Du(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=xu(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=xu(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=nu();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=Au(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(no.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ou())}isEqual(e){return this.batchId===e.batchId&&Zs(this.mutations,e.mutations,((e,t)=>Ru(e,t)))&&Zs(this.baseMutations,e.baseMutations,((e,t)=>Ru(e,t)))}}class ju{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Fs(e.mutations.length===n.length);let r=iu;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new ju(e,t,n,r)}}class qu{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class zu{constructor(e,t){this.count=e,this.unchangedNames=t}}var $u,Ku;function Gu(e){if(void 0===e)return Os("GRPC error has no .code"),Us.UNKNOWN;switch(e){case $u.OK:return Us.OK;case $u.CANCELLED:return Us.CANCELLED;case $u.UNKNOWN:return Us.UNKNOWN;case $u.DEADLINE_EXCEEDED:return Us.DEADLINE_EXCEEDED;case $u.RESOURCE_EXHAUSTED:return Us.RESOURCE_EXHAUSTED;case $u.INTERNAL:return Us.INTERNAL;case $u.UNAVAILABLE:return Us.UNAVAILABLE;case $u.UNAUTHENTICATED:return Us.UNAUTHENTICATED;case $u.INVALID_ARGUMENT:return Us.INVALID_ARGUMENT;case $u.NOT_FOUND:return Us.NOT_FOUND;case $u.ALREADY_EXISTS:return Us.ALREADY_EXISTS;case $u.PERMISSION_DENIED:return Us.PERMISSION_DENIED;case $u.FAILED_PRECONDITION:return Us.FAILED_PRECONDITION;case $u.ABORTED:return Us.ABORTED;case $u.OUT_OF_RANGE:return Us.OUT_OF_RANGE;case $u.UNIMPLEMENTED:return Us.UNIMPLEMENTED;case $u.DATA_LOSS:return Us.DATA_LOSS;default:return Ms()}}(Ku=$u||($u={}))[Ku.OK=0]="OK",Ku[Ku.CANCELLED=1]="CANCELLED",Ku[Ku.UNKNOWN=2]="UNKNOWN",Ku[Ku.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ku[Ku.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ku[Ku.NOT_FOUND=5]="NOT_FOUND",Ku[Ku.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ku[Ku.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ku[Ku.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ku[Ku.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ku[Ku.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ku[Ku.ABORTED=10]="ABORTED",Ku[Ku.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ku[Ku.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ku[Ku.INTERNAL=13]="INTERNAL",Ku[Ku.UNAVAILABLE=14]="UNAVAILABLE",Ku[Ku.DATA_LOSS=15]="DATA_LOSS";class Hu{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return Wu}static getOrCreateInstance(){return null===Wu&&(Wu=new Hu),Wu}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach((t=>t(e)))}}let Wu=null;const Qu=new Ss([4294967295,4294967295],0);function Xu(e){const t=(new TextEncoder).encode(e),n=new _s;return n.update(t),new Uint8Array(n.digest())}function Yu(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Ss([n,r],0),new Ss([i,s],0)]}class Ju{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Zu(`Invalid padding: ${t}`);if(n<0)throw new Zu(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Zu(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Zu(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=Ss.fromNumber(this.It)}Et(e,t,n){let r=e.add(t.multiply(Ss.fromNumber(n)));return 1===r.compare(Qu)&&(r=new Ss([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Tt).toNumber()}At(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;const t=Xu(e),[n,r]=Yu(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,r,e);if(!this.At(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new Ju(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.It)return;const t=Xu(e),[n,r]=Yu(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,r,e);this.Rt(t)}}Rt(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Zu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class el{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,tl.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new el(no.min(),r,new fa(Js),Yc(),ou())}}class tl{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new tl(n,t,ou(),ou(),ou())}}class nl{constructor(e,t,n,r){this.Pt=e,this.removedTargetIds=t,this.key=n,this.bt=r}}class rl{constructor(e,t){this.targetId=e,this.Vt=t}}class il{constructor(e,t,n=Ia.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class sl{constructor(){this.St=0,this.Dt=cl(),this.Ct=Ia.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=ou(),t=ou(),n=ou();return this.Dt.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Ms()}})),new tl(this.Ct,this.xt,e,t,n)}Ft(){this.Nt=!1,this.Dt=cl()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class ol{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=Yc(),this.zt=al(),this.Wt=new fa(Js)}Ht(e){for(const t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(const t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,(t=>{const n=this.Zt(t);switch(e.state){case 0:this.te(t)&&n.$t(e.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(e.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(t);break;case 3:this.te(t)&&(n.Kt(),n.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),n.$t(e.resumeToken));break;default:Ms()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach(((e,n)=>{this.te(n)&&t(n)}))}ne(e){var t;const n=e.targetId,r=e.Vt.count,i=this.se(n);if(i){const s=i.target;if(Dc(s))if(0===r){const e=new ao(s.path);this.Yt(n,e,ec.newNoDocument(e,no.min()))}else Fs(1===r);else{const i=this.ie(n);if(i!==r){const r=this.re(e,i);if(0!==r){this.ee(n);const e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,e)}null===(t=Hu.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(e,t,n){var r,i,s,o,a,c;const u={localCacheCount:t,existenceFilterCount:n.count},l=n.unchangedNames;return l&&(u.bloomFilter={applied:0===e,hashCount:null!==(r=null==l?void 0:l.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(o=null===(s=null===(i=null==l?void 0:l.bits)||void 0===i?void 0:i.bitmap)||void 0===s?void 0:s.length)&&void 0!==o?o:0,padding:null!==(c=null===(a=null==l?void 0:l.bits)||void 0===a?void 0:a.padding)&&void 0!==c?c:0}),u}(r,i,e.Vt))}}}}re(e,t){const{unchangedNames:n,count:r}=e.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:i="",padding:s=0},hashCount:o=0}=n;let a,c;try{a=Sa(i).toUint8Array()}catch(e){if(e instanceof ba)return Ps("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{c=new Ju(a,s,o)}catch(e){return Ps(e instanceof Zu?"BloomFilter error: ":"Applying bloom filter failed: ",e),1}return 0===c.It?1:r!==t-this.oe(e.targetId,c)?2:0}oe(e,t){const n=this.Gt.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.Gt.ue(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.vt(s)||(this.Yt(e,n,null),r++)})),r}ce(e){const t=new Map;this.Qt.forEach(((n,r)=>{const i=this.se(r);if(i){if(n.current&&Dc(i.target)){const t=new ao(i.target.path);null!==this.jt.get(t)||this.ae(r,t)||this.Yt(r,t,ec.newNoDocument(t,e))}n.Mt&&(t.set(r,n.Ot()),n.Ft())}}));let n=ou();this.zt.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.se(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.jt.forEach(((t,n)=>n.setReadTime(e)));const r=new el(e,t,this.Wt,this.jt,n);return this.jt=Yc(),this.zt=al(),this.Wt=new fa(Js),r}Jt(e,t){if(!this.te(e))return;const n=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,n),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,n){if(!this.te(e))return;const r=this.Zt(e);this.ae(e,t)?r.Bt(t,1):r.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),n&&(this.jt=this.jt.insert(t,n))}removeTarget(e){this.Qt.delete(e)}ie(e){const t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new sl,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new ga(Js),this.zt=this.zt.insert(e,t)),t}te(e){const t=null!==this.se(e);return t||Rs("WatchChangeAggregator","Detected inactive target",e),t}se(e){const t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new sl),this.Gt.getRemoteKeysForTarget(e).forEach((t=>{this.Yt(e,t,null)}))}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function al(){return new fa(ao.comparator)}function cl(){return new fa(ao.comparator)}const ul={asc:"ASCENDING",desc:"DESCENDING"},ll={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},hl={and:"AND",or:"OR"};class dl{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function fl(e,t){return e.useProto3Json||Oo(t)?t:{value:t}}function pl(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ml(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function gl(e,t){return pl(e,t.toTimestamp())}function yl(e){return Fs(!!e),no.fromTimestamp(function(e){const t=Ta(e);return new to(t.seconds,t.nanos)}(e))}function vl(e,t){return function(e){return new io(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function wl(e){const t=io.fromString(e);return Fs(Bl(t)),t}function bl(e,t){return vl(e.databaseId,t.path)}function Il(e,t){const n=wl(t);if(n.get(1)!==e.databaseId.projectId)throw new Bs(Us.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Bs(Us.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ao(Sl(n))}function El(e,t){return vl(e.databaseId,t)}function Tl(e){const t=wl(e);return 4===t.length?io.emptyPath():Sl(t)}function _l(e){return new io(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Sl(e){return Fs(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Cl(e,t,n){return{name:bl(e,t),fields:n.value.mapValue.fields}}function kl(e,t){let n;if(t instanceof Ou)n={update:Cl(e,t.key,t.value)};else if(t instanceof Vu)n={delete:bl(e,t.key)};else if(t instanceof Pu)n={update:Cl(e,t.key,t.data),updateMask:Ul(t.fieldMask)};else{if(!(t instanceof Uu))return Ms();n={verify:bl(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof mu)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof gu)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof vu)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof bu)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw Ms()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:gl(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Ms()}(e,t.precondition)),n}function Al(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Su.updateTime(yl(e.updateTime)):void 0!==e.exists?Su.exists(e.exists):Su.none()}(t.currentDocument):Su.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)Fs("REQUEST_TIME"===t.setToServerValue),n=new mu;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new gu(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new vu(e)}else"increment"in t?n=new bu(e,t.increment):Ms();const r=oo.fromServerFormat(t.fieldPath);return new Tu(r,n)}(e,t))):[];if(t.update){t.update.name;const i=Il(e,t.update.name),s=new Ja({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new wa(t.map((e=>oo.fromServerFormat(e))))}(t.updateMask);return new Pu(i,s,e,n,r)}return new Ou(i,s,n,r)}if(t.delete){const r=Il(e,t.delete);return new Vu(r,n)}if(t.verify){const r=Il(e,t.verify);return new Uu(r,n)}return Ms()}function Dl(e,t){return{documents:[El(e,t.path)]}}function xl(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=El(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=El(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0!==e.length)return Vl(cc.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Ml(e.field),direction:Ol(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=fl(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function Nl(e){let t=Tl(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Fs(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Rl(e);return t instanceof cc&&hc(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new ic(Fl(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Oo(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new tc(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new tc(n,t)}(n.endAt)),function(e,t,n,r,i,s,o,a){return new Oc(e,t,n,r,i,s,o,a)}(t,i,o,s,a,"F",c,u)}function Rl(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Fl(e.unaryFilter.field);return ac.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Fl(e.unaryFilter.field);return ac.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Fl(e.unaryFilter.field);return ac.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Fl(e.unaryFilter.field);return ac.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Ms()}}(e):void 0!==e.fieldFilter?function(e){return ac.create(Fl(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ms()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return cc.create(e.compositeFilter.filters.map((e=>Rl(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Ms()}}(e.compositeFilter.op))}(e):Ms()}function Ol(e){return ul[e]}function Pl(e){return ll[e]}function Ll(e){return hl[e]}function Ml(e){return{fieldPath:e.canonicalString()}}function Fl(e){return oo.fromServerFormat(e.fieldPath)}function Vl(e){return e instanceof ac?function(e){if("=="===e.op){if($a(e.value))return{unaryFilter:{field:Ml(e.field),op:"IS_NAN"}};if(za(e.value))return{unaryFilter:{field:Ml(e.field),op:"IS_NULL"}}}else if("!="===e.op){if($a(e.value))return{unaryFilter:{field:Ml(e.field),op:"IS_NOT_NAN"}};if(za(e.value))return{unaryFilter:{field:Ml(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ml(e.field),op:Pl(e.op),value:e.value}}}(e):e instanceof cc?function(e){const t=e.getFilters().map((e=>Vl(e)));return 1===t.length?t[0]:{compositeFilter:{op:Ll(e.op),filters:t}}}(e):Ms()}function Ul(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Bl(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class jl{constructor(e,t,n,r,i=no.min(),s=no.min(),o=Ia.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new jl(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new jl(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new jl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new jl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ql{constructor(e){this.fe=e}}function zl(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:$l(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:bl(e,t.key),fields:t.data.value.mapValue.fields,updateTime:pl(e,t.version.toTimestamp()),createTime:pl(e,t.createTime.toTimestamp())}}(e.fe,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Kl(t.version)};else{if(!t.isUnknownDocument())return Ms();r.unknownDocument={path:n.path.toArray(),version:Kl(t.version)}}return r}function $l(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Kl(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Gl(e){const t=new to(e.seconds,e.nanoseconds);return no.fromTimestamp(t)}function Hl(e,t){const n=(t.baseMutations||[]).map((t=>Al(e.fe,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>Al(e.fe,t))),i=to.fromMillis(t.localWriteTimeMs);return new Bu(t.batchId,i,n,r)}function Wl(e){const t=Gl(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Gl(e.lastLimboFreeSnapshotVersion):no.min();let r;var i;return void 0!==e.query.documents?(Fs(1===(i=e.query).documents.length),r=Bc(Pc(Tl(i.documents[0])))):r=function(e){return Bc(Nl(e))}(e.query),new jl(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,Ia.fromBase64String(e.resumeToken))}function Ql(e,t){const n=Kl(t.snapshotVersion),r=Kl(t.lastLimboFreeSnapshotVersion);let i;i=Dc(t.target)?Dl(e.fe,t.target):xl(e.fe,t.target);const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:kc(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Xl(e){const t=Nl({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?qc(t,t.limit,"L"):t}function Yl(e,t){return new qu(t.largestBatchId,Al(e.fe,t.overlayMutation))}function Jl(e,t){const n=t.path.lastSegment();return[e,Lo(t.path.popLast()),n]}function Zl(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Kl(r.readTime),documentKey:Lo(r.documentKey.path),largestBatchId:r.largestBatchId}}class eh{getBundleMetadata(e,t){return th(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:Gl(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return th(e).put({bundleId:(n=t).id,createTime:Kl(yl(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return nh(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:Xl(t.bundledQuery),readTime:Gl(t.readTime)};var t}))}saveNamedQuery(e,t){return nh(e).put(function(e){return{name:e.name,readTime:Kl(yl(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function th(e){return ua(e,"bundles")}function nh(e){return ua(e,"namedQueries")}class rh{constructor(e,t){this.serializer=e,this.userId=t}static de(e,t){const n=t.uid||"";return new rh(e,n)}getOverlay(e,t){return ih(e).get(Jl(this.userId,t)).next((e=>e?Yl(this.serializer,e):null))}getOverlays(e,t){const n=tu();return bo.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new qu(t,i);r.push(this.we(e,s))})),bo.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(Lo(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(ih(e).J("collectionPathOverlayIndex",r))})),bo.waitFor(i)}getOverlaysForCollection(e,t,n){const r=tu(),i=Lo(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return ih(e).j("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=Yl(this.serializer,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=tu();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ih(e).X({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=Yl(this.serializer,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}we(e,t){return ih(e).put(function(e,t,n){const[r,i,s]=Jl(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:kl(e.fe,n.mutation)}}(this.serializer,this.userId,t))}}function ih(e){return ua(e,"documentOverlays")}class sh{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(_a(e.integerValue));else if("doubleValue"in e){const n=_a(e.doubleValue);isNaN(n)?this.ye(t,13):(this.ye(t,15),Po(n)?t.pe(0):t.pe(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ye(t,20),"string"==typeof n?t.Ie(n):(t.Ie(`${n.seconds||""}`),t.pe(n.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(Sa(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ye(t,45),t.pe(n.latitude||0),t.pe(n.longitude||0)}else"mapValue"in e?Ha(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):Ms()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){const n=e.fields||{};this.ye(t,55);for(const e of Object.keys(n))this.Te(e,t),this.me(n[e],t)}Pe(e,t){const n=e.values||[];this.ye(t,50);for(const e of n)this.me(e,t)}ve(e,t){this.ye(t,37),ao.fromName(e).path.forEach((e=>{this.ye(t,60),this.be(e,t)}))}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}function oh(e){if(0===e)return 8;let t=0;return!(e>>4)&&(t+=4,e<<=4),!(e>>6)&&(t+=2,e<<=2),!(e>>7)&&(t+=1),t}function ah(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=oh(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}sh.Ve=new sh;class ch{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Se(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.De(n.value),n=t.next();this.Ce()}xe(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ne(n.value),n=t.next();this.ke()}Me(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.De(e);else if(e<2048)this.De(960|e>>>6),this.De(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.De(480|e>>>12),this.De(128|63&e>>>6),this.De(128|63&e);else{const e=t.codePointAt(0);this.De(240|e>>>18),this.De(128|63&e>>>12),this.De(128|63&e>>>6),this.De(128|63&e)}}this.Ce()}$e(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ne(e);else if(e<2048)this.Ne(960|e>>>6),this.Ne(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ne(480|e>>>12),this.Ne(128|63&e>>>6),this.Ne(128|63&e);else{const e=t.codePointAt(0);this.Ne(240|e>>>18),this.Ne(128|63&e>>>12),this.Ne(128|63&e>>>6),this.Ne(128|63&e)}}this.ke()}Oe(e){const t=this.Fe(e),n=ah(t);this.Be(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}Le(e){const t=this.Fe(e),n=ah(t);this.Be(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}qe(){this.Ue(255),this.Ue(255)}Ke(){this.Ge(255),this.Ge(255)}reset(){this.position=0}seed(e){this.Be(e.length),this.buffer.set(e,this.position),this.position+=e.length}Qe(){return this.buffer.slice(0,this.position)}Fe(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}De(e){const t=255&e;0===t?(this.Ue(0),this.Ue(255)):255===t?(this.Ue(255),this.Ue(0)):this.Ue(t)}Ne(e){const t=255&e;0===t?(this.Ge(0),this.Ge(255)):255===t?(this.Ge(255),this.Ge(0)):this.Ge(e)}Ce(){this.Ue(0),this.Ue(1)}ke(){this.Ge(0),this.Ge(1)}Ue(e){this.Be(1),this.buffer[this.position++]=e}Ge(e){this.Be(1),this.buffer[this.position++]=~e}Be(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class uh{constructor(e){this.je=e}Ae(e){this.je.Se(e)}Ie(e){this.je.Me(e)}pe(e){this.je.Oe(e)}ge(){this.je.qe()}}class lh{constructor(e){this.je=e}Ae(e){this.je.xe(e)}Ie(e){this.je.$e(e)}pe(e){this.je.Le(e)}ge(){this.je.Ke()}}class hh{constructor(){this.je=new ch,this.ze=new uh(this.je),this.We=new lh(this.je)}seed(e){this.je.seed(e)}He(e){return 0===e?this.ze:this.We}Qe(){return this.je.Qe()}reset(){this.je.reset()}}class dh{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Je(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new dh(this.indexId,this.documentKey,this.arrayValue,n)}}function fh(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=ph(e.arrayValue,t.arrayValue),0!==n?n:(n=ph(e.directionalValue,t.directionalValue),0!==n?n:ao.comparator(e.documentKey,t.documentKey)))}function ph(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class mh{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ye=e.orderBy,this.Xe=[];for(const t of e.filters){const e=t;e.isInequality()?this.Ze=e:this.Xe.push(e)}}tn(e){Fs(e.collectionGroup===this.collectionId);const t=uo(e);if(void 0!==t&&!this.en(t))return!1;const n=lo(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.en(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(void 0!==this.Ze){if(!r.has(this.Ze.field.canonicalString())){const e=n[i];if(!this.nn(this.Ze,e)||!this.sn(this.Ye[s++],e))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.Ye.length||!this.sn(this.Ye[s++],e))return!1}return!0}en(e){for(const t of this.Xe)if(this.nn(t,e))return!0;return!1}nn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function gh(e){var t,n;if(Fs(e instanceof ac||e instanceof cc),e instanceof ac){if(e instanceof Ec){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>ac.create(e.field,"==",t))))||[];return cc.create(r,"or")}return e}const r=e.filters.map((e=>gh(e)));return cc.create(r,e.op)}function yh(e){if(0===e.getFilters().length)return[];const t=Ih(gh(e));return Fs(bh(t)),vh(t)||wh(t)?[t]:t.getFilters()}function vh(e){return e instanceof ac}function wh(e){return e instanceof cc&&hc(e)}function bh(e){return vh(e)||wh(e)||function(e){if(e instanceof cc&&lc(e)){for(const t of e.getFilters())if(!vh(t)&&!wh(t))return!1;return!0}return!1}(e)}function Ih(e){if(Fs(e instanceof ac||e instanceof cc),e instanceof ac)return e;if(1===e.filters.length)return Ih(e.filters[0]);const t=e.filters.map((e=>Ih(e)));let n=cc.create(t,e.op);return n=_h(n),bh(n)?n:(Fs(n instanceof cc),Fs(uc(n)),Fs(n.filters.length>1),n.filters.reduce(((e,t)=>Eh(e,t))))}function Eh(e,t){let n;return Fs(e instanceof ac||e instanceof cc),Fs(t instanceof ac||t instanceof cc),n=e instanceof ac?t instanceof ac?function(e,t){return cc.create([e,t],"and")}(e,t):Th(e,t):t instanceof ac?Th(t,e):function(e,t){if(Fs(e.filters.length>0&&t.filters.length>0),uc(e)&&uc(t))return mc(e,t.getFilters());const n=lc(e)?e:t,r=lc(e)?t:e,i=n.filters.map((e=>Eh(e,r)));return cc.create(i,"or")}(e,t),_h(n)}function Th(e,t){if(uc(t))return mc(t,e.getFilters());{const n=t.filters.map((t=>Eh(e,t)));return cc.create(n,"or")}}function _h(e){if(Fs(e instanceof ac||e instanceof cc),e instanceof ac)return e;const t=e.getFilters();if(1===t.length)return _h(t[0]);if(dc(e))return e;const n=t.map((e=>_h(e))),r=[];return n.forEach((t=>{t instanceof ac?r.push(t):t instanceof cc&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:cc.create(r,e.op)}class Sh{constructor(){this.rn=new Ch}addToCollectionParentIndex(e,t){return this.rn.add(t),bo.resolve()}getCollectionParents(e,t){return bo.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return bo.resolve()}deleteFieldIndex(e,t){return bo.resolve()}getDocumentsMatchingTarget(e,t){return bo.resolve(null)}getIndexType(e,t){return bo.resolve(0)}getFieldIndexes(e,t){return bo.resolve([])}getNextCollectionGroupToUpdate(e){return bo.resolve(null)}getMinOffset(e,t){return bo.resolve(mo.min())}getMinOffsetFromCollectionGroup(e,t){return bo.resolve(mo.min())}updateCollectionGroup(e,t,n){return bo.resolve()}updateIndexEntries(e,t){return bo.resolve()}}class Ch{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new ga(io.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new ga(io.comparator)).toArray()}}const kh=new Uint8Array(0);class Ah{constructor(e,t){this.user=e,this.databaseId=t,this.on=new Ch,this.un=new Qc((e=>kc(e)),((e,t)=>Ac(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.on.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.on.add(t)}));const i={collectionId:n,parent:Lo(r)};return Dh(e).put(i)}return bo.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[eo(t),""],!1,!0);return Dh(e).j(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Vo(r.parent))}return n}))}addFieldIndex(e,t){const n=Nh(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=Rh(e);return i.next((e=>{n.put(Zl(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=Nh(e),r=Rh(e),i=xh(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}getDocumentsMatchingTarget(e,t){const n=xh(e);let r=!0;const i=new Map;return bo.forEach(this.cn(t),(t=>this.an(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=ou();const r=[];return bo.forEach(i,((i,s)=>{var o;Rs("IndexedDbIndexManager",`Using index ${o=i,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`} to execute ${kc(t)}`);const a=function(e,t){const n=uo(t);if(void 0===n)return null;for(const t of xc(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),c=function(e,t){const n=new Map;for(const r of lo(t))for(const t of xc(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of lo(t)){const t=0===i.kind?Nc(e,i.fieldPath,e.startAt):Rc(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new tc(n,r)}(s,i),l=function(e,t){const n=[];let r=!0;for(const i of lo(t)){const t=0===i.kind?Rc(e,i.fieldPath,e.endAt):Nc(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new tc(n,r)}(s,i),h=this.hn(i,s,u),d=this.hn(i,s,l),f=this.ln(i,s,c),p=this.fn(i.indexId,a,h,u.inclusive,d,l.inclusive,f);return bo.forEach(p,(i=>n.H(i,t.limit).next((t=>{t.forEach((t=>{const n=ao.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return bo.resolve(null)}))}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:yh(cc.create(e.filters,"and")).map((t=>Cc(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.un.set(e,t),t)}fn(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),c=a/(null!=t?t.length:1),u=[];for(let l=0;l<a;++l){const a=t?this.dn(t[l/c]):kh,h=this.wn(e,a,n[l%c],r),d=this._n(e,a,i[l%c],s),f=o.map((t=>this.wn(e,a,t,!0)));u.push(...this.createRange(h,d,f))}return u}wn(e,t,n,r){const i=new dh(e,ao.empty(),t,n);return r?i:i.Je()}_n(e,t,n,r){const i=new dh(e,ao.empty(),t,n);return r?i.Je():i}an(e,t){const n=new mh(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.tn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.cn(t);return bo.forEach(r,(t=>this.an(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new ga(oo.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}mn(e,t){const n=new hh;for(const r of lo(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.He(r.kind);sh.Ve._e(e,i)}return n.Qe()}dn(e){const t=new hh;return sh.Ve._e(e,t.He(0)),t.Qe()}gn(e,t){const n=new hh;return sh.Ve._e(Ba(this.databaseId,t),n.He(function(e){const t=lo(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Qe()}ln(e,t,n){if(null===n)return[];let r=[];r.push(new hh);let i=0;for(const s of lo(e)){const e=n[i++];for(const n of r)if(this.yn(t,s.fieldPath)&&qa(e))r=this.pn(r,s,e);else{const t=n.He(s.kind);sh.Ve._e(e,t)}}return this.In(r)}hn(e,t,n){return this.ln(e,t,n.position)}In(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Qe();return t}pn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new hh;r.seed(n.Qe()),sh.Ve._e(e,r.He(t.kind)),i.push(r)}return i}yn(e,t){return!!e.filters.find((e=>e instanceof ac&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=Nh(e),r=Rh(e);return(t?n.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.j()).next((e=>{const t=[];return bo.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new fo(t.sequenceNumber,new mo(Gl(t.readTime),new ao(Vo(t.documentKey)),t.largestBatchId)):fo.empty(),r=e.fields.map((([e,t])=>new ho(oo.fromServerFormat(e),t)));return new co(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Js(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=Nh(e),i=Rh(e);return this.Tn(e).next((e=>r.j("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>bo.forEach(t,(t=>i.put(Zl(t.indexId,this.user,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return bo.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?bo.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),bo.forEach(i,(n=>this.En(e,t,n).next((t=>{const i=this.An(r,n);return t.isEqual(i)?bo.resolve():this.vn(e,r,n,t,i)})))))))}))}Rn(e,t,n,r){return xh(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.gn(n,t.key),documentKey:t.key.path.toArray()})}Pn(e,t,n,r){return xh(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.gn(n,t.key),t.key.path.toArray()])}En(e,t,n){const r=xh(e);let i=new ga(fh);return r.X({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.gn(n,t)])},((e,r)=>{i=i.add(new dh(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}An(e,t){let n=new ga(fh);const r=this.mn(t,e);if(null==r)return n;const i=uo(t);if(null!=i){const s=e.data.field(i.fieldPath);if(qa(s))for(const i of s.arrayValue.values||[])n=n.add(new dh(t.indexId,e.key,this.dn(i),r))}else n=n.add(new dh(t.indexId,e.key,kh,r));return n}vn(e,t,n,r,i){Rs("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=va(s),c=va(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=va(o)):t?(i(a),a=va(s)):(a=va(s),c=va(o))}}(r,i,fh,(r=>{s.push(this.Rn(e,t,n,r))}),(r=>{s.push(this.Pn(e,t,n,r))})),bo.waitFor(s)}Tn(e){let t=1;return Rh(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>fh(e,t))).filter(((e,t,n)=>!t||0!==fh(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=fh(i,e),s=fh(i,t);if(0===n)r[0]=e.Je();else if(n>0&&s<0)r.push(i),r.push(i.Je());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.bn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,kh,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,kh,[]];i.push(IDBKeyRange.bound(t,n))}return i}bn(e,t){return fh(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Oh)}getMinOffset(e,t){return bo.mapArray(this.cn(t),(t=>this.an(e,t).next((e=>e||Ms())))).next(Oh)}}function Dh(e){return ua(e,"collectionParents")}function xh(e){return ua(e,"indexEntries")}function Nh(e){return ua(e,"indexConfiguration")}function Rh(e){return ua(e,"indexState")}function Oh(e){Fs(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;go(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new mo(t.readTime,t.documentKey,n)}const Ph={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Lh{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Lh(e,Lh.DEFAULT_COLLECTION_PERCENTILE,Lh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Mh(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.X({range:o},((e,t,n)=>(a++,n.delete())));s.push(c.next((()=>{Fs(1===a)})));const u=[];for(const e of n.mutations){const r=jo(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return bo.waitFor(s).next((()=>u))}function Fh(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Ms();t=e.noDocument}return JSON.stringify(t).length}Lh.DEFAULT_COLLECTION_PERCENTILE=10,Lh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Lh.DEFAULT=new Lh(41943040,Lh.DEFAULT_COLLECTION_PERCENTILE,Lh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Lh.DISABLED=new Lh(-1,0,0);class Vh{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Vn={}}static de(e,t,n,r){Fs(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Vh(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Bh(e).X({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=jh(e),s=Bh(e);return s.add({}).next((o=>{Fs("number"==typeof o);const a=new Bu(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>kl(e.fe,t))),i=n.mutations.map((t=>kl(e.fe,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,a),u=[];let l=new ga(((e,t)=>Js(e.canonicalString(),t.canonicalString())));for(const e of r){const t=jo(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,qo))}return l.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Vn[o]=a.keys()})),bo.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return Bh(e).get(t).next((e=>e?(Fs(e.userId===this.userId),Hl(this.serializer,e)):null))}Sn(e,t){return this.Vn[t]?bo.resolve(this.Vn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.Vn[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Bh(e).X({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(Fs(t.batchId>=n),i=Hl(this.serializer,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Bh(e).X({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Bh(e).j("userMutationsIndex",t).next((e=>e.map((e=>Hl(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Bo(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return jh(e).X({range:r},((n,r,s)=>{const[o,a,c]=n,u=Vo(a);if(o===this.userId&&t.path.isEqual(u))return Bh(e).get(c).next((e=>{if(!e)throw Ms();Fs(e.userId===this.userId),i.push(Hl(this.serializer,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ga(Js);const r=[];return t.forEach((t=>{const i=Bo(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=jh(e).X({range:s},((e,r,i)=>{const[s,o,a]=e,c=Vo(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),bo.waitFor(r).next((()=>this.Dn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=Bo(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new ga(Js);return jh(e).X({range:s},((e,t,i)=>{const[s,a,c]=e,u=Vo(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.Dn(e,o)))}Dn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(Bh(e).get(t).next((e=>{if(null===e)throw Ms();Fs(e.userId===this.userId),n.push(Hl(this.serializer,e))})))})),bo.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return Mh(e.ht,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.Cn(t.batchId)})),bo.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}Cn(e){delete this.Vn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return bo.resolve();const n=IDBKeyRange.lowerBound([this.userId]),r=[];return jh(e).X({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=Vo(e[1]);r.push(t)}else n.done()})).next((()=>{Fs(0===r.length)}))}))}containsKey(e,t){return Uh(e,this.userId,t)}xn(e){return qh(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Uh(e,t,n){const r=Bo(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return jh(e).X({range:s,Y:!0},((e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()})).next((()=>o))}function Bh(e){return ua(e,"mutations")}function jh(e){return ua(e,"documentMutations")}function qh(e){return ua(e,"mutationQueues")}class zh{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new zh(0)}static Mn(){return new zh(-1)}}class $h{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.$n(e).next((t=>{const n=new zh(t.highestTargetId);return t.highestTargetId=n.next(),this.On(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.$n(e).next((e=>no.fromTimestamp(new to(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.$n(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.$n(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.On(e,r))))}addTargetData(e,t){return this.Fn(e,t).next((()=>this.$n(e).next((n=>(n.targetCount+=1,this.Bn(t,n),this.On(e,n))))))}updateTargetData(e,t){return this.Fn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Kh(e).delete(t.targetId))).next((()=>this.$n(e))).next((t=>(Fs(t.targetCount>0),t.targetCount-=1,this.On(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return Kh(e).X(((s,o)=>{const a=Wl(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>bo.waitFor(i))).next((()=>r))}forEachTarget(e,t){return Kh(e).X(((e,n)=>{const r=Wl(n);t(r)}))}$n(e){return Gh(e).get("targetGlobalKey").next((e=>(Fs(null!==e),e)))}On(e,t){return Gh(e).put("targetGlobalKey",t)}Fn(e,t){return Kh(e).put(Ql(this.serializer,t))}Bn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.$n(e).next((e=>e.targetCount))}getTargetData(e,t){const n=kc(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Kh(e).X({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const s=Wl(n);Ac(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=Hh(e);return t.forEach((t=>{const s=Lo(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),bo.waitFor(r)}removeMatchingKeys(e,t,n){const r=Hh(e);return bo.forEach(t,(t=>{const i=Lo(t.path);return bo.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=Hh(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Hh(e);let i=ou();return r.X({range:n,Y:!0},((e,t,n)=>{const r=Vo(e[1]),s=new ao(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=Lo(t.path),r=IDBKeyRange.bound([n],[eo(n)],!1,!0);let i=0;return Hh(e).X({index:"documentTargetsIndex",Y:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}le(e,t){return Kh(e).get(t).next((e=>e?Wl(e):null))}}function Kh(e){return ua(e,"targets")}function Gh(e){return ua(e,"targetGlobal")}function Hh(e){return ua(e,"targetDocuments")}function Wh([e,t],[n,r]){const i=Js(e,n);return 0===i?Js(t,r):i}class Qh{constructor(e){this.Ln=e,this.buffer=new ga(Wh),this.qn=0}Un(){return++this.qn}Kn(e){const t=[e,this.Un()];if(this.buffer.size<this.Ln)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Wh(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Xh{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Qn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}Qn(e){Rs("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){So(e)?Rs("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await wo(e)}await this.Qn(3e5)}))}}class Yh{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.zn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return bo.resolve(Ro.ct);const n=new Qh(t);return this.jn.forEachTarget(e,(e=>n.Kn(e.sequenceNumber))).next((()=>this.jn.Wn(e,(e=>n.Kn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(Rs("LruGarbageCollector","Garbage collection skipped; disabled"),bo.resolve(Ph)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(Rs("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ph):this.Hn(e,t)))}getCacheSize(e){return this.jn.getCacheSize(e)}Hn(e,t){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(Rs("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),Ns()<=q.DEBUG&&Rs("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),bo.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}class Jh{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new Yh(e,t)}(this,t)}zn(e){const t=this.Jn(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Jn(e){let t=0;return this.Wn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Wn(e,t){return this.Yn(e,((e,n)=>t(n)))}addReference(e,t,n){return Zh(e,n)}removeReference(e,t,n){return Zh(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Zh(e,t)}Xn(e,t){return function(e,t){let n=!1;return qh(e).Z((r=>Uh(e,r,t).next((e=>(e&&(n=!0),bo.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Yn(e,((s,o)=>{if(o<=t){const t=this.Xn(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,no.min()),Hh(e).delete([0,Lo(s.path)]))))}));r.push(t)}})).next((()=>bo.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Zh(e,t)}Yn(e,t){const n=Hh(e);let r,i=Ro.ct;return n.X({index:"documentTargetsIndex"},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==Ro.ct&&t(new ao(Vo(r)),i),i=o,r=s):i=Ro.ct})).next((()=>{i!==Ro.ct&&t(new ao(Vo(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Zh(e,t){return Hh(e).put(function(e,t){return{targetId:0,path:Lo(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class ed{constructor(){this.changes=new Qc((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ec.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?bo.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class td{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return sd(e).put(n)}removeEntry(e,t,n){return sd(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],$l(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Zn(e,n))))}getEntry(e,t){let n=ec.newInvalidDocument(t);return sd(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(od(t))},((e,r)=>{n=this.ts(t,r)})).next((()=>n))}es(e,t){let n={size:0,document:ec.newInvalidDocument(t)};return sd(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(od(t))},((e,r)=>{n={document:this.ts(t,r),size:Fh(r)}})).next((()=>n))}getEntries(e,t){let n=Yc();return this.ns(e,t,((e,t)=>{const r=this.ts(e,t);n=n.insert(e,r)})).next((()=>n))}ss(e,t){let n=Yc(),r=new fa(ao.comparator);return this.ns(e,t,((e,t)=>{const i=this.ts(e,t);n=n.insert(e,i),r=r.insert(e,Fh(t))})).next((()=>({documents:n,rs:r})))}ns(e,t,n){if(t.isEmpty())return bo.resolve();let r=new ga(cd);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(od(r.first()),od(r.last())),s=r.getIterator();let o=s.getNext();return sd(e).X({index:"documentKeyIndex",range:i},((e,t,r)=>{const i=ao.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&cd(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.G(od(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r){const i=t.path,s=[i.popLast().toArray(),i.lastSegment(),$l(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return sd(e).j(IDBKeyRange.bound(s,o,!0)).next((e=>{let n=Yc();for(const i of e){const e=this.ts(ao.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(Gc(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let i=Yc();const s=ad(t,n),o=ad(t,mo.max());return sd(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((e,t,n)=>{const s=this.ts(ao.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new rd(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return id(e).get("remoteDocumentGlobalKey").next((e=>(Fs(!!e),e)))}Zn(e,t){return id(e).put("remoteDocumentGlobalKey",t)}ts(e,t){if(t){const e=function(e,t){let n;if(t.document)n=function(e,t,n){const r=Il(e,t.name),i=yl(t.updateTime),s=t.createTime?yl(t.createTime):no.min(),o=new Ja({mapValue:{fields:t.fields}}),a=ec.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}(e.fe,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=ao.fromSegments(t.noDocument.path),r=Gl(t.noDocument.readTime);n=ec.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Ms();{const e=ao.fromSegments(t.unknownDocument.path),r=Gl(t.unknownDocument.version);n=ec.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new to(e[0],e[1]);return no.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(no.min()))return e}return ec.newInvalidDocument(e)}}function nd(e){return new td(e)}class rd extends ed{constructor(e,t){super(),this.os=e,this.trackRemovals=t,this.us=new Qc((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new ga(((e,t)=>Js(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.us.get(i);if(t.push(this.os.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=zl(this.os.serializer,s);r=r.add(i.path.popLast());const c=Fh(a);n+=c-o.size,t.push(this.os.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=zl(this.os.serializer,s.convertToNoDocument(no.min()));t.push(this.os.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.os.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.os.updateMetadata(e,n)),bo.waitFor(t)}getFromCache(e,t){return this.os.es(e,t).next((e=>(this.us.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.os.ss(e,t).next((({documents:e,rs:t})=>(t.forEach(((t,n)=>{this.us.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function id(e){return ua(e,"remoteDocumentGlobal")}function sd(e){return ua(e,"remoteDocumentsV14")}function od(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function ad(e,t){const n=t.documentKey.path.toArray();return[e,$l(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function cd(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=Js(n[e],r[e]),i)return i;return i=Js(n.length,r.length),i||(i=Js(n[n.length-2],r[r.length-2]),i||Js(n[n.length-1],r[r.length-1]))}class ud{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ld{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&xu(n.mutation,e,wa.empty(),to.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,ou()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=ou()){const r=tu();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=Zc();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=tu();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,ou())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=Yc();const s=ru(),o=ru();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Pu)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),xu(o.mutation,t,o.mutation.getFieldMask(),to.now())):s.set(t.key,wa.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new ud(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=ru();let r=new fa(((e,t)=>e-t)),i=ou();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||wa.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||ou()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=nu();c.forEach((e=>{if(!i.has(e)){const r=Au(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return bo.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return ao.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Vc(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):bo.resolve(tu());let o=-1,a=i;return s.next((t=>bo.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?bo.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,ou()))).next((e=>({batchId:o,changes:eu(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ao(t)).next((e=>{let t=Zc();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const r=t.collectionGroup;let i=Zc();return this.indexManager.getCollectionParents(e,r).next((s=>bo.forEach(s,(s=>{const o=function(e,t){return new Oc(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r)))).next((e=>{r.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,ec.newInvalidDocument(r)))}));let n=Zc();return e.forEach(((e,i)=>{const s=r.get(e);void 0!==s&&xu(s.mutation,i,wa.empty(),to.now()),Gc(t,i)&&(n=n.insert(e,i))})),n}))}}class hd{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return bo.resolve(this.cs.get(t))}saveBundleMetadata(e,t){var n;return this.cs.set(t.id,{id:(n=t).id,version:n.version,createTime:yl(n.createTime)}),bo.resolve()}getNamedQuery(e,t){return bo.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,function(e){return{name:e.name,query:Xl(e.bundledQuery),readTime:yl(e.readTime)}}(t)),bo.resolve()}}class dd{constructor(){this.overlays=new fa(ao.comparator),this.ls=new Map}getOverlay(e,t){return bo.resolve(this.overlays.get(t))}getOverlays(e,t){const n=tu();return bo.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.we(e,t,r)})),bo.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.ls.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.ls.delete(n)),bo.resolve()}getOverlaysForCollection(e,t,n){const r=tu(),i=t.length+1,s=new ao(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return bo.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new fa(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=tu(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=tu(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return bo.resolve(o)}we(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.ls.get(r.largestBatchId).delete(n.key);this.ls.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new qu(t,n));let i=this.ls.get(t);void 0===i&&(i=ou(),this.ls.set(t,i)),this.ls.set(t,i.add(n.key))}}class fd{constructor(){this.fs=new ga(pd.ds),this.ws=new ga(pd._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){const n=new pd(e,t);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.ys(new pd(e,t))}ps(e,t){e.forEach((e=>this.removeReference(e,t)))}Is(e){const t=new ao(new io([])),n=new pd(t,e),r=new pd(t,e+1),i=[];return this.ws.forEachInRange([n,r],(e=>{this.ys(e),i.push(e.key)})),i}Ts(){this.fs.forEach((e=>this.ys(e)))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const t=new ao(new io([])),n=new pd(t,e),r=new pd(t,e+1);let i=ou();return this.ws.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new pd(e,0),n=this.fs.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class pd{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return ao.comparator(e.key,t.key)||Js(e.As,t.As)}static _s(e,t){return Js(e.As,t.As)||ao.comparator(e.key,t.key)}}class md{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new ga(pd.ds)}checkEmpty(e){return bo.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Bu(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.Rs=this.Rs.add(new pd(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return bo.resolve(s)}lookupMutationBatch(e,t){return bo.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.bs(n),i=r<0?0:r;return bo.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return bo.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return bo.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new pd(t,0),r=new pd(t,Number.POSITIVE_INFINITY),i=[];return this.Rs.forEachInRange([n,r],(e=>{const t=this.Ps(e.As);i.push(t)})),bo.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ga(Js);return t.forEach((e=>{const t=new pd(e,0),r=new pd(e,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([t,r],(e=>{n=n.add(e.As)}))})),bo.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;ao.isDocumentKey(i)||(i=i.child(""));const s=new pd(new ao(i),0);let o=new ga(Js);return this.Rs.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.As)),!0)}),s),bo.resolve(this.Vs(o))}Vs(e){const t=[];return e.forEach((e=>{const n=this.Ps(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Fs(0===this.Ss(t.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return bo.forEach(t.mutations,(r=>{const i=new pd(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Rs=n}))}Cn(e){}containsKey(e,t){const n=new pd(t,0),r=this.Rs.firstAfterOrEqual(n);return bo.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,bo.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){const t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class gd{constructor(e){this.Ds=e,this.docs=new fa(ao.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Ds(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return bo.resolve(n?n.document.mutableCopy():ec.newInvalidDocument(t))}getEntries(e,t){let n=Yc();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ec.newInvalidDocument(e))})),bo.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Yc();const s=t.path,o=new ao(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||go(po(o),n)<=0||(r.has(o.key)||Gc(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return bo.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Ms()}Cs(e,t){return bo.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new yd(this)}getSize(e){return bo.resolve(this.size)}}class yd extends ed{constructor(e){super(),this.os=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.os.addEntry(e,r)):this.os.removeEntry(n)})),bo.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class vd{constructor(e){this.persistence=e,this.xs=new Qc((e=>kc(e)),Ac),this.lastRemoteSnapshotVersion=no.min(),this.highestTargetId=0,this.Ns=0,this.ks=new fd,this.targetCount=0,this.Ms=zh.kn()}forEachTarget(e,t){return this.xs.forEach(((e,n)=>t(n))),bo.resolve()}getLastRemoteSnapshotVersion(e){return bo.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return bo.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),bo.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ns&&(this.Ns=t),bo.resolve()}Fn(e){this.xs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ms=new zh(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,bo.resolve()}updateTargetData(e,t){return this.Fn(t),bo.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,bo.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.xs.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.xs.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),bo.waitFor(i).next((()=>r))}getTargetCount(e){return bo.resolve(this.targetCount)}getTargetData(e,t){const n=this.xs.get(t)||null;return bo.resolve(n)}addMatchingKeys(e,t,n){return this.ks.gs(t,n),bo.resolve()}removeMatchingKeys(e,t,n){this.ks.ps(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),bo.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),bo.resolve()}getMatchingKeysForTargetId(e,t){const n=this.ks.Es(t);return bo.resolve(n)}containsKey(e,t){return bo.resolve(this.ks.containsKey(t))}}class wd{constructor(e,t){this.$s={},this.overlays={},this.Os=new Ro(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new vd(this),this.indexManager=new Sh,this.remoteDocumentCache=function(e){return new gd(e)}((e=>this.referenceDelegate.Ls(e))),this.serializer=new ql(t),this.qs=new hd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new dd,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.$s[e.toKey()];return n||(n=new md(t,this.referenceDelegate),this.$s[e.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,n){Rs("MemoryPersistence","Starting transaction:",e);const r=new bd(this.Os.next());return this.referenceDelegate.Us(),n(r).next((e=>this.referenceDelegate.Ks(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gs(e,t){return bo.or(Object.values(this.$s).map((n=>()=>n.containsKey(e,t))))}}class bd extends vo{constructor(e){super(),this.currentSequenceNumber=e}}class Id{constructor(e){this.persistence=e,this.Qs=new fd,this.js=null}static zs(e){return new Id(e)}get Ws(){if(this.js)return this.js;throw Ms()}addReference(e,t,n){return this.Qs.addReference(n,t),this.Ws.delete(n.toString()),bo.resolve()}removeReference(e,t,n){return this.Qs.removeReference(n,t),this.Ws.add(n.toString()),bo.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),bo.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach((e=>this.Ws.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Ws.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Us(){this.js=new Set}Ks(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return bo.forEach(this.Ws,(n=>{const r=ao.fromPath(n);return this.Hs(e,r).next((e=>{e||t.removeEntry(r,no.min())}))})).next((()=>(this.js=null,t.apply(e))))}updateLimboDocument(e,t){return this.Hs(e,t).next((e=>{e?this.Ws.delete(t.toString()):this.Ws.add(t.toString())}))}Ls(e){return 0}Hs(e,t){return bo.or([()=>bo.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class Ed{constructor(e){this.serializer=e}O(e,t,n,r){const i=new Io("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Uo,{unique:!0}),e.createObjectStore("documentMutations")}(e),Td(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=bo.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),Td(e)),s=s.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:no.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store("mutations").j().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Uo,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return bo.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Ys(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.Xs(i))))),n<7&&r>=7&&(s=s.next((()=>this.Zs(i)))),n<8&&r>=8&&(s=s.next((()=>this.ti(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.ei(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:ea});t.createIndex("collectionPathOverlayIndex",ta,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",na,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:zo});t.createIndex("documentKeyIndex",$o),t.createIndex("collectionGroupIndex",Ko)}(e))).next((()=>this.ni(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>this.si(e,i)))),n<15&&r>=15&&(s=s.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Xo}).createIndex("sequenceNumberIndex",Yo,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Jo}).createIndex("documentKeyIndex",Zo,{unique:!1})}(e)))),s}Xs(e){let t=0;return e.store("remoteDocuments").X(((e,n)=>{t+=Fh(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Ys(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.j().next((t=>bo.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.j("userMutationsIndex",r).next((n=>bo.forEach(n,(n=>{Fs(n.userId===t.userId);const r=Hl(this.serializer,n);return Mh(e,t.userId,r).next((()=>{}))}))))}))))}Zs(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.X(((n,i)=>{const s=new io(n),o=function(e){return[0,Lo(e)]}(s);r.push(t.get(o).next((n=>n?bo.resolve():(n=>t.put({targetId:0,path:Lo(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>bo.waitFor(r)))}))}ti(e,t){e.createObjectStore("collectionParents",{keyPath:Qo});const n=t.store("collectionParents"),r=new Ch,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Lo(r)})}};return t.store("remoteDocuments").X({Y:!0},((e,t)=>{const n=new io(e);return i(n.popLast())})).next((()=>t.store("documentMutations").X({Y:!0},(([e,t,n],r)=>{const s=Vo(t);return i(s.popLast())}))))}ei(e){const t=e.store("targets");return t.X(((e,n)=>{const r=Wl(n),i=Ql(this.serializer,r);return t.put(i)}))}ni(e,t){const n=t.store("remoteDocuments"),r=[];return n.X(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=(o=n,o.document?new ao(io.fromString(o.document.name).popFirst(5)):o.noDocument?ao.fromSegments(o.noDocument.path):o.unknownDocument?ao.fromSegments(o.unknownDocument.path):Ms()).path.toArray();var o;const a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))})).next((()=>bo.waitFor(r)))}si(e,t){const n=t.store("mutations"),r=nd(this.serializer),i=new wd(Id.zs,this.serializer.fe);return n.j().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:ou();Hl(this.serializer,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),bo.forEach(n,((e,n)=>{const s=new As(n),o=rh.de(this.serializer,s),a=i.getIndexManager(s),c=Vh.de(s,this.serializer,a,i.referenceDelegate);return new ld(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new ca(t,Ro.ct),e).next()}))}))}}function Td(e){e.createObjectStore("targetDocuments",{keyPath:Ho}).createIndex("documentTargetsIndex",Wo,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Go,{unique:!0}),e.createObjectStore("targetGlobal")}const _d="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Sd{constructor(e,t,n,r,i,s,o,a,c,u,l=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ii=i,this.window=s,this.document=o,this.ri=c,this.oi=u,this.ui=l,this.Os=null,this.Fs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.ai=null,this.hi=null,this.li=Number.NEGATIVE_INFINITY,this.fi=e=>Promise.resolve(),!Sd.D())throw new Bs(Us.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Jh(this,r),this.di=t+"main",this.serializer=new ql(a),this.wi=new Eo(this.di,this.ui,new Ed(this.serializer)),this.Bs=new $h(this.referenceDelegate,this.serializer),this.remoteDocumentCache=nd(this.serializer),this.qs=new eh,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===u&&Os("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Bs(Us.FAILED_PRECONDITION,_d);return this.gi(),this.yi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Bs.getHighestSequenceNumber(e)))})).then((e=>{this.Os=new Ro(e,this.ri)})).then((()=>{this.Fs=!0})).catch((e=>(this.wi&&this.wi.close(),Promise.reject(e))))}Ii(e){return this.fi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.wi.B((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ii.enqueueAndForget((async()=>{this.started&&await this.mi()})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>kd(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Ti(e).next((e=>{e||(this.isPrimary=!1,this.ii.enqueueRetryable((()=>this.fi(!1))))}))})).next((()=>this.Ei(e))).next((t=>this.isPrimary&&!t?this.Ai(e).next((()=>!1)):!!t&&this.vi(e).next((()=>!0)))))).catch((e=>{if(So(e))return Rs("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Rs("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.ii.enqueueRetryable((()=>this.fi(e))),this.isPrimary=e}))}Ti(e){return Cd(e).get("owner").next((e=>bo.resolve(this.Ri(e))))}Pi(e){return kd(e).delete(this.clientId)}async bi(){if(this.isPrimary&&!this.Vi(this.li,18e5)){this.li=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=ua(e,"clientMetadata");return t.j().next((e=>{const n=this.Si(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return bo.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this._i)for(const t of e)this._i.removeItem(this.Di(t.clientId))}}pi(){this.hi=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.mi().then((()=>this.bi())).then((()=>this.pi()))))}Ri(e){return!!e&&e.ownerId===this.clientId}Ei(e){return this.oi?bo.resolve(!0):Cd(e).get("owner").next((t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)){if(this.Ri(t)&&this.networkEnabled)return!0;if(!this.Ri(t)){if(!t.allowTabSynchronization)throw new Bs(Us.FAILED_PRECONDITION,_d);return!1}}return!(!this.networkEnabled||!this.inForeground)||kd(e).j().next((e=>void 0===this.Si(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&Rs("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.Fs=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Ni(),this.ki(),await this.wi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new ca(e,Ro.ct);return this.Ai(t).next((()=>this.Pi(t)))})),this.wi.close(),this.Mi()}Si(e,t){return e.filter((e=>this.Vi(e.updateTimeMs,t)&&!this.Ci(e.clientId)))}$i(){return this.runTransaction("getActiveClients","readonly",(e=>kd(e).j().next((e=>this.Si(e,18e5).map((e=>e.clientId))))))}get started(){return this.Fs}getMutationQueue(e,t){return Vh.de(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Ah(e,this.serializer.fe.databaseId)}getDocumentOverlayCache(e){return rh.de(this.serializer,e)}getBundleCache(){return this.qs}runTransaction(e,t,n){Rs("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=15===(s=this.ui)?aa:14===s?oa:13===s?sa:12===s?ia:11===s?ra:void Ms();var s;let o;return this.wi.runTransaction(e,r,i,(r=>(o=new ca(r,this.Os?this.Os.next():Ro.ct),"readwrite-primary"===t?this.Ti(o).next((e=>!!e||this.Ei(o))).next((t=>{if(!t)throw Os(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ii.enqueueRetryable((()=>this.fi(!1))),new Bs(Us.FAILED_PRECONDITION,yo);return n(o)})).next((e=>this.vi(o).next((()=>e)))):this.Oi(o).next((()=>n(o)))))).then((e=>(o.raiseOnCommittedEvent(),e)))}Oi(e){return Cd(e).get("owner").next((e=>{if(null!==e&&this.Vi(e.leaseTimestampMs,5e3)&&!this.Ci(e.ownerId)&&!this.Ri(e)&&!(this.oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new Bs(Us.FAILED_PRECONDITION,_d)}))}vi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Cd(e).put("owner",t)}static D(){return Eo.D()}Ai(e){const t=Cd(e);return t.get("owner").next((e=>this.Ri(e)?(Rs("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):bo.resolve()))}Vi(e,t){const n=Date.now();return!(e<n-t||e>n&&(Os(`Detected an update time that is in the future: ${e} > ${n}`),1))}gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ai=()=>{this.ii.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.mi())))},this.document.addEventListener("visibilitychange",this.ai),this.inForeground="visible"===this.document.visibilityState)}Ni(){this.ai&&(this.document.removeEventListener("visibilitychange",this.ai),this.ai=null)}yi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const e=/(?:Version|Mobile)\/1[456]/;!I()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.ii.enterRestrictedMode(!0),this.ii.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ci))}ki(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Ci(e){var t;try{const n=null!==(null===(t=this._i)||void 0===t?void 0:t.getItem(this.Di(e)));return Rs("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Os("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this._i)try{this._i.setItem(this.Di(this.clientId),String(Date.now()))}catch(e){Os("Failed to set zombie client id.",e)}}Mi(){if(this._i)try{this._i.removeItem(this.Di(this.clientId))}catch(e){}}Di(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Cd(e){return ua(e,"owner")}function kd(e){return ua(e,"clientMetadata")}class Ad{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Fi=n,this.Bi=r}static Li(e,t){let n=ou(),r=ou();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Ad(e,t.fromCache,n,r)}}class Dd{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,n,r){return this.Ki(e,t).next((i=>i||this.Gi(e,t,r,n))).next((n=>n||this.Qi(e,t)))}Ki(e,t){if(Lc(t))return bo.resolve(null);let n=Bc(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=qc(t,null,"F"),n=Bc(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=ou(...r);return this.Ui.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.ji(t,r);return this.zi(t,s,i,n.readTime)?this.Ki(e,qc(t,null,"F")):this.Wi(e,s,t,n)}))))})))))}Gi(e,t,n,r){return Lc(t)||r.isEqual(no.min())?this.Qi(e,t):this.Ui.getDocuments(e,n).next((i=>{const s=this.ji(t,i);return this.zi(t,s,n,r)?this.Qi(e,t):(Ns()<=q.DEBUG&&Rs("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Kc(t)),this.Wi(e,s,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=no.fromTimestamp(1e9===r?new to(n+1,0):new to(n,r));return new mo(i,ao.empty(),t)}(r,-1)))}))}ji(e,t){let n=new ga(Hc(e));return t.forEach(((t,r)=>{Gc(e,r)&&(n=n.add(r))})),n}zi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Qi(e,t){return Ns()<=q.DEBUG&&Rs("QueryEngine","Using full collection scan to execute query:",Kc(t)),this.Ui.getDocumentsMatchingQuery(e,t,mo.min())}Wi(e,t,n,r){return this.Ui.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class xd{constructor(e,t,n,r){this.persistence=e,this.Hi=t,this.serializer=r,this.Ji=new fa(Js),this.Yi=new Qc((e=>kc(e)),Ac),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(n)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ld(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ji)))}}function Nd(e,t,n,r){return new xd(e,t,n,r)}async function Rd(e,t){const n=Vs(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.tr(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=ou();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({er:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function Od(e){const t=Vs(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Bs.getLastRemoteSnapshotVersion(e)))}function Pd(e,t){const n=Vs(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}async function Ld(e,t,n){const r=Vs(e),i=r.Ji.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!So(e))throw e;Rs("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ji=r.Ji.remove(t),r.Yi.delete(i.target)}function Md(e,t,n){const r=Vs(e);let i=no.min(),s=ou();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=Vs(e),i=r.Yi.get(n);return void 0!==i?bo.resolve(r.Ji.get(i)):r.Bs.getTargetData(t,n)}(r,e,Bc(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Bs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.Hi.getDocumentsMatchingQuery(e,t,n?i:no.min(),n?s:ou()))).next((e=>(function(e,t,n){let r=e.Xi.get(t)||no.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Xi.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,ir:s})))))}class Fd{constructor(){this.activeTargetIds=au}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Vd{constructor(){this.Hr=new Fd,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,n){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new Fd,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Ud{Yr(e){}shutdown(){}}class Bd{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){Rs("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){Rs("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let jd=null;function qd(){return null===jd?jd=268435456+Math.round(2147483648*Math.random()):jd++,"0x"+jd.toString(16)}const zd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class $d{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}const Kd="WebChannelConnection";class Gd extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.mo=t+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,n,r,i){const s=qd(),o=this.To(e,t);Rs("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const a={};return this.Eo(a,r,i),this.Ao(e,o,a,n).then((t=>(Rs("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw Ps("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,r,i,s){return this.Io(e,t,n,r,i)}Eo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Ds,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}To(e,t){const n=zd[e];return`${this.mo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,n,r){const i=qd();return new Promise(((s,o)=>{const a=new Ts;a.setWithCredentials(!0),a.listenOnce(vs.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case ys.NO_ERROR:const t=a.getResponseJson();Rs(Kd,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case ys.TIMEOUT:Rs(Kd,`RPC '${e}' ${i} timed out`),o(new Bs(Us.DEADLINE_EXCEEDED,"Request time out"));break;case ys.HTTP_ERROR:const n=a.getStatus();if(Rs(Kd,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Us).indexOf(t)>=0?t:Us.UNKNOWN}(t.status);o(new Bs(e,t.message))}else o(new Bs(Us.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Bs(Us.UNAVAILABLE,"Connection failed."));break;default:Ms()}}finally{Rs(Kd,`RPC '${e}' ${i} completed.`)}}));const c=JSON.stringify(r);Rs(Kd,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)}))}Ro(e,t,n){const r=qd(),i=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=ms(),o=gs(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new Is({})),this.Eo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=i.join("");Rs(Kd,`Creating RPC '${e}' stream ${r}: ${u}`,a);const l=s.createWebChannel(u,a);let h=!1,d=!1;const f=new $d({ro:t=>{d?Rs(Kd,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||(Rs(Kd,`Opening RPC '${e}' stream ${r} transport.`),l.open(),h=!0),Rs(Kd,`RPC '${e}' stream ${r} sending:`,t),l.send(t))},oo:()=>l.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return p(l,Es.EventType.OPEN,(()=>{d||Rs(Kd,`RPC '${e}' stream ${r} transport opened.`)})),p(l,Es.EventType.CLOSE,(()=>{d||(d=!0,Rs(Kd,`RPC '${e}' stream ${r} transport closed`),f.wo())})),p(l,Es.EventType.ERROR,(t=>{d||(d=!0,Ps(Kd,`RPC '${e}' stream ${r} transport errored:`,t),f.wo(new Bs(Us.UNAVAILABLE,"The operation could not be completed")))})),p(l,Es.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];Fs(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Rs(Kd,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=$u[e];if(void 0!==t)return Gu(t)}(t),i=o.message;void 0===n&&(n=Us.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.wo(new Bs(n,i)),l.close()}else Rs(Kd,`RPC '${e}' stream ${r} received:`,i),f._o(i)}})),p(o,ws.STAT_EVENT,(t=>{t.stat===bs.PROXY?Rs(Kd,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===bs.NOPROXY&&Rs(Kd,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.fo()}),0),f}}function Hd(){return"undefined"!=typeof document?document:null}function Wd(e){return new dl(e,!0)}class Qd{constructor(e,t,n=1e3,r=1.5,i=6e4){this.ii=e,this.timerId=t,this.Po=n,this.bo=r,this.Vo=i,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const t=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),r=Math.max(0,t-n);r>0&&Rs("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,r,(()=>(this.Co=Date.now(),e()))),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class Xd{constructor(e,t,n,r,i,s,o,a){this.ii=e,this.$o=n,this.Oo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new Qd(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,(()=>this.zo())))}Wo(e){this.Ho(),this.stream.send(e)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(e,t){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==e?this.qo.reset():t&&t.code===Us.RESOURCE_EXHAUSTED?(Os(t.toString()),Os("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):t&&t.code===Us.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.ao(t)}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Fo===t&&this.Zo(e,n)}),(t=>{e((()=>{const e=new Bs(Us.UNKNOWN,"Fetching auth token failed: "+t.message);return this.tu(e)}))}))}Zo(e,t){const n=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo((()=>{n((()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,(()=>(this.Ko()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.ao((e=>{n((()=>this.tu(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Go(){this.state=5,this.qo.No((async()=>{this.state=0,this.start()}))}tu(e){return Rs("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget((()=>this.Fo===e?t():(Rs("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Yd extends Xd{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Ms()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(Fs(void 0===t||"string"==typeof t),Ia.fromBase64String(t||"")):(Fs(void 0===t||t instanceof Uint8Array),Ia.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Us.UNKNOWN:Gu(e.code);return new Bs(t,e.message||"")}(o);n=new il(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Il(e,r.document.name),s=yl(r.document.updateTime),o=r.document.createTime?yl(r.document.createTime):no.min(),a=new Ja({mapValue:{fields:r.document.fields}}),c=ec.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new nl(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Il(e,r.document),s=r.readTime?yl(r.readTime):no.min(),o=ec.newNoDocument(i,s),a=r.removedTargetIds||[];n=new nl([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Il(e,r.document),s=r.removedTargetIds||[];n=new nl([],s,i,null)}else{if(!("filter"in t))return Ms();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new zu(r,i),o=e.targetId;n=new rl(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return no.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?no.min():t.readTime?yl(t.readTime):no.min()}(e);return this.listener.nu(t,n)}su(e){const t={};t.database=_l(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Dc(r)?{documents:Dl(e,r)}:{query:xl(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=ml(e,t.resumeToken);const r=fl(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(no.min())>0){n.readTime=pl(e,t.snapshotVersion.toTimestamp());const r=fl(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ms()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Wo(t)}iu(e){const t={};t.database=_l(this.serializer),t.removeTarget=e,this.Wo(t)}}class Jd extends Xd{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){if(Fs(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const t=function(e,t){return e&&e.length>0?(Fs(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?yl(e.updateTime):yl(t);return n.isEqual(no.min())&&(n=yl(t)),new _u(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=yl(e.commitTime);return this.listener.cu(n,t)}return Fs(!e.writeResults||0===e.writeResults.length),this.ru=!0,this.listener.au()}hu(){const e={};e.database=_l(this.serializer),this.Wo(e)}uu(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>kl(this.serializer,e)))};this.Wo(t)}}class Zd extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.lu=!1}fu(){if(this.lu)throw new Bs(Us.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.Io(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Us.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Bs(Us.UNKNOWN,e.toString())}))}vo(e,t,n,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.vo(e,t,n,i,s,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Us.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Bs(Us.UNKNOWN,e.toString())}))}terminate(){this.lu=!0}}class ef{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve()))))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(Os(t),this.mu=!1):Rs("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class tf{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=i,this.Pu.Yr((e=>{n.enqueueAndForget((async()=>{hf(this)&&(Rs("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Vs(e);t.vu.add(4),await rf(t),t.bu.set("Unknown"),t.vu.delete(4),await nf(t)}(this))}))})),this.bu=new ef(n,r)}}async function nf(e){if(hf(e))for(const t of e.Ru)await t(!0)}async function rf(e){for(const t of e.Ru)await t(!1)}function sf(e,t){const n=Vs(e);n.Au.has(t.targetId)||(n.Au.set(t.targetId,t),lf(n)?uf(n):Af(n).Ko()&&af(n,t))}function of(e,t){const n=Vs(e),r=Af(n);n.Au.delete(t),r.Ko()&&cf(n,t),0===n.Au.size&&(r.Ko()?r.jo():hf(n)&&n.bu.set("Unknown"))}function af(e,t){if(e.Vu.qt(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(no.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Af(e).su(t)}function cf(e,t){e.Vu.qt(t),Af(e).iu(t)}function uf(e){e.Vu=new ol({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),le:t=>e.Au.get(t)||null,ue:()=>e.datastore.serializer.databaseId}),Af(e).start(),e.bu.gu()}function lf(e){return hf(e)&&!Af(e).Uo()&&e.Au.size>0}function hf(e){return 0===Vs(e).vu.size}function df(e){e.Vu=void 0}async function ff(e){e.Au.forEach(((t,n)=>{af(e,t)}))}async function pf(e,t){df(e),lf(e)?(e.bu.Iu(t),uf(e)):e.bu.set("Unknown")}async function mf(e,t,n){if(e.bu.set("Online"),t instanceof il&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Au.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Au.delete(r),e.Vu.removeTarget(r))}(e,t)}catch(n){Rs("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await gf(e,n)}else if(t instanceof nl?e.Vu.Ht(t):t instanceof rl?e.Vu.ne(t):e.Vu.Xt(t),!n.isEqual(no.min()))try{const t=await Od(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Vu.ce(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Au.get(r);i&&e.Au.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.Au.get(t);if(!r)return;e.Au.set(t,r.withResumeToken(Ia.EMPTY_BYTE_STRING,r.snapshotVersion)),cf(e,t);const i=new jl(r.target,t,n,r.sequenceNumber);af(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Rs("RemoteStore","Failed to raise snapshot:",t),await gf(e,t)}}async function gf(e,t,n){if(!So(t))throw t;e.vu.add(1),await rf(e),e.bu.set("Offline"),n||(n=()=>Od(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Rs("RemoteStore","Retrying IndexedDB access"),await n(),e.vu.delete(1),await nf(e)}))}function yf(e,t){return t().catch((n=>gf(e,n,t)))}async function vf(e){const t=Vs(e),n=Df(t);let r=t.Eu.length>0?t.Eu[t.Eu.length-1].batchId:-1;for(;wf(t);)try{const e=await Pd(t.localStore,r);if(null===e){0===t.Eu.length&&n.jo();break}r=e.batchId,bf(t,e)}catch(e){await gf(t,e)}If(t)&&Ef(t)}function wf(e){return hf(e)&&e.Eu.length<10}function bf(e,t){e.Eu.push(t);const n=Df(e);n.Ko()&&n.ou&&n.uu(t.mutations)}function If(e){return hf(e)&&!Df(e).Uo()&&e.Eu.length>0}function Ef(e){Df(e).start()}async function Tf(e){Df(e).hu()}async function _f(e){const t=Df(e);for(const n of e.Eu)t.uu(n.mutations)}async function Sf(e,t,n){const r=e.Eu.shift(),i=ju.from(r,t,n);await yf(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await vf(e)}async function Cf(e,t){t&&Df(e).ou&&await async function(e,t){if(function(e){switch(e){default:return Ms();case Us.CANCELLED:case Us.UNKNOWN:case Us.DEADLINE_EXCEEDED:case Us.RESOURCE_EXHAUSTED:case Us.INTERNAL:case Us.UNAVAILABLE:case Us.UNAUTHENTICATED:return!1;case Us.INVALID_ARGUMENT:case Us.NOT_FOUND:case Us.ALREADY_EXISTS:case Us.PERMISSION_DENIED:case Us.FAILED_PRECONDITION:case Us.ABORTED:case Us.OUT_OF_RANGE:case Us.UNIMPLEMENTED:case Us.DATA_LOSS:return!0}}(n=t.code)&&n!==Us.ABORTED){const n=e.Eu.shift();Df(e).Qo(),await yf(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await vf(e)}var n}(e,t),If(e)&&Ef(e)}async function kf(e,t){const n=Vs(e);n.asyncQueue.verifyOperationInProgress(),Rs("RemoteStore","RemoteStore received new credentials");const r=hf(n);n.vu.add(3),await rf(n),r&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.vu.delete(3),await nf(n)}function Af(e){return e.Su||(e.Su=function(e,t,n){const r=Vs(e);return r.fu(),new Yd(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{uo:ff.bind(null,e),ao:pf.bind(null,e),nu:mf.bind(null,e)}),e.Ru.push((async t=>{t?(e.Su.Qo(),lf(e)?uf(e):e.bu.set("Unknown")):(await e.Su.stop(),df(e))}))),e.Su}function Df(e){return e.Du||(e.Du=function(e,t,n){const r=Vs(e);return r.fu(),new Jd(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{uo:Tf.bind(null,e),ao:Cf.bind(null,e),au:_f.bind(null,e),cu:Sf.bind(null,e)}),e.Ru.push((async t=>{t?(e.Du.Qo(),await vf(e)):(await e.Du.stop(),e.Eu.length>0&&(Rs("RemoteStore",`Stopping write stream with ${e.Eu.length} pending writes`),e.Eu=[]))}))),e.Du}class xf{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new js,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new xf(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Bs(Us.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Nf(e,t){if(Os("AsyncQueue",`${t}: ${e}`),So(e))return new Bs(Us.UNAVAILABLE,`${t}: ${e}`);throw e}class Rf{constructor(e){this.comparator=e?(t,n)=>e(t,n)||ao.comparator(t.key,n.key):(e,t)=>ao.comparator(e.key,t.key),this.keyedMap=Zc(),this.sortedSet=new fa(this.comparator)}static emptySet(e){return new Rf(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Rf))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Rf;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Of{constructor(){this.Cu=new fa(ao.comparator)}track(e){const t=e.doc.key,n=this.Cu.get(t);n?0!==e.type&&3===n.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==n.type?this.Cu=this.Cu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Cu=this.Cu.remove(t):1===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):Ms():this.Cu=this.Cu.insert(t,e)}xu(){const e=[];return this.Cu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Pf{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new Pf(e,t,Rf.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&zc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Lf{constructor(){this.Nu=void 0,this.listeners=[]}}class Mf{constructor(){this.queries=new Qc((e=>$c(e)),zc),this.onlineState="Unknown",this.ku=new Set}}async function Ff(e,t){const n=Vs(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Lf),i)try{s.Nu=await n.onListen(r)}catch(e){const n=Nf(e,`Initialization of query '${Kc(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.Mu(n.onlineState),s.Nu&&t.$u(s.Nu)&&jf(n)}async function Vf(e,t){const n=Vs(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Uf(e,t){const n=Vs(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.$u(e)&&(r=!0);i.Nu=e}}r&&jf(n)}function Bf(e,t,n){const r=Vs(e),i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}function jf(e){e.ku.forEach((e=>{e.next()}))}class qf{constructor(e,t,n){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Pf(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Ku||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){if(e.docChanges.length>0)return!0;const t=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Uu(e){e=Pf.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class zf{constructor(e){this.key=e}}class $f{constructor(e){this.key=e}}class Kf{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=ou(),this.mutatedKeys=ou(),this.tc=Hc(e),this.ec=new Rf(this.tc)}get nc(){return this.Yu}sc(e,t){const n=t?t.ic:new Of,r=t?t.ec:this.ec;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=Gc(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.rc(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.tc(l,a)>0||c&&this.tc(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ec:s,ic:n,zi:o,mutatedKeys:i}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const i=e.ic.xu();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ms()}};return n(e)-n(t)}(e.type,t.type)||this.tc(e.doc,t.doc))),this.oc(n);const s=t?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return this.Xu=o,0!==i.length||a?{snapshot:new Pf(this.query,e.ec,r,i,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:s}:{cc:s}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new Of,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach((e=>this.Yu=this.Yu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Yu=this.Yu.delete(e))),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=ou(),this.ec.forEach((e=>{this.ac(e.key)&&(this.Zu=this.Zu.add(e.key))}));const t=[];return e.forEach((e=>{this.Zu.has(e)||t.push(new $f(e))})),this.Zu.forEach((n=>{e.has(n)||t.push(new zf(n))})),t}hc(e){this.Yu=e.ir,this.Zu=ou();const t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return Pf.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class Gf{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Hf{constructor(e){this.key=e,this.fc=!1}}class Wf{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.dc={},this.wc=new Qc((e=>$c(e)),zc),this._c=new Map,this.mc=new Set,this.gc=new fa(ao.comparator),this.yc=new Map,this.Ic=new fd,this.Tc={},this.Ec=new Map,this.Ac=zh.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function Qf(e,t){const n=function(e){const t=Vs(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Yf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=hp.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Zf.bind(null,t),t.dc.nu=Uf.bind(null,t.eventManager),t.dc.Pc=Bf.bind(null,t.eventManager),t}(e);let r,i;const s=n.wc.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.lc();else{const e=await function(e,t){const n=Vs(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Bs.getTargetData(e,t).next((i=>i?(r=i,bo.resolve(r)):n.Bs.allocateTargetId(e).next((i=>(r=new jl(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Bs.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.Ji.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(e.targetId,e),n.Yi.set(t,e.targetId)),e}))}(n.localStore,Bc(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await async function(e,t,n,r,i){e.Rc=(t,n,r)=>async function(e,t,n,r){let i=t.view.sc(n);i.zi&&(i=await Md(e.localStore,t.query,!1).then((({documents:e})=>t.view.sc(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return op(e,t.targetId,o.cc),o.snapshot}(e,t,n,r);const s=await Md(e.localStore,t,!0),o=new Kf(t,s.ir),a=o.sc(s.documents),c=tl.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);op(e,n,u.cc);const l=new Gf(t,n,o);return e.wc.set(t,l),e._c.has(n)?e._c.get(n).push(t):e._c.set(n,[t]),u.snapshot}(n,t,r,"current"===s,e.resumeToken),n.isPrimaryClient&&sf(n.remoteStore,e)}return i}async function Xf(e,t){const n=Vs(e),r=n.wc.get(t),i=n._c.get(r.targetId);if(i.length>1)return n._c.set(r.targetId,i.filter((e=>!zc(e,t)))),void n.wc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Ld(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),of(n.remoteStore,r.targetId),ip(n,r.targetId)})).catch(wo)):(ip(n,r.targetId),await Ld(n.localStore,r.targetId,!0))}async function Yf(e,t){const n=Vs(e);try{const e=await function(e,t){const n=Vs(e),r=t.snapshotVersion;let i=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Zi.newChangeBuffer({trackRemovals:!0});i=n.Ji;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Bs.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Bs.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(Ia.EMPTY_BYTE_STRING,no.min()).withLastLimboFreeSnapshotVersion(no.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Bs.updateTargetData(e,u))}));let a=Yc(),c=ou();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(function(e,t,n){let r=ou(),i=ou();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=Yc();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(no.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):Rs("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{nr:r,sr:i}}))}(e,s,t.documentUpdates).next((e=>{a=e.nr,c=e.sr}))),!r.isEqual(no.min())){const t=n.Bs.getLastRemoteSnapshotVersion(e).next((t=>n.Bs.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return bo.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.Ji=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.yc.get(t);r&&(Fs(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.fc=!0:e.modifiedDocuments.size>0?Fs(r.fc):e.removedDocuments.size>0&&(Fs(r.fc),r.fc=!1))})),await up(n,e,t)}catch(e){await wo(e)}}function Jf(e,t,n){const r=Vs(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.wc.forEach(((n,r)=>{const i=r.view.Mu(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=Vs(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.Mu(t)&&(r=!0)})),r&&jf(n)}(r.eventManager,t),e.length&&r.dc.nu(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Zf(e,t,n){const r=Vs(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.yc.get(t),s=i&&i.key;if(s){let e=new fa(ao.comparator);e=e.insert(s,ec.newNoDocument(s,no.min()));const n=ou().add(s),i=new el(no.min(),new Map,new fa(Js),e,n);await Yf(r,i),r.gc=r.gc.remove(s),r.yc.delete(t),cp(r)}else await Ld(r.localStore,t,!1).then((()=>ip(r,t,n))).catch(wo)}async function ep(e,t){const n=Vs(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Vs(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.Zi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=bo.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);Fs(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=ou();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);rp(n,r,null),np(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await up(n,e)}catch(e){await wo(e)}}async function tp(e,t,n){const r=Vs(e);try{const e=await function(e,t){const n=Vs(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(Fs(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);rp(r,t,n),np(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await up(r,e)}catch(n){await wo(n)}}function np(e,t){(e.Ec.get(t)||[]).forEach((e=>{e.resolve()})),e.Ec.delete(t)}function rp(e,t,n){const r=Vs(e);let i=r.Tc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Tc[r.currentUser.toKey()]=i}}function ip(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e._c.get(t))e.wc.delete(r),n&&e.dc.Pc(r,n);e._c.delete(t),e.isPrimaryClient&&e.Ic.Is(t).forEach((t=>{e.Ic.containsKey(t)||sp(e,t)}))}function sp(e,t){e.mc.delete(t.path.canonicalString());const n=e.gc.get(t);null!==n&&(of(e.remoteStore,n),e.gc=e.gc.remove(t),e.yc.delete(n),cp(e))}function op(e,t,n){for(const r of n)r instanceof zf?(e.Ic.addReference(r.key,t),ap(e,r)):r instanceof $f?(Rs("SyncEngine","Document no longer in limbo: "+r.key),e.Ic.removeReference(r.key,t),e.Ic.containsKey(r.key)||sp(e,r.key)):Ms()}function ap(e,t){const n=t.key,r=n.path.canonicalString();e.gc.get(n)||e.mc.has(r)||(Rs("SyncEngine","New document in limbo: "+n),e.mc.add(r),cp(e))}function cp(e){for(;e.mc.size>0&&e.gc.size<e.maxConcurrentLimboResolutions;){const t=e.mc.values().next().value;e.mc.delete(t);const n=new ao(io.fromString(t)),r=e.Ac.next();e.yc.set(r,new Hf(n)),e.gc=e.gc.insert(n,r),sf(e.remoteStore,new jl(Bc(Pc(n.path)),r,"TargetPurposeLimboResolution",Ro.ct))}}async function up(e,t,n){const r=Vs(e),i=[],s=[],o=[];r.wc.isEmpty()||(r.wc.forEach(((e,a)=>{o.push(r.Rc(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=Ad.Li(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.dc.nu(i),await async function(e,t){const n=Vs(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>bo.forEach(t,(t=>bo.forEach(t.Fi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>bo.forEach(t.Bi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!So(e))throw e;Rs("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ji.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.Ji=n.Ji.insert(t,i)}}}(r.localStore,s))}async function lp(e,t){const n=Vs(e);if(!n.currentUser.isEqual(t)){Rs("SyncEngine","User change. New user:",t.toKey());const e=await Rd(n.localStore,t);n.currentUser=t,function(e){e.Ec.forEach((e=>{e.forEach((e=>{e.reject(new Bs(Us.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ec.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await up(n,e.er)}}function hp(e,t){const n=Vs(e),r=n.yc.get(t);if(r&&r.fc)return ou().add(r.key);{let e=ou();const r=n._c.get(t);if(!r)return e;for(const t of r){const r=n.wc.get(t);e=e.unionWith(r.view.nc)}return e}}function dp(e){const t=Vs(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=ep.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=tp.bind(null,t),t}class fp{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Wd(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Nd(this.persistence,new Dd,e.initialUser,this.serializer)}createPersistence(e){return new wd(Id.zs,this.serializer)}createSharedClientState(e){return new Vd}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class pp extends fp{constructor(e,t,n){super(),this.Vc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Vc.initialize(this,e),await dp(this.Vc.syncEngine),await vf(this.Vc.remoteStore),await this.persistence.Ii((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}createLocalStore(e){return Nd(this.persistence,new Dd,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new Xh(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new No(t,this.persistence);return new xo(e.asyncQueue,n)}createPersistence(e){const t=function(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Lh.withCacheSize(this.cacheSizeBytes):Lh.DEFAULT;return new Sd(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,"undefined"!=typeof window?window:null,Hd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Vd}}class mp{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Jf(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=lp.bind(null,this.syncEngine),await async function(e,t){const n=Vs(e);t?(n.vu.delete(2),await nf(n)):t||(n.vu.add(2),await rf(n),n.bu.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Mf}createDatastore(e){const t=Wd(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new Gd(r));var r;return function(e,t,n,r){return new Zd(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Jf(this.syncEngine,e,0),s=Bd.D()?new Bd:new Ud,new tf(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Wf(e,t,n,r,i,s);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Vs(e);Rs("RemoteStore","RemoteStore shutting down."),t.vu.add(5),await rf(t),t.Pu.shutdown(),t.bu.set("Unknown")}(this.remoteStore)}}class gp{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):Os("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class yp{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=As.UNAUTHENTICATED,this.clientId=Ys.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{Rs("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(Rs("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Bs(Us.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new js;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Nf(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function vp(e,t){e.asyncQueue.verifyOperationInProgress(),Rs("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Rd(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function wp(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Rs("FirestoreClient","Using user provided OfflineComponentProvider");try{await vp(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!bp(n))throw n;Ps("Error using user provided cache. Falling back to memory cache: "+n),await vp(e,new fp)}}else Rs("FirestoreClient","Using default OfflineComponentProvider"),await vp(e,new fp);return e._offlineComponents}(e);Rs("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>kf(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>kf(t.remoteStore,n))),e._onlineComponents=t}function bp(e){return"FirebaseError"===e.name?e.code===Us.FAILED_PRECONDITION||e.code===Us.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function Ip(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Rs("FirestoreClient","Using user provided OnlineComponentProvider"),await wp(e,e._uninitializedComponentsProvider._online)):(Rs("FirestoreClient","Using default OnlineComponentProvider"),await wp(e,new mp))),e._onlineComponents}async function Ep(e){const t=await Ip(e),n=t.eventManager;return n.onListen=Qf.bind(null,t.syncEngine),n.onUnlisten=Xf.bind(null,t.syncEngine),n}function Tp(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const _p=new Map;function Sp(e,t,n){if(!n)throw new Bs(Us.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Cp(e){if(!ao.isDocumentKey(e))throw new Bs(Us.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function kp(e){if(ao.isDocumentKey(e))throw new Bs(Us.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Ap(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Ms()}function Dp(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Bs(Us.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Ap(e);throw new Bs(Us.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class xp{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new Bs(Us.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Bs(Us.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new Bs(Us.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Tp(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Bs(Us.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new Bs(Us.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new Bs(Us.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class Np{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new xp({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Bs(Us.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Bs(Us.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new xp(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new zs;switch(e.type){case"firstParty":return new Hs(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Bs(Us.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=_p.get(e);t&&(Rs("ComponentProvider","Removing Datastore"),_p.delete(e),t.terminate())}(this),Promise.resolve()}}class Rp{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Pp(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Rp(this.firestore,e,this._key)}}class Op{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Op(this.firestore,e,this._query)}}class Pp extends Op{constructor(e,t,n){super(e,t,Pc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Rp(this.firestore,null,new ao(e))}withConverter(e){return new Pp(this.firestore,e,this._path)}}function Lp(e,t,...n){if(e=M(e),Sp("collection","path",t),e instanceof Np){const r=io.fromString(t,...n);return kp(r),new Pp(e,null,r)}{if(!(e instanceof Rp||e instanceof Pp))throw new Bs(Us.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(io.fromString(t,...n));return kp(r),new Pp(e.firestore,null,r)}}function Mp(e,t,...n){if(e=M(e),1===arguments.length&&(t=Ys.A()),Sp("doc","path",t),e instanceof Np){const r=io.fromString(t,...n);return Cp(r),new Rp(e,null,new ao(r))}{if(!(e instanceof Rp||e instanceof Pp))throw new Bs(Us.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(io.fromString(t,...n));return Cp(r),new Rp(e.firestore,e instanceof Pp?e.converter:null,new ao(r))}}class Fp{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new Qd(this,"async_queue_retry"),this.Xc=()=>{const e=Hd();e&&Rs("AsyncQueue","Visibility state changed to "+e.visibilityState),this.qo.Mo()};const e=Hd();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const t=Hd();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise((()=>{}));const t=new js;return this.ta((()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Qc.push(e),this.ea())))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!So(e))throw e;Rs("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No((()=>this.ea()))}}ta(e){const t=this.Gc.then((()=>(this.Hc=!0,e().catch((e=>{this.Wc=e,this.Hc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Os("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Hc=!1,e))))));return this.Gc=t,t}enqueueAfterDelay(e,t,n){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);const r=xf.createAndSchedule(this,e,t,n,(e=>this.na(e)));return this.zc.push(r),r}Zc(){this.Wc&&Ms()}verifyOperationInProgress(){}async sa(){let e;do{e=this.Gc,await e}while(e!==this.Gc)}ia(e){for(const t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then((()=>{this.zc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.zc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()}))}oa(e){this.Yc.push(e)}na(e){const t=this.zc.indexOf(e);this.zc.splice(t,1)}}class Vp extends Np{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Fp,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Bp(this),this._firestoreClient.terminate()}}function Up(e){return e._firestoreClient||Bp(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Bp(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new Da(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Tp(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new yp(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.cache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.cache.kind,_offline:i.cache._offlineComponentProvider,_online:i.cache._onlineComponentProvider})}class jp{constructor(e){this._byteString=e}static fromBase64String(e){try{return new jp(Ia.fromBase64String(e))}catch(e){throw new Bs(Us.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new jp(Ia.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class qp{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Bs(Us.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new oo(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class zp{constructor(e){this._methodName=e}}class $p{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Bs(Us.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Bs(Us.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Js(this._lat,e._lat)||Js(this._long,e._long)}}const Kp=/^__.*__$/;class Gp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Pu(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ou(e,this.data,t,this.fieldTransforms)}}class Hp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Pu(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Wp(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ms()}}class Qp{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.ua(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new Qp(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.fa(e),r}da(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.ua(),r}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return um(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(Wp(this.ca)&&Kp.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class Xp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Wd(e)}ya(e,t,n,r=!1){return new Qp({ca:e,methodName:t,ga:n,path:oo.emptyPath(),la:!1,ma:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Yp(e){const t=e._freezeSettings(),n=Wd(e._databaseId);return new Xp(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Jp(e,t,n,r,i,s={}){const o=e.ya(s.merge||s.mergeFields?2:0,t,n,i);sm("Data must be an object, but it was:",o,r);const a=rm(r,o);let c,u;if(s.merge)c=new wa(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=om(t,r,n);if(!o.contains(i))throw new Bs(Us.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);lm(e,i)||e.push(i)}c=new wa(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new Gp(new Ja(a),c,u)}class Zp extends zp{_toFieldTransform(e){if(2!==e.ca)throw 1===e.ca?e._a(`${this._methodName}() can only appear at the top level of your update data`):e._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Zp}}class em extends zp{_toFieldTransform(e){return new Tu(e.path,new mu)}isEqual(e){return e instanceof em}}function tm(e,t,n,r=!1){return nm(n,e.ya(r?4:3,t))}function nm(e,t){if(im(e=M(e)))return sm("Unsupported field value:",t,e),rm(e,t);if(e instanceof zp)return function(e,t){if(!Wp(t.ca))throw t._a(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t._a(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.la&&4!==t.ca)throw t._a("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=nm(i,t.wa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=M(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return lu(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=to.fromDate(e);return{timestampValue:pl(t.serializer,n)}}if(e instanceof to){const n=new to(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:pl(t.serializer,n)}}if(e instanceof $p)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof jp)return{bytesValue:ml(t.serializer,e._byteString)};if(e instanceof Rp){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t._a(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:vl(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t._a(`Unsupported field value: ${Ap(e)}`)}(e,t)}function rm(e,t){const n={};return da(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ha(e,((e,r)=>{const i=nm(r,t.ha(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function im(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof to||e instanceof $p||e instanceof jp||e instanceof Rp||e instanceof zp)}function sm(e,t,n){if(!im(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Ap(n);throw"an object"===r?t._a(e+" a custom object"):t._a(e+" "+r)}}function om(e,t,n){if((t=M(t))instanceof qp)return t._internalPath;if("string"==typeof t)return cm(e,t);throw um("Field path arguments must be of type string or ",e,!1,void 0,n)}const am=new RegExp("[~\\*/\\[\\]]");function cm(e,t,n){if(t.search(am)>=0)throw um(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new qp(...t.split("."))._internalPath}catch(r){throw um(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function um(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Bs(Us.INVALID_ARGUMENT,a+e+c)}function lm(e,t){return e.some((e=>e.isEqual(t)))}class hm{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Rp(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new dm(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(fm("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class dm extends hm{data(){return super.data()}}function fm(e,t){return"string"==typeof t?cm(e,t):t instanceof qp?t._internalPath:t._delegate._internalPath}class pm{}class mm extends pm{}function gm(e,t,...n){let r=[];t instanceof pm&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof wm)).length,n=e.filter((e=>e instanceof ym)).length;if(t>1||t>0&&n>0)throw new Bs(Us.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class ym extends mm{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new ym(e,t,n)}_apply(e){const t=this._parse(e);return Cm(e._query,t),new Op(e.firestore,e.converter,jc(e._query,t))}_parse(e){const t=Yp(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Bs(Us.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Sm(o,s);const t=[];for(const n of o)t.push(_m(r,e,n));a={arrayValue:{values:t}}}else a=_m(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Sm(o,s),a=tm(n,"where",o,"in"===s||"not-in"===s);return ac.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function vm(e,t,n){const r=t,i=fm("where",e);return ym._create(i,r,n)}class wm extends pm{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new wm(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:cc.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)Cm(n,e),n=jc(n,e)}(e._query,t),new Op(e.firestore,e.converter,jc(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class bm extends mm{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new bm(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new Bs(Us.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Bs(Us.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new ic(t,n);return function(e,t){if(null===Mc(e)){const n=Fc(e);null!==n&&km(0,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new Op(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Oc(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class Im extends mm{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Im(e,t,n)}_apply(e){return new Op(e.firestore,e.converter,qc(e._query,this._limit,this._limitType))}}function Em(e){return function(e,t){if(t<=0)throw new Bs(Us.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}("limit",e),Im._create("limit",e,"F")}class Tm extends mm{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Tm(e,t,n)}_apply(e){const t=function(e,t,n,r){if(n[0]=M(n[0]),n[0]instanceof hm)return function(e,t,n,r,i){if(!r)throw new Bs(Us.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Uc(e))if(n.field.isKeyField())s.push(Ba(t,r.key));else{const e=r.data.field(n.field);if(Ca(e))throw new Bs(Us.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new Bs(Us.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new tc(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=Yp(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new Bs(Us.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const c=i[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new Bs(Us.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Vc(e)&&-1!==c.indexOf("/"))throw new Bs(Us.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(io.fromString(c));if(!ao.isDocumentKey(n))throw new Bs(Us.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new ao(n);a.push(Ba(t,i))}else{const e=tm(n,r,c);a.push(e)}}return new tc(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}(e,this.type,this._docOrFields,this._inclusive);return new Op(e.firestore,e.converter,function(e,t){return new Oc(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}function _m(e,t,n){if("string"==typeof(n=M(n))){if(""===n)throw new Bs(Us.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Vc(t)&&-1!==n.indexOf("/"))throw new Bs(Us.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(io.fromString(n));if(!ao.isDocumentKey(r))throw new Bs(Us.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ba(e,new ao(r))}if(n instanceof Rp)return Ba(e,n._key);throw new Bs(Us.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ap(n)}.`)}function Sm(e,t){if(!Array.isArray(e)||0===e.length)throw new Bs(Us.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Cm(e,t){if(t.isInequality()){const n=Fc(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new Bs(Us.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);const i=Mc(e);null!==i&&km(0,r,i)}const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new Bs(Us.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Bs(Us.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function km(e,t,n){if(!n.isEqual(t))throw new Bs(Us.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Am{convertValue(e,t="none"){switch(Oa(e)){case 0:return null;case 1:return e.booleanValue;case 2:return _a(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Sa(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Ms()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return ha(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new $p(_a(e.latitude),_a(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=ka(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Aa(e));default:return null}}convertTimestamp(e){const t=Ta(e);return new to(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=io.fromString(e);Fs(Bl(n));const r=new xa(n.get(1),n.get(3)),i=new ao(n.popFirst(5));return r.isEqual(t)||Os(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Dm(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class xm{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Nm extends hm{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Rm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(fm("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Rm extends Nm{data(e={}){return super.data(e)}}class Om{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new xm(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Rm(this._firestore,this._userDataWriter,n.key,n,new xm(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Bs(Us.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new Rm(e._firestore,e._userDataWriter,n.doc.key,n.doc,new xm(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new Rm(e._firestore,e._userDataWriter,t.doc.key,t.doc,new xm(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Pm(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Pm(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ms()}}function Lm(e){e=Dp(e,Rp);const t=Dp(e.firestore,Vp);return function(e,t,n={}){const r=new js;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new gp({next:s=>{t.enqueueAndForget((()=>Vf(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new Bs(Us.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new Bs(Us.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new qf(Pc(n.path),s,{includeMetadataChanges:!0,Ku:!0});return Ff(e,o)}(await Ep(e),e.asyncQueue,t,n,r))),r.promise}(Up(t),e._key).then((n=>function(e,t,n){const r=n.docs.get(t._key),i=new Mm(e);return new Nm(e,i,t._key,r,new xm(n.hasPendingWrites,n.fromCache),t.converter)}(t,e,n)))}class Mm extends Am{constructor(e){super(),this.firestore=e}convertBytes(e){return new jp(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Rp(this.firestore,null,t)}}function Fm(e){e=Dp(e,Op);const t=Dp(e.firestore,Vp),n=Up(t),r=new Mm(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Bs(Us.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),function(e,t,n={}){const r=new js;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new gp({next:n=>{t.enqueueAndForget((()=>Vf(e,o))),n.fromCache&&"server"===r.source?i.reject(new Bs(Us.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new qf(n,s,{includeMetadataChanges:!0,Ku:!0});return Ff(e,o)}(await Ep(e),e.asyncQueue,t,n,r))),r.promise}(n,e._query).then((n=>new Om(t,r,e,n)))}function Vm(e,t,n,...r){e=Dp(e,Rp);const i=Dp(e.firestore,Vp),s=Yp(i);let o;return o="string"==typeof(t=M(t))||t instanceof qp?function(e,t,n,r,i,s){const o=e.ya(1,t,n),a=[om(t,r,n)],c=[i];if(s.length%2!=0)throw new Bs(Us.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(om(t,s[e])),c.push(s[e+1]);const u=[],l=Ja.empty();for(let e=a.length-1;e>=0;--e)if(!lm(u,a[e])){const t=a[e];let n=c[e];n=M(n);const r=o.da(t);if(n instanceof Zp)u.push(t);else{const e=nm(n,r);null!=e&&(u.push(t),l.set(t,e))}}const h=new wa(u);return new Hp(l,h,o.fieldTransforms)}(s,"updateDoc",e._key,t,n,r):function(e,t,n,r){const i=e.ya(1,t,n);sm("Data must be an object, but it was:",i,r);const s=[],o=Ja.empty();ha(r,((e,r)=>{const a=cm(t,e,n);r=M(r);const c=i.da(a);if(r instanceof Zp)s.push(a);else{const e=nm(r,c);null!=e&&(s.push(a),o.set(a,e))}}));const a=new wa(s);return new Hp(o,a,i.fieldTransforms)}(s,"updateDoc",e._key,t),Bm(i,[o.toMutation(e._key,Su.exists(!0))])}function Um(e,t){const n=Dp(e.firestore,Vp),r=Mp(e),i=Dm(e.converter,t);return Bm(n,[Jp(Yp(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Su.exists(!1))]).then((()=>r))}function Bm(e,t){return function(e,t){const n=new js;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=dp(e);try{const e=await function(e,t){const n=Vs(e),r=to.now(),i=t.reduce(((e,t)=>e.add(t.key)),ou());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=Yc(),c=ou();return n.Zi.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=Nu(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Pu(e.key,t,Za(t.value.mapValue),Su.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:eu(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Tc[e.currentUser.toKey()];r||(r=new fa(Js)),r=r.insert(t,n),e.Tc[e.currentUser.toKey()]=r}(r,e.batchId,n),await up(r,e.changes),await vf(r.remoteStore)}catch(e){const t=Nf(e,"Failed to persist write");n.reject(t)}}(await function(e){return Ip(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(Up(e),t)}function jm(){return new em("serverTimestamp")}function qm(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}!function(e,t=!0){!function(e){Ds=e}(He),ze(new F("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new Vp(new Ks(e.getProvider("auth-internal")),new Qs(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Bs(Us.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xa(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Xe(ks,"3.13.0",e),Xe(ks,"3.13.0","esm2017")}(),Xe("firebase","9.23.0","app"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const zm=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},$m=new C("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Km=new H("@firebase/auth");function Gm(e,...t){Km.logLevel<=q.ERROR&&Km.error(`Auth (${He}): ${e}`,...t)}function Hm(e,...t){throw Qm(e,...t)}function Wm(e,...t){return Qm(e,...t)}function Qm(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return $m.create(e,...t)}function Xm(e,t,...n){if(!e)throw Qm(t,...n)}function Ym(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Gm(t),new Error(t)}function Jm(e,t){e||Ym(t)}function Zm(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function eg(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class tg{constructor(e,t){this.shortDelay=e,this.longDelay=t,Jm(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(b())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===eg()||"https:"===eg()||E()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function ng(e,t){Jm(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class rg{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void Ym("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void Ym("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void Ym("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const ig={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},sg=new tg(3e4,6e4);function og(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function ag(e,t,n,r,i={}){return cg(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=x(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),rg.fetch()(lg(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))}async function cg(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},ig),t);try{const t=new hg(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw dg(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw dg(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw dg(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw dg(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw function(e,t,n){const r=Object.assign(Object.assign({},zm()),{[t]:n});return new C("auth","Firebase",r).create(t,{appName:e.name})}(e,a,o);Hm(e,a)}}catch(t){if(t instanceof S)throw t;Hm(e,"network-request-failed",{message:String(t)})}}async function ug(e,t,n,r,i={}){const s=await ag(e,t,n,r,i);return"mfaPendingCredential"in s&&Hm(e,"multi-factor-auth-required",{_serverResponse:s}),s}function lg(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?ng(e.config,i):`${e.config.apiScheme}://${i}`}class hg{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Wm(this.auth,"network-request-failed"))),sg.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function dg(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Wm(e,t,r);return i.customData._tokenResponse=n,i}function fg(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function pg(e){return 1e3*Number(e)}function mg(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return Gm("JWT malformed, contained fewer than 3 sections"),null;try{const e=d(n);return e?JSON.parse(e):(Gm("Failed to decode base64 JWT payload"),null)}catch(e){return Gm("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function gg(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof S&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class yg{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class vg{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=fg(this.lastLoginAt),this.creationTime=fg(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function wg(e){var t;const n=e.auth,r=await e.getIdToken(),i=await gg(e,async function(e,t){return ag(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));Xm(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=qm(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new vg(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class bg{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Xm(e.idToken,"internal-error"),Xm(void 0!==e.idToken,"internal-error"),Xm(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=mg(e);return Xm(t,"internal-error"),Xm(void 0!==t.exp,"internal-error"),Xm(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return Xm(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await cg(e,{},(async()=>{const n=x({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=lg(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",rg.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new bg;return n&&(Xm("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(Xm("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(Xm("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new bg,this.toJSON())}_performRefresh(){return Ym("not implemented")}}function Ig(e,t){Xm("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Eg{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=qm(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new yg(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new vg(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await gg(this,this.stsTokenManager.getToken(this.auth,e));return Xm(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=M(e),r=await n.getIdToken(t),i=mg(r);Xm(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:fg(pg(i.auth_time)),issuedAtTime:fg(pg(i.iat)),expirationTime:fg(pg(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=M(e);await wg(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Xm(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Eg(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Xm(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await wg(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await gg(this,async function(e,t){return ag(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:b,providerData:I,stsTokenManager:E}=t;Xm(v&&E,e,"internal-error");const T=bg.fromJSON(this.name,E);Xm("string"==typeof v,e,"internal-error"),Ig(l,e.name),Ig(h,e.name),Xm("boolean"==typeof w,e,"internal-error"),Xm("boolean"==typeof b,e,"internal-error"),Ig(d,e.name),Ig(f,e.name),Ig(p,e.name),Ig(m,e.name),Ig(g,e.name),Ig(y,e.name);const _=new Eg({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:b,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:y});return I&&Array.isArray(I)&&(_.providerData=I.map((e=>Object.assign({},e)))),m&&(_._redirectEventId=m),_}static async _fromIdTokenResponse(e,t,n=!1){const r=new bg;r.updateFromServerResponse(t);const i=new Eg({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await wg(i),i}}const Tg=new Map;function _g(e){Jm(e instanceof Function,"Expected a class definition");let t=Tg.get(e);return t?(Jm(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Tg.set(e,t),t)}class Sg{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Sg.type="NONE";const Cg=Sg;function kg(e,t,n){return`firebase:${e}:${t}:${n}`}class Ag{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=kg(this.userKey,r.apiKey,i),this.fullPersistenceKey=kg("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Eg._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Ag(_g(Cg),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||_g(Cg);const s=kg(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=Eg._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new Ag(i,e,n)):new Ag(i,e,n)}}function Dg(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Og(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(xg(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Lg(t))return"Blackberry";if(Mg(t))return"Webos";if(Ng(t))return"Safari";if((t.includes("chrome/")||Rg(t))&&!t.includes("edge/"))return"Chrome";if(Pg(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function xg(e=b()){return/firefox\//i.test(e)}function Ng(e=b()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Rg(e=b()){return/crios\//i.test(e)}function Og(e=b()){return/iemobile/i.test(e)}function Pg(e=b()){return/android/i.test(e)}function Lg(e=b()){return/blackberry/i.test(e)}function Mg(e=b()){return/webos/i.test(e)}function Fg(e=b()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Vg(e=b()){return Fg(e)||Pg(e)||Mg(e)||Lg(e)||/windows phone/i.test(e)||Og(e)}function Ug(e,t=[]){let n;switch(e){case"Browser":n=Dg(b());break;case"Worker":n=`${Dg(b())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${He}/${r}`}async function Bg(e,t){return ag(e,"GET","/v2/recaptchaConfig",og(e,t))}function jg(e){return void 0!==e&&void 0!==e.enterprise}class qg{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some((e=>"EMAIL_PASSWORD_PROVIDER"===e.provider&&"OFF"!==e.enforcementState))}}function zg(e){return new Promise(((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=Wm("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)}))}function $g(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Kg{constructor(e){this.type="recaptcha-enterprise",this.auth=Qg(e)}async verify(e="verify",t=!1){function n(t,n,r){const i=window.grecaptcha;jg(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{Bg(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new qg(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&jg(window.grecaptcha))n(i,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));zg("https://www.google.com/recaptcha/enterprise.js?render="+i).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function Gg(e,t,n,r=!1){const i=new Kg(e);let s;try{s=await i.verify(n)}catch(e){s=await i.verify(n,!0)}const o=Object.assign({},t);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}class Hg{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Wg{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Xg(this),this.idTokenSubscription=new Xg(this),this.beforeStateQueue=new Hg(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=$m,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=_g(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await Ag.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Xm(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await wg(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?M(e):null;return t&&Xm(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Xm(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(_g(e))}))}async initializeRecaptchaConfig(){const e=await Bg(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),t=new qg(e);null==this.tenantId?this._agentRecaptchaConfig=t:this._tenantRecaptchaConfigs[this.tenantId]=t,t.emailPasswordEnabled&&new Kg(this).verify()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new C("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&_g(e)||this._popupRedirectResolver;Xm(t,this,"argument-error"),this.redirectPersistenceManager=await Ag.create(this,[_g(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return Xm(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Xm(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ug(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Km.logLevel<=q.WARN&&Km.warn(`Auth (${He}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Qg(e){return M(e)}class Xg{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e){const t=new O(e,void 0);return t.subscribe.bind(t)}((e=>this.observer=e))}get next(){return Xm(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Yg(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Jg(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Zg{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ym("not implemented")}_getIdTokenResponse(e){return Ym("not implemented")}_linkToIdToken(e,t){return Ym("not implemented")}_getReauthenticationResolver(e){return Ym("not implemented")}}async function ey(e,t){return ug(e,"POST","/v1/accounts:signInWithPassword",og(e,t))}class ty extends Zg{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new ty(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new ty(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){var t;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null===(t=e._getRecaptchaConfig())||void 0===t?void 0:t.emailPasswordEnabled){const t=await Gg(e,n,"signInWithPassword");return ey(e,t)}return ey(e,n).catch((async t=>{if("auth/missing-recaptcha-token"===t.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const t=await Gg(e,n,"signInWithPassword");return ey(e,t)}return Promise.reject(t)}));case"emailLink":return async function(e,t){return ug(e,"POST","/v1/accounts:signInWithEmailLink",og(e,t))}(e,{email:this._email,oobCode:this._password});default:Hm(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return async function(e,t){return ag(e,"POST","/v1/accounts:update",t)}(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return ug(e,"POST","/v1/accounts:signInWithEmailLink",og(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Hm(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function ny(e,t){return ug(e,"POST","/v1/accounts:signInWithIdp",og(e,t))}class ry extends Zg{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ry(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Hm("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=qm(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new ry(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return ny(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,ny(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ny(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=x(t)}return e}}const iy={USER_NOT_FOUND:"user-not-found"};class sy extends Zg{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new sy({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new sy({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return ug(e,"POST","/v1/accounts:signInWithPhoneNumber",og(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await ug(e,"POST","/v1/accounts:signInWithPhoneNumber",og(e,t));if(n.temporaryProof)throw dg(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return ug(e,"POST","/v1/accounts:signInWithPhoneNumber",og(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),iy)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new sy({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class oy{constructor(e){var t,n,r,i,s,o;const a=N(R(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);Xm(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=N(R(e)).link,n=t?N(R(t)).deep_link_id:null,r=N(R(e)).deep_link_id;return(r?N(R(r)).link:null)||r||n||t||e}(e);try{return new oy(t)}catch(e){return null}}}class ay{constructor(){this.providerId=ay.PROVIDER_ID}static credential(e,t){return ty._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=oy.parseLink(t);return Xm(n,"argument-error"),ty._fromEmailAndCode(e,n.code,n.tenantId)}}ay.PROVIDER_ID="password",ay.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ay.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class cy{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class uy extends cy{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ly extends uy{constructor(){super("facebook.com")}static credential(e){return ry._fromParams({providerId:ly.PROVIDER_ID,signInMethod:ly.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ly.credentialFromTaggedObject(e)}static credentialFromError(e){return ly.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return ly.credential(e.oauthAccessToken)}catch(e){return null}}}ly.FACEBOOK_SIGN_IN_METHOD="facebook.com",ly.PROVIDER_ID="facebook.com";class hy extends uy{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ry._fromParams({providerId:hy.PROVIDER_ID,signInMethod:hy.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return hy.credentialFromTaggedObject(e)}static credentialFromError(e){return hy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return hy.credential(t,n)}catch(e){return null}}}hy.GOOGLE_SIGN_IN_METHOD="google.com",hy.PROVIDER_ID="google.com";class dy extends uy{constructor(){super("github.com")}static credential(e){return ry._fromParams({providerId:dy.PROVIDER_ID,signInMethod:dy.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return dy.credentialFromTaggedObject(e)}static credentialFromError(e){return dy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return dy.credential(e.oauthAccessToken)}catch(e){return null}}}dy.GITHUB_SIGN_IN_METHOD="github.com",dy.PROVIDER_ID="github.com";class fy extends uy{constructor(){super("twitter.com")}static credential(e,t){return ry._fromParams({providerId:fy.PROVIDER_ID,signInMethod:fy.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return fy.credentialFromTaggedObject(e)}static credentialFromError(e){return fy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return fy.credential(t,n)}catch(e){return null}}}fy.TWITTER_SIGN_IN_METHOD="twitter.com",fy.PROVIDER_ID="twitter.com";class py{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await Eg._fromIdTokenResponse(e,n,r),s=my(n);return new py({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=my(n);return new py({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function my(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class gy extends S{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,gy.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new gy(e,t,n,r)}}function yy(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw gy._fromErrorAndOperation(e,n,t,r);throw n}))}new WeakMap;const vy="__sak";class wy{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(vy,"1"),this.storage.removeItem(vy),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class by extends wy{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=b();return Ng(e)||Fg(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Vg(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);!function(){const e=b();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||i===e.newValue||e.newValue===e.oldValue?r():setTimeout(r,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}by.type="LOCAL";const Iy=by;class Ey extends wy{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Ey.type="SESSION";const Ty=Ey;class _y{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new _y(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Sy(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}_y.receivers=[];class Cy{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=Sy("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function ky(){return window}function Ay(){return void 0!==ky().WorkerGlobalScope&&"function"==typeof ky().importScripts}const Dy="firebaseLocalStorageDb",xy="firebaseLocalStorage",Ny="fbase_key";class Ry{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Oy(e,t){return e.transaction([xy],t?"readwrite":"readonly").objectStore(xy)}function Py(){const e=indexedDB.open(Dy,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(xy,{keyPath:Ny})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(xy)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Dy);return new Ry(e).toPromise()}(),t(await Py()))}))}))}async function Ly(e,t,n){const r=Oy(e,!0).put({[Ny]:t,value:n});return new Ry(r).toPromise()}function My(e,t){const n=Oy(e,!0).delete(t);return new Ry(n).toPromise()}class Fy{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Py()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ay()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=_y._getInstance(Ay()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Cy(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}var t}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Py();return await Ly(e,vy,"1"),await My(e,vy),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Ly(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Oy(e,!1).get(t),r=await new Ry(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>My(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Oy(e,!1).getAll();return new Ry(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Fy.type="LOCAL";const Vy=Fy;$g("rcb"),new tg(3e4,6e4);class Uy{constructor(e){this.providerId=Uy.PROVIDER_ID,this.auth=Qg(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var r;const i=await n.verify();try{let s;if(Xm("string"==typeof i,e,"argument-error"),Xm("recaptcha"===n.type,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){Xm("enroll"===t.type,e,"internal-error");const n=await function(e,t){return ag(e,"POST","/v2/accounts/mfaEnrollment:start",og(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{Xm("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;Xm(n,e,"missing-multi-factor-info");const o=await function(e,t){return ag(e,"POST","/v2/accounts/mfaSignIn:start",og(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return ag(e,"POST","/v1/accounts:sendVerificationCode",og(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}(this.auth,e,M(t))}static credential(e,t){return sy._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Uy.credentialFromTaggedObject(t)}static credentialFromError(e){return Uy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?sy._fromTokenResponse(t,n):null}}Uy.PROVIDER_ID="phone",Uy.PHONE_SIGN_IN_METHOD="phone";class By extends Zg{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ny(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ny(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ny(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function jy(e){return async function(e,t,n=!1){const r="signIn",i=await yy(e,r,t),s=await py._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}(e.auth,new By(e),e.bypassAuthState)}function qy(e){const{auth:t,user:n}=e;return Xm(n,t,"internal-error"),async function(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await gg(e,yy(r,i,t,e),n);Xm(s.idToken,r,"internal-error");const o=mg(s.idToken);Xm(o,r,"internal-error");const{sub:a}=o;return Xm(e.uid===a,r,"user-mismatch"),py._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Hm(r,"user-mismatch"),e}}(n,new By(e),e.bypassAuthState)}async function zy(e){const{auth:t,user:n}=e;return Xm(n,t,"internal-error"),async function(e,t,n=!1){const r=await gg(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return py._forOperation(e,"link",r)}(n,new By(e),e.bypassAuthState)}class $y{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return jy;case"linkViaPopup":case"linkViaRedirect":return zy;case"reauthViaPopup":case"reauthViaRedirect":return qy;default:Hm(this.auth,"internal-error")}}resolve(e){Jm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Jm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Ky=new tg(2e3,1e4);class Gy extends $y{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Gy.currentPopupAction&&Gy.currentPopupAction.cancel(),Gy.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Xm(e,this.auth,"internal-error"),e}async onExecution(){Jm(1===this.filter.length,"Popup operations only handle one event");const e=Sy();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Wm(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Wm(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Gy.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Wm(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Ky.get())};e()}}Gy.currentPopupAction=null;const Hy=new Map;class Wy extends $y{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Hy.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return kg("pendingRedirect",e.config.apiKey,e.name)}(t),r=function(e){return _g(e._redirectPersistence)}(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Hy.set(this.auth._key(),e)}return this.bypassAuthState||Hy.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Qy(e,t){Hy.set(e._key(),t)}async function Xy(e,t,n=!1){const r=Qg(e),i=function(e,t){return t?_g(t):(Xm(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(r,t),s=new Wy(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class Yy{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Zy(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Zy(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Wm(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Jy(e))}saveEventToCache(e){this.cachedEventUids.add(Jy(e)),this.lastProcessedEventTime=Date.now()}}function Jy(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Zy({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const ev=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,tv=/^https?/;function nv(e){const t=Zm(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!tv.test(n))return!1;if(ev.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const rv=new tg(3e4,6e4);function iv(){const e=ky().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let sv=null;function ov(e){return sv=sv||function(e){return new Promise(((t,n)=>{var r,i,s;function o(){iv(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{iv(),n(Wm(e,"network-request-failed"))},timeout:rv.get()})}if(null===(i=null===(r=ky().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=ky().gapi)||void 0===s?void 0:s.load)){const t=$g("iframefcb");return ky()[t]=()=>{gapi.load?o():n(Wm(e,"network-request-failed"))},zg(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw sv=null,e}))}(e),sv}const av=new tg(5e3,15e3),cv={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},uv=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function lv(e){const t=e.config;Xm(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?ng(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:He},i=uv.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${x(r).slice(1)}`}const hv={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class dv{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const fv=encodeURIComponent("fac");async function pv(e,t,n,r,i,s){Xm(e.config.authDomain,e,"auth-domain-config-required"),Xm(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:He,eventId:i};if(t instanceof cy){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof uy){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),u=c?`#${fv}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?ng(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${x(a).slice(1)}${u}`}const mv="webStorageSupport",gv=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ty,this._completeRedirectFn=Xy,this._overrideRedirectResult=Qy}async _openPopup(e,t,n,r){var i;return Jm(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},hv),{width:r.toString(),height:i.toString(),top:s,left:o}),u=b().toLowerCase();n&&(a=Rg(u)?"_blank":n),xg(u)&&(t=t||"http://localhost",c.scrollbars="yes");const l=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=b()){var t;return Fg(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new dv(null);const h=window.open(t||"",a,l);Xm(h,e,"popup-blocked");try{h.focus()}catch(e){}return new dv(h)}(e,await pv(e,t,n,Zm(),r),Sy())}async _openRedirect(e,t,n,r){return await this._originValidation(e),i=await pv(e,t,n,Zm(),r),ky().location.href=i,new Promise((()=>{}));var i}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Jm(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await ov(e),n=ky().gapi;return Xm(n,e,"internal-error"),t.open({where:document.body,url:lv(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:cv,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=Wm(e,"network-request-failed"),s=ky().setTimeout((()=>{r(i)}),av.get());function o(){ky().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new Yy(e);return t.register("authEvent",(t=>(Xm(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(mv,{type:mv},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[mv];void 0!==i&&t(!!i),Hm(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return ag(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(nv(e))return}catch(e){}Hm(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Vg()||Ng()||Fg()}};var yv="@firebase/auth",vv="0.23.2";class wv{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Xm(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const bv=y("authIdTokenMaxAge")||300;let Iv=null;var Ev;Ev="Browser",ze(new F("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;Xm(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:Ev,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ug(Ev)},c=new Wg(n,r,i,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(_g);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),ze(new F("auth-internal",(e=>{return t=Qg(e.getProvider("auth").getImmediate()),new wv(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),Xe(yv,vv,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Ev)),Xe(yv,vv,"esm2017");const Tv="firebasestorage.googleapis.com",_v="storageBucket";class Sv extends S{constructor(e,t,n=0){super(Av(e),`Firebase Storage: ${t} (${Av(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Sv.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Av(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var Cv,kv;function Av(e){return"storage/"+e}function Dv(){return new Sv(Cv.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function xv(e){return new Sv(Cv.INVALID_ARGUMENT,e)}function Nv(){return new Sv(Cv.APP_DELETED,"The Firebase app was deleted.")}function Rv(e,t){return new Sv(Cv.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function Ov(e){throw new Sv(Cv.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(Cv||(Cv={}));class Pv{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Pv.makeFromUrl(e,t)}catch(t){return new Pv(e,"")}if(""===n.path)return n;throw r=e,new Sv(Cv.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)",i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${t===Tv?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<a.length;t++){const r=a[t],i=r.regex.exec(e);if(i){const e=i[r.indices.bucket];let t=i[r.indices.path];t||(t=""),n=new Pv(e,t),r.postModify(n);break}}if(null==n)throw function(e){return new Sv(Cv.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class Lv{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function Mv(e){return"string"==typeof e||e instanceof String}function Fv(e){return Vv()&&e instanceof Blob}function Vv(){return"undefined"!=typeof Blob&&!I()}function Uv(e,t,n,r){if(r<t)throw xv(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw xv(`Invalid value for '${e}'. Expected ${n} or less.`)}function Bv(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function jv(e){const t=encodeURIComponent;let n="?";for(const r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n=n.slice(0,-1),n}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(kv||(kv={}));class qv{constructor(e,t,n,r,i,s,o,a,c,u,l,h=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=l,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(e){r(e)}else if(null!==i){const e=Dv();e.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else t.canceled?r(this.appDelete_?Nv():new Sv(Cv.CANCELED,"User canceled the upload/download.")):r(new Sv(Cv.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?e(0,new zv(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,o=!1,a=0;function c(){return 2===a}let u=!1;function l(...e){u||(u=!0,t.apply(null,e))}function h(t){i=setTimeout((()=>{i=null,e(f,c())}),t)}function d(){s&&clearTimeout(s)}function f(e,...t){if(u)return void d();if(e)return d(),void l.call(null,e,...t);if(c()||o)return d(),void l.call(null,e,...t);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),h(n)}let p=!1;function m(e){p||(p=!0,d(),u||(null!==i?(e||(a=2),clearTimeout(i),h(0)):e||(a=1)))}return h(0),s=setTimeout((()=>{o=!0,m(!0)}),n),m}(((e,t)=>{if(t)return void e(!1,new zv(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===kv.NO_ERROR,i=n.getStatus();if(!t||function(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}(i,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===kv.ABORT;return void e(!1,new zv(!1,null,t))}const s=-1!==this.successCodes_.indexOf(i);e(!0,new zv(s,n))}))}),e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function(e){e(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class zv{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function $v(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function Kv(...e){const t=$v();if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(Vv())return new Blob(e);throw new Sv(Cv.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}const Gv="base64",Hv="base64url",Wv="data_url";class Qv{constructor(e,t){this.data=e,this.contentType=t||null}}function Xv(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<=127?t.push(r):r<=2047?t.push(192|r>>6,128|63&r):55296==(64512&r)?n<e.length-1&&56320==(64512&e.charCodeAt(n+1))?(r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):t.push(239,191,189):56320==(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function Yv(e,t){switch(e){case Gv:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw Rv(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case Hv:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r)throw Rv(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=function(e){if("undefined"==typeof atob)throw new Sv(Cv.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw Rv(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);return r}class Jv{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw Rv(Wv,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;var r,i;null!=n&&(this.base64=(i=";base64",(r=n).length>=7&&r.substring(r.length-7)===i),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class Zv{constructor(e,t){let n=0,r="";Fv(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(Fv(this.data_)){const s=(n=this.data_,r=e,i=t,n.webkitSlice?n.webkitSlice(r,i):n.mozSlice?n.mozSlice(r,i):n.slice?n.slice(r,i):null);return null===s?null:new Zv(s)}var n,r,i;{const n=new Uint8Array(this.data_.buffer,e,t-e);return new Zv(n,!0)}}static getBlob(...e){if(Vv()){const t=e.map((e=>e instanceof Zv?e.data_:e));return new Zv(Kv.apply(null,t))}{const t=e.map((e=>Mv(e)?function(e,t){switch(e){case"raw":return new Qv(Xv(t));case Gv:case Hv:return new Qv(Yv(e,t));case Wv:return new Qv(function(e){const t=new Jv(e);return t.base64?Yv(Gv,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw Rv(Wv,"Malformed data URL.")}return Xv(t)}(t.rest)}(t),new Jv(t).contentType)}throw Dv()}("raw",e).data:e.data_));let n=0;t.forEach((e=>{n+=e.byteLength}));const r=new Uint8Array(n);let i=0;return t.forEach((e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]})),new Zv(r,!0)}}uploadData(){return this.data_}}function ew(e){let t;try{t=JSON.parse(e)}catch(e){return null}return function(e){return"object"==typeof e&&!Array.isArray(e)}(t)?t:null}function tw(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function nw(e,t){return t}class rw{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||nw}}let iw=null;function sw(){if(iw)return iw;const e=[];e.push(new rw("bucket")),e.push(new rw("generation")),e.push(new rw("metageneration")),e.push(new rw("name","fullPath",!0));const t=new rw("name");t.xform=function(e,t){return function(e){return!Mv(e)||e.length<2?e:tw(e)}(t)},e.push(t);const n=new rw("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new rw("timeCreated")),e.push(new rw("updated")),e.push(new rw("md5Hash",null,!0)),e.push(new rw("cacheControl",null,!0)),e.push(new rw("contentDisposition",null,!0)),e.push(new rw("contentEncoding",null,!0)),e.push(new rw("contentLanguage",null,!0)),e.push(new rw("contentType",null,!0)),e.push(new rw("metadata","customMetadata",!0)),iw=e,iw}function ow(e,t,n){const r=ew(t);return null===r?null:function(e,t,n){const r={type:"file"},i=n.length;for(let e=0;e<i;e++){const i=n[e];r[i.local]=i.xform(r,t[i.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,i=new Pv(n,r);return t._makeStorageReference(i)}})}(r,e),r}(e,r,n)}class aw{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function cw(e){if(!e)throw Dv()}function uw(e){return function(t,n){let r;var i,s;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new Sv(Cv.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new Sv(Cv.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(s=e.bucket,r=new Sv(Cv.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,r=new Sv(Cv.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):r=n,r.status=t.getStatus(),r.serverResponse=n.serverResponse,r}}function lw(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const c=function(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return t&&t.type()||"application/octet-stream"}(0,t)),r}(t,r,i),u="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+function(e,t){const n={},r=t.length;for(let i=0;i<r;i++){const r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",l="\r\n--"+a+"--",h=Zv.getBlob(u,r,l);if(null===h)throw new Sv(Cv.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.");const d={name:c.fullPath},f=Bv(s,e.host,e._protocol),p=e.maxUploadRetryTime,m=new aw(f,"POST",function(e,t){return function(n,r){const i=ow(e,r,t);return cw(null!==i),i}}(e,n),p);return m.urlParams=d,m.headers=o,m.body=h.uploadData(),m.errorHandler=uw(t),m}class hw{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=kv.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=kv.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=kv.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,n,r){if(this.sent_)throw Ov("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const e in r)r.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,r[e].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Ov("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Ov("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw Ov("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Ov("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class dw extends hw{initXhr(){this.xhr_.responseType="text"}}function fw(){return new dw}class pw{constructor(e,t){this._service=e,this._location=t instanceof Pv?t:Pv.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new pw(e,t)}get root(){const e=new Pv(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return tw(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new Pv(this._location.bucket,e);return new pw(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Sv(Cv.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function mw(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=Bv(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,s=new aw(r,"GET",function(e,t){return function(n,r){const i=ow(e,r,t);return cw(null!==i),function(e,t,n,r){const i=ew(t);if(null===i)return null;if(!Mv(i.downloadTokens))return null;const s=i.downloadTokens;if(0===s.length)return null;const o=encodeURIComponent;return s.split(",").map((t=>{const i=e.bucket,s=e.fullPath;return Bv("/b/"+o(i)+"/o/"+o(s),n,r)+jv({alt:"media",token:t})}))[0]}(i,r,e.host,e._protocol)}}(e,n),i);return s.errorHandler=function(e){const t=uw(e);return function(n,r){let i=t(n,r);var s;return 404===n.getStatus()&&(s=e.path,i=new Sv(Cv.OBJECT_NOT_FOUND,"Object '"+s+"' does not exist.")),i.serverResponse=r.serverResponse,i}}(t),s}(e.storage,e._location,sw());return e.storage.makeRequestWithTokens(t,fw).then((e=>{if(null===e)throw new Sv(Cv.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e}))}function gw(e,t){if(e instanceof vw){const n=e;if(null==n._bucket)throw new Sv(Cv.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+_v+"' property when initializing the app?");const r=new pw(n,n._bucket);return null!=t?gw(r,t):r}return void 0!==t?function(e,t){const n=function(e,t){const n=t.split("/").filter((e=>e.length>0)).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),r=new Pv(e._location.bucket,n);return new pw(e.storage,r)}(e,t):e}function yw(e,t){const n=null==t?void 0:t[_v];return null==n?null:Pv.makeFromBucketSpec(n,e)}class vw{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=Tv,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?Pv.makeFromBucketSpec(r,this._host):yw(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=Pv.makeFromBucketSpec(this._url,e):this._bucket=yw(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Uv("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Uv("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new pw(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new Lv(Nv());{const s=function(e,t,n,r,i,s,o=!0){const a=jv(e.urlParams),c=e.url+a,u=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(u,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(u,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(u,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(u,r),new qv(c,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,o)}(e,this._appId,n,r,t,this._firebaseVersion,i);return this._requests.add(s),s.getPromise().then((()=>this._requests.delete(s)),(()=>this._requests.delete(s))),s}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const ww="@firebase/storage",bw="0.11.2",Iw="storage";let Ew,Tw;ze(new F(Iw,(function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new vw(n,r,i,t,He)}),"PUBLIC").setMultipleInstances(!0)),Xe(ww,bw,""),Xe(ww,bw,"esm2017");const _w=new WeakMap,Sw=new WeakMap,Cw=new WeakMap,kw=new WeakMap,Aw=new WeakMap;let Dw={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Sw.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Cw.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Nw(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function xw(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Tw||(Tw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(Rw(this),e),Nw(_w.get(this))}:function(...e){return Nw(t.apply(Rw(this),e))}:function(e,...n){const r=t.call(Rw(this),e,...n);return Cw.set(r,e.sort?e.sort():[e]),Nw(r)}:(e instanceof IDBTransaction&&function(e){if(Sw.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));Sw.set(e,t)}(e),n=e,(Ew||(Ew=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,Dw):e);var t,n}function Nw(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(Nw(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&_w.set(t,e)})).catch((()=>{})),Aw.set(t,e),t}(e);if(kw.has(e))return kw.get(e);const t=xw(e);return t!==e&&(kw.set(e,t),Aw.set(t,e)),t}const Rw=e=>Aw.get(e),Ow=["get","getKey","getAll","getAllKeys","count"],Pw=["put","add","delete","clear"],Lw=new Map;function Mw(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Lw.get(t))return Lw.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=Pw.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Ow.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return Lw.set(t,s),s}Dw=(e=>({...e,get:(t,n,r)=>Mw(t,n)||e.get(t,n,r),has:(t,n)=>!!Mw(t,n)||e.has(t,n)}))(Dw);const Fw="@firebase/installations",Vw="0.6.4",Uw=`w:${Vw}`,Bw="FIS_v2",jw=new C("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function qw(e){return e instanceof S&&e.code.includes("request-failed")}function zw({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function $w(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function Kw(e,t){const n=(await t.json()).error;return jw.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Gw({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function Hw(e){const t=await e();return t.status>=500&&t.status<600?e():t}function Ww(e){return new Promise((t=>{setTimeout(t,e)}))}const Qw=/^[cdef][\w-]{21}$/;function Xw(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return Qw.test(t)?t:""}catch(e){return""}}function Yw(e){return`${e.appName}!${e.appId}`}const Jw=new Map;function Zw(e,t){const n=Yw(e);eb(n,t),function(e,t){const n=(!tb&&"BroadcastChannel"in self&&(tb=new BroadcastChannel("[Firebase] FID Change"),tb.onmessage=e=>{eb(e.data.key,e.data.fid)}),tb);n&&n.postMessage({key:e,fid:t}),0===Jw.size&&tb&&(tb.close(),tb=null)}(n,t)}function eb(e,t){const n=Jw.get(e);if(n)for(const e of n)e(t)}let tb=null;const nb="firebase-installations-store";let rb=null;function ib(){return rb||(rb=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=Nw(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(Nw(o.result),e.oldVersion,e.newVersion,Nw(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),a}("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(nb)}})),rb}async function sb(e,t){const n=Yw(e),r=(await ib()).transaction(nb,"readwrite"),i=r.objectStore(nb),s=await i.get(n);return await i.put(t,n),await r.done,s&&s.fid===t.fid||Zw(e,t.fid),t}async function ob(e){const t=Yw(e),n=(await ib()).transaction(nb,"readwrite");await n.objectStore(nb).delete(t),await n.done}async function ab(e,t){const n=Yw(e),r=(await ib()).transaction(nb,"readwrite"),i=r.objectStore(nb),s=await i.get(n),o=t(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,!o||s&&s.fid===o.fid||Zw(e,o.fid),o}async function cb(e){let t;const n=await ab(e.appConfig,(n=>{const r=function(e){return hb(e||{fid:Xw(),registrationStatus:0})}(n),i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(jw.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=zw(e),i=Gw(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={fid:n,authVersion:Bw,appId:e.appId,sdkVersion:Uw},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await Hw((()=>fetch(r,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:$w(e.authToken)}}throw await Kw("Create Installation",c)}(e,t);return sb(e.appConfig,n)}catch(n){throw qw(n)&&409===n.customData.serverCode?await ob(e.appConfig):await sb(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:ub(e)}:{installationEntry:t}}(e,r);return t=i.registrationPromise,i.installationEntry}));return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function ub(e){let t=await lb(e.appConfig);for(;1===t.registrationStatus;)await Ww(100),t=await lb(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await cb(e);return n||t}return t}function lb(e){return ab(e,(e=>{if(!e)throw jw.create("installation-not-found");return hb(e)}))}function hb(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function db({appConfig:e,heartbeatServiceProvider:t},n){const r=function(e,{fid:t}){return`${zw(e)}/${t}/authTokens:generate`}(e,n),i=function(e,{refreshToken:t}){const n=Gw(e);return n.append("Authorization",function(e){return`${Bw} ${e}`}(t)),n}(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={installation:{sdkVersion:Uw,appId:e.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await Hw((()=>fetch(r,a)));if(c.ok)return $w(await c.json());throw await Kw("Generate Auth Token",c)}async function fb(e,t=!1){let n;const r=await ab(e.appConfig,(r=>{if(!mb(r))throw jw.create("not-registered");const i=r.authToken;if(!t&&(2===(s=i).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(s)))return r;var s;if(1===i.requestStatus)return n=async function(e,t){let n=await pb(e.appConfig);for(;1===n.authToken.requestStatus;)await Ww(100),n=await pb(e.appConfig);const r=n.authToken;return 0===r.requestStatus?fb(e,t):r}(e,t),r;{if(!navigator.onLine)throw jw.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(r);return n=async function(e,t){try{const n=await db(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await sb(e.appConfig,r),n}catch(n){if(!qw(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await sb(e.appConfig,n)}else await ob(e.appConfig);throw n}}(e,t),t}}));return n?await n:r.authToken}function pb(e){return ab(e,(e=>{if(!mb(e))throw jw.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function mb(e){return void 0!==e&&2===e.registrationStatus}function gb(e){return jw.create("missing-app-config-values",{valueName:e})}const yb="installations";ze(new F(yb,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw gb("App Configuration");if(!e.name)throw gb("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw gb(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:$e(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),ze(new F("installations-internal",(e=>{const t=$e(e.getProvider("app").getImmediate(),yb).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:r}=await cb(t);return r?r.catch(console.error):fb(t).catch(console.error),n.fid}(t),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await cb(e);t&&await t}(n),(await fb(n,t)).token}(t,e)}}),"PRIVATE")),Xe(Fw,Vw),Xe(Fw,Vw,"esm2017");const vb="analytics",wb="https://www.googletagmanager.com/gtag/js",bb=new H("@firebase/analytics"),Ib=new C("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function Eb(e){if(!e.startsWith(wb)){const t=Ib.create("invalid-gtag-resource",{gtagURL:e});return bb.warn(t.message),""}return e}function Tb(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}const _b=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function Sb(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function Cb(e,t=_b,n){const{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw Ib.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw Ib.create("no-api-key")}const o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Ab;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),kb({appId:r,apiKey:i,measurementId:s},o,a,t)}async function kb(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=_b){var s;const{appId:o,measurementId:a}=e;try{await function(e,t){return new Promise(((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener((()=>{clearTimeout(s),r(Ib.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(r,t)}catch(e){if(a)return bb.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:a};throw e}try{const t=await async function(e){var t;const{appId:n,apiKey:r}=e,i={method:"GET",headers:Sb(r)},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(s,i);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw Ib.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return i.deleteThrottleMetadata(o),t}catch(t){const c=t;if(!function(e){if(!(e instanceof S&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(c)){if(i.deleteThrottleMetadata(o),a)return bb.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw t}const u=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?L(n,i.intervalMillis,30):L(n,i.intervalMillis),l={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return i.setThrottleMetadata(o,l),bb.debug(`Calling attemptFetch again in ${u} millis`),kb(e,l,r,i)}}class Ab{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let Db,xb;async function Nb(e,t,n,r,i,s,o){var a;const c=Cb(e);c.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&bb.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>bb.error(e))),t.push(c);const u=async function(){if(!T())return bb.warn(Ib.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await _()}catch(e){return bb.warn(Ib.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?r.getId():void 0)),[l,h]=await Promise.all([c,u]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(wb)&&n.src.includes(e))return n;return null})(s)||function(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",t)),n}(0,{createScriptURL:Eb}),r=document.createElement("script"),i=`${wb}?l=${e}&id=${t}`;r.src=n?null==n?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}(s,l.measurementId),xb&&(i("consent","default",xb),xb=void 0),i("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d.origin="firebase",d.update=!0,null!=h&&(d.firebase_id=h),i("config",l.measurementId,d),Db&&(i("set",Db),Db=void 0),l.measurementId}class Rb{constructor(e){this.app=e}_delete(){return delete Ob[this.app.options.appId],Promise.resolve()}}let Ob={},Pb=[];const Lb={};let Mb,Fb,Vb="dataLayer",Ub=!1;function Bb(e,t,n){!function(){const e=[];if(E()&&e.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=Ib.create("invalid-analytics-context",{errorInfo:t});bb.warn(n.message)}}();const r=e.options.appId;if(!r)throw Ib.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw Ib.create("no-api-key");bb.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Ob[r])throw Ib.create("already-exists",{id:r});if(!Ub){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(Vb);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,i){let s=function(...e){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=function(e,t,n,r){return async function(i,...s){try{if("event"===i){const[r,i]=s;await async function(e,t,n,r,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const r=await Tb(n);for(const n of e){const e=r.find((e=>e.measurementId===n)),i=e&&t[e.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",r,i||{})}catch(e){bb.error(e)}}(e,t,n,r,i)}else if("config"===i){const[i,o]=s;await async function(e,t,n,r,i,s){const o=r[i];try{if(o)await t[o];else{const e=(await Tb(n)).find((e=>e.measurementId===i));e&&await t[e.appId]}}catch(e){bb.error(e)}e("config",i,s)}(e,t,n,r,i,o)}else if("consent"===i){const[t]=s;e("consent","update",t)}else if("get"===i){const[t,n,r]=s;e("get",t,n,r)}else if("set"===i){const[t]=s;e("set",t)}else e(i,...s)}catch(e){bb.error(e)}}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(Ob,Pb,Lb,Vb,"gtag");Fb=e,Mb=t,Ub=!0}return Ob[r]=Nb(e,Pb,Lb,t,Mb,Vb,n),new Rb(e)}const jb="@firebase/analytics",qb="0.10.0";ze(new F(vb,((e,{options:t})=>Bb(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),ze(new F("analytics-internal",(function(e){try{const t=e.getProvider(vb).getImmediate();return{logEvent:(e,n,r)=>function(e,t,n,r){e=M(e),async function(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=await t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}}(Fb,Ob[e.app.options.appId],t,n,r).catch((e=>bb.error(e)))}(t,e,n,r)}}catch(e){throw Ib.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),Xe(jb,qb),Xe(jb,qb,"esm2017");var zb=We({apiKey:"AIzaSyAzd4ZozdCWCy6bQK255uyVFdOrbsHoxfQ",authDomain:"fastnetlite.firebaseapp.com",projectId:"fastnetlite",storageBucket:"fastnetlite.firebasestorage.app",messagingSenderId:"539673548783",appId:"1:539673548783:web:a9f7da3299069f0abf081a",measurementId:"G-GSR54JNW8J"}),$b=function(e){const t="string"==typeof e?e:"(default)",n=$e("object"==typeof e?e:Qe(),"firestore").getImmediate({identifier:t});if(!n._initialized){const e=m("firestore");e&&function(e,t,n,r={}){var i;const s=(e=Dp(e,Np))._getSettings(),o=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Ps("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=As.MOCK_USER;else{t=w(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Bs(Us.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new As(s)}e._authCredentials=new $s(new qs(t,n))}}(n,...e)}return n}(zb),Kb=function(e=Qe()){const t=$e(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=$e(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(A(n.getOptions(),null!=t?t:{}))return e;Hm(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:gv,persistence:[Vy,Iy,Ty]}),r=y("authTokenSyncURL");if(r){const e=(i=r,async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>bv)return;const r=null==t?void 0:t.token;Iv!==r&&(Iv=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(e,t,n){M(e).beforeAuthStateChanged(t,n)}(n,e,(()=>e(n.currentUser))),function(t){M(t).onIdTokenChanged((t=>e(t)),void 0,void 0)}(n)}var i;const s=p("auth");return s&&function(e,t,n){const r=Qg(e);Xm(r._canInitEmulator,r,"emulator-config-failed"),Xm(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=Yg(t),{host:o,port:a}=function(e){const t=Yg(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Jg(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Jg(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${s}`),n}(zb),Gb=function(e=Qe(),t){const n=$e(e=M(e),Iw).getImmediate({identifier:t}),r=m("storage");return r&&function(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:i}=r;i&&(e._overrideAuthToken="string"==typeof i?i:w(i,e.app.options.projectId))}(e,t,n,r)}(n,...r),n}(zb);function Hb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Wb(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?Hb(Object(r),!0).forEach((function(n){t(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hb(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Qb(e){if(console.log("Configuration des champs de collecte avec les paramètres:",e),e||(console.warn("advancedSettings est undefined, utilisation des valeurs par défaut"),e={collectClientName:!0,collectClientPhone:!0,requireClientPhone:!0,collectClientEmail:!1,requireClientEmail:!1,collectClientInfo:!0}),!1===e.collectClientInfo){console.log("Collecte d'informations désactivée, masquage du formulaire et déclenchement automatique du paiement");var t=document.querySelector(".form-card");t&&(t.style.display="none");var n=document.createElement("div");n.id="autoPaymentLoading",n.className="text-center my-5",n.innerHTML='\n            <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">\n                <span class="visually-hidden">Chargement...</span>\n            </div>\n            <h4 class="mt-3">Initialisation du paiement...</h4>\n            <p class="text-muted">Veuillez patienter pendant que nous préparons votre paiement</p>\n        ';var r=document.querySelector(".container");return r&&r.appendChild(n),void setTimeout((function(){!function(){var e=new URLSearchParams(window.location.search),t=e.get("routerId"),n=e.get("profileId");if(t&&n){var r="Client",i=new bootstrap.Modal(document.getElementById("loadingModal"));i.show(),Yb(t,r,"","").then((function(e){return console.log("Client créé/trouvé avec succès:",e),Zb(t,n,e,r,"")})).then((function(e){console.log("Paiement en attente créé avec succès:",e),i.hide(),tI(t,n,e,r)})).catch((function(e){console.error("Erreur lors du paiement direct:",e),i.hide(),oI("Erreur lors de l'initialisation du paiement: ".concat(e.message))}))}else oI("Paramètres manquants pour le paiement.")}()}),500)}var i=document.getElementById("nameFieldContainer");i?!1===e.collectClientName?i.classList.add("d-none"):i.classList.remove("d-none"):console.warn("L'élément nameFieldContainer n'a pas été trouvé");var s=document.getElementById("phoneFieldContainer"),o=document.getElementById("clientPhone");s&&o?!1===e.collectClientPhone?s.classList.add("d-none"):(s.classList.remove("d-none"),!0===e.requireClientPhone?o.required=!0:o.required=!1):console.warn("L'élément phoneFieldContainer ou clientPhone n'a pas été trouvé");var a=document.getElementById("emailFieldContainer"),c=document.getElementById("clientEmail");a&&c?!0===e.collectClientEmail?(a.classList.remove("d-none"),!0===e.requireClientEmail?c.required=!0:c.required=!1):a.classList.add("d-none"):console.warn("L'élément emailFieldContainer ou clientEmail n'a pas été trouvé")}function Xb(){return(Xb=i(o().mark((function e(t,n){var r,i,s,a,c,u,l,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Clic sur le bouton d'achat"),window.routerInfo&&window.profileInfo){e.next=4;break}return oI("Informations incomplètes. Veuillez rafraîchir la page et réessayer."),e.abrupt("return");case 4:if(r=document.getElementById("clientName").value.trim(),i=document.getElementById("clientPhone").value.trim(),s=document.getElementById("clientEmail").value.trim(),window.clientName=r,window.clientPhone=i,window.clientEmail=s,console.log("Informations client récupérées:",{clientName:r,clientPhone:i,clientEmail:s}),a=!0,c="",window.advancedSettings&&!1!==window.advancedSettings.collectClientName&&""===r&&(a=!1,c="Veuillez entrer votre nom."),window.advancedSettings&&!1!==window.advancedSettings.collectClientPhone&&(""===i?(a=!1,c="Veuillez entrer votre numéro WhatsApp."):/^\d{8,15}$/.test(i.replace(/\D/g,""))||(a=!1,c="Veuillez entrer un numéro WhatsApp valide.")),window.advancedSettings&&!0===window.advancedSettings.collectClientEmail&&(!0===window.advancedSettings.requireClientEmail&&""===s?(a=!1,c="Veuillez entrer votre email."):""===s||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)||(a=!1,c="Veuillez entrer un email valide.")),a){e.next=19;break}return oI(c),e.abrupt("return");case 19:return(u=new bootstrap.Modal(document.getElementById("loadingModal"))).show(),e.prev=21,e.next=24,Yb(t,r,i,s);case 24:return l=e.sent,console.log("Client ID:",l),e.next=28,Zb(t,n,l,r,i);case 28:return h=e.sent,console.log("Paiement ID:",h),e.next=32,tI(t,n,h,r);case 32:u.hide(),e.next=40;break;case 35:e.prev=35,e.t0=e.catch(21),console.error("Erreur lors du processus d'achat:",e.t0),u.hide(),oI("Une erreur est survenue lors du traitement de votre achat. Veuillez réessayer plus tard.");case 40:case"end":return e.stop()}}),e,null,[[21,35]])})))).apply(this,arguments)}function Yb(e,t,n,r){return Jb.apply(this,arguments)}function Jb(){return(Jb=i(o().mark((function e(t,n,r,i){var s,a,c,u,l,h,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=Lp($b,"clients"),a=gm(s,vm("whatsapp","==",r),vm("routerId","==",t),Em(1)),e.next=5,Fm(a);case 5:if((c=e.sent).empty){e.next=13;break}return u=c.docs[0],l=u.data(),console.log("Client existant trouvé:",l),e.next=12,Vm(Mp($b,"clients",u.id),{lastActivity:jm(),updatedAt:jm()});case 12:return e.abrupt("return",u.id);case 13:return h={name:n,whatsapp:r,email:i||"",routerId:t,createdAt:jm(),updatedAt:jm(),lastActivity:jm(),purchasedCodes:0,totalSpent:0,note:""},e.next=16,Um(s,h);case 16:return d=e.sent,console.log("Nouveau client créé avec ID:",d.id),e.abrupt("return",d.id);case 21:throw e.prev=21,e.t0=e.catch(0),console.error("Erreur lors de la recherche/création du client:",e.t0),e.t0;case 25:case"end":return e.stop()}}),e,null,[[0,21]])})))).apply(this,arguments)}function Zb(e,t,n,r,i){return eI.apply(this,arguments)}function eI(){return(eI=i(o().mark((function e(t,n,r,i,s){var a,c,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={amount:window.profileInfo.price,clientId:r,clientName:i||s,clientPhone:s,createdAt:jm(),updatedAt:jm(),method:"fedapay",note:"",profileId:n,profileName:"".concat(window.profileInfo.name," - ").concat(window.profileInfo.price," FCFA"),routerId:t,status:"pending"},c=Lp($b,"payments"),e.next=5,Um(c,a);case 5:return u=e.sent,console.log("Paiement en attente créé avec ID:",u.id),e.abrupt("return",u.id);case 10:throw e.prev=10,e.t0=e.catch(0),console.error("Erreur lors de la création du paiement:",e.t0),e.t0;case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function tI(e,t,n,r){return nI.apply(this,arguments)}function nI(){return(nI=i(o().mark((function e(t,n,r,i){var s,a,c,u,l,h,d,f,p,m;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,window.fedaPayInitialized){e.next=4;break}throw console.error("FedaPay n'a pas été initialisé. Impossible de procéder au paiement."),new Error("Configuration de paiement non initialisée. Veuillez recharger la page et réessayer.");case 4:return e.next=6,Lm(Mp($b,"payments",r));case 6:if((s=e.sent).exists()){e.next=9;break}throw new Error("Paiement non trouvé");case 9:return a=s.data(),c=a.clientPhone||"",console.log("Informations de paiement récupérées:",{paymentId:r,clientName:i,clientPhone:c}),u=window.routerInfo.userId,e.next=15,Lm(Mp($b,"users",u));case 15:if((l=e.sent).exists()){e.next=18;break}throw new Error("Utilisateur non trouvé");case 18:if(h=l.data().email||"contact@fastnetlite.com",e.prev=19,d=window.routerInfo.fedapayApiKey){e.next=23;break}throw new Error("Clé API FedaPay non configurée pour ce routeur");case 23:return console.log("Réinitialisation de FedaPay avec la clé publique:",d.substring(0,4)+"..."+d.substring(d.length-4)),e.next=26,Vm(Mp($b,"payments",r),{status:"processing",updatedAt:jm()});case 26:f="temp-fedapay-button-"+Date.now(),(p=document.createElement("button")).id=f,p.style.display="none",document.body.appendChild(p),m={public_key:d,transaction:{amount:window.profileInfo.price,description:window.profileInfo.description||"Achat de forfait ".concat(window.profileInfo.name),currency:{iso:"XOF"}},customer:{email:h||"client@fastnetlite.com",firstname:i.split(" ")[0]||"Client",lastname:i.split(" ").slice(1).join(" ")||"FastNetLite",phone_number:{number:"string"==typeof c?c.replace(/\D/g,""):"",country:"BJ"}},onComplete:function(e){if(console.log("Callback onComplete de FedaPay reçu:",e),document.getElementById(f)&&document.getElementById(f).remove(),e&&"DIALOG DISMISSED"===e.reason)return console.log("Paiement FedaPay annulé par l'utilisateur"),void Vm(Mp($b,"payments",r),{status:"cancelled",updatedAt:jm(),note:"Paiement annulé par l'utilisateur"}).catch((function(e){console.error("Erreur lors de la mise à jour du statut du paiement:",e)}));if(e&&e.transaction&&e.transaction.id&&"approved"===e.transaction.status)console.log("Transaction FedaPay validée avec ID:",e.transaction.id,"et statut:",e.transaction.status),Vm(Mp($b,"payments",r),{status:"completed",transactionId:e.transaction.id,updatedAt:jm()}).then((function(){return rI(t,n)})).then((function(e){if(e)return console.log("Code WiFi trouvé:",e.id,"avec username:",e.username),Vm(Mp($b,"payments",r),{code:e.id,updatedAt:jm()}).then((function(){return Vm(Mp($b,"wifiCodes",e.id),{status:"used",usedAt:jm(),paymentId:r,updatedAt:jm()}).then((function(){sI(e.username,e.password,e.validUntil)}))}));console.error("Aucun code WiFi disponible pour le profil:",n),oI("Aucun code WiFi disponible pour ce profil. Veuillez contacter l'administrateur.")})).catch((function(e){console.error("Erreur lors du traitement du paiement réussi:",e),oI("Une erreur est survenue lors de la finalisation de votre achat. Veuillez contacter l'administrateur.")}));else{console.error("Transaction FedaPay non approuvée ou invalide:",e);var i="Transaction non approuvée";e&&e.transaction&&(e.transaction.status&&(i="Transaction avec statut: ".concat(e.transaction.status)),e.transaction.last_error_code&&(i+=" (Code erreur: ".concat(e.transaction.last_error_code,")"))),Vm(Mp($b,"payments",r),{status:"failed",updatedAt:jm(),errorMessage:i}).catch((function(e){console.error("Erreur lors de la mise à jour du statut du paiement:",e)})),oI("Le paiement n'a pas été approuvé. Veuillez réessayer ou contacter l'administrateur.")}},onError:function(e){console.error("Erreur FedaPay:",e),Vm(Mp($b,"payments",r),{status:"failed",updatedAt:jm(),errorMessage:e?JSON.stringify(e):"Erreur inconnue"}).catch((function(e){console.error("Erreur lors de la mise à jour du statut du paiement:",e)})),oI("Une erreur est survenue lors du paiement. Veuillez réessayer plus tard."),document.getElementById(f)&&document.getElementById(f).remove()},onClose:function(){console.log("Paiement FedaPay fermé"),Vm(Mp($b,"payments",r),{status:"cancelled",updatedAt:jm()}).catch((function(e){console.error("Erreur lors de la mise à jour du statut du paiement:",e)})),document.getElementById(f)&&document.getElementById(f).remove()}},console.log("Initialisation de FedaPay avec la configuration:",JSON.stringify(m,null,2)),window.FedaPay.init("#"+f,m),console.log("Déclenchement du paiement FedaPay..."),p.click(),e.next=42;break;case 38:throw e.prev=38,e.t0=e.catch(19),console.error("Erreur lors de la création de la transaction FedaPay:",e.t0),new Error("Impossible de créer la transaction FedaPay. Veuillez réessayer plus tard.");case 42:e.next=48;break;case 44:throw e.prev=44,e.t1=e.catch(0),console.error("Erreur lors de l'initialisation de FedaPay:",e.t1),e.t1;case 48:case"end":return e.stop()}}),e,null,[[0,44],[19,38]])})))).apply(this,arguments)}function rI(e,t){return iI.apply(this,arguments)}function iI(){return(iI=i(o().mark((function e(t,n){var r,i,s,a,c,u,l,h,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Recherche d'un code WiFi disponible pour routerId:",t,"et profileId:",n),t&&n){e.next=5;break}return console.error("routerId ou profileId invalide:",{routerId:t,profileId:n}),e.abrupt("return",null);case 5:return r=Lp($b,"wifiCodes"),i=gm(r,vm("routerId","==",t),vm("profileId","==",n),vm("status","==","available"),Em(1)),console.log("Exécution de la requête Firestore pour trouver un code disponible..."),e.next=10,Fm(i);case 10:if(s=e.sent,console.log("Nombre de codes trouvés:",s.size),s.empty){e.next=17;break}return a=s.docs[0],c=Wb({id:a.id},a.data()),console.log("Code WiFi disponible trouvé:",c.id),e.abrupt("return",c);case 17:return u=gm(r,vm("routerId","==",t),vm("profileId","==",n),Em(1)),e.next=20,Fm(u);case 20:return e.sent.empty?console.log("Aucun code n'existe pour ce profil"):console.log("Des codes existent pour ce profil mais sont déjà utilisés"),console.log("Vérification des codes avec des requêtes individuelles..."),e.next=25,Fm(Lp($b,"wifiCodes"));case 25:return l=e.sent,console.log("Nombre total de codes dans la base:",l.size),h=[],d=0,l.forEach((function(e){if(d<5){var t=e.data();h.push({id:e.id,routerId:t.routerId,profileId:t.profileId,status:t.status}),d++}})),console.log("Exemple de codes dans la base:",h),e.abrupt("return",null);case 34:throw e.prev=34,e.t0=e.catch(0),console.error("Erreur lors de la recherche d'un code WiFi disponible:",e.t0),e.t0;case 38:case"end":return e.stop()}}),e,null,[[0,34]])})))).apply(this,arguments)}function sI(e,t,n){if(!document.getElementById("wifiCodeModal")){var r=document.createElement("div");r.innerHTML='\n        <div class="modal fade" id="wifiCodeModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="wifiCodeModalLabel" aria-hidden="true">\n            <div class="modal-dialog modal-dialog-centered">\n                <div class="modal-content">\n                    <div class="modal-body text-center py-5">\n                        <div class="mb-4">\n                            <i class="fas fa-wifi fa-4x mb-3 text-black-50"></i>\n                            <h4 class="mb-3" style="font-weight: 500;">Votre code WiFi</h4>\n                            <p class="lead mb-4" style="font-weight: 300;">Voici vos informations de connexion</p>\n                        </div>\n                        <div class="card mb-4">\n                            <div class="card-body p-4">\n                                <div class="row mb-4">\n                                    <div class="col-5 text-end text-muted">Nom d\'utilisateur</div>\n                                    <div class="col-7 text-start fw-bold" id="wifiUsername"></div>\n                                </div>\n                                <div class="row mb-4">\n                                    <div class="col-5 text-end text-muted">Mot de passe</div>\n                                    <div class="col-7 text-start fw-bold" id="wifiPassword"></div>\n                                </div>\n                                <div class="row">\n                                    <div class="col-5 text-end text-muted">Valide jusqu\'au</div>\n                                    <div class="col-7 text-start" id="wifiValidUntil"></div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="alert alert-danger">\n                            <i class="fas fa-exclamation-circle"></i> Veuillez noter ces informations, elles ne seront plus accessibles après la fermeture de cette fenêtre.\n                        </div>\n                        <div class="mt-4 d-flex justify-content-center gap-3">\n                            <button type="button" class="btn btn-primary px-4" id="autoConnectBtn">\n                                Connexion automatique\n                            </button>\n                            <button type="button" class="btn btn-outline-secondary px-4" id="closeCodeBtn">\n                                Fermer\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        ',document.body.appendChild(r.firstElementChild),document.getElementById("autoConnectBtn").addEventListener("click",(function(){if(window.routerInfo&&window.routerInfo.connectionUrl){var e=document.getElementById("wifiUsername").textContent,t=document.getElementById("wifiPassword").textContent,n="http://".concat(window.routerInfo.connectionUrl,"/login?username=").concat(encodeURIComponent(e),"&password=").concat(encodeURIComponent(t));console.log("URL de connexion automatique:",n),window.open(n,"_blank")}else alert("URL de connexion non disponible. Veuillez vous connecter manuellement au réseau WiFi.")})),document.getElementById("closeCodeBtn").addEventListener("click",(function(){bootstrap.Modal.getInstance(document.getElementById("wifiCodeModal")).hide(),window.location.reload()}))}var i="Non spécifiée";if(n){var s=n instanceof Date?n:new Date(n);isNaN(s.getTime())||(i=s.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}))}document.getElementById("wifiUsername").textContent=e||"Non spécifié",document.getElementById("wifiPassword").textContent=t||"Non spécifié",document.getElementById("wifiValidUntil").textContent=i,new bootstrap.Modal(document.getElementById("wifiCodeModal")).show()}function oI(e){document.getElementById("errorMessage").textContent=e,new bootstrap.Modal(document.getElementById("errorModal")).show()}!function(e=Qe()){const t=$e(e=M(e),vb);t.isInitialized()?t.getImmediate():function(e,t={}){const n=$e(e,vb);if(n.isInitialized()){const e=n.getImmediate();if(A(t,n.getOptions()))return e;throw Ib.create("already-initialized")}n.initialize({options:t})}(e)}(zb),function(e){!function(e){if(e._initialized||e._terminated)throw new Bs(Us.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}(e=Dp(e,Vp));const t=Up(e);if(t._uninitializedComponentsProvider)throw new Bs(Us.FAILED_PRECONDITION,"SDK cache is already specified.");Ps("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings(),r=new mp;return function(e,t,n){const r=new js;return e.asyncQueue.enqueue((async()=>{try{await vp(e,n),await wp(e,t),r.resolve()}catch(e){const t=e;if(!bp(t))throw t;Ps("Error enabling indexeddb cache. Falling back to memory cache: "+t),r.reject(t)}})).then((()=>r.promise))}(t,r,new pp(r,n.cacheSizeBytes,void 0))}($b).catch((function(e){"failed-precondition"===e.code?console.warn("La persistance des données ne peut pas être activée car plusieurs onglets sont ouverts"):"unimplemented"===e.code&&console.warn("Le navigateur ne prend pas en charge la persistance des données hors ligne")})),window.firebase={auth:function(){return Kb},firestore:function(){return{collection:function(e){return Lp($b,e)},doc:function(e){return Mp($b,e)},FieldValue:{serverTimestamp:function(){return jm()}}}},storage:function(){return Gb}},window.db=$b,window.auth=Kb,window.storage=Gb,window.firestore={collection:Lp,doc:Mp,setDoc:function(e,t,n){e=Dp(e,Rp);const r=Dp(e.firestore,Vp),i=Dm(e.converter,t,n);return Bm(r,[Jp(Yp(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Su.none())])},getDoc:Lm,getDocs:Fm,query:gm,where:vm,orderBy:function(e,t="asc"){const n=t,r=fm("orderBy",e);return bm._create(r,n)},limit:Em,startAfter:function(...e){return Tm._create("startAfter",e,!1)},serverTimestamp:jm},window.storageRef=function(e,t){return function(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof vw)return new pw(e,t);throw xv("To use ref(service, url), the first argument must be a Storage instance.")}return gw(e,t)}(e=M(e),t)},window.uploadBytes=function(e,t,n){return function(e,t,n){e._throwIfRoot("uploadBytes");const r=lw(e.storage,e._location,sw(),new Zv(t,!0),n);return e.storage.makeRequestWithTokens(r,fw).then((t=>({metadata:t,ref:e})))}(e=M(e),t,n)},window.getDownloadURL=function(e){return mw(e=M(e))},console.log("Configuration Firebase chargée avec SDK moderne"),window.profilBuyCodeJsInitialized=window.profilBuyCodeJsInitialized||!1,window.fedaPayInitialized=window.fedaPayInitialized||!1,document.addEventListener("DOMContentLoaded",(function(){if(window.profilBuyCodeJsInitialized)console.log("profilbuy-code.js déjà initialisé, initialisation ignorée");else if(void 0===window.FedaPay){console.error("Le script FedaPay n'est pas chargé. Chargement dynamique...");var e=document.createElement("script");e.src="https://cdn.fedapay.com/checkout.js?v=1.1.7",e.async=!0,e.onload=function(){console.log("Script FedaPay chargé avec succès"),t()},e.onerror=function(){console.error("Erreur lors du chargement du script FedaPay"),oI("Erreur lors du chargement du module de paiement. Veuillez recharger la page ou contacter l'administrateur.")},document.head.appendChild(e)}else console.log("Script FedaPay déjà chargé"),t();function t(){window.profilBuyCodeJsInitialized=!0,console.log("Initialisation de profilbuy-code.js");var e=new URLSearchParams(window.location.search),t=e.get("routerId"),n=e.get("profileId");if(!t||!n)return oI("Paramètres manquants. Veuillez accéder à cette page depuis le lien fourni par votre fournisseur WiFi."),void console.error("Paramètres routerId ou profileId manquants dans l'URL");console.log("ID du routeur récupéré:",t),console.log("ID du profil récupéré:",n),function(e,t){(function(e){Lm(Mp($b,"routers",e)).then((function(t){if(t.exists()){var n=t.data();if(document.title="".concat(n.buyPageTitle||n.name," - Achat de forfait WiFi"),document.getElementById("routerName").textContent=n.buyPageTitle||n.name,document.getElementById("routerDescription").textContent=n.buyPageDescription||n.description||"Complétez vos informations pour acheter ce forfait",window.routerInfo=n,n.fedapayApiKey)try{!function(e){if(window.fedaPayInitialized)console.log("FedaPay déjà initialisé");else{if(!e||!e.startsWith("pk_"))throw console.error("Clé publique FedaPay invalide:",e),new Error("Clé publique FedaPay invalide. La clé doit commencer par pk_");try{if(void 0===window.FedaPay)throw console.error("L'objet FedaPay n'est pas défini. Vérifiez que le script FedaPay est bien chargé."),new Error("L'objet FedaPay n'est pas disponible. Vérifiez que le script FedaPay est bien chargé.");console.log("Initialisation de FedaPay avec la clé publique:",e.substring(0,4)+"..."+e.substring(e.length-4));try{window.FedaPay.init({public_key:e}),window.fedaPayInitialized=!0,console.log("FedaPay initialisé avec succès")}catch(t){console.error("Erreur spécifique lors de l'initialisation de FedaPay:",t),console.log("Tentative alternative d'initialisation..."),window.FedaPay.setApiKey(e),window.fedaPayInitialized=!0,console.log("FedaPay initialisé avec succès via setApiKey")}}catch(e){throw console.error("Erreur lors de l'initialisation de FedaPay:",e),e}}}(n.fedapayApiKey)}catch(e){console.error("Erreur lors de l'initialisation de FedaPay:",e),oI("Erreur de configuration du paiement. Veuillez contacter l'administrateur.")}else console.error("Clé API FedaPay non configurée pour ce routeur:",e)}else console.error("Routeur non trouvé:",e),oI("Routeur non trouvé. Veuillez vérifier le lien et réessayer.")})).catch((function(e){console.error("Erreur lors de la récupération des informations du routeur:",e),oI("Une erreur est survenue lors du chargement des informations. Veuillez réessayer plus tard.")}))})(e),function(e){Lm(Mp($b,"profiles",e)).then((function(t){if(t.exists()){var n=t.data();if(!1===n.enabled)return console.error("Profil désactivé:",e),void oI("Ce forfait n'est plus disponible. Veuillez en choisir un autre.");document.getElementById("profileName").textContent=n.name||"Forfait sans nom",document.getElementById("profilePrice").textContent="".concat(n.price||0," FCFA"),document.getElementById("profileDuration").textContent=n.duration||"Non spécifiée",document.getElementById("profileSpeed").textContent=n.speed||"Non spécifié",document.getElementById("profileDescription").textContent=n.description||"Aucune description disponible",window.profileInfo=n}else console.error("Profil non trouvé:",e),oI("Forfait non trouvé. Veuillez vérifier le lien et réessayer.")})).catch((function(e){console.error("Erreur lors de la récupération des informations du profil:",e),oI("Une erreur est survenue lors du chargement des informations. Veuillez réessayer plus tard.")}))}(t),function(e){Lm(Mp($b,"routers",e,"settings","advanced")).then((function(e){if(e.exists()&&e.data()){var t=e.data();console.log("Paramètres avancés chargés:",t),window.advancedSettings=t,Qb(t)}else{console.log("Document de paramètres avancés non trouvé, utilisation des valeurs par défaut");var n={collectClientName:!0,collectClientPhone:!0,requireClientPhone:!0,collectClientEmail:!1,requireClientEmail:!1,collectClientInfo:!0};window.advancedSettings=n,Qb(n)}})).catch((function(e){console.error("Erreur lors de la récupération des paramètres avancés:",e);var t={collectClientName:!0,collectClientPhone:!0,requireClientPhone:!0,collectClientEmail:!1,requireClientEmail:!1,collectClientInfo:!0};window.advancedSettings=t,Qb(t)}))}(e),function(e){Lm(Mp($b,"routers",e,"settings","appearance")).then((function(e){if(e.exists()&&e.data()){var t=e.data();console.log("Paramètres d'apparence chargés:",t);var n="";t&&t.primaryColor?n+="\n                        :root {\n                            --primary-color: ".concat(t.primaryColor,";\n                        }\n                        .btn-primary {\n                            background-color: ").concat(t.primaryColor,";\n                            border-color: ").concat(t.primaryColor,";\n                        }\n                        .btn-outline-primary {\n                            color: ").concat(t.primaryColor,";\n                            border-color: ").concat(t.primaryColor,";\n                        }\n                        .btn-outline-primary:hover {\n                            background-color: ").concat(t.primaryColor,";\n                            border-color: ").concat(t.primaryColor,";\n                        }\n                        .profile-card-header {\n                            background-color: ").concat(t.primaryColor,";\n                        }\n                    "):n+="\n                        :root {\n                            --primary-color: #007bff;\n                        }\n                    ",t.secondaryColor&&(n+="\n                        :root {\n                            --secondary-color: ".concat(t.secondaryColor,";\n                        }\n                        .text-secondary {\n                            color: ").concat(t.secondaryColor," !important;\n                        }\n                    ")),t.customCSS&&(n+=t.customCSS),document.getElementById("dynamicStyles").textContent=n}else console.log("Aucun paramètre d'apparence trouvé, utilisation des styles par défaut")})).catch((function(e){console.error("Erreur lors de la récupération des styles personnalisés:",e)}))}(e)}(t,n),function(e,t){var n,r;r="click","string"==typeof(n="buyButton")&&(n=document.getElementById(n)),n&&!n.getAttribute("data-".concat(r,"-handler-attached"))&&(n.setAttribute("data-".concat(r,"-handler-attached"),"true"),n.addEventListener(r,(function(){!function(e,t){Xb.apply(this,arguments)}(e,t)})),console.log("Gestionnaire ".concat(r," attaché à ").concat(n.id||"un élément")))}(t,n)}}))})()})();