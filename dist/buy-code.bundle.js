/*! For license information please see buy-code.bundle.js.LICENSE.txt */
(()=>{var e={606:e=>{var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var a,c=[],u=!1,l=-1;function h(){u&&a&&(u=!1,a.length?c=a.concat(c):l=-1,c.length&&d())}function d(){if(!u){var e=o(h);u=!0;for(var t=c.length;t;){for(a=c,c=[];++l<t;)a&&a[l].run();l=-1,t=c.length}a=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||u||o(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}var t=n(606);const r=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==o||null==a||null==c)throw new s;const u=i<<2|o>>4;if(r.push(u),64!==a){const e=o<<4&240|a>>2;if(r.push(e),64!==c){const e=a<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class s extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(e){return function(e){const t=r(e);return i.encodeByteArray(t,!0)}(e).replace(/\./g,"")},a=function(e){try{return i.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},c=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(void 0===t||void 0===t.env)return;const e=t.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&a(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},u=e=>{var t,n;return null===(n=null===(t=c())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},l=e=>{const t=u(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},h=()=>{var e;return null===(e=c())||void 0===e?void 0:e.config},d=e=>{var t;return null===(t=c())||void 0===t?void 0:t[`_${e}`]};class f{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function p(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(s)),""].join(".")}function m(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function g(){var e;const t=null===(e=c())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function y(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function v(){try{return"object"==typeof indexedDB}catch(e){return!1}}function w(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class I extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,I.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,b.prototype.create)}}class b{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(E,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new I(r,o,n)}}const E=/\{\$([^}]+)}/g;function T(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(_(n)&&_(s)){if(!T(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function _(e){return null!==e&&"object"==typeof e}function S(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function C(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function k(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class A{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=D),void 0===r.error&&(r.error=D),void 0===r.complete&&(r.complete=D);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function D(){}function N(e,t=1e3,n=2){const r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+i)}function x(e){return e&&e._delegate?e._delegate:e}class R{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const O="[DEFAULT]";class P{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new f;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:O})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=O){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=O){return this.instances.has(e)}getOptions(e=O){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===O?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=O){return this.component?this.component.multipleInstances?e:O:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class L{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new P(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const M=[];var F;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(F||(F={}));const V={debug:F.DEBUG,verbose:F.VERBOSE,info:F.INFO,warn:F.WARN,error:F.ERROR,silent:F.SILENT},U=F.INFO,B={[F.DEBUG]:"log",[F.VERBOSE]:"log",[F.INFO]:"info",[F.WARN]:"warn",[F.ERROR]:"error"},j=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=B[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class q{constructor(e){this.name=e,this._logLevel=U,this._logHandler=j,this._userLogHandler=null,M.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in F))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?V[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,F.DEBUG,...e),this._logHandler(this,F.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,F.VERBOSE,...e),this._logHandler(this,F.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,F.INFO,...e),this._logHandler(this,F.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,F.WARN,...e),this._logHandler(this,F.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,F.ERROR,...e),this._logHandler(this,F.ERROR,...e)}}let z,$;const K=new WeakMap,G=new WeakMap,H=new WeakMap,W=new WeakMap,Q=new WeakMap;let X={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return G.get(e);if("objectStoreNames"===t)return e.objectStoreNames||H.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return J(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Y(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?($||($=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(Z(this),e),J(K.get(this))}:function(...e){return J(t.apply(Z(this),e))}:function(e,...n){const r=t.call(Z(this),e,...n);return H.set(r,e.sort?e.sort():[e]),J(r)}:(e instanceof IDBTransaction&&function(e){if(G.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));G.set(e,t)}(e),n=e,(z||(z=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,X):e);var t,n}function J(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(J(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&K.set(t,e)})).catch((()=>{})),Q.set(t,e),t}(e);if(W.has(e))return W.get(e);const t=Y(e);return t!==e&&(W.set(e,t),Q.set(t,e)),t}const Z=e=>Q.get(e),ee=["get","getKey","getAll","getAllKeys","count"],te=["put","add","delete","clear"],ne=new Map;function re(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(ne.get(t))return ne.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=te.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!ee.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return ne.set(t,s),s}var ie;ie=X,X={...ie,get:(e,t,n)=>re(e,t)||ie.get(e,t,n),has:(e,t)=>!!re(e,t)||ie.has(e,t)};class se{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const oe="@firebase/app",ae="0.9.13",ce=new q("@firebase/app"),ue="@firebase/app-compat",le="@firebase/analytics-compat",he="@firebase/analytics",de="@firebase/app-check-compat",fe="@firebase/app-check",pe="@firebase/auth",me="@firebase/auth-compat",ge="@firebase/database",ye="@firebase/database-compat",ve="@firebase/functions",we="@firebase/functions-compat",Ie="@firebase/installations",be="@firebase/installations-compat",Ee="@firebase/messaging",Te="@firebase/messaging-compat",_e="@firebase/performance",Se="@firebase/performance-compat",Ce="@firebase/remote-config",ke="@firebase/remote-config-compat",Ae="@firebase/storage",De="@firebase/storage-compat",Ne="@firebase/firestore",xe="@firebase/firestore-compat",Re="firebase",Oe="[DEFAULT]",Pe={[oe]:"fire-core",[ue]:"fire-core-compat",[he]:"fire-analytics",[le]:"fire-analytics-compat",[fe]:"fire-app-check",[de]:"fire-app-check-compat",[pe]:"fire-auth",[me]:"fire-auth-compat",[ge]:"fire-rtdb",[ye]:"fire-rtdb-compat",[ve]:"fire-fn",[we]:"fire-fn-compat",[Ie]:"fire-iid",[be]:"fire-iid-compat",[Ee]:"fire-fcm",[Te]:"fire-fcm-compat",[_e]:"fire-perf",[Se]:"fire-perf-compat",[Ce]:"fire-rc",[ke]:"fire-rc-compat",[Ae]:"fire-gcs",[De]:"fire-gcs-compat",[Ne]:"fire-fst",[xe]:"fire-fst-compat","fire-js":"fire-js",[Re]:"fire-js-all"},Le=new Map,Me=new Map;function Fe(e,t){try{e.container.addComponent(t)}catch(n){ce.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Ve(e){const t=e.name;if(Me.has(t))return ce.debug(`There were multiple attempts to register component ${t}.`),!1;Me.set(t,e);for(const t of Le.values())Fe(t,e);return!0}function Ue(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const Be=new b("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class je{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new R("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Be.create("app-deleted",{appName:this._name})}}const qe="9.23.0";function ze(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:Oe,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw Be.create("bad-app-name",{appName:String(i)});if(n||(n=h()),!n)throw Be.create("no-options");const s=Le.get(i);if(s){if(T(n,s.options)&&T(r,s.config))return s;throw Be.create("duplicate-app",{appName:i})}const o=new L(i);for(const e of Me.values())o.addComponent(e);const a=new je(n,r,o);return Le.set(i,a),a}function $e(e=Oe){const t=Le.get(e);if(!t&&e===Oe&&h())return ze();if(!t)throw Be.create("no-app",{appName:e});return t}function Ke(e,t,n){var r;let i=null!==(r=Pe[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void ce.warn(e.join(" "))}Ve(new R(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const Ge="firebase-heartbeat-store";let He=null;function We(){return He||(He=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=J(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(J(o.result),e.oldVersion,e.newVersion,J(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Ge)}}).catch((e=>{throw Be.create("idb-open",{originalErrorMessage:e.message})}))),He}async function Qe(e,t){try{const n=(await We()).transaction(Ge,"readwrite"),r=n.objectStore(Ge);await r.put(t,Xe(e)),await n.done}catch(e){if(e instanceof I)ce.warn(e.message);else{const t=Be.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});ce.warn(t.message)}}}function Xe(e){return`${e.name}!${e.options.appId}`}class Ye{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ze(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Je();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=Je(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),et(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),et(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=o(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function Je(){return(new Date).toISOString().substring(0,10)}class Ze{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!v()&&w().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=await We();return await t.transaction(Ge).objectStore(Ge).get(Xe(e))}catch(e){if(e instanceof I)ce.warn(e.message);else{const t=Be.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});ce.warn(t.message)}}}(this.app);return e||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Qe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Qe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function et(e){return o(JSON.stringify({version:2,heartbeats:e})).length}Ve(new R("platform-logger",(e=>new se(e)),"PRIVATE")),Ve(new R("heartbeat",(e=>new Ye(e)),"PRIVATE")),Ke(oe,ae,""),Ke(oe,ae,"esm2017"),Ke("fire-js","");var tt,nt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},rt={},it=it||{},st=nt||self;function ot(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function at(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var ct="closure_uid_"+(1e9*Math.random()>>>0),ut=0;function lt(e,t,n){return e.call.apply(e.bind,arguments)}function ht(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function dt(e,t,n){return(dt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?lt:ht).apply(null,arguments)}function ft(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function pt(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function mt(){this.s=this.s,this.o=this.o}mt.prototype.s=!1,mt.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,ct)&&e[ct]||(e[ct]=++ut))},mt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const gt=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function yt(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function vt(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(ot(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function wt(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}wt.prototype.h=function(){this.defaultPrevented=!0};var It=function(){if(!st.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{st.addEventListener("test",(()=>{}),t),st.removeEventListener("test",(()=>{}),t)}catch(e){}return e}();function bt(e){return/^[\s\xa0]*$/.test(e)}function Et(){var e=st.navigator;return e&&(e=e.userAgent)?e:""}function Tt(e){return-1!=Et().indexOf(e)}function _t(e){return _t[" "](e),e}_t[" "]=function(){};var St,Ct,kt,At=Tt("Opera"),Dt=Tt("Trident")||Tt("MSIE"),Nt=Tt("Edge"),xt=Nt||Dt,Rt=Tt("Gecko")&&!(-1!=Et().toLowerCase().indexOf("webkit")&&!Tt("Edge"))&&!(Tt("Trident")||Tt("MSIE"))&&!Tt("Edge"),Ot=-1!=Et().toLowerCase().indexOf("webkit")&&!Tt("Edge");function Pt(){var e=st.document;return e?e.documentMode:void 0}e:{var Lt="",Mt=(Ct=Et(),Rt?/rv:([^\);]+)(\)|;)/.exec(Ct):Nt?/Edge\/([\d\.]+)/.exec(Ct):Dt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Ct):Ot?/WebKit\/(\S+)/.exec(Ct):At?/(?:Version)[ \/]?(\S+)/.exec(Ct):void 0);if(Mt&&(Lt=Mt?Mt[1]:""),Dt){var Ft=Pt();if(null!=Ft&&Ft>parseFloat(Lt)){St=String(Ft);break e}}St=Lt}st.document&&Dt?kt=Pt()||parseInt(St,10)||void 0:kt=void 0;var Vt=kt;function Ut(e,t){if(wt.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Rt){e:{try{_t(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Bt[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Ut.$.h.call(this)}}pt(Ut,wt);var Bt={2:"touch",3:"pen",4:"mouse"};Ut.prototype.h=function(){Ut.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var jt="closure_listenable_"+(1e6*Math.random()|0),qt=0;function zt(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++qt,this.fa=this.ia=!1}function $t(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function Kt(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function Gt(e){const t={};for(const n in e)t[n]=e[n];return t}const Ht="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Wt(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<Ht.length;t++)n=Ht[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Qt(e){this.src=e,this.g={},this.h=0}function Xt(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=gt(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&($t(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Yt(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==r)return i}return-1}Qt.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Yt(e,t,r,i);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new zt(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var Jt="closure_lm_"+(1e6*Math.random()|0),Zt={};function en(e,t,n,r,i){if(r&&r.once)return nn(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)en(e,t[s],n,r,i);return null}return n=ln(n),e&&e[jt]?e.O(t,n,at(r)?!!r.capture:!!r,i):tn(e,t,n,!1,r,i)}function tn(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=at(i)?!!i.capture:!!i,a=cn(e);if(a||(e[Jt]=a=new Qt(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){const e=an;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)It||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(on(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function nn(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)nn(e,t[s],n,r,i);return null}return n=ln(n),e&&e[jt]?e.P(t,n,at(r)?!!r.capture:!!r,i):tn(e,t,n,!0,r,i)}function rn(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)rn(e,t[s],n,r,i);else r=at(r)?!!r.capture:!!r,n=ln(n),e&&e[jt]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=Yt(s=e.g[t],n,r,i))&&($t(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=cn(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Yt(t,n,r,i)),(n=-1<e?t[e]:null)&&sn(n))}function sn(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[jt])Xt(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(on(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=cn(t))?(Xt(n,e),0==n.h&&(n.src=null,t[Jt]=null)):$t(e)}}}function on(e){return e in Zt?Zt[e]:Zt[e]="on"+e}function an(e,t){if(e.fa)e=!0;else{t=new Ut(t,this);var n=e.listener,r=e.la||e.src;e.ia&&sn(e),e=n.call(r,t)}return e}function cn(e){return(e=e[Jt])instanceof Qt?e:null}var un="__closure_events_fn_"+(1e9*Math.random()>>>0);function ln(e){return"function"==typeof e?e:(e[un]||(e[un]=function(t){return e.handleEvent(t)}),e[un])}function hn(){mt.call(this),this.i=new Qt(this),this.S=this,this.J=null}function dn(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new wt(t,e);else if(t instanceof wt)t.target=t.target||e;else{var i=t;Wt(t=new wt(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=fn(o,r,!0,t)&&i}if(i=fn(o=t.g=e,r,!0,t)&&i,i=fn(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=fn(o=t.g=n[s],r,!1,t)&&i}function fn(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&Xt(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}pt(hn,mt),hn.prototype[jt]=!0,hn.prototype.removeEventListener=function(e,t,n,r){rn(this,e,t,n,r)},hn.prototype.N=function(){if(hn.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)$t(n[r]);delete t.g[e],t.h--}}this.J=null},hn.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},hn.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var pn=st.JSON.stringify;function mn(){var e=En;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var gn=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new yn),(e=>e.reset()));class yn{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function vn(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function wn(e){st.setTimeout((()=>{throw e}),0)}let In,bn=!1,En=new class{constructor(){this.h=this.g=null}add(e,t){const n=gn.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},Tn=()=>{const e=st.Promise.resolve(void 0);In=()=>{e.then(_n)}};var _n=()=>{for(var e;e=mn();){try{e.h.call(e.g)}catch(e){wn(e)}var t=gn;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}bn=!1};function Sn(e,t){hn.call(this),this.h=e||1,this.g=t||st,this.j=dt(this.qb,this),this.l=Date.now()}function Cn(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function kn(e,t,n){if("function"==typeof e)n&&(e=dt(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=dt(e.handleEvent,e)}return 2147483647<Number(t)?-1:st.setTimeout(e,t||0)}function An(e){e.g=kn((()=>{e.g=null,e.i&&(e.i=!1,An(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}pt(Sn,hn),(tt=Sn.prototype).ga=!1,tt.T=null,tt.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),dn(this,"tick"),this.ga&&(Cn(this),this.start()))}},tt.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},tt.N=function(){Sn.$.N.call(this),Cn(this),delete this.g};class Dn extends mt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:An(this)}N(){super.N(),this.g&&(st.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Nn(e){mt.call(this),this.h=e,this.g={}}pt(Nn,mt);var xn=[];function Rn(e,t,n,r){Array.isArray(n)||(n&&(xn[0]=n.toString()),n=xn);for(var i=0;i<n.length;i++){var s=en(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function On(e){Kt(e.g,(function(e,t){this.g.hasOwnProperty(t)&&sn(e)}),e),e.g={}}function Pn(){this.g=!0}function Ln(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return pn(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}Nn.prototype.N=function(){Nn.$.N.call(this),On(this)},Nn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Pn.prototype.Ea=function(){this.g=!1},Pn.prototype.info=function(){};var Mn={},Fn=null;function Vn(){return Fn=Fn||new hn}function Un(e){wt.call(this,Mn.Ta,e)}function Bn(e){const t=Vn();dn(t,new Un(t))}function jn(e,t){wt.call(this,Mn.STAT_EVENT,e),this.stat=t}function qn(e){const t=Vn();dn(t,new jn(t,e))}function zn(e,t){wt.call(this,Mn.Ua,e),this.size=t}function $n(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return st.setTimeout((function(){e()}),t)}Mn.Ta="serverreachability",pt(Un,wt),Mn.STAT_EVENT="statevent",pt(jn,wt),Mn.Ua="timingevent",pt(zn,wt);var Kn={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Gn={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Hn(){}function Wn(e){return e.h||(e.h=e.i())}function Qn(){}Hn.prototype.h=null;var Xn,Yn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Jn(){wt.call(this,"d")}function Zn(){wt.call(this,"c")}function er(){}function tr(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new Nn(this),this.P=rr,e=xt?125:void 0,this.V=new Sn(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new nr}function nr(){this.i=null,this.g="",this.h=!1}pt(Jn,wt),pt(Zn,wt),pt(er,Hn),er.prototype.g=function(){return new XMLHttpRequest},er.prototype.i=function(){return{}},Xn=new er;var rr=45e3,ir={},sr={};function or(e,t,n){e.L=1,e.v=Sr(Ir(t)),e.s=n,e.S=!0,ar(e,null)}function ar(e,t){e.G=Date.now(),hr(e),e.A=Ir(e.v);var n=e.A,r=e.W;Array.isArray(r)||(r=[String(r)]),Vr(n.i,"t",r),e.C=0,n=e.l.J,e.h=new nr,e.g=Vi(e.l,n?t:null,!e.s),0<e.O&&(e.M=new Dn(dt(e.Pa,e,e.g),e.O)),Rn(e.U,e.g,"readystatechange",e.nb),t=e.I?Gt(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),Bn(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.W,e.s)}function cr(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.l.Ha}function ur(e,t,n){let r,i=!0;for(;!e.J&&e.C<n.length;){if(r=lr(e,n),r==sr){4==t&&(e.o=4,qn(14),i=!1),Ln(e.j,e.m,null,"[Incomplete Response]");break}if(r==ir){e.o=4,qn(15),Ln(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}Ln(e.j,e.m,r,null),gr(e,r)}cr(e)&&r!=sr&&r!=ir&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,qn(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Ni(t),t.M=!0,qn(11))):(Ln(e.j,e.m,n,"[Invalid Chunked Response]"),mr(e),pr(e))}function lr(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?sr:(n=Number(t.substring(n,r)),isNaN(n)?ir:(r+=1)+n>t.length?sr:(t=t.slice(r,r+n),e.C=r+n,t))}function hr(e){e.Y=Date.now()+e.P,dr(e,e.P)}function dr(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=$n(dt(e.lb,e),t)}function fr(e){e.B&&(st.clearTimeout(e.B),e.B=null)}function pr(e){0==e.l.H||e.J||Oi(e.l,e)}function mr(e){fr(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,Cn(e.V),On(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function gr(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||Kr(n.i,e)))if(!e.K&&Kr(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;Ri(n),Ei(n)}Di(n),qn(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=$n(dt(n.ib,n),6e3));if(1>=$r(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else Li(n,11)}else if((e.K||n.g==e)&&Ri(n),!bt(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Gr(s,s.h),s.h=null))}if(r.F){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,_r(r.I,r.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((r=n).wa=Fi(r,r.J?r.pa:null,r.Y),o.K){Hr(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.B&&(fr(a),hr(a)),r.g=o}else Ai(r);0<n.j.length&&_i(n)}else"stop"!=u[0]&&"close"!=u[0]||Li(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Li(n,7):bi(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}Bn()}catch(e){}}function yr(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(ot(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(ot(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(ot(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(tt=tr.prototype).setTimeout=function(e){this.P=e},tt.nb=function(e){e=e.target;const t=this.M;t&&3==mi(e)?t.l():this.Pa(e)},tt.Pa=function(e){try{if(e==this.g)e:{const l=mi(this.g);var t=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||xt||this.g&&(this.h.h||this.g.ja()||gi(this.g)))){this.J||4!=l||7==t||Bn(),fr(this);var n=this.g.da();this.ca=n;t:if(cr(this)){var r=gi(this.g);e="";var i=r.length,s=4==mi(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){mr(this),pr(this);var o="";break t}this.h.i=new st.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!bt(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,qn(12),mr(this),pr(this);break e}Ln(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,gr(this,n)}this.S?(ur(this,l,o),xt&&this.i&&3==l&&(Rn(this.U,this.V,"tick",this.mb),this.V.start())):(Ln(this.j,this.m,o,null),gr(this,o)),4==l&&mr(this),this.i&&!this.J&&(4==l?Oi(this.l,this):(this.i=!1,hr(this)))}else(function(e){const t={};e=(e.g&&2<=mi(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(bt(e[r]))continue;var n=vn(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,qn(12)):(this.o=0,qn(13)),mr(this),pr(this)}}}catch(e){}},tt.mb=function(){if(this.g){var e=mi(this.g),t=this.g.ja();this.C<t.length&&(fr(this),ur(this,e,t),this.i&&4!=e&&hr(this))}},tt.cancel=function(){this.J=!0,mr(this)},tt.lb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.L&&(Bn(),qn(17)),mr(this),this.o=2,pr(this)):dr(this,this.Y-e)};var vr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function wr(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof wr){this.h=e.h,br(this,e.j),this.s=e.s,this.g=e.g,Er(this,e.m),this.l=e.l;var t=e.i,n=new Pr;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Tr(this,n),this.o=e.o}else e&&(t=String(e).match(vr))?(this.h=!1,br(this,t[1]||"",!0),this.s=Cr(t[2]||""),this.g=Cr(t[3]||"",!0),Er(this,t[4]),this.l=Cr(t[5]||"",!0),Tr(this,t[6]||"",!0),this.o=Cr(t[7]||"")):(this.h=!1,this.i=new Pr(null,this.h))}function Ir(e){return new wr(e)}function br(e,t,n){e.j=n?Cr(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Er(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Tr(e,t,n){t instanceof Pr?(e.i=t,function(e,t){t&&!e.j&&(Lr(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Mr(this,t),Vr(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=kr(t,Rr)),e.i=new Pr(t,e.h))}function _r(e,t,n){e.i.set(t,n)}function Sr(e){return _r(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Cr(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function kr(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Ar),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Ar(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}wr.prototype.toString=function(){var e=[],t=this.j;t&&e.push(kr(t,Dr,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(kr(t,Dr,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(kr(n,"/"==n.charAt(0)?xr:Nr,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",kr(n,Or)),e.join("")};var Dr=/[#\/\?@]/g,Nr=/[#\?:]/g,xr=/[#\?]/g,Rr=/[#\?@]/g,Or=/#/g;function Pr(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Lr(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Mr(e,t){Lr(e),t=Ur(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Fr(e,t){return Lr(e),t=Ur(e,t),e.g.has(t)}function Vr(e,t,n){Mr(e,t),0<n.length&&(e.i=null,e.g.set(Ur(e,t),yt(n)),e.h+=n.length)}function Ur(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(tt=Pr.prototype).add=function(e,t){Lr(this),this.i=null,e=Ur(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},tt.forEach=function(e,t){Lr(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},tt.ta=function(){Lr(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},tt.Z=function(e){Lr(this);let t=[];if("string"==typeof e)Fr(this,e)&&(t=t.concat(this.g.get(Ur(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},tt.set=function(e,t){return Lr(this),this.i=null,Fr(this,e=Ur(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},tt.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},tt.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};var Br=class{constructor(e,t){this.g=e,this.map=t}};function jr(e){this.l=e||qr,e=st.PerformanceNavigationTiming?0<(e=st.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(st.g&&st.g.Ka&&st.g.Ka()&&st.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var qr=10;function zr(e){return!!e.h||!!e.g&&e.g.size>=e.j}function $r(e){return e.h?1:e.g?e.g.size:0}function Kr(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Gr(e,t){e.g?e.g.add(t):e.h=t}function Hr(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Wr(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return yt(e.i)}jr.prototype.cancel=function(){if(this.i=Wr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var Qr=class{stringify(e){return st.JSON.stringify(e,void 0)}parse(e){return st.JSON.parse(e,void 0)}};function Xr(){this.g=new Qr}function Yr(e,t,n){const r=n||"";try{yr(e,(function(e,n){let i=e;at(e)&&(i=pn(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Jr(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function Zr(e){this.l=e.fc||null,this.j=e.ob||!1}function ei(e,t){hn.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=ti,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}pt(Zr,Hn),Zr.prototype.g=function(){return new ei(this.l,this.j)},Zr.prototype.i=function(e){return function(){return e}}({}),pt(ei,hn);var ti=0;function ni(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function ri(e){e.readyState=4,e.l=null,e.j=null,e.A=null,ii(e)}function ii(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(tt=ei.prototype).open=function(e,t){if(this.readyState!=ti)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,ii(this)},tt.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||st).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},tt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ri(this)),this.readyState=ti},tt.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,ii(this)),this.g&&(this.readyState=3,ii(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==st.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ni(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},tt.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ri(this):ii(this),3==this.readyState&&ni(this)}},tt.Za=function(e){this.g&&(this.response=this.responseText=e,ri(this))},tt.Ya=function(e){this.g&&(this.response=e,ri(this))},tt.ka=function(){this.g&&ri(this)},tt.setRequestHeader=function(e,t){this.v.append(e,t)},tt.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},tt.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(ei.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var si=st.JSON.parse;function oi(e){hn.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=ai,this.L=this.M=!1}pt(oi,hn);var ai="",ci=/^https?$/i,ui=["POST","PUT"];function li(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,hi(e),fi(e)}function hi(e){e.F||(e.F=!0,dn(e,"complete"),dn(e,"error"))}function di(e){if(e.h&&void 0!==it&&(!e.C[1]||4!=mi(e)||2!=e.da()))if(e.v&&4==mi(e))kn(e.La,0,e);else if(dn(e,"readystatechange"),4==mi(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===o){var i=String(e.I).match(vr)[1]||null;!i&&st.self&&st.self.location&&(i=st.self.location.protocol.slice(0,-1)),r=!ci.test(i?i.toLowerCase():"")}n=r}if(n)dn(e,"complete"),dn(e,"success");else{e.m=6;try{var s=2<mi(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",hi(e)}}finally{fi(e)}}}function fi(e,t){if(e.g){pi(e);const n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||dn(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function pi(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(st.clearTimeout(e.A),e.A=null)}function mi(e){return e.g?e.g.readyState:0}function gi(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case ai:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function yi(e){let t="";return Kt(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function vi(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=yi(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):_r(e,t,n))}function wi(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Ii(e){this.Ga=0,this.j=[],this.l=new Pn,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=wi("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=wi("baseRetryDelayMs",5e3,e),this.hb=wi("retryDelaySeedMs",1e4,e),this.eb=wi("forwardChannelMaxRetries",2,e),this.xa=wi("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new jr(e&&e.concurrentRequestLimit),this.Ja=new Xr,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function bi(e){if(Ti(e),3==e.H){var t=e.W++,n=Ir(e.I);if(_r(n,"SID",e.K),_r(n,"RID",t),_r(n,"TYPE","terminate"),Ci(e,n),(t=new tr(e,e.l,t)).L=2,t.v=Sr(Ir(n)),n=!1,st.navigator&&st.navigator.sendBeacon)try{n=st.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&st.Image&&((new Image).src=t.v,n=!0),n||(t.g=Vi(t.l,null),t.g.ha(t.v)),t.G=Date.now(),hr(t)}Mi(e)}function Ei(e){e.g&&(Ni(e),e.g.cancel(),e.g=null)}function Ti(e){Ei(e),e.u&&(st.clearTimeout(e.u),e.u=null),Ri(e),e.i.cancel(),e.m&&("number"==typeof e.m&&st.clearTimeout(e.m),e.m=null)}function _i(e){if(!zr(e.i)&&!e.m){e.m=!0;var t=e.Na;In||Tn(),bn||(In(),bn=!0),En.add(t,e),e.C=0}}function Si(e,t){var n;n=t?t.m:e.W++;const r=Ir(e.I);_r(r,"SID",e.K),_r(r,"RID",n),_r(r,"AID",e.V),Ci(e,r),e.o&&e.s&&vi(r,e.o,e.s),n=new tr(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=ki(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),Gr(e.i,n),or(n,r,t)}function Ci(e,t){e.na&&Kt(e.na,(function(e,n){_r(t,n,e)})),e.h&&yr({},(function(e,n){_r(t,n,e)}))}function ki(e,t,n){n=Math.min(e.j.length,n);var r=e.h?dt(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{Yr(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function Ai(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;In||Tn(),bn||(In(),bn=!0),En.add(t,e),e.A=0}}function Di(e){return!(e.g||e.u||3<=e.A||(e.ba++,e.u=$n(dt(e.Ma,e),Pi(e,e.A)),e.A++,0))}function Ni(e){null!=e.B&&(st.clearTimeout(e.B),e.B=null)}function xi(e){e.g=new tr(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=Ir(e.wa);_r(t,"RID","rpc"),_r(t,"SID",e.K),_r(t,"AID",e.V),_r(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&_r(t,"TO",e.qa),_r(t,"TYPE","xmlhttp"),Ci(e,t),e.o&&e.s&&vi(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=Sr(Ir(t)),n.s=null,n.S=!0,ar(n,e)}function Ri(e){null!=e.v&&(st.clearTimeout(e.v),e.v=null)}function Oi(e,t){var n=null;if(e.g==t){Ri(e),Ni(e),e.g=null;var r=2}else{if(!Kr(e.i,t))return;n=t.F,Hr(e.i,t),r=1}if(0!=e.H)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.G;var i=e.C;dn(r=Vn(),new zn(r,n)),_i(e)}else Ai(e);else if(3==(i=t.o)||0==i&&0<t.ca||!(1==r&&function(e,t){return!($r(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=$n(dt(e.Na,e,t),Pi(e,e.C)),e.C++,0)))}(e,t)||2==r&&Di(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:Li(e,5);break;case 4:Li(e,10);break;case 3:Li(e,6);break;default:Li(e,2)}}function Pi(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function Li(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=dt(e.pb,e);n||(n=new wr("//www.google.com/images/cleardot.gif"),st.location&&"http"==st.location.protocol||br(n,"https"),Sr(n)),function(e,t){const n=new Pn;if(st.Image){const r=new Image;r.onload=ft(Jr,n,r,"TestLoadImage: loaded",!0,t),r.onerror=ft(Jr,n,r,"TestLoadImage: error",!1,t),r.onabort=ft(Jr,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=ft(Jr,n,r,"TestLoadImage: timeout",!1,t),st.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else qn(2);e.H=0,e.h&&e.h.za(t),Mi(e),Ti(e)}function Mi(e){if(e.H=0,e.ma=[],e.h){const t=Wr(e.i);0==t.length&&0==e.j.length||(vt(e.ma,t),vt(e.ma,e.j),e.i.i.length=0,yt(e.j),e.j.length=0),e.h.ya()}}function Fi(e,t,n){var r=n instanceof wr?Ir(n):new wr(n);if(""!=r.g)t&&(r.g=t+"."+r.g),Er(r,r.m);else{var i=st.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new wr(null);r&&br(s,r),t&&(s.g=t),i&&Er(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&_r(r,n,t),_r(r,"VER",e.ra),Ci(e,r),r}function Vi(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ha&&!e.va?new oi(new Zr({ob:!0})):new oi(e.va)).Oa(e.J),t}function Ui(){}function Bi(){if(Dt&&!(10<=Number(Vt)))throw Error("Environmental error: no available transport.")}function ji(e,t){hn.call(this),this.g=new Ii(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!bt(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!bt(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new $i(this)}function qi(e){Jn.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function zi(){Zn.call(this),this.status=1}function $i(e){this.g=e}function Ki(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Gi(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function Hi(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(tt=oi.prototype).Oa=function(e){this.M=e},tt.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Xn.g(),this.C=this.u?Wn(this.u):Wn(Xn),this.g.onreadystatechange=dt(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void li(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=st.FormData&&e instanceof st.FormData,!(0<=gt(ui,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{pi(this),0<this.B&&((this.L=function(e){return Dt&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=dt(this.ua,this)):this.A=kn(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){li(this,e)}},tt.ua=function(){void 0!==it&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,dn(this,"timeout"),this.abort(8))},tt.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,dn(this,"complete"),dn(this,"abort"),fi(this))},tt.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),fi(this,!0)),oi.$.N.call(this)},tt.La=function(){this.s||(this.G||this.v||this.l?di(this):this.kb())},tt.kb=function(){di(this)},tt.isActive=function(){return!!this.g},tt.da=function(){try{return 2<mi(this)?this.g.status:-1}catch(e){return-1}},tt.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},tt.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),si(t)}},tt.Ia=function(){return this.m},tt.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(tt=Ii.prototype).ra=8,tt.H=1,tt.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const i=new tr(this,this.l,e);let s=this.s;if(this.U&&(s?(s=Gt(s),Wt(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=ki(this,i,t),_r(n=Ir(this.I),"RID",e),_r(n,"CVER",22),this.F&&_r(n,"X-HTTP-Session-Id",this.F),Ci(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(yi(s)))+"&"+t:this.o&&vi(n,this.o,s)),Gr(this.i,i),this.bb&&_r(n,"TYPE","init"),this.P?(_r(n,"$req",t),_r(n,"SID","null"),i.aa=!0,or(i,n,null)):or(i,n,t),this.H=2}}else 3==this.H&&(e?Si(this,e):0==this.j.length||zr(this.i)||Si(this))},tt.Ma=function(){if(this.u=null,xi(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=$n(dt(this.jb,this),e)}},tt.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,qn(10),Ei(this),xi(this))},tt.ib=function(){null!=this.v&&(this.v=null,Ei(this),Di(this),qn(19))},tt.pb=function(e){e?(this.l.info("Successfully pinged google.com"),qn(2)):(this.l.info("Failed to ping google.com"),qn(1))},tt.isActive=function(){return!!this.h&&this.h.isActive(this)},(tt=Ui.prototype).Ba=function(){},tt.Aa=function(){},tt.za=function(){},tt.ya=function(){},tt.isActive=function(){return!0},tt.Va=function(){},Bi.prototype.g=function(e,t){return new ji(e,t)},pt(ji,hn),ji.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;qn(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=Fi(e,null,e.Y),_i(e)},ji.prototype.close=function(){bi(this.g)},ji.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=pn(e),e=n);t.j.push(new Br(t.fb++,e)),3==t.H&&_i(t)},ji.prototype.N=function(){this.g.h=null,delete this.j,bi(this.g),delete this.g,ji.$.N.call(this)},pt(qi,Jn),pt(zi,Zn),pt($i,Ui),$i.prototype.Ba=function(){dn(this.g,"a")},$i.prototype.Aa=function(e){dn(this.g,new qi(e))},$i.prototype.za=function(e){dn(this.g,new zi)},$i.prototype.ya=function(){dn(this.g,"b")},pt(Ki,(function(){this.blockSize=-1})),Ki.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Ki.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)Gi(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){Gi(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){Gi(this,r),i=0;break}}this.h=i,this.i+=t},Ki.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var Wi={};function Qi(e){return-128<=e&&128>e?function(e){var t=Wi;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new Hi([0|e],0>e?-1:0)}(e)}(e):new Hi([0|e],0>e?-1:0)}function Xi(e){if(isNaN(e)||!isFinite(e))return Ji;if(0>e)return rs(Xi(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=Yi;return new Hi(t,0)}var Yi=4294967296,Ji=Qi(0),Zi=Qi(1),es=Qi(16777216);function ts(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function ns(e){return-1==e.h}function rs(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new Hi(n,~e.h).add(Zi)}function is(e,t){return e.add(rs(t))}function ss(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function os(e,t){this.g=e,this.h=t}function as(e,t){if(ts(t))throw Error("division by zero");if(ts(e))return new os(Ji,Ji);if(ns(e))return t=as(rs(e),t),new os(rs(t.g),rs(t.h));if(ns(t))return t=as(e,rs(t)),new os(rs(t.g),t.h);if(30<e.g.length){if(ns(e)||ns(t))throw Error("slowDivide_ only works with positive integers.");for(var n=Zi,r=t;0>=r.X(e);)n=cs(n),r=cs(r);var i=us(n,1),s=us(r,1);for(r=us(r,2),n=us(n,2);!ts(r);){var o=s.add(r);0>=o.X(e)&&(i=i.add(n),s=o),r=us(r,1),n=us(n,1)}return t=is(e,i.R(t)),new os(i,t)}for(i=Ji;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=Xi(n)).R(t);ns(o)||0<o.X(e);)o=(s=Xi(n-=r)).R(t);ts(s)&&(s=Zi),i=i.add(s),e=is(e,o)}return new os(i,e)}function cs(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new Hi(n,e.h)}function us(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new Hi(i,e.h)}(tt=Hi.prototype).ea=function(){if(ns(this))return-rs(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:Yi+r)*t,t*=Yi}return e},tt.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(ts(this))return"0";if(ns(this))return"-"+rs(this).toString(e);for(var t=Xi(Math.pow(e,6)),n=this,r="";;){var i=as(n,t).g,s=((0<(n=is(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(ts(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},tt.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},tt.X=function(e){return ns(e=is(this,e))?-1:ts(e)?0:1},tt.abs=function(){return ns(this)?rs(this):this},tt.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new Hi(n,-2147483648&n[n.length-1]?-1:0)},tt.R=function(e){if(ts(this)||ts(e))return Ji;if(ns(this))return ns(e)?rs(this).R(rs(e)):rs(rs(this).R(e));if(ns(e))return rs(this.R(rs(e)));if(0>this.X(es)&&0>e.X(es))return Xi(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=e.D(i)>>>16,c=65535&e.D(i);n[2*r+2*i]+=o*c,ss(n,2*r+2*i),n[2*r+2*i+1]+=s*c,ss(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,ss(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,ss(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new Hi(n,0)},tt.gb=function(e){return as(this,e).h},tt.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new Hi(n,this.h&e.h)},tt.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new Hi(n,this.h|e.h)},tt.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new Hi(n,this.h^e.h)},Bi.prototype.createWebChannel=Bi.prototype.g,ji.prototype.send=ji.prototype.u,ji.prototype.open=ji.prototype.m,ji.prototype.close=ji.prototype.close,Kn.NO_ERROR=0,Kn.TIMEOUT=8,Kn.HTTP_ERROR=6,Gn.COMPLETE="complete",Qn.EventType=Yn,Yn.OPEN="a",Yn.CLOSE="b",Yn.ERROR="c",Yn.MESSAGE="d",hn.prototype.listen=hn.prototype.O,oi.prototype.listenOnce=oi.prototype.P,oi.prototype.getLastError=oi.prototype.Sa,oi.prototype.getLastErrorCode=oi.prototype.Ia,oi.prototype.getStatus=oi.prototype.da,oi.prototype.getResponseJson=oi.prototype.Wa,oi.prototype.getResponseText=oi.prototype.ja,oi.prototype.send=oi.prototype.ha,oi.prototype.setWithCredentials=oi.prototype.Oa,Ki.prototype.digest=Ki.prototype.l,Ki.prototype.reset=Ki.prototype.reset,Ki.prototype.update=Ki.prototype.j,Hi.prototype.add=Hi.prototype.add,Hi.prototype.multiply=Hi.prototype.R,Hi.prototype.modulo=Hi.prototype.gb,Hi.prototype.compare=Hi.prototype.X,Hi.prototype.toNumber=Hi.prototype.ea,Hi.prototype.toString=Hi.prototype.toString,Hi.prototype.getBits=Hi.prototype.D,Hi.fromNumber=Xi,Hi.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return rs(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=Xi(Math.pow(n,8)),i=Ji,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=Xi(Math.pow(n,o)),i=i.R(o).add(Xi(a))):i=(i=i.R(r)).add(Xi(a))}return i};var ls=rt.createWebChannelTransport=function(){return new Bi},hs=rt.getStatEventTarget=function(){return Vn()},ds=rt.ErrorCode=Kn,fs=rt.EventType=Gn,ps=rt.Event=Mn,ms=rt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},gs=rt.FetchXmlHttpFactory=Zr,ys=rt.WebChannel=Qn,vs=rt.XhrIo=oi,ws=rt.Md5=Ki,Is=rt.Integer=Hi,bs=n(606);const Es="@firebase/firestore";class Ts{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ts.UNAUTHENTICATED=new Ts(null),Ts.GOOGLE_CREDENTIALS=new Ts("google-credentials-uid"),Ts.FIRST_PARTY=new Ts("first-party-uid"),Ts.MOCK_USER=new Ts("mock-user");let _s="9.23.0";const Ss=new q("@firebase/firestore");function Cs(){return Ss.logLevel}function ks(e,...t){if(Ss.logLevel<=F.DEBUG){const n=t.map(Ns);Ss.debug(`Firestore (${_s}): ${e}`,...n)}}function As(e,...t){if(Ss.logLevel<=F.ERROR){const n=t.map(Ns);Ss.error(`Firestore (${_s}): ${e}`,...n)}}function Ds(e,...t){if(Ss.logLevel<=F.WARN){const n=t.map(Ns);Ss.warn(`Firestore (${_s}): ${e}`,...n)}}function Ns(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function xs(e="Unexpected state"){const t=`FIRESTORE (${_s}) INTERNAL ASSERTION FAILED: `+e;throw As(t),new Error(t)}function Rs(e,t){e||xs()}function Os(e,t){return e}const Ps={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ls extends I{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ms{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Fs{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Vs{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ts.UNAUTHENTICATED)))}shutdown(){}}class Us{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Bs{constructor(e){this.t=e,this.currentUser=Ts.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Ms;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Ms,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{ks("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(ks("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Ms)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(ks("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Rs("string"==typeof t.accessToken),new Fs(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Rs(null===e||"string"==typeof e),new Ts(e)}}class js{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=Ts.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class qs{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new js(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(Ts.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class zs{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class $s{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){const n=e=>{null!=e.error&&ks("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.T;return this.T=e.token,ks("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{ks("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.I.getImmediate({optional:!0});e?r(e):ks("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Rs("string"==typeof e.token),this.T=e.token,new zs(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Ks(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class Gs{static A(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=Ks(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function Hs(e,t){return e<t?-1:e>t?1:0}function Ws(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function Qs(e){return e+"\0"}class Xs{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ls(Ps.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ls(Ps.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Ls(Ps.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ls(Ps.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Xs.fromMillis(Date.now())}static fromDate(e){return Xs.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Xs(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Hs(this.nanoseconds,e.nanoseconds):Hs(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Ys{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ys(e)}static min(){return new Ys(new Xs(0,0))}static max(){return new Ys(new Xs(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Js{constructor(e,t,n){void 0===t?t=0:t>e.length&&xs(),void 0===n?n=e.length-t:n>e.length-t&&xs(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Js.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Js?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Zs extends Js{construct(e,t,n){return new Zs(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Ls(Ps.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new Zs(t)}static emptyPath(){return new Zs([])}}const eo=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class to extends Js{construct(e,t,n){return new to(e,t,n)}static isValidIdentifier(e){return eo.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),to.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new to(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Ls(Ps.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Ls(Ps.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Ls(Ps.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new Ls(Ps.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new to(t)}static emptyPath(){return new to([])}}class no{constructor(e){this.path=e}static fromPath(e){return new no(Zs.fromString(e))}static fromName(e){return new no(Zs.fromString(e).popFirst(5))}static empty(){return new no(Zs.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Zs.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Zs.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new no(new Zs(e.slice()))}}class ro{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function io(e){return e.fields.find((e=>2===e.kind))}function so(e){return e.fields.filter((e=>2!==e.kind))}ro.UNKNOWN_ID=-1;class oo{constructor(e,t){this.fieldPath=e,this.kind=t}}class ao{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ao(0,uo.min())}}function co(e){return new uo(e.readTime,e.key,-1)}class uo{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new uo(Ys.min(),no.empty(),-1)}static max(){return new uo(Ys.max(),no.empty(),-1)}}function lo(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=no.comparator(e.documentKey,t.documentKey),0!==n?n:Hs(e.largestBatchId,t.largestBatchId))}const ho="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class fo{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function po(e){if(e.code!==Ps.FAILED_PRECONDITION||e.message!==ho)throw e;ks("LocalStore","Unexpectedly lost primary lease")}class mo{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&xs(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new mo(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof mo?t:mo.resolve(t)}catch(e){return mo.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):mo.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):mo.reject(t)}static resolve(e){return new mo(((t,n)=>{t(e)}))}static reject(e){return new mo(((t,n)=>{n(e)}))}static waitFor(e){return new mo(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=mo.resolve(!1);for(const n of e)t=t.next((e=>e?mo.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new mo(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new mo(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}class go{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.v=new Ms,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{t.error?this.v.reject(new wo(e,t.error)):this.v.resolve()},this.transaction.onerror=t=>{const n=_o(t.target.error);this.v.reject(new wo(e,n))}}static open(e,t,n,r){try{return new go(t,e.transaction(r,n))}catch(e){throw new wo(t,e)}}get R(){return this.v.promise}abort(e){e&&this.v.reject(e),this.aborted||(ks("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new bo(t)}}class yo{constructor(e,t,n){this.name=e,this.version=t,this.V=n,12.2===yo.S(m())&&As("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return ks("SimpleDb","Removing database:",e),Eo(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!v())return!1;if(yo.C())return!0;const e=m(),t=yo.S(e),n=0<t&&t<10,r=yo.N(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static C(){var e;return void 0!==bs&&"YES"===(null===(e=bs.env)||void 0===e?void 0:e.k)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static N(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async $(e){return this.db||(ks("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new wo(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new Ls(Ps.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Ls(Ps.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new wo(e,r))},r.onupgradeneeded=e=>{ks("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.V.O(t,r.transaction,e.oldVersion,this.version).next((()=>{ks("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.F&&(this.db.onversionchange=e=>this.F(e)),this.db}B(e){this.F=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.$(e);const t=go.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.P(),e))).catch((e=>(t.abort(e),mo.reject(e)))).toPromise();return s.catch((()=>{})),await t.R,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(ks("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class vo{constructor(e){this.L=e,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(e){this.L=e}done(){this.q=!0}G(e){this.U=e}delete(){return Eo(this.L.delete())}}class wo extends Ls{constructor(e,t){super(Ps.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Io(e){return"IndexedDbTransactionError"===e.name}class bo{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(ks("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(ks("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Eo(n)}add(e){return ks("SimpleDb","ADD",this.store.name,e,e),Eo(this.store.add(e))}get(e){return Eo(this.store.get(e)).next((t=>(void 0===t&&(t=null),ks("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return ks("SimpleDb","DELETE",this.store.name,e),Eo(this.store.delete(e))}count(){return ks("SimpleDb","COUNT",this.store.name),Eo(this.store.count())}j(e,t){const n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){const e=this.cursor(n),t=[];return this.W(e,((e,n)=>{t.push(n)})).next((()=>t))}{const e=this.store.getAll(n.range);return new mo(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}}H(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new mo(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}J(e,t){ks("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Y=!1;const r=this.cursor(n);return this.W(r,((e,t,n)=>n.delete()))}X(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.W(r,t)}Z(e){const t=this.cursor({});return new mo(((n,r)=>{t.onerror=e=>{const t=_o(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}W(e,t){const n=[];return new mo(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new vo(i),o=t(i.primaryKey,i.value,s);if(o instanceof mo){const e=o.catch((e=>(s.done(),mo.reject(e))));n.push(e)}s.isDone?r():null===s.K?i.continue():i.continue(s.K)}})).next((()=>mo.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Eo(e){return new mo(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=_o(e.target.error);n(t)}}))}let To=!1;function _o(e){const t=yo.S(m());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new Ls("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return To||(To=!0,setTimeout((()=>{throw e}),0)),e}}return e}class So{constructor(e,t){this.asyncQueue=e,this.tt=t,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(e){ks("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{ks("IndexBackiller",`Documents written: ${await this.tt.nt()}`)}catch(e){Io(e)?ks("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await po(e)}await this.et(6e4)}))}}class Co{constructor(e,t){this.localStore=e,this.persistence=t}async nt(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.st(t,e)))}st(e,t){const n=new Set;let r=t,i=!0;return mo.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return ks("IndexBackiller",`Processing collection: ${t}`),this.it(e,t,r).next((e=>{r-=e,n.add(t)}));i=!1})))).next((()=>t-r))}it(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.rt(r,n))).next((n=>(ks("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}rt(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=co(t);lo(r,n)>0&&(n=r)})),new uo(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ko{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ut&&this.ut(e),e}}function Ao(e){return null==e}function Do(e){return 0===e&&1/e==-1/0}function No(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Ro(t)),t=xo(e.get(n),t);return Ro(t)}function xo(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Ro(e){return e+""}function Oo(e){const t=e.length;if(Rs(t>=2),2===t)return Rs(""===e.charAt(0)&&""===e.charAt(1)),Zs.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("",s);switch((t<0||t>n)&&xs(),e.charAt(t+1)){case"":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:xs()}s=t+2}return new Zs(r)}ko.ct=-1;const Po=["userId","batchId"];function Lo(e,t){return[e,No(t)]}function Mo(e,t,n){return[e,No(t),n]}const Fo={},Vo=["prefixPath","collectionGroup","readTime","documentId"],Uo=["prefixPath","collectionGroup","documentId"],Bo=["collectionGroup","readTime","prefixPath","documentId"],jo=["canonicalId","targetId"],qo=["targetId","path"],zo=["path","targetId"],$o=["collectionId","parent"],Ko=["indexId","uid"],Go=["uid","sequenceNumber"],Ho=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Wo=["indexId","uid","orderedDocumentKey"],Qo=["userId","collectionPath","documentId"],Xo=["userId","collectionPath","largestBatchId"],Yo=["userId","collectionGroup","largestBatchId"],Jo=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Zo=[...Jo,"documentOverlays"],ea=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ta=ea,na=[...ta,"indexConfiguration","indexState","indexEntries"];class ra extends fo{constructor(e,t){super(),this.ht=e,this.currentSequenceNumber=t}}function ia(e,t){const n=Os(e);return yo.M(n.ht,t)}function sa(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function oa(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function aa(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class ca{constructor(e,t){this.comparator=e,this.root=t||la.EMPTY}insert(e,t){return new ca(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,la.BLACK,null,null))}remove(e){return new ca(this.comparator,this.root.remove(e,this.comparator).copy(null,null,la.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ua(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ua(this.root,e,this.comparator,!1)}getReverseIterator(){return new ua(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ua(this.root,e,this.comparator,!0)}}class ua{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class la{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:la.RED,this.left=null!=r?r:la.EMPTY,this.right=null!=i?i:la.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new la(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return la.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return la.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,la.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,la.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw xs();if(this.right.isRed())throw xs();const e=this.left.check();if(e!==this.right.check())throw xs();return e+(this.isRed()?0:1)}}la.EMPTY=null,la.RED=!0,la.BLACK=!1,la.EMPTY=new class{constructor(){this.size=0}get key(){throw xs()}get value(){throw xs()}get color(){throw xs()}get left(){throw xs()}get right(){throw xs()}copy(e,t,n,r,i){return this}insert(e,t,n){return new la(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ha{constructor(e){this.comparator=e,this.data=new ca(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new da(this.data.getIterator())}getIteratorFrom(e){return new da(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof ha))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ha(this.comparator);return t.data=e,t}}class da{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function fa(e){return e.hasNext()?e.getNext():void 0}class pa{constructor(e){this.fields=e,e.sort(to.comparator)}static empty(){return new pa([])}unionWith(e){let t=new ha(to.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new pa(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ws(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class ma extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ga{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new ma("Invalid base64 string: "+e):e}}(e);return new ga(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new ga(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Hs(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ga.EMPTY_BYTE_STRING=new ga("");const ya=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function va(e){if(Rs(!!e),"string"==typeof e){let t=0;const n=ya.exec(e);if(Rs(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:wa(e.seconds),nanos:wa(e.nanos)}}function wa(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ia(e){return"string"==typeof e?ga.fromBase64String(e):ga.fromUint8Array(e)}function ba(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ea(e){const t=e.mapValue.fields.__previous_value__;return ba(t)?Ea(t):t}function Ta(e){const t=va(e.mapValue.fields.__local_write_time__.timestampValue);return new Xs(t.seconds,t.nanos)}class _a{constructor(e,t,n,r,i,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Sa{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Sa("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Sa&&e.projectId===this.projectId&&e.database===this.database}}const Ca={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},ka={nullValue:"NULL_VALUE"};function Aa(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ba(e)?4:qa(e)?9007199254740991:10:xs()}function Da(e,t){if(e===t)return!0;const n=Aa(e);if(n!==Aa(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ta(e).isEqual(Ta(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=va(e.timestampValue),r=va(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Ia(e.bytesValue).isEqual(Ia(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return wa(e.geoPointValue.latitude)===wa(t.geoPointValue.latitude)&&wa(e.geoPointValue.longitude)===wa(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return wa(e.integerValue)===wa(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=wa(e.doubleValue),r=wa(t.doubleValue);return n===r?Do(n)===Do(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Ws(e.arrayValue.values||[],t.arrayValue.values||[],Da);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(sa(n)!==sa(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Da(n[e],r[e])))return!1;return!0}(e,t);default:return xs()}}function Na(e,t){return void 0!==(e.values||[]).find((e=>Da(e,t)))}function xa(e,t){if(e===t)return 0;const n=Aa(e),r=Aa(t);if(n!==r)return Hs(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Hs(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=wa(e.integerValue||e.doubleValue),r=wa(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Ra(e.timestampValue,t.timestampValue);case 4:return Ra(Ta(e),Ta(t));case 5:return Hs(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ia(e),r=Ia(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=Hs(n[e],r[e]);if(0!==t)return t}return Hs(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Hs(wa(e.latitude),wa(t.latitude));return 0!==n?n:Hs(wa(e.longitude),wa(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=xa(n[e],r[e]);if(t)return t}return Hs(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Ca.mapValue&&t===Ca.mapValue)return 0;if(e===Ca.mapValue)return 1;if(t===Ca.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=Hs(r[e],s[e]);if(0!==t)return t;const o=xa(n[r[e]],i[s[e]]);if(0!==o)return o}return Hs(r.length,s.length)}(e.mapValue,t.mapValue);default:throw xs()}}function Ra(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Hs(e,t);const n=va(e),r=va(t),i=Hs(n.seconds,r.seconds);return 0!==i?i:Hs(n.nanos,r.nanos)}function Oa(e){return Pa(e)}function Pa(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=va(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ia(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,no.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Pa(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Pa(e.fields[i])}`;return n+"}"}(e.mapValue):xs();var t,n}function La(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Ma(e){return!!e&&"integerValue"in e}function Fa(e){return!!e&&"arrayValue"in e}function Va(e){return!!e&&"nullValue"in e}function Ua(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Ba(e){return!!e&&"mapValue"in e}function ja(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return oa(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=ja(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=ja(e.arrayValue.values[n]);return t}return Object.assign({},e)}function qa(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function za(e){return"nullValue"in e?ka:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?La(Sa.empty(),no.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:xs()}function $a(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?La(Sa.empty(),no.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?Ca:xs()}function Ka(e,t){const n=xa(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Ga(e,t){const n=xa(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Ha{constructor(e){this.value=e}static empty(){return new Ha({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ba(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ja(t)}setAll(e){let t=to.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=ja(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Ba(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Da(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Ba(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){oa(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Ha(ja(this.value))}}function Wa(e){const t=[];return oa(e.fields,((e,n)=>{const r=new to([e]);if(Ba(n)){const e=Wa(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new pa(t)}class Qa{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new Qa(e,0,Ys.min(),Ys.min(),Ys.min(),Ha.empty(),0)}static newFoundDocument(e,t,n,r){return new Qa(e,1,t,Ys.min(),n,r,0)}static newNoDocument(e,t){return new Qa(e,2,t,Ys.min(),Ys.min(),Ha.empty(),0)}static newUnknownDocument(e,t){return new Qa(e,3,t,Ys.min(),Ys.min(),Ha.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ys.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ha.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ha.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ys.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Qa&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Qa(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Xa{constructor(e,t){this.position=e,this.inclusive=t}}function Ya(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?no.comparator(no.fromName(o.referenceValue),n.key):xa(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Ja(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Da(e.position[n],t.position[n]))return!1;return!0}class Za{constructor(e,t="asc"){this.field=e,this.dir=t}}function ec(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class tc{}class nc extends tc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new dc(e,t,n):"array-contains"===t?new gc(e,n):"in"===t?new yc(e,n):"not-in"===t?new vc(e,n):"array-contains-any"===t?new wc(e,n):new nc(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new fc(e,n):new pc(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(xa(t,this.value)):null!==t&&Aa(this.value)===Aa(t)&&this.matchesComparison(xa(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return xs()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class rc extends tc{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new rc(e,t)}matches(e){return ic(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft((e=>e.isInequality()));return null!==e?e.field:null}ft(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function ic(e){return"and"===e.op}function sc(e){return"or"===e.op}function oc(e){return ac(e)&&ic(e)}function ac(e){for(const t of e.filters)if(t instanceof rc)return!1;return!0}function cc(e){if(e instanceof nc)return e.field.canonicalString()+e.op.toString()+Oa(e.value);if(oc(e))return e.filters.map((e=>cc(e))).join(",");{const t=e.filters.map((e=>cc(e))).join(",");return`${e.op}(${t})`}}function uc(e,t){return e instanceof nc?function(e,t){return t instanceof nc&&e.op===t.op&&e.field.isEqual(t.field)&&Da(e.value,t.value)}(e,t):e instanceof rc?function(e,t){return t instanceof rc&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&uc(n,t.filters[r])),!0)}(e,t):void xs()}function lc(e,t){const n=e.filters.concat(t);return rc.create(n,e.op)}function hc(e){return e instanceof nc?function(e){return`${e.field.canonicalString()} ${e.op} ${Oa(e.value)}`}(e):e instanceof rc?function(e){return e.op.toString()+" {"+e.getFilters().map(hc).join(" ,")+"}"}(e):"Filter"}class dc extends nc{constructor(e,t,n){super(e,t,n),this.key=no.fromName(n.referenceValue)}matches(e){const t=no.comparator(e.key,this.key);return this.matchesComparison(t)}}class fc extends nc{constructor(e,t){super(e,"in",t),this.keys=mc(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class pc extends nc{constructor(e,t){super(e,"not-in",t),this.keys=mc(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function mc(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>no.fromName(e.referenceValue)))}class gc extends nc{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Fa(t)&&Na(t.arrayValue,this.value)}}class yc extends nc{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Na(this.value.arrayValue,t)}}class vc extends nc{constructor(e,t){super(e,"not-in",t)}matches(e){if(Na(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Na(this.value.arrayValue,t)}}class wc extends nc{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Fa(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Na(this.value.arrayValue,e)))}}class Ic{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.dt=null}}function bc(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Ic(e,t,n,r,i,s,o)}function Ec(e){const t=Os(e);if(null===t.dt){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>cc(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Ao(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Oa(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Oa(e))).join(",")),t.dt=e}return t.dt}function Tc(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!ec(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!uc(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Ja(e.startAt,t.startAt)&&Ja(e.endAt,t.endAt)}function _c(e){return no.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Sc(e,t){return e.filters.filter((e=>e instanceof nc&&e.field.isEqual(t)))}function Cc(e,t,n){let r=ka,i=!0;for(const n of Sc(e,t)){let e=ka,t=!0;switch(n.op){case"<":case"<=":e=za(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=ka}Ka({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Ka({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function kc(e,t,n){let r=Ca,i=!0;for(const n of Sc(e,t)){let e=Ca,t=!0;switch(n.op){case">=":case">":e=$a(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=Ca}Ga({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Ga({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class Ac{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function Dc(e){return new Ac(e)}function Nc(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function xc(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function Rc(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function Oc(e){return null!==e.collectionGroup}function Pc(e){const t=Os(e);if(null===t.wt){t.wt=[];const e=Rc(t),n=xc(t);if(null!==e&&null===n)e.isKeyField()||t.wt.push(new Za(e)),t.wt.push(new Za(to.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.wt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.wt.push(new Za(to.keyField(),e))}}}return t.wt}function Lc(e){const t=Os(e);if(!t._t)if("F"===t.limitType)t._t=bc(t.path,t.collectionGroup,Pc(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of Pc(t)){const t="desc"===n.dir?"asc":"desc";e.push(new Za(n.field,t))}const n=t.endAt?new Xa(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Xa(t.startAt.position,t.startAt.inclusive):null;t._t=bc(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t._t}function Mc(e,t){t.getFirstInequalityField(),Rc(e);const n=e.filters.concat([t]);return new Ac(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Fc(e,t,n){return new Ac(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Vc(e,t){return Tc(Lc(e),Lc(t))&&e.limitType===t.limitType}function Uc(e){return`${Ec(Lc(e))}|lt:${e.limitType}`}function Bc(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>hc(e))).join(", ")}]`),Ao(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Oa(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Oa(e))).join(",")),`Target(${t})`}(Lc(e))}; limitType=${e.limitType})`}function jc(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):no.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Pc(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Ya(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Pc(e),t)||e.endAt&&!function(e,t,n){const r=Ya(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Pc(e),t))}(e,t)}function qc(e){return(t,n)=>{let r=!1;for(const i of Pc(e)){const e=zc(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function zc(e,t,n){const r=e.field.isKeyField()?no.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?xa(r,i):xs()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return xs()}}class $c{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){oa(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return aa(this.inner)}size(){return this.innerSize}}const Kc=new ca(no.comparator);function Gc(){return Kc}const Hc=new ca(no.comparator);function Wc(...e){let t=Hc;for(const n of e)t=t.insert(n.key,n);return t}function Qc(e){let t=Hc;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Xc(){return Jc()}function Yc(){return Jc()}function Jc(){return new $c((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Zc=new ca(no.comparator),eu=new ha(no.comparator);function tu(...e){let t=eu;for(const n of e)t=t.add(n);return t}const nu=new ha(Hs);function ru(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Do(t)?"-0":t}}function iu(e){return{integerValue:""+e}}function su(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!Do(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?iu(t):ru(e,t)}class ou{constructor(){this._=void 0}}function au(e,t,n){return e instanceof lu?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&ba(t)&&(t=Ea(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof hu?du(e,t):e instanceof fu?pu(e,t):function(e,t){const n=uu(e,t),r=gu(n)+gu(e.gt);return Ma(n)&&Ma(e.gt)?iu(r):ru(e.serializer,r)}(e,t)}function cu(e,t,n){return e instanceof hu?du(e,t):e instanceof fu?pu(e,t):n}function uu(e,t){return e instanceof mu?Ma(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class lu extends ou{}class hu extends ou{constructor(e){super(),this.elements=e}}function du(e,t){const n=yu(t);for(const t of e.elements)n.some((e=>Da(e,t)))||n.push(t);return{arrayValue:{values:n}}}class fu extends ou{constructor(e){super(),this.elements=e}}function pu(e,t){let n=yu(t);for(const t of e.elements)n=n.filter((e=>!Da(e,t)));return{arrayValue:{values:n}}}class mu extends ou{constructor(e,t){super(),this.serializer=e,this.gt=t}}function gu(e){return wa(e.integerValue||e.doubleValue)}function yu(e){return Fa(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class vu{constructor(e,t){this.field=e,this.transform=t}}class wu{constructor(e,t){this.version=e,this.transformResults=t}}class Iu{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Iu}static exists(e){return new Iu(void 0,e)}static updateTime(e){return new Iu(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function bu(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Eu{}function Tu(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Ou(e.key,Iu.none()):new Au(e.key,e.data,Iu.none());{const n=e.data,r=Ha.empty();let i=new ha(to.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Du(e.key,r,new pa(i.toArray()),Iu.none())}}function _u(e,t,n){e instanceof Au?function(e,t,n){const r=e.value.clone(),i=xu(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Du?function(e,t,n){if(!bu(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=xu(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Nu(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Su(e,t,n,r){return e instanceof Au?function(e,t,n,r){if(!bu(e.precondition,t))return n;const i=e.value.clone(),s=Ru(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Du?function(e,t,n,r){if(!bu(e.precondition,t))return n;const i=Ru(e.fieldTransforms,r,t),s=t.data;return s.setAll(Nu(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return bu(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Cu(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=uu(r.transform,e||null);null!=i&&(null===n&&(n=Ha.empty()),n.set(r.field,i))}return n||null}function ku(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Ws(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof hu&&t instanceof hu||e instanceof fu&&t instanceof fu?Ws(e.elements,t.elements,Da):e instanceof mu&&t instanceof mu?Da(e.gt,t.gt):e instanceof lu&&t instanceof lu}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Au extends Eu{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Du extends Eu{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Nu(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function xu(e,t,n){const r=new Map;Rs(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,cu(o,a,n[i]))}return r}function Ru(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,au(e,s,t))}return r}class Ou extends Eu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Pu extends Eu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Lu{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&_u(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Su(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Su(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Yc();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=Tu(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(Ys.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),tu())}isEqual(e){return this.batchId===e.batchId&&Ws(this.mutations,e.mutations,((e,t)=>ku(e,t)))&&Ws(this.baseMutations,e.baseMutations,((e,t)=>ku(e,t)))}}class Mu{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Rs(e.mutations.length===n.length);let r=Zc;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Mu(e,t,n,r)}}class Fu{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Vu{constructor(e,t){this.count=e,this.unchangedNames=t}}var Uu,Bu;function ju(e){if(void 0===e)return As("GRPC error has no .code"),Ps.UNKNOWN;switch(e){case Uu.OK:return Ps.OK;case Uu.CANCELLED:return Ps.CANCELLED;case Uu.UNKNOWN:return Ps.UNKNOWN;case Uu.DEADLINE_EXCEEDED:return Ps.DEADLINE_EXCEEDED;case Uu.RESOURCE_EXHAUSTED:return Ps.RESOURCE_EXHAUSTED;case Uu.INTERNAL:return Ps.INTERNAL;case Uu.UNAVAILABLE:return Ps.UNAVAILABLE;case Uu.UNAUTHENTICATED:return Ps.UNAUTHENTICATED;case Uu.INVALID_ARGUMENT:return Ps.INVALID_ARGUMENT;case Uu.NOT_FOUND:return Ps.NOT_FOUND;case Uu.ALREADY_EXISTS:return Ps.ALREADY_EXISTS;case Uu.PERMISSION_DENIED:return Ps.PERMISSION_DENIED;case Uu.FAILED_PRECONDITION:return Ps.FAILED_PRECONDITION;case Uu.ABORTED:return Ps.ABORTED;case Uu.OUT_OF_RANGE:return Ps.OUT_OF_RANGE;case Uu.UNIMPLEMENTED:return Ps.UNIMPLEMENTED;case Uu.DATA_LOSS:return Ps.DATA_LOSS;default:return xs()}}(Bu=Uu||(Uu={}))[Bu.OK=0]="OK",Bu[Bu.CANCELLED=1]="CANCELLED",Bu[Bu.UNKNOWN=2]="UNKNOWN",Bu[Bu.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Bu[Bu.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Bu[Bu.NOT_FOUND=5]="NOT_FOUND",Bu[Bu.ALREADY_EXISTS=6]="ALREADY_EXISTS",Bu[Bu.PERMISSION_DENIED=7]="PERMISSION_DENIED",Bu[Bu.UNAUTHENTICATED=16]="UNAUTHENTICATED",Bu[Bu.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Bu[Bu.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Bu[Bu.ABORTED=10]="ABORTED",Bu[Bu.OUT_OF_RANGE=11]="OUT_OF_RANGE",Bu[Bu.UNIMPLEMENTED=12]="UNIMPLEMENTED",Bu[Bu.INTERNAL=13]="INTERNAL",Bu[Bu.UNAVAILABLE=14]="UNAVAILABLE",Bu[Bu.DATA_LOSS=15]="DATA_LOSS";class qu{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return zu}static getOrCreateInstance(){return null===zu&&(zu=new qu),zu}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach((t=>t(e)))}}let zu=null;const $u=new Is([4294967295,4294967295],0);function Ku(e){const t=(new TextEncoder).encode(e),n=new ws;return n.update(t),new Uint8Array(n.digest())}function Gu(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Is([n,r],0),new Is([i,s],0)]}class Hu{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Wu(`Invalid padding: ${t}`);if(n<0)throw new Wu(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Wu(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Wu(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=Is.fromNumber(this.It)}Et(e,t,n){let r=e.add(t.multiply(Is.fromNumber(n)));return 1===r.compare($u)&&(r=new Is([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Tt).toNumber()}At(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;const t=Ku(e),[n,r]=Gu(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,r,e);if(!this.At(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new Hu(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.It)return;const t=Ku(e),[n,r]=Gu(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,r,e);this.Rt(t)}}Rt(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Wu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Qu{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Xu.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Qu(Ys.min(),r,new ca(Hs),Gc(),tu())}}class Xu{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Xu(n,t,tu(),tu(),tu())}}class Yu{constructor(e,t,n,r){this.Pt=e,this.removedTargetIds=t,this.key=n,this.bt=r}}class Ju{constructor(e,t){this.targetId=e,this.Vt=t}}class Zu{constructor(e,t,n=ga.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class el{constructor(){this.St=0,this.Dt=rl(),this.Ct=ga.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=tu(),t=tu(),n=tu();return this.Dt.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:xs()}})),new Xu(this.Ct,this.xt,e,t,n)}Ft(){this.Nt=!1,this.Dt=rl()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class tl{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=Gc(),this.zt=nl(),this.Wt=new ca(Hs)}Ht(e){for(const t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(const t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,(t=>{const n=this.Zt(t);switch(e.state){case 0:this.te(t)&&n.$t(e.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(e.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(t);break;case 3:this.te(t)&&(n.Kt(),n.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),n.$t(e.resumeToken));break;default:xs()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach(((e,n)=>{this.te(n)&&t(n)}))}ne(e){var t;const n=e.targetId,r=e.Vt.count,i=this.se(n);if(i){const s=i.target;if(_c(s))if(0===r){const e=new no(s.path);this.Yt(n,e,Qa.newNoDocument(e,Ys.min()))}else Rs(1===r);else{const i=this.ie(n);if(i!==r){const r=this.re(e,i);if(0!==r){this.ee(n);const e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,e)}null===(t=qu.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(e,t,n){var r,i,s,o,a,c;const u={localCacheCount:t,existenceFilterCount:n.count},l=n.unchangedNames;return l&&(u.bloomFilter={applied:0===e,hashCount:null!==(r=null==l?void 0:l.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(o=null===(s=null===(i=null==l?void 0:l.bits)||void 0===i?void 0:i.bitmap)||void 0===s?void 0:s.length)&&void 0!==o?o:0,padding:null!==(c=null===(a=null==l?void 0:l.bits)||void 0===a?void 0:a.padding)&&void 0!==c?c:0}),u}(r,i,e.Vt))}}}}re(e,t){const{unchangedNames:n,count:r}=e.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:i="",padding:s=0},hashCount:o=0}=n;let a,c;try{a=Ia(i).toUint8Array()}catch(e){if(e instanceof ma)return Ds("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{c=new Hu(a,s,o)}catch(e){return Ds(e instanceof Wu?"BloomFilter error: ":"Applying bloom filter failed: ",e),1}return 0===c.It?1:r!==t-this.oe(e.targetId,c)?2:0}oe(e,t){const n=this.Gt.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.Gt.ue(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.vt(s)||(this.Yt(e,n,null),r++)})),r}ce(e){const t=new Map;this.Qt.forEach(((n,r)=>{const i=this.se(r);if(i){if(n.current&&_c(i.target)){const t=new no(i.target.path);null!==this.jt.get(t)||this.ae(r,t)||this.Yt(r,t,Qa.newNoDocument(t,e))}n.Mt&&(t.set(r,n.Ot()),n.Ft())}}));let n=tu();this.zt.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.se(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.jt.forEach(((t,n)=>n.setReadTime(e)));const r=new Qu(e,t,this.Wt,this.jt,n);return this.jt=Gc(),this.zt=nl(),this.Wt=new ca(Hs),r}Jt(e,t){if(!this.te(e))return;const n=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,n),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,n){if(!this.te(e))return;const r=this.Zt(e);this.ae(e,t)?r.Bt(t,1):r.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),n&&(this.jt=this.jt.insert(t,n))}removeTarget(e){this.Qt.delete(e)}ie(e){const t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new el,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new ha(Hs),this.zt=this.zt.insert(e,t)),t}te(e){const t=null!==this.se(e);return t||ks("WatchChangeAggregator","Detected inactive target",e),t}se(e){const t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new el),this.Gt.getRemoteKeysForTarget(e).forEach((t=>{this.Yt(e,t,null)}))}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function nl(){return new ca(no.comparator)}function rl(){return new ca(no.comparator)}const il={asc:"ASCENDING",desc:"DESCENDING"},sl={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ol={and:"AND",or:"OR"};class al{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function cl(e,t){return e.useProto3Json||Ao(t)?t:{value:t}}function ul(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ll(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function hl(e,t){return ul(e,t.toTimestamp())}function dl(e){return Rs(!!e),Ys.fromTimestamp(function(e){const t=va(e);return new Xs(t.seconds,t.nanos)}(e))}function fl(e,t){return function(e){return new Zs(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function pl(e){const t=Zs.fromString(e);return Rs(Ll(t)),t}function ml(e,t){return fl(e.databaseId,t.path)}function gl(e,t){const n=pl(t);if(n.get(1)!==e.databaseId.projectId)throw new Ls(Ps.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Ls(Ps.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new no(Il(n))}function yl(e,t){return fl(e.databaseId,t)}function vl(e){const t=pl(e);return 4===t.length?Zs.emptyPath():Il(t)}function wl(e){return new Zs(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Il(e){return Rs(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function bl(e,t,n){return{name:ml(e,t),fields:n.value.mapValue.fields}}function El(e,t){let n;if(t instanceof Au)n={update:bl(e,t.key,t.value)};else if(t instanceof Ou)n={delete:ml(e,t.key)};else if(t instanceof Du)n={update:bl(e,t.key,t.data),updateMask:Pl(t.fieldMask)};else{if(!(t instanceof Pu))return xs();n={verify:ml(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof lu)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof hu)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof fu)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof mu)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw xs()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:hl(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:xs()}(e,t.precondition)),n}function Tl(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Iu.updateTime(dl(e.updateTime)):void 0!==e.exists?Iu.exists(e.exists):Iu.none()}(t.currentDocument):Iu.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)Rs("REQUEST_TIME"===t.setToServerValue),n=new lu;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new hu(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new fu(e)}else"increment"in t?n=new mu(e,t.increment):xs();const r=to.fromServerFormat(t.fieldPath);return new vu(r,n)}(e,t))):[];if(t.update){t.update.name;const i=gl(e,t.update.name),s=new Ha({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new pa(t.map((e=>to.fromServerFormat(e))))}(t.updateMask);return new Du(i,s,e,n,r)}return new Au(i,s,n,r)}if(t.delete){const r=gl(e,t.delete);return new Ou(r,n)}if(t.verify){const r=gl(e,t.verify);return new Pu(r,n)}return xs()}function _l(e,t){return{documents:[yl(e,t.path)]}}function Sl(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=yl(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=yl(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0!==e.length)return Ol(rc.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:xl(e.field),direction:Al(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=cl(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function Cl(e){let t=vl(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Rs(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=kl(e);return t instanceof rc&&oc(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new Za(Rl(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Ao(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Xa(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new Xa(n,t)}(n.endAt)),function(e,t,n,r,i,s,o,a){return new Ac(e,t,n,r,i,s,o,a)}(t,i,o,s,a,"F",c,u)}function kl(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Rl(e.unaryFilter.field);return nc.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Rl(e.unaryFilter.field);return nc.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Rl(e.unaryFilter.field);return nc.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Rl(e.unaryFilter.field);return nc.create(i,"!=",{nullValue:"NULL_VALUE"});default:return xs()}}(e):void 0!==e.fieldFilter?function(e){return nc.create(Rl(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return xs()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return rc.create(e.compositeFilter.filters.map((e=>kl(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return xs()}}(e.compositeFilter.op))}(e):xs()}function Al(e){return il[e]}function Dl(e){return sl[e]}function Nl(e){return ol[e]}function xl(e){return{fieldPath:e.canonicalString()}}function Rl(e){return to.fromServerFormat(e.fieldPath)}function Ol(e){return e instanceof nc?function(e){if("=="===e.op){if(Ua(e.value))return{unaryFilter:{field:xl(e.field),op:"IS_NAN"}};if(Va(e.value))return{unaryFilter:{field:xl(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ua(e.value))return{unaryFilter:{field:xl(e.field),op:"IS_NOT_NAN"}};if(Va(e.value))return{unaryFilter:{field:xl(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xl(e.field),op:Dl(e.op),value:e.value}}}(e):e instanceof rc?function(e){const t=e.getFilters().map((e=>Ol(e)));return 1===t.length?t[0]:{compositeFilter:{op:Nl(e.op),filters:t}}}(e):xs()}function Pl(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Ll(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Ml{constructor(e,t,n,r,i=Ys.min(),s=Ys.min(),o=ga.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Ml(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ml(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ml(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ml(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Fl{constructor(e){this.fe=e}}function Vl(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Ul(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:ml(e,t.key),fields:t.data.value.mapValue.fields,updateTime:ul(e,t.version.toTimestamp()),createTime:ul(e,t.createTime.toTimestamp())}}(e.fe,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Bl(t.version)};else{if(!t.isUnknownDocument())return xs();r.unknownDocument={path:n.path.toArray(),version:Bl(t.version)}}return r}function Ul(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Bl(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function jl(e){const t=new Xs(e.seconds,e.nanoseconds);return Ys.fromTimestamp(t)}function ql(e,t){const n=(t.baseMutations||[]).map((t=>Tl(e.fe,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>Tl(e.fe,t))),i=Xs.fromMillis(t.localWriteTimeMs);return new Lu(t.batchId,i,n,r)}function zl(e){const t=jl(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?jl(e.lastLimboFreeSnapshotVersion):Ys.min();let r;var i;return void 0!==e.query.documents?(Rs(1===(i=e.query).documents.length),r=Lc(Dc(vl(i.documents[0])))):r=function(e){return Lc(Cl(e))}(e.query),new Ml(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,ga.fromBase64String(e.resumeToken))}function $l(e,t){const n=Bl(t.snapshotVersion),r=Bl(t.lastLimboFreeSnapshotVersion);let i;i=_c(t.target)?_l(e.fe,t.target):Sl(e.fe,t.target);const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Ec(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Kl(e){const t=Cl({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Fc(t,t.limit,"L"):t}function Gl(e,t){return new Fu(t.largestBatchId,Tl(e.fe,t.overlayMutation))}function Hl(e,t){const n=t.path.lastSegment();return[e,No(t.path.popLast()),n]}function Wl(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Bl(r.readTime),documentKey:No(r.documentKey.path),largestBatchId:r.largestBatchId}}class Ql{getBundleMetadata(e,t){return Xl(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:jl(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return Xl(e).put({bundleId:(n=t).id,createTime:Bl(dl(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return Yl(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:Kl(t.bundledQuery),readTime:jl(t.readTime)};var t}))}saveNamedQuery(e,t){return Yl(e).put(function(e){return{name:e.name,readTime:Bl(dl(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function Xl(e){return ia(e,"bundles")}function Yl(e){return ia(e,"namedQueries")}class Jl{constructor(e,t){this.serializer=e,this.userId=t}static de(e,t){const n=t.uid||"";return new Jl(e,n)}getOverlay(e,t){return Zl(e).get(Hl(this.userId,t)).next((e=>e?Gl(this.serializer,e):null))}getOverlays(e,t){const n=Xc();return mo.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new Fu(t,i);r.push(this.we(e,s))})),mo.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(No(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(Zl(e).J("collectionPathOverlayIndex",r))})),mo.waitFor(i)}getOverlaysForCollection(e,t,n){const r=Xc(),i=No(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Zl(e).j("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=Gl(this.serializer,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=Xc();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Zl(e).X({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=Gl(this.serializer,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}we(e,t){return Zl(e).put(function(e,t,n){const[r,i,s]=Hl(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:El(e.fe,n.mutation)}}(this.serializer,this.userId,t))}}function Zl(e){return ia(e,"documentOverlays")}class eh{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(wa(e.integerValue));else if("doubleValue"in e){const n=wa(e.doubleValue);isNaN(n)?this.ye(t,13):(this.ye(t,15),Do(n)?t.pe(0):t.pe(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ye(t,20),"string"==typeof n?t.Ie(n):(t.Ie(`${n.seconds||""}`),t.pe(n.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(Ia(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ye(t,45),t.pe(n.latitude||0),t.pe(n.longitude||0)}else"mapValue"in e?qa(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):xs()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){const n=e.fields||{};this.ye(t,55);for(const e of Object.keys(n))this.Te(e,t),this.me(n[e],t)}Pe(e,t){const n=e.values||[];this.ye(t,50);for(const e of n)this.me(e,t)}ve(e,t){this.ye(t,37),no.fromName(e).path.forEach((e=>{this.ye(t,60),this.be(e,t)}))}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}function th(e){if(0===e)return 8;let t=0;return!(e>>4)&&(t+=4,e<<=4),!(e>>6)&&(t+=2,e<<=2),!(e>>7)&&(t+=1),t}function nh(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=th(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}eh.Ve=new eh;class rh{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Se(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.De(n.value),n=t.next();this.Ce()}xe(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ne(n.value),n=t.next();this.ke()}Me(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.De(e);else if(e<2048)this.De(960|e>>>6),this.De(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.De(480|e>>>12),this.De(128|63&e>>>6),this.De(128|63&e);else{const e=t.codePointAt(0);this.De(240|e>>>18),this.De(128|63&e>>>12),this.De(128|63&e>>>6),this.De(128|63&e)}}this.Ce()}$e(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ne(e);else if(e<2048)this.Ne(960|e>>>6),this.Ne(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ne(480|e>>>12),this.Ne(128|63&e>>>6),this.Ne(128|63&e);else{const e=t.codePointAt(0);this.Ne(240|e>>>18),this.Ne(128|63&e>>>12),this.Ne(128|63&e>>>6),this.Ne(128|63&e)}}this.ke()}Oe(e){const t=this.Fe(e),n=nh(t);this.Be(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}Le(e){const t=this.Fe(e),n=nh(t);this.Be(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}qe(){this.Ue(255),this.Ue(255)}Ke(){this.Ge(255),this.Ge(255)}reset(){this.position=0}seed(e){this.Be(e.length),this.buffer.set(e,this.position),this.position+=e.length}Qe(){return this.buffer.slice(0,this.position)}Fe(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}De(e){const t=255&e;0===t?(this.Ue(0),this.Ue(255)):255===t?(this.Ue(255),this.Ue(0)):this.Ue(t)}Ne(e){const t=255&e;0===t?(this.Ge(0),this.Ge(255)):255===t?(this.Ge(255),this.Ge(0)):this.Ge(e)}Ce(){this.Ue(0),this.Ue(1)}ke(){this.Ge(0),this.Ge(1)}Ue(e){this.Be(1),this.buffer[this.position++]=e}Ge(e){this.Be(1),this.buffer[this.position++]=~e}Be(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class ih{constructor(e){this.je=e}Ae(e){this.je.Se(e)}Ie(e){this.je.Me(e)}pe(e){this.je.Oe(e)}ge(){this.je.qe()}}class sh{constructor(e){this.je=e}Ae(e){this.je.xe(e)}Ie(e){this.je.$e(e)}pe(e){this.je.Le(e)}ge(){this.je.Ke()}}class oh{constructor(){this.je=new rh,this.ze=new ih(this.je),this.We=new sh(this.je)}seed(e){this.je.seed(e)}He(e){return 0===e?this.ze:this.We}Qe(){return this.je.Qe()}reset(){this.je.reset()}}class ah{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Je(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new ah(this.indexId,this.documentKey,this.arrayValue,n)}}function ch(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=uh(e.arrayValue,t.arrayValue),0!==n?n:(n=uh(e.directionalValue,t.directionalValue),0!==n?n:no.comparator(e.documentKey,t.documentKey)))}function uh(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class lh{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ye=e.orderBy,this.Xe=[];for(const t of e.filters){const e=t;e.isInequality()?this.Ze=e:this.Xe.push(e)}}tn(e){Rs(e.collectionGroup===this.collectionId);const t=io(e);if(void 0!==t&&!this.en(t))return!1;const n=so(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.en(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(void 0!==this.Ze){if(!r.has(this.Ze.field.canonicalString())){const e=n[i];if(!this.nn(this.Ze,e)||!this.sn(this.Ye[s++],e))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.Ye.length||!this.sn(this.Ye[s++],e))return!1}return!0}en(e){for(const t of this.Xe)if(this.nn(t,e))return!0;return!1}nn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function hh(e){var t,n;if(Rs(e instanceof nc||e instanceof rc),e instanceof nc){if(e instanceof yc){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>nc.create(e.field,"==",t))))||[];return rc.create(r,"or")}return e}const r=e.filters.map((e=>hh(e)));return rc.create(r,e.op)}function dh(e){if(0===e.getFilters().length)return[];const t=gh(hh(e));return Rs(mh(t)),fh(t)||ph(t)?[t]:t.getFilters()}function fh(e){return e instanceof nc}function ph(e){return e instanceof rc&&oc(e)}function mh(e){return fh(e)||ph(e)||function(e){if(e instanceof rc&&sc(e)){for(const t of e.getFilters())if(!fh(t)&&!ph(t))return!1;return!0}return!1}(e)}function gh(e){if(Rs(e instanceof nc||e instanceof rc),e instanceof nc)return e;if(1===e.filters.length)return gh(e.filters[0]);const t=e.filters.map((e=>gh(e)));let n=rc.create(t,e.op);return n=wh(n),mh(n)?n:(Rs(n instanceof rc),Rs(ic(n)),Rs(n.filters.length>1),n.filters.reduce(((e,t)=>yh(e,t))))}function yh(e,t){let n;return Rs(e instanceof nc||e instanceof rc),Rs(t instanceof nc||t instanceof rc),n=e instanceof nc?t instanceof nc?function(e,t){return rc.create([e,t],"and")}(e,t):vh(e,t):t instanceof nc?vh(t,e):function(e,t){if(Rs(e.filters.length>0&&t.filters.length>0),ic(e)&&ic(t))return lc(e,t.getFilters());const n=sc(e)?e:t,r=sc(e)?t:e,i=n.filters.map((e=>yh(e,r)));return rc.create(i,"or")}(e,t),wh(n)}function vh(e,t){if(ic(t))return lc(t,e.getFilters());{const n=t.filters.map((t=>yh(e,t)));return rc.create(n,"or")}}function wh(e){if(Rs(e instanceof nc||e instanceof rc),e instanceof nc)return e;const t=e.getFilters();if(1===t.length)return wh(t[0]);if(ac(e))return e;const n=t.map((e=>wh(e))),r=[];return n.forEach((t=>{t instanceof nc?r.push(t):t instanceof rc&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:rc.create(r,e.op)}class Ih{constructor(){this.rn=new bh}addToCollectionParentIndex(e,t){return this.rn.add(t),mo.resolve()}getCollectionParents(e,t){return mo.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return mo.resolve()}deleteFieldIndex(e,t){return mo.resolve()}getDocumentsMatchingTarget(e,t){return mo.resolve(null)}getIndexType(e,t){return mo.resolve(0)}getFieldIndexes(e,t){return mo.resolve([])}getNextCollectionGroupToUpdate(e){return mo.resolve(null)}getMinOffset(e,t){return mo.resolve(uo.min())}getMinOffsetFromCollectionGroup(e,t){return mo.resolve(uo.min())}updateCollectionGroup(e,t,n){return mo.resolve()}updateIndexEntries(e,t){return mo.resolve()}}class bh{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new ha(Zs.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new ha(Zs.comparator)).toArray()}}const Eh=new Uint8Array(0);class Th{constructor(e,t){this.user=e,this.databaseId=t,this.on=new bh,this.un=new $c((e=>Ec(e)),((e,t)=>Tc(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.on.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.on.add(t)}));const i={collectionId:n,parent:No(r)};return _h(e).put(i)}return mo.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[Qs(t),""],!1,!0);return _h(e).j(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Oo(r.parent))}return n}))}addFieldIndex(e,t){const n=Ch(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=kh(e);return i.next((e=>{n.put(Wl(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=Ch(e),r=kh(e),i=Sh(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}getDocumentsMatchingTarget(e,t){const n=Sh(e);let r=!0;const i=new Map;return mo.forEach(this.cn(t),(t=>this.an(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=tu();const r=[];return mo.forEach(i,((i,s)=>{var o;ks("IndexedDbIndexManager",`Using index ${o=i,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`} to execute ${Ec(t)}`);const a=function(e,t){const n=io(t);if(void 0===n)return null;for(const t of Sc(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),c=function(e,t){const n=new Map;for(const r of so(t))for(const t of Sc(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of so(t)){const t=0===i.kind?Cc(e,i.fieldPath,e.startAt):kc(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new Xa(n,r)}(s,i),l=function(e,t){const n=[];let r=!0;for(const i of so(t)){const t=0===i.kind?kc(e,i.fieldPath,e.endAt):Cc(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new Xa(n,r)}(s,i),h=this.hn(i,s,u),d=this.hn(i,s,l),f=this.ln(i,s,c),p=this.fn(i.indexId,a,h,u.inclusive,d,l.inclusive,f);return mo.forEach(p,(i=>n.H(i,t.limit).next((t=>{t.forEach((t=>{const n=no.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return mo.resolve(null)}))}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:dh(rc.create(e.filters,"and")).map((t=>bc(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.un.set(e,t),t)}fn(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),c=a/(null!=t?t.length:1),u=[];for(let l=0;l<a;++l){const a=t?this.dn(t[l/c]):Eh,h=this.wn(e,a,n[l%c],r),d=this._n(e,a,i[l%c],s),f=o.map((t=>this.wn(e,a,t,!0)));u.push(...this.createRange(h,d,f))}return u}wn(e,t,n,r){const i=new ah(e,no.empty(),t,n);return r?i:i.Je()}_n(e,t,n,r){const i=new ah(e,no.empty(),t,n);return r?i.Je():i}an(e,t){const n=new lh(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.tn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.cn(t);return mo.forEach(r,(t=>this.an(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new ha(to.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}mn(e,t){const n=new oh;for(const r of so(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.He(r.kind);eh.Ve._e(e,i)}return n.Qe()}dn(e){const t=new oh;return eh.Ve._e(e,t.He(0)),t.Qe()}gn(e,t){const n=new oh;return eh.Ve._e(La(this.databaseId,t),n.He(function(e){const t=so(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Qe()}ln(e,t,n){if(null===n)return[];let r=[];r.push(new oh);let i=0;for(const s of so(e)){const e=n[i++];for(const n of r)if(this.yn(t,s.fieldPath)&&Fa(e))r=this.pn(r,s,e);else{const t=n.He(s.kind);eh.Ve._e(e,t)}}return this.In(r)}hn(e,t,n){return this.ln(e,t,n.position)}In(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Qe();return t}pn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new oh;r.seed(n.Qe()),eh.Ve._e(e,r.He(t.kind)),i.push(r)}return i}yn(e,t){return!!e.filters.find((e=>e instanceof nc&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=Ch(e),r=kh(e);return(t?n.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.j()).next((e=>{const t=[];return mo.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new ao(t.sequenceNumber,new uo(jl(t.readTime),new no(Oo(t.documentKey)),t.largestBatchId)):ao.empty(),r=e.fields.map((([e,t])=>new oo(to.fromServerFormat(e),t)));return new ro(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Hs(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=Ch(e),i=kh(e);return this.Tn(e).next((e=>r.j("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>mo.forEach(t,(t=>i.put(Wl(t.indexId,this.user,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return mo.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?mo.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),mo.forEach(i,(n=>this.En(e,t,n).next((t=>{const i=this.An(r,n);return t.isEqual(i)?mo.resolve():this.vn(e,r,n,t,i)})))))))}))}Rn(e,t,n,r){return Sh(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.gn(n,t.key),documentKey:t.key.path.toArray()})}Pn(e,t,n,r){return Sh(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.gn(n,t.key),t.key.path.toArray()])}En(e,t,n){const r=Sh(e);let i=new ha(ch);return r.X({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.gn(n,t)])},((e,r)=>{i=i.add(new ah(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}An(e,t){let n=new ha(ch);const r=this.mn(t,e);if(null==r)return n;const i=io(t);if(null!=i){const s=e.data.field(i.fieldPath);if(Fa(s))for(const i of s.arrayValue.values||[])n=n.add(new ah(t.indexId,e.key,this.dn(i),r))}else n=n.add(new ah(t.indexId,e.key,Eh,r));return n}vn(e,t,n,r,i){ks("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=fa(s),c=fa(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=fa(o)):t?(i(a),a=fa(s)):(a=fa(s),c=fa(o))}}(r,i,ch,(r=>{s.push(this.Rn(e,t,n,r))}),(r=>{s.push(this.Pn(e,t,n,r))})),mo.waitFor(s)}Tn(e){let t=1;return kh(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>ch(e,t))).filter(((e,t,n)=>!t||0!==ch(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=ch(i,e),s=ch(i,t);if(0===n)r[0]=e.Je();else if(n>0&&s<0)r.push(i),r.push(i.Je());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.bn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,Eh,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,Eh,[]];i.push(IDBKeyRange.bound(t,n))}return i}bn(e,t){return ch(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Ah)}getMinOffset(e,t){return mo.mapArray(this.cn(t),(t=>this.an(e,t).next((e=>e||xs())))).next(Ah)}}function _h(e){return ia(e,"collectionParents")}function Sh(e){return ia(e,"indexEntries")}function Ch(e){return ia(e,"indexConfiguration")}function kh(e){return ia(e,"indexState")}function Ah(e){Rs(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;lo(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new uo(t.readTime,t.documentKey,n)}const Dh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Nh{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Nh(e,Nh.DEFAULT_COLLECTION_PERCENTILE,Nh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function xh(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.X({range:o},((e,t,n)=>(a++,n.delete())));s.push(c.next((()=>{Rs(1===a)})));const u=[];for(const e of n.mutations){const r=Mo(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return mo.waitFor(s).next((()=>u))}function Rh(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw xs();t=e.noDocument}return JSON.stringify(t).length}Nh.DEFAULT_COLLECTION_PERCENTILE=10,Nh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Nh.DEFAULT=new Nh(41943040,Nh.DEFAULT_COLLECTION_PERCENTILE,Nh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Nh.DISABLED=new Nh(-1,0,0);class Oh{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Vn={}}static de(e,t,n,r){Rs(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Oh(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Lh(e).X({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=Mh(e),s=Lh(e);return s.add({}).next((o=>{Rs("number"==typeof o);const a=new Lu(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>El(e.fe,t))),i=n.mutations.map((t=>El(e.fe,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,a),u=[];let l=new ha(((e,t)=>Hs(e.canonicalString(),t.canonicalString())));for(const e of r){const t=Mo(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,Fo))}return l.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Vn[o]=a.keys()})),mo.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return Lh(e).get(t).next((e=>e?(Rs(e.userId===this.userId),ql(this.serializer,e)):null))}Sn(e,t){return this.Vn[t]?mo.resolve(this.Vn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.Vn[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Lh(e).X({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(Rs(t.batchId>=n),i=ql(this.serializer,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Lh(e).X({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Lh(e).j("userMutationsIndex",t).next((e=>e.map((e=>ql(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Lo(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return Mh(e).X({range:r},((n,r,s)=>{const[o,a,c]=n,u=Oo(a);if(o===this.userId&&t.path.isEqual(u))return Lh(e).get(c).next((e=>{if(!e)throw xs();Rs(e.userId===this.userId),i.push(ql(this.serializer,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ha(Hs);const r=[];return t.forEach((t=>{const i=Lo(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=Mh(e).X({range:s},((e,r,i)=>{const[s,o,a]=e,c=Oo(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),mo.waitFor(r).next((()=>this.Dn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=Lo(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new ha(Hs);return Mh(e).X({range:s},((e,t,i)=>{const[s,a,c]=e,u=Oo(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.Dn(e,o)))}Dn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(Lh(e).get(t).next((e=>{if(null===e)throw xs();Rs(e.userId===this.userId),n.push(ql(this.serializer,e))})))})),mo.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return xh(e.ht,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.Cn(t.batchId)})),mo.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}Cn(e){delete this.Vn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return mo.resolve();const n=IDBKeyRange.lowerBound([this.userId]),r=[];return Mh(e).X({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=Oo(e[1]);r.push(t)}else n.done()})).next((()=>{Rs(0===r.length)}))}))}containsKey(e,t){return Ph(e,this.userId,t)}xn(e){return Fh(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Ph(e,t,n){const r=Lo(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Mh(e).X({range:s,Y:!0},((e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()})).next((()=>o))}function Lh(e){return ia(e,"mutations")}function Mh(e){return ia(e,"documentMutations")}function Fh(e){return ia(e,"mutationQueues")}class Vh{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new Vh(0)}static Mn(){return new Vh(-1)}}class Uh{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.$n(e).next((t=>{const n=new Vh(t.highestTargetId);return t.highestTargetId=n.next(),this.On(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.$n(e).next((e=>Ys.fromTimestamp(new Xs(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.$n(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.$n(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.On(e,r))))}addTargetData(e,t){return this.Fn(e,t).next((()=>this.$n(e).next((n=>(n.targetCount+=1,this.Bn(t,n),this.On(e,n))))))}updateTargetData(e,t){return this.Fn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Bh(e).delete(t.targetId))).next((()=>this.$n(e))).next((t=>(Rs(t.targetCount>0),t.targetCount-=1,this.On(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return Bh(e).X(((s,o)=>{const a=zl(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>mo.waitFor(i))).next((()=>r))}forEachTarget(e,t){return Bh(e).X(((e,n)=>{const r=zl(n);t(r)}))}$n(e){return jh(e).get("targetGlobalKey").next((e=>(Rs(null!==e),e)))}On(e,t){return jh(e).put("targetGlobalKey",t)}Fn(e,t){return Bh(e).put($l(this.serializer,t))}Bn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.$n(e).next((e=>e.targetCount))}getTargetData(e,t){const n=Ec(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Bh(e).X({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const s=zl(n);Tc(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=qh(e);return t.forEach((t=>{const s=No(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),mo.waitFor(r)}removeMatchingKeys(e,t,n){const r=qh(e);return mo.forEach(t,(t=>{const i=No(t.path);return mo.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=qh(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=qh(e);let i=tu();return r.X({range:n,Y:!0},((e,t,n)=>{const r=Oo(e[1]),s=new no(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=No(t.path),r=IDBKeyRange.bound([n],[Qs(n)],!1,!0);let i=0;return qh(e).X({index:"documentTargetsIndex",Y:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}le(e,t){return Bh(e).get(t).next((e=>e?zl(e):null))}}function Bh(e){return ia(e,"targets")}function jh(e){return ia(e,"targetGlobal")}function qh(e){return ia(e,"targetDocuments")}function zh([e,t],[n,r]){const i=Hs(e,n);return 0===i?Hs(t,r):i}class $h{constructor(e){this.Ln=e,this.buffer=new ha(zh),this.qn=0}Un(){return++this.qn}Kn(e){const t=[e,this.Un()];if(this.buffer.size<this.Ln)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();zh(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Kh{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Qn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}Qn(e){ks("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Io(e)?ks("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await po(e)}await this.Qn(3e5)}))}}class Gh{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.zn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return mo.resolve(ko.ct);const n=new $h(t);return this.jn.forEachTarget(e,(e=>n.Kn(e.sequenceNumber))).next((()=>this.jn.Wn(e,(e=>n.Kn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(ks("LruGarbageCollector","Garbage collection skipped; disabled"),mo.resolve(Dh)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(ks("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Dh):this.Hn(e,t)))}getCacheSize(e){return this.jn.getCacheSize(e)}Hn(e,t){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(ks("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),Cs()<=F.DEBUG&&ks("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),mo.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}class Hh{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new Gh(e,t)}(this,t)}zn(e){const t=this.Jn(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Jn(e){let t=0;return this.Wn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Wn(e,t){return this.Yn(e,((e,n)=>t(n)))}addReference(e,t,n){return Wh(e,n)}removeReference(e,t,n){return Wh(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Wh(e,t)}Xn(e,t){return function(e,t){let n=!1;return Fh(e).Z((r=>Ph(e,r,t).next((e=>(e&&(n=!0),mo.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Yn(e,((s,o)=>{if(o<=t){const t=this.Xn(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,Ys.min()),qh(e).delete([0,No(s.path)]))))}));r.push(t)}})).next((()=>mo.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Wh(e,t)}Yn(e,t){const n=qh(e);let r,i=ko.ct;return n.X({index:"documentTargetsIndex"},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==ko.ct&&t(new no(Oo(r)),i),i=o,r=s):i=ko.ct})).next((()=>{i!==ko.ct&&t(new no(Oo(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Wh(e,t){return qh(e).put(function(e,t){return{targetId:0,path:No(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class Qh{constructor(){this.changes=new $c((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Qa.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?mo.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Xh{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return ed(e).put(n)}removeEntry(e,t,n){return ed(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Ul(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Zn(e,n))))}getEntry(e,t){let n=Qa.newInvalidDocument(t);return ed(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(td(t))},((e,r)=>{n=this.ts(t,r)})).next((()=>n))}es(e,t){let n={size:0,document:Qa.newInvalidDocument(t)};return ed(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(td(t))},((e,r)=>{n={document:this.ts(t,r),size:Rh(r)}})).next((()=>n))}getEntries(e,t){let n=Gc();return this.ns(e,t,((e,t)=>{const r=this.ts(e,t);n=n.insert(e,r)})).next((()=>n))}ss(e,t){let n=Gc(),r=new ca(no.comparator);return this.ns(e,t,((e,t)=>{const i=this.ts(e,t);n=n.insert(e,i),r=r.insert(e,Rh(t))})).next((()=>({documents:n,rs:r})))}ns(e,t,n){if(t.isEmpty())return mo.resolve();let r=new ha(rd);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(td(r.first()),td(r.last())),s=r.getIterator();let o=s.getNext();return ed(e).X({index:"documentKeyIndex",range:i},((e,t,r)=>{const i=no.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&rd(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.G(td(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r){const i=t.path,s=[i.popLast().toArray(),i.lastSegment(),Ul(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ed(e).j(IDBKeyRange.bound(s,o,!0)).next((e=>{let n=Gc();for(const i of e){const e=this.ts(no.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(jc(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let i=Gc();const s=nd(t,n),o=nd(t,uo.max());return ed(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((e,t,n)=>{const s=this.ts(no.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new Jh(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return Zh(e).get("remoteDocumentGlobalKey").next((e=>(Rs(!!e),e)))}Zn(e,t){return Zh(e).put("remoteDocumentGlobalKey",t)}ts(e,t){if(t){const e=function(e,t){let n;if(t.document)n=function(e,t,n){const r=gl(e,t.name),i=dl(t.updateTime),s=t.createTime?dl(t.createTime):Ys.min(),o=new Ha({mapValue:{fields:t.fields}}),a=Qa.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}(e.fe,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=no.fromSegments(t.noDocument.path),r=jl(t.noDocument.readTime);n=Qa.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return xs();{const e=no.fromSegments(t.unknownDocument.path),r=jl(t.unknownDocument.version);n=Qa.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new Xs(e[0],e[1]);return Ys.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(Ys.min()))return e}return Qa.newInvalidDocument(e)}}function Yh(e){return new Xh(e)}class Jh extends Qh{constructor(e,t){super(),this.os=e,this.trackRemovals=t,this.us=new $c((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new ha(((e,t)=>Hs(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.us.get(i);if(t.push(this.os.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=Vl(this.os.serializer,s);r=r.add(i.path.popLast());const c=Rh(a);n+=c-o.size,t.push(this.os.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=Vl(this.os.serializer,s.convertToNoDocument(Ys.min()));t.push(this.os.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.os.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.os.updateMetadata(e,n)),mo.waitFor(t)}getFromCache(e,t){return this.os.es(e,t).next((e=>(this.us.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.os.ss(e,t).next((({documents:e,rs:t})=>(t.forEach(((t,n)=>{this.us.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function Zh(e){return ia(e,"remoteDocumentGlobal")}function ed(e){return ia(e,"remoteDocumentsV14")}function td(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function nd(e,t){const n=t.documentKey.path.toArray();return[e,Ul(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function rd(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=Hs(n[e],r[e]),i)return i;return i=Hs(n.length,r.length),i||(i=Hs(n[n.length-2],r[r.length-2]),i||Hs(n[n.length-1],r[r.length-1]))}class id{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class sd{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Su(n.mutation,e,pa.empty(),Xs.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,tu()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=tu()){const r=Xc();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=Wc();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Xc();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,tu())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=Gc();const s=Jc(),o=Jc();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Du)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Su(o.mutation,t,o.mutation.getFieldMask(),Xs.now())):s.set(t.key,pa.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new id(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=Jc();let r=new ca(((e,t)=>e-t)),i=tu();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||pa.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||tu()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Yc();c.forEach((e=>{if(!i.has(e)){const r=Tu(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return mo.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return no.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Oc(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):mo.resolve(Xc());let o=-1,a=i;return s.next((t=>mo.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?mo.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,tu()))).next((e=>({batchId:o,changes:Qc(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new no(t)).next((e=>{let t=Wc();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const r=t.collectionGroup;let i=Wc();return this.indexManager.getCollectionParents(e,r).next((s=>mo.forEach(s,(s=>{const o=function(e,t){return new Ac(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r)))).next((e=>{r.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Qa.newInvalidDocument(r)))}));let n=Wc();return e.forEach(((e,i)=>{const s=r.get(e);void 0!==s&&Su(s.mutation,i,pa.empty(),Xs.now()),jc(t,i)&&(n=n.insert(e,i))})),n}))}}class od{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return mo.resolve(this.cs.get(t))}saveBundleMetadata(e,t){var n;return this.cs.set(t.id,{id:(n=t).id,version:n.version,createTime:dl(n.createTime)}),mo.resolve()}getNamedQuery(e,t){return mo.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,function(e){return{name:e.name,query:Kl(e.bundledQuery),readTime:dl(e.readTime)}}(t)),mo.resolve()}}class ad{constructor(){this.overlays=new ca(no.comparator),this.ls=new Map}getOverlay(e,t){return mo.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Xc();return mo.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.we(e,t,r)})),mo.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.ls.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.ls.delete(n)),mo.resolve()}getOverlaysForCollection(e,t,n){const r=Xc(),i=t.length+1,s=new no(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return mo.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new ca(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Xc(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Xc(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return mo.resolve(o)}we(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.ls.get(r.largestBatchId).delete(n.key);this.ls.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Fu(t,n));let i=this.ls.get(t);void 0===i&&(i=tu(),this.ls.set(t,i)),this.ls.set(t,i.add(n.key))}}class cd{constructor(){this.fs=new ha(ud.ds),this.ws=new ha(ud._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){const n=new ud(e,t);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.ys(new ud(e,t))}ps(e,t){e.forEach((e=>this.removeReference(e,t)))}Is(e){const t=new no(new Zs([])),n=new ud(t,e),r=new ud(t,e+1),i=[];return this.ws.forEachInRange([n,r],(e=>{this.ys(e),i.push(e.key)})),i}Ts(){this.fs.forEach((e=>this.ys(e)))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const t=new no(new Zs([])),n=new ud(t,e),r=new ud(t,e+1);let i=tu();return this.ws.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new ud(e,0),n=this.fs.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class ud{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return no.comparator(e.key,t.key)||Hs(e.As,t.As)}static _s(e,t){return Hs(e.As,t.As)||no.comparator(e.key,t.key)}}class ld{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new ha(ud.ds)}checkEmpty(e){return mo.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Lu(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.Rs=this.Rs.add(new ud(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return mo.resolve(s)}lookupMutationBatch(e,t){return mo.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.bs(n),i=r<0?0:r;return mo.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return mo.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return mo.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new ud(t,0),r=new ud(t,Number.POSITIVE_INFINITY),i=[];return this.Rs.forEachInRange([n,r],(e=>{const t=this.Ps(e.As);i.push(t)})),mo.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ha(Hs);return t.forEach((e=>{const t=new ud(e,0),r=new ud(e,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([t,r],(e=>{n=n.add(e.As)}))})),mo.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;no.isDocumentKey(i)||(i=i.child(""));const s=new ud(new no(i),0);let o=new ha(Hs);return this.Rs.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.As)),!0)}),s),mo.resolve(this.Vs(o))}Vs(e){const t=[];return e.forEach((e=>{const n=this.Ps(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Rs(0===this.Ss(t.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return mo.forEach(t.mutations,(r=>{const i=new ud(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Rs=n}))}Cn(e){}containsKey(e,t){const n=new ud(t,0),r=this.Rs.firstAfterOrEqual(n);return mo.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,mo.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){const t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class hd{constructor(e){this.Ds=e,this.docs=new ca(no.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Ds(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return mo.resolve(n?n.document.mutableCopy():Qa.newInvalidDocument(t))}getEntries(e,t){let n=Gc();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Qa.newInvalidDocument(e))})),mo.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Gc();const s=t.path,o=new no(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||lo(co(o),n)<=0||(r.has(o.key)||jc(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return mo.resolve(i)}getAllFromCollectionGroup(e,t,n,r){xs()}Cs(e,t){return mo.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new dd(this)}getSize(e){return mo.resolve(this.size)}}class dd extends Qh{constructor(e){super(),this.os=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.os.addEntry(e,r)):this.os.removeEntry(n)})),mo.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class fd{constructor(e){this.persistence=e,this.xs=new $c((e=>Ec(e)),Tc),this.lastRemoteSnapshotVersion=Ys.min(),this.highestTargetId=0,this.Ns=0,this.ks=new cd,this.targetCount=0,this.Ms=Vh.kn()}forEachTarget(e,t){return this.xs.forEach(((e,n)=>t(n))),mo.resolve()}getLastRemoteSnapshotVersion(e){return mo.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return mo.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),mo.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ns&&(this.Ns=t),mo.resolve()}Fn(e){this.xs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ms=new Vh(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,mo.resolve()}updateTargetData(e,t){return this.Fn(t),mo.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,mo.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.xs.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.xs.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),mo.waitFor(i).next((()=>r))}getTargetCount(e){return mo.resolve(this.targetCount)}getTargetData(e,t){const n=this.xs.get(t)||null;return mo.resolve(n)}addMatchingKeys(e,t,n){return this.ks.gs(t,n),mo.resolve()}removeMatchingKeys(e,t,n){this.ks.ps(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),mo.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),mo.resolve()}getMatchingKeysForTargetId(e,t){const n=this.ks.Es(t);return mo.resolve(n)}containsKey(e,t){return mo.resolve(this.ks.containsKey(t))}}class pd{constructor(e,t){this.$s={},this.overlays={},this.Os=new ko(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new fd(this),this.indexManager=new Ih,this.remoteDocumentCache=function(e){return new hd(e)}((e=>this.referenceDelegate.Ls(e))),this.serializer=new Fl(t),this.qs=new od(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ad,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.$s[e.toKey()];return n||(n=new ld(t,this.referenceDelegate),this.$s[e.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,n){ks("MemoryPersistence","Starting transaction:",e);const r=new md(this.Os.next());return this.referenceDelegate.Us(),n(r).next((e=>this.referenceDelegate.Ks(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gs(e,t){return mo.or(Object.values(this.$s).map((n=>()=>n.containsKey(e,t))))}}class md extends fo{constructor(e){super(),this.currentSequenceNumber=e}}class gd{constructor(e){this.persistence=e,this.Qs=new cd,this.js=null}static zs(e){return new gd(e)}get Ws(){if(this.js)return this.js;throw xs()}addReference(e,t,n){return this.Qs.addReference(n,t),this.Ws.delete(n.toString()),mo.resolve()}removeReference(e,t,n){return this.Qs.removeReference(n,t),this.Ws.add(n.toString()),mo.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),mo.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach((e=>this.Ws.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Ws.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Us(){this.js=new Set}Ks(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return mo.forEach(this.Ws,(n=>{const r=no.fromPath(n);return this.Hs(e,r).next((e=>{e||t.removeEntry(r,Ys.min())}))})).next((()=>(this.js=null,t.apply(e))))}updateLimboDocument(e,t){return this.Hs(e,t).next((e=>{e?this.Ws.delete(t.toString()):this.Ws.add(t.toString())}))}Ls(e){return 0}Hs(e,t){return mo.or([()=>mo.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class yd{constructor(e){this.serializer=e}O(e,t,n,r){const i=new go("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Po,{unique:!0}),e.createObjectStore("documentMutations")}(e),vd(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=mo.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),vd(e)),s=s.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Ys.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store("mutations").j().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Po,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return mo.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Ys(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.Xs(i))))),n<7&&r>=7&&(s=s.next((()=>this.Zs(i)))),n<8&&r>=8&&(s=s.next((()=>this.ti(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.ei(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:Qo});t.createIndex("collectionPathOverlayIndex",Xo,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",Yo,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:Vo});t.createIndex("documentKeyIndex",Uo),t.createIndex("collectionGroupIndex",Bo)}(e))).next((()=>this.ni(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>this.si(e,i)))),n<15&&r>=15&&(s=s.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Ko}).createIndex("sequenceNumberIndex",Go,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Ho}).createIndex("documentKeyIndex",Wo,{unique:!1})}(e)))),s}Xs(e){let t=0;return e.store("remoteDocuments").X(((e,n)=>{t+=Rh(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Ys(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.j().next((t=>mo.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.j("userMutationsIndex",r).next((n=>mo.forEach(n,(n=>{Rs(n.userId===t.userId);const r=ql(this.serializer,n);return xh(e,t.userId,r).next((()=>{}))}))))}))))}Zs(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.X(((n,i)=>{const s=new Zs(n),o=function(e){return[0,No(e)]}(s);r.push(t.get(o).next((n=>n?mo.resolve():(n=>t.put({targetId:0,path:No(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>mo.waitFor(r)))}))}ti(e,t){e.createObjectStore("collectionParents",{keyPath:$o});const n=t.store("collectionParents"),r=new bh,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:No(r)})}};return t.store("remoteDocuments").X({Y:!0},((e,t)=>{const n=new Zs(e);return i(n.popLast())})).next((()=>t.store("documentMutations").X({Y:!0},(([e,t,n],r)=>{const s=Oo(t);return i(s.popLast())}))))}ei(e){const t=e.store("targets");return t.X(((e,n)=>{const r=zl(n),i=$l(this.serializer,r);return t.put(i)}))}ni(e,t){const n=t.store("remoteDocuments"),r=[];return n.X(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=(o=n,o.document?new no(Zs.fromString(o.document.name).popFirst(5)):o.noDocument?no.fromSegments(o.noDocument.path):o.unknownDocument?no.fromSegments(o.unknownDocument.path):xs()).path.toArray();var o;const a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))})).next((()=>mo.waitFor(r)))}si(e,t){const n=t.store("mutations"),r=Yh(this.serializer),i=new pd(gd.zs,this.serializer.fe);return n.j().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:tu();ql(this.serializer,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),mo.forEach(n,((e,n)=>{const s=new Ts(n),o=Jl.de(this.serializer,s),a=i.getIndexManager(s),c=Oh.de(s,this.serializer,a,i.referenceDelegate);return new sd(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new ra(t,ko.ct),e).next()}))}))}}function vd(e){e.createObjectStore("targetDocuments",{keyPath:qo}).createIndex("documentTargetsIndex",zo,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",jo,{unique:!0}),e.createObjectStore("targetGlobal")}const wd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Id{constructor(e,t,n,r,i,s,o,a,c,u,l=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ii=i,this.window=s,this.document=o,this.ri=c,this.oi=u,this.ui=l,this.Os=null,this.Fs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.ai=null,this.hi=null,this.li=Number.NEGATIVE_INFINITY,this.fi=e=>Promise.resolve(),!Id.D())throw new Ls(Ps.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Hh(this,r),this.di=t+"main",this.serializer=new Fl(a),this.wi=new yo(this.di,this.ui,new yd(this.serializer)),this.Bs=new Uh(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Yh(this.serializer),this.qs=new Ql,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===u&&As("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Ls(Ps.FAILED_PRECONDITION,wd);return this.gi(),this.yi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Bs.getHighestSequenceNumber(e)))})).then((e=>{this.Os=new ko(e,this.ri)})).then((()=>{this.Fs=!0})).catch((e=>(this.wi&&this.wi.close(),Promise.reject(e))))}Ii(e){return this.fi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.wi.B((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ii.enqueueAndForget((async()=>{this.started&&await this.mi()})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Ed(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Ti(e).next((e=>{e||(this.isPrimary=!1,this.ii.enqueueRetryable((()=>this.fi(!1))))}))})).next((()=>this.Ei(e))).next((t=>this.isPrimary&&!t?this.Ai(e).next((()=>!1)):!!t&&this.vi(e).next((()=>!0)))))).catch((e=>{if(Io(e))return ks("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ks("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.ii.enqueueRetryable((()=>this.fi(e))),this.isPrimary=e}))}Ti(e){return bd(e).get("owner").next((e=>mo.resolve(this.Ri(e))))}Pi(e){return Ed(e).delete(this.clientId)}async bi(){if(this.isPrimary&&!this.Vi(this.li,18e5)){this.li=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=ia(e,"clientMetadata");return t.j().next((e=>{const n=this.Si(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return mo.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this._i)for(const t of e)this._i.removeItem(this.Di(t.clientId))}}pi(){this.hi=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.mi().then((()=>this.bi())).then((()=>this.pi()))))}Ri(e){return!!e&&e.ownerId===this.clientId}Ei(e){return this.oi?mo.resolve(!0):bd(e).get("owner").next((t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)){if(this.Ri(t)&&this.networkEnabled)return!0;if(!this.Ri(t)){if(!t.allowTabSynchronization)throw new Ls(Ps.FAILED_PRECONDITION,wd);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ed(e).j().next((e=>void 0===this.Si(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&ks("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.Fs=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Ni(),this.ki(),await this.wi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new ra(e,ko.ct);return this.Ai(t).next((()=>this.Pi(t)))})),this.wi.close(),this.Mi()}Si(e,t){return e.filter((e=>this.Vi(e.updateTimeMs,t)&&!this.Ci(e.clientId)))}$i(){return this.runTransaction("getActiveClients","readonly",(e=>Ed(e).j().next((e=>this.Si(e,18e5).map((e=>e.clientId))))))}get started(){return this.Fs}getMutationQueue(e,t){return Oh.de(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Th(e,this.serializer.fe.databaseId)}getDocumentOverlayCache(e){return Jl.de(this.serializer,e)}getBundleCache(){return this.qs}runTransaction(e,t,n){ks("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=15===(s=this.ui)?na:14===s?ta:13===s?ea:12===s?Zo:11===s?Jo:void xs();var s;let o;return this.wi.runTransaction(e,r,i,(r=>(o=new ra(r,this.Os?this.Os.next():ko.ct),"readwrite-primary"===t?this.Ti(o).next((e=>!!e||this.Ei(o))).next((t=>{if(!t)throw As(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ii.enqueueRetryable((()=>this.fi(!1))),new Ls(Ps.FAILED_PRECONDITION,ho);return n(o)})).next((e=>this.vi(o).next((()=>e)))):this.Oi(o).next((()=>n(o)))))).then((e=>(o.raiseOnCommittedEvent(),e)))}Oi(e){return bd(e).get("owner").next((e=>{if(null!==e&&this.Vi(e.leaseTimestampMs,5e3)&&!this.Ci(e.ownerId)&&!this.Ri(e)&&!(this.oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new Ls(Ps.FAILED_PRECONDITION,wd)}))}vi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return bd(e).put("owner",t)}static D(){return yo.D()}Ai(e){const t=bd(e);return t.get("owner").next((e=>this.Ri(e)?(ks("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):mo.resolve()))}Vi(e,t){const n=Date.now();return!(e<n-t||e>n&&(As(`Detected an update time that is in the future: ${e} > ${n}`),1))}gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ai=()=>{this.ii.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.mi())))},this.document.addEventListener("visibilitychange",this.ai),this.inForeground="visible"===this.document.visibilityState)}Ni(){this.ai&&(this.document.removeEventListener("visibilitychange",this.ai),this.ai=null)}yi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const e=/(?:Version|Mobile)\/1[456]/;!g()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.ii.enterRestrictedMode(!0),this.ii.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ci))}ki(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Ci(e){var t;try{const n=null!==(null===(t=this._i)||void 0===t?void 0:t.getItem(this.Di(e)));return ks("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return As("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this._i)try{this._i.setItem(this.Di(this.clientId),String(Date.now()))}catch(e){As("Failed to set zombie client id.",e)}}Mi(){if(this._i)try{this._i.removeItem(this.Di(this.clientId))}catch(e){}}Di(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function bd(e){return ia(e,"owner")}function Ed(e){return ia(e,"clientMetadata")}class Td{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Fi=n,this.Bi=r}static Li(e,t){let n=tu(),r=tu();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Td(e,t.fromCache,n,r)}}class _d{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,n,r){return this.Ki(e,t).next((i=>i||this.Gi(e,t,r,n))).next((n=>n||this.Qi(e,t)))}Ki(e,t){if(Nc(t))return mo.resolve(null);let n=Lc(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Fc(t,null,"F"),n=Lc(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=tu(...r);return this.Ui.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.ji(t,r);return this.zi(t,s,i,n.readTime)?this.Ki(e,Fc(t,null,"F")):this.Wi(e,s,t,n)}))))})))))}Gi(e,t,n,r){return Nc(t)||r.isEqual(Ys.min())?this.Qi(e,t):this.Ui.getDocuments(e,n).next((i=>{const s=this.ji(t,i);return this.zi(t,s,n,r)?this.Qi(e,t):(Cs()<=F.DEBUG&&ks("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Bc(t)),this.Wi(e,s,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=Ys.fromTimestamp(1e9===r?new Xs(n+1,0):new Xs(n,r));return new uo(i,no.empty(),t)}(r,-1)))}))}ji(e,t){let n=new ha(qc(e));return t.forEach(((t,r)=>{jc(e,r)&&(n=n.add(r))})),n}zi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Qi(e,t){return Cs()<=F.DEBUG&&ks("QueryEngine","Using full collection scan to execute query:",Bc(t)),this.Ui.getDocumentsMatchingQuery(e,t,uo.min())}Wi(e,t,n,r){return this.Ui.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class Sd{constructor(e,t,n,r){this.persistence=e,this.Hi=t,this.serializer=r,this.Ji=new ca(Hs),this.Yi=new $c((e=>Ec(e)),Tc),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(n)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sd(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ji)))}}function Cd(e,t,n,r){return new Sd(e,t,n,r)}async function kd(e,t){const n=Os(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.tr(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=tu();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({er:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function Ad(e){const t=Os(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Bs.getLastRemoteSnapshotVersion(e)))}function Dd(e,t){const n=Os(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}async function Nd(e,t,n){const r=Os(e),i=r.Ji.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!Io(e))throw e;ks("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ji=r.Ji.remove(t),r.Yi.delete(i.target)}function xd(e,t,n){const r=Os(e);let i=Ys.min(),s=tu();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=Os(e),i=r.Yi.get(n);return void 0!==i?mo.resolve(r.Ji.get(i)):r.Bs.getTargetData(t,n)}(r,e,Lc(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Bs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.Hi.getDocumentsMatchingQuery(e,t,n?i:Ys.min(),n?s:tu()))).next((e=>(function(e,t,n){let r=e.Xi.get(t)||Ys.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Xi.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,ir:s})))))}class Rd{constructor(){this.activeTargetIds=nu}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Od{constructor(){this.Hr=new Rd,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,n){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new Rd,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Pd{Yr(e){}shutdown(){}}class Ld{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){ks("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){ks("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Md=null;function Fd(){return null===Md?Md=268435456+Math.round(2147483648*Math.random()):Md++,"0x"+Md.toString(16)}const Vd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Ud{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}const Bd="WebChannelConnection";class jd extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.mo=t+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,n,r,i){const s=Fd(),o=this.To(e,t);ks("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const a={};return this.Eo(a,r,i),this.Ao(e,o,a,n).then((t=>(ks("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw Ds("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,r,i,s){return this.Io(e,t,n,r,i)}Eo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+_s,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}To(e,t){const n=Vd[e];return`${this.mo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,n,r){const i=Fd();return new Promise(((s,o)=>{const a=new vs;a.setWithCredentials(!0),a.listenOnce(fs.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case ds.NO_ERROR:const t=a.getResponseJson();ks(Bd,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case ds.TIMEOUT:ks(Bd,`RPC '${e}' ${i} timed out`),o(new Ls(Ps.DEADLINE_EXCEEDED,"Request time out"));break;case ds.HTTP_ERROR:const n=a.getStatus();if(ks(Bd,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Ps).indexOf(t)>=0?t:Ps.UNKNOWN}(t.status);o(new Ls(e,t.message))}else o(new Ls(Ps.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Ls(Ps.UNAVAILABLE,"Connection failed."));break;default:xs()}}finally{ks(Bd,`RPC '${e}' ${i} completed.`)}}));const c=JSON.stringify(r);ks(Bd,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)}))}Ro(e,t,n){const r=Fd(),i=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=ls(),o=hs(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new gs({})),this.Eo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=i.join("");ks(Bd,`Creating RPC '${e}' stream ${r}: ${u}`,a);const l=s.createWebChannel(u,a);let h=!1,d=!1;const f=new Ud({ro:t=>{d?ks(Bd,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||(ks(Bd,`Opening RPC '${e}' stream ${r} transport.`),l.open(),h=!0),ks(Bd,`RPC '${e}' stream ${r} sending:`,t),l.send(t))},oo:()=>l.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return p(l,ys.EventType.OPEN,(()=>{d||ks(Bd,`RPC '${e}' stream ${r} transport opened.`)})),p(l,ys.EventType.CLOSE,(()=>{d||(d=!0,ks(Bd,`RPC '${e}' stream ${r} transport closed`),f.wo())})),p(l,ys.EventType.ERROR,(t=>{d||(d=!0,Ds(Bd,`RPC '${e}' stream ${r} transport errored:`,t),f.wo(new Ls(Ps.UNAVAILABLE,"The operation could not be completed")))})),p(l,ys.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];Rs(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){ks(Bd,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=Uu[e];if(void 0!==t)return ju(t)}(t),i=o.message;void 0===n&&(n=Ps.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.wo(new Ls(n,i)),l.close()}else ks(Bd,`RPC '${e}' stream ${r} received:`,i),f._o(i)}})),p(o,ps.STAT_EVENT,(t=>{t.stat===ms.PROXY?ks(Bd,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===ms.NOPROXY&&ks(Bd,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.fo()}),0),f}}function qd(){return"undefined"!=typeof document?document:null}function zd(e){return new al(e,!0)}class $d{constructor(e,t,n=1e3,r=1.5,i=6e4){this.ii=e,this.timerId=t,this.Po=n,this.bo=r,this.Vo=i,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const t=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),r=Math.max(0,t-n);r>0&&ks("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,r,(()=>(this.Co=Date.now(),e()))),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class Kd{constructor(e,t,n,r,i,s,o,a){this.ii=e,this.$o=n,this.Oo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new $d(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,(()=>this.zo())))}Wo(e){this.Ho(),this.stream.send(e)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(e,t){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==e?this.qo.reset():t&&t.code===Ps.RESOURCE_EXHAUSTED?(As(t.toString()),As("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):t&&t.code===Ps.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.ao(t)}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Fo===t&&this.Zo(e,n)}),(t=>{e((()=>{const e=new Ls(Ps.UNKNOWN,"Fetching auth token failed: "+t.message);return this.tu(e)}))}))}Zo(e,t){const n=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo((()=>{n((()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,(()=>(this.Ko()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.ao((e=>{n((()=>this.tu(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Go(){this.state=5,this.qo.No((async()=>{this.state=0,this.start()}))}tu(e){return ks("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget((()=>this.Fo===e?t():(ks("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Gd extends Kd{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:xs()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(Rs(void 0===t||"string"==typeof t),ga.fromBase64String(t||"")):(Rs(void 0===t||t instanceof Uint8Array),ga.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Ps.UNKNOWN:ju(e.code);return new Ls(t,e.message||"")}(o);n=new Zu(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=gl(e,r.document.name),s=dl(r.document.updateTime),o=r.document.createTime?dl(r.document.createTime):Ys.min(),a=new Ha({mapValue:{fields:r.document.fields}}),c=Qa.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new Yu(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=gl(e,r.document),s=r.readTime?dl(r.readTime):Ys.min(),o=Qa.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Yu([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=gl(e,r.document),s=r.removedTargetIds||[];n=new Yu([],s,i,null)}else{if(!("filter"in t))return xs();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new Vu(r,i),o=e.targetId;n=new Ju(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Ys.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Ys.min():t.readTime?dl(t.readTime):Ys.min()}(e);return this.listener.nu(t,n)}su(e){const t={};t.database=wl(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=_c(r)?{documents:_l(e,r)}:{query:Sl(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=ll(e,t.resumeToken);const r=cl(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(Ys.min())>0){n.readTime=ul(e,t.snapshotVersion.toTimestamp());const r=cl(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return xs()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Wo(t)}iu(e){const t={};t.database=wl(this.serializer),t.removeTarget=e,this.Wo(t)}}class Hd extends Kd{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){if(Rs(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const t=function(e,t){return e&&e.length>0?(Rs(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?dl(e.updateTime):dl(t);return n.isEqual(Ys.min())&&(n=dl(t)),new wu(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=dl(e.commitTime);return this.listener.cu(n,t)}return Rs(!e.writeResults||0===e.writeResults.length),this.ru=!0,this.listener.au()}hu(){const e={};e.database=wl(this.serializer),this.Wo(e)}uu(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>El(this.serializer,e)))};this.Wo(t)}}class Wd extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.lu=!1}fu(){if(this.lu)throw new Ls(Ps.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.Io(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Ps.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Ls(Ps.UNKNOWN,e.toString())}))}vo(e,t,n,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.vo(e,t,n,i,s,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Ps.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Ls(Ps.UNKNOWN,e.toString())}))}terminate(){this.lu=!0}}class Qd{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve()))))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(As(t),this.mu=!1):ks("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class Xd{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=i,this.Pu.Yr((e=>{n.enqueueAndForget((async()=>{of(this)&&(ks("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Os(e);t.vu.add(4),await Jd(t),t.bu.set("Unknown"),t.vu.delete(4),await Yd(t)}(this))}))})),this.bu=new Qd(n,r)}}async function Yd(e){if(of(e))for(const t of e.Ru)await t(!0)}async function Jd(e){for(const t of e.Ru)await t(!1)}function Zd(e,t){const n=Os(e);n.Au.has(t.targetId)||(n.Au.set(t.targetId,t),sf(n)?rf(n):Tf(n).Ko()&&tf(n,t))}function ef(e,t){const n=Os(e),r=Tf(n);n.Au.delete(t),r.Ko()&&nf(n,t),0===n.Au.size&&(r.Ko()?r.jo():of(n)&&n.bu.set("Unknown"))}function tf(e,t){if(e.Vu.qt(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Ys.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Tf(e).su(t)}function nf(e,t){e.Vu.qt(t),Tf(e).iu(t)}function rf(e){e.Vu=new tl({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),le:t=>e.Au.get(t)||null,ue:()=>e.datastore.serializer.databaseId}),Tf(e).start(),e.bu.gu()}function sf(e){return of(e)&&!Tf(e).Uo()&&e.Au.size>0}function of(e){return 0===Os(e).vu.size}function af(e){e.Vu=void 0}async function cf(e){e.Au.forEach(((t,n)=>{tf(e,t)}))}async function uf(e,t){af(e),sf(e)?(e.bu.Iu(t),rf(e)):e.bu.set("Unknown")}async function lf(e,t,n){if(e.bu.set("Online"),t instanceof Zu&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Au.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Au.delete(r),e.Vu.removeTarget(r))}(e,t)}catch(n){ks("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await hf(e,n)}else if(t instanceof Yu?e.Vu.Ht(t):t instanceof Ju?e.Vu.ne(t):e.Vu.Xt(t),!n.isEqual(Ys.min()))try{const t=await Ad(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Vu.ce(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Au.get(r);i&&e.Au.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.Au.get(t);if(!r)return;e.Au.set(t,r.withResumeToken(ga.EMPTY_BYTE_STRING,r.snapshotVersion)),nf(e,t);const i=new Ml(r.target,t,n,r.sequenceNumber);tf(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){ks("RemoteStore","Failed to raise snapshot:",t),await hf(e,t)}}async function hf(e,t,n){if(!Io(t))throw t;e.vu.add(1),await Jd(e),e.bu.set("Offline"),n||(n=()=>Ad(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{ks("RemoteStore","Retrying IndexedDB access"),await n(),e.vu.delete(1),await Yd(e)}))}function df(e,t){return t().catch((n=>hf(e,n,t)))}async function ff(e){const t=Os(e),n=_f(t);let r=t.Eu.length>0?t.Eu[t.Eu.length-1].batchId:-1;for(;pf(t);)try{const e=await Dd(t.localStore,r);if(null===e){0===t.Eu.length&&n.jo();break}r=e.batchId,mf(t,e)}catch(e){await hf(t,e)}gf(t)&&yf(t)}function pf(e){return of(e)&&e.Eu.length<10}function mf(e,t){e.Eu.push(t);const n=_f(e);n.Ko()&&n.ou&&n.uu(t.mutations)}function gf(e){return of(e)&&!_f(e).Uo()&&e.Eu.length>0}function yf(e){_f(e).start()}async function vf(e){_f(e).hu()}async function wf(e){const t=_f(e);for(const n of e.Eu)t.uu(n.mutations)}async function If(e,t,n){const r=e.Eu.shift(),i=Mu.from(r,t,n);await df(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await ff(e)}async function bf(e,t){t&&_f(e).ou&&await async function(e,t){if(function(e){switch(e){default:return xs();case Ps.CANCELLED:case Ps.UNKNOWN:case Ps.DEADLINE_EXCEEDED:case Ps.RESOURCE_EXHAUSTED:case Ps.INTERNAL:case Ps.UNAVAILABLE:case Ps.UNAUTHENTICATED:return!1;case Ps.INVALID_ARGUMENT:case Ps.NOT_FOUND:case Ps.ALREADY_EXISTS:case Ps.PERMISSION_DENIED:case Ps.FAILED_PRECONDITION:case Ps.ABORTED:case Ps.OUT_OF_RANGE:case Ps.UNIMPLEMENTED:case Ps.DATA_LOSS:return!0}}(n=t.code)&&n!==Ps.ABORTED){const n=e.Eu.shift();_f(e).Qo(),await df(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await ff(e)}var n}(e,t),gf(e)&&yf(e)}async function Ef(e,t){const n=Os(e);n.asyncQueue.verifyOperationInProgress(),ks("RemoteStore","RemoteStore received new credentials");const r=of(n);n.vu.add(3),await Jd(n),r&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.vu.delete(3),await Yd(n)}function Tf(e){return e.Su||(e.Su=function(e,t,n){const r=Os(e);return r.fu(),new Gd(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{uo:cf.bind(null,e),ao:uf.bind(null,e),nu:lf.bind(null,e)}),e.Ru.push((async t=>{t?(e.Su.Qo(),sf(e)?rf(e):e.bu.set("Unknown")):(await e.Su.stop(),af(e))}))),e.Su}function _f(e){return e.Du||(e.Du=function(e,t,n){const r=Os(e);return r.fu(),new Hd(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{uo:vf.bind(null,e),ao:bf.bind(null,e),au:wf.bind(null,e),cu:If.bind(null,e)}),e.Ru.push((async t=>{t?(e.Du.Qo(),await ff(e)):(await e.Du.stop(),e.Eu.length>0&&(ks("RemoteStore",`Stopping write stream with ${e.Eu.length} pending writes`),e.Eu=[]))}))),e.Du}class Sf{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ms,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new Sf(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ls(Ps.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Cf(e,t){if(As("AsyncQueue",`${t}: ${e}`),Io(e))return new Ls(Ps.UNAVAILABLE,`${t}: ${e}`);throw e}class kf{constructor(e){this.comparator=e?(t,n)=>e(t,n)||no.comparator(t.key,n.key):(e,t)=>no.comparator(e.key,t.key),this.keyedMap=Wc(),this.sortedSet=new ca(this.comparator)}static emptySet(e){return new kf(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof kf))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new kf;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Af{constructor(){this.Cu=new ca(no.comparator)}track(e){const t=e.doc.key,n=this.Cu.get(t);n?0!==e.type&&3===n.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==n.type?this.Cu=this.Cu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Cu=this.Cu.remove(t):1===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):xs():this.Cu=this.Cu.insert(t,e)}xu(){const e=[];return this.Cu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Df{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new Df(e,t,kf.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Vc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Nf{constructor(){this.Nu=void 0,this.listeners=[]}}class xf{constructor(){this.queries=new $c((e=>Uc(e)),Vc),this.onlineState="Unknown",this.ku=new Set}}async function Rf(e,t){const n=Os(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Nf),i)try{s.Nu=await n.onListen(r)}catch(e){const n=Cf(e,`Initialization of query '${Bc(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.Mu(n.onlineState),s.Nu&&t.$u(s.Nu)&&Mf(n)}async function Of(e,t){const n=Os(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Pf(e,t){const n=Os(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.$u(e)&&(r=!0);i.Nu=e}}r&&Mf(n)}function Lf(e,t,n){const r=Os(e),i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}function Mf(e){e.ku.forEach((e=>{e.next()}))}class Ff{constructor(e,t,n){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Df(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Ku||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){if(e.docChanges.length>0)return!0;const t=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Uu(e){e=Df.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class Vf{constructor(e){this.key=e}}class Uf{constructor(e){this.key=e}}class Bf{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=tu(),this.mutatedKeys=tu(),this.tc=qc(e),this.ec=new kf(this.tc)}get nc(){return this.Yu}sc(e,t){const n=t?t.ic:new Af,r=t?t.ec:this.ec;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=jc(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.rc(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.tc(l,a)>0||c&&this.tc(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ec:s,ic:n,zi:o,mutatedKeys:i}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const i=e.ic.xu();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return xs()}};return n(e)-n(t)}(e.type,t.type)||this.tc(e.doc,t.doc))),this.oc(n);const s=t?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return this.Xu=o,0!==i.length||a?{snapshot:new Df(this.query,e.ec,r,i,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:s}:{cc:s}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new Af,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach((e=>this.Yu=this.Yu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Yu=this.Yu.delete(e))),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=tu(),this.ec.forEach((e=>{this.ac(e.key)&&(this.Zu=this.Zu.add(e.key))}));const t=[];return e.forEach((e=>{this.Zu.has(e)||t.push(new Uf(e))})),this.Zu.forEach((n=>{e.has(n)||t.push(new Vf(n))})),t}hc(e){this.Yu=e.ir,this.Zu=tu();const t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return Df.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class jf{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class qf{constructor(e){this.key=e,this.fc=!1}}class zf{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.dc={},this.wc=new $c((e=>Uc(e)),Vc),this._c=new Map,this.mc=new Set,this.gc=new ca(no.comparator),this.yc=new Map,this.Ic=new cd,this.Tc={},this.Ec=new Map,this.Ac=Vh.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function $f(e,t){const n=function(e){const t=Os(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Gf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=op.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Wf.bind(null,t),t.dc.nu=Pf.bind(null,t.eventManager),t.dc.Pc=Lf.bind(null,t.eventManager),t}(e);let r,i;const s=n.wc.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.lc();else{const e=await function(e,t){const n=Os(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Bs.getTargetData(e,t).next((i=>i?(r=i,mo.resolve(r)):n.Bs.allocateTargetId(e).next((i=>(r=new Ml(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Bs.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.Ji.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(e.targetId,e),n.Yi.set(t,e.targetId)),e}))}(n.localStore,Lc(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await async function(e,t,n,r,i){e.Rc=(t,n,r)=>async function(e,t,n,r){let i=t.view.sc(n);i.zi&&(i=await xd(e.localStore,t.query,!1).then((({documents:e})=>t.view.sc(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return tp(e,t.targetId,o.cc),o.snapshot}(e,t,n,r);const s=await xd(e.localStore,t,!0),o=new Bf(t,s.ir),a=o.sc(s.documents),c=Xu.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);tp(e,n,u.cc);const l=new jf(t,n,o);return e.wc.set(t,l),e._c.has(n)?e._c.get(n).push(t):e._c.set(n,[t]),u.snapshot}(n,t,r,"current"===s,e.resumeToken),n.isPrimaryClient&&Zd(n.remoteStore,e)}return i}async function Kf(e,t){const n=Os(e),r=n.wc.get(t),i=n._c.get(r.targetId);if(i.length>1)return n._c.set(r.targetId,i.filter((e=>!Vc(e,t)))),void n.wc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Nd(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),ef(n.remoteStore,r.targetId),Zf(n,r.targetId)})).catch(po)):(Zf(n,r.targetId),await Nd(n.localStore,r.targetId,!0))}async function Gf(e,t){const n=Os(e);try{const e=await function(e,t){const n=Os(e),r=t.snapshotVersion;let i=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Zi.newChangeBuffer({trackRemovals:!0});i=n.Ji;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Bs.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Bs.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(ga.EMPTY_BYTE_STRING,Ys.min()).withLastLimboFreeSnapshotVersion(Ys.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Bs.updateTargetData(e,u))}));let a=Gc(),c=tu();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(function(e,t,n){let r=tu(),i=tu();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=Gc();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(Ys.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):ks("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{nr:r,sr:i}}))}(e,s,t.documentUpdates).next((e=>{a=e.nr,c=e.sr}))),!r.isEqual(Ys.min())){const t=n.Bs.getLastRemoteSnapshotVersion(e).next((t=>n.Bs.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return mo.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.Ji=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.yc.get(t);r&&(Rs(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.fc=!0:e.modifiedDocuments.size>0?Rs(r.fc):e.removedDocuments.size>0&&(Rs(r.fc),r.fc=!1))})),await ip(n,e,t)}catch(e){await po(e)}}function Hf(e,t,n){const r=Os(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.wc.forEach(((n,r)=>{const i=r.view.Mu(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=Os(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.Mu(t)&&(r=!0)})),r&&Mf(n)}(r.eventManager,t),e.length&&r.dc.nu(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Wf(e,t,n){const r=Os(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.yc.get(t),s=i&&i.key;if(s){let e=new ca(no.comparator);e=e.insert(s,Qa.newNoDocument(s,Ys.min()));const n=tu().add(s),i=new Qu(Ys.min(),new Map,new ca(Hs),e,n);await Gf(r,i),r.gc=r.gc.remove(s),r.yc.delete(t),rp(r)}else await Nd(r.localStore,t,!1).then((()=>Zf(r,t,n))).catch(po)}async function Qf(e,t){const n=Os(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Os(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.Zi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=mo.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);Rs(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=tu();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);Jf(n,r,null),Yf(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await ip(n,e)}catch(e){await po(e)}}async function Xf(e,t,n){const r=Os(e);try{const e=await function(e,t){const n=Os(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(Rs(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Jf(r,t,n),Yf(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await ip(r,e)}catch(n){await po(n)}}function Yf(e,t){(e.Ec.get(t)||[]).forEach((e=>{e.resolve()})),e.Ec.delete(t)}function Jf(e,t,n){const r=Os(e);let i=r.Tc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Tc[r.currentUser.toKey()]=i}}function Zf(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e._c.get(t))e.wc.delete(r),n&&e.dc.Pc(r,n);e._c.delete(t),e.isPrimaryClient&&e.Ic.Is(t).forEach((t=>{e.Ic.containsKey(t)||ep(e,t)}))}function ep(e,t){e.mc.delete(t.path.canonicalString());const n=e.gc.get(t);null!==n&&(ef(e.remoteStore,n),e.gc=e.gc.remove(t),e.yc.delete(n),rp(e))}function tp(e,t,n){for(const r of n)r instanceof Vf?(e.Ic.addReference(r.key,t),np(e,r)):r instanceof Uf?(ks("SyncEngine","Document no longer in limbo: "+r.key),e.Ic.removeReference(r.key,t),e.Ic.containsKey(r.key)||ep(e,r.key)):xs()}function np(e,t){const n=t.key,r=n.path.canonicalString();e.gc.get(n)||e.mc.has(r)||(ks("SyncEngine","New document in limbo: "+n),e.mc.add(r),rp(e))}function rp(e){for(;e.mc.size>0&&e.gc.size<e.maxConcurrentLimboResolutions;){const t=e.mc.values().next().value;e.mc.delete(t);const n=new no(Zs.fromString(t)),r=e.Ac.next();e.yc.set(r,new qf(n)),e.gc=e.gc.insert(n,r),Zd(e.remoteStore,new Ml(Lc(Dc(n.path)),r,"TargetPurposeLimboResolution",ko.ct))}}async function ip(e,t,n){const r=Os(e),i=[],s=[],o=[];r.wc.isEmpty()||(r.wc.forEach(((e,a)=>{o.push(r.Rc(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=Td.Li(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.dc.nu(i),await async function(e,t){const n=Os(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>mo.forEach(t,(t=>mo.forEach(t.Fi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>mo.forEach(t.Bi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Io(e))throw e;ks("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ji.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.Ji=n.Ji.insert(t,i)}}}(r.localStore,s))}async function sp(e,t){const n=Os(e);if(!n.currentUser.isEqual(t)){ks("SyncEngine","User change. New user:",t.toKey());const e=await kd(n.localStore,t);n.currentUser=t,function(e){e.Ec.forEach((e=>{e.forEach((e=>{e.reject(new Ls(Ps.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ec.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await ip(n,e.er)}}function op(e,t){const n=Os(e),r=n.yc.get(t);if(r&&r.fc)return tu().add(r.key);{let e=tu();const r=n._c.get(t);if(!r)return e;for(const t of r){const r=n.wc.get(t);e=e.unionWith(r.view.nc)}return e}}function ap(e){const t=Os(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Qf.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Xf.bind(null,t),t}class cp{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=zd(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Cd(this.persistence,new _d,e.initialUser,this.serializer)}createPersistence(e){return new pd(gd.zs,this.serializer)}createSharedClientState(e){return new Od}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class up extends cp{constructor(e,t,n){super(),this.Vc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Vc.initialize(this,e),await ap(this.Vc.syncEngine),await ff(this.Vc.remoteStore),await this.persistence.Ii((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}createLocalStore(e){return Cd(this.persistence,new _d,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new Kh(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new Co(t,this.persistence);return new So(e.asyncQueue,n)}createPersistence(e){const t=function(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Nh.withCacheSize(this.cacheSizeBytes):Nh.DEFAULT;return new Id(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,"undefined"!=typeof window?window:null,qd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Od}}class lp{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Hf(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=sp.bind(null,this.syncEngine),await async function(e,t){const n=Os(e);t?(n.vu.delete(2),await Yd(n)):t||(n.vu.add(2),await Jd(n),n.bu.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new xf}createDatastore(e){const t=zd(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new jd(r));var r;return function(e,t,n,r){return new Wd(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Hf(this.syncEngine,e,0),s=Ld.D()?new Ld:new Pd,new Xd(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new zf(e,t,n,r,i,s);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Os(e);ks("RemoteStore","RemoteStore shutting down."),t.vu.add(5),await Jd(t),t.Pu.shutdown(),t.bu.set("Unknown")}(this.remoteStore)}}class hp{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):As("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class dp{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Ts.UNAUTHENTICATED,this.clientId=Gs.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{ks("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(ks("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Ls(Ps.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ms;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Cf(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function fp(e,t){e.asyncQueue.verifyOperationInProgress(),ks("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await kd(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function pp(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){ks("FirestoreClient","Using user provided OfflineComponentProvider");try{await fp(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!mp(n))throw n;Ds("Error using user provided cache. Falling back to memory cache: "+n),await fp(e,new cp)}}else ks("FirestoreClient","Using default OfflineComponentProvider"),await fp(e,new cp);return e._offlineComponents}(e);ks("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>Ef(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Ef(t.remoteStore,n))),e._onlineComponents=t}function mp(e){return"FirebaseError"===e.name?e.code===Ps.FAILED_PRECONDITION||e.code===Ps.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function gp(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(ks("FirestoreClient","Using user provided OnlineComponentProvider"),await pp(e,e._uninitializedComponentsProvider._online)):(ks("FirestoreClient","Using default OnlineComponentProvider"),await pp(e,new lp))),e._onlineComponents}async function yp(e){const t=await gp(e),n=t.eventManager;return n.onListen=$f.bind(null,t.syncEngine),n.onUnlisten=Kf.bind(null,t.syncEngine),n}function vp(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const wp=new Map;function Ip(e,t,n){if(!n)throw new Ls(Ps.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function bp(e){if(!no.isDocumentKey(e))throw new Ls(Ps.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Ep(e){if(no.isDocumentKey(e))throw new Ls(Ps.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Tp(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":xs()}function _p(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Ls(Ps.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Tp(e);throw new Ls(Ps.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class Sp{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new Ls(Ps.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Ls(Ps.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new Ls(Ps.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=vp(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Ls(Ps.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new Ls(Ps.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new Ls(Ps.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class Cp{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Sp({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Ls(Ps.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Ls(Ps.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Sp(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Vs;switch(e.type){case"firstParty":return new qs(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Ls(Ps.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=wp.get(e);t&&(ks("ComponentProvider","Removing Datastore"),wp.delete(e),t.terminate())}(this),Promise.resolve()}}class kp{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Dp(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new kp(this.firestore,e,this._key)}}class Ap{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Ap(this.firestore,e,this._query)}}class Dp extends Ap{constructor(e,t,n){super(e,t,Dc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new kp(this.firestore,null,new no(e))}withConverter(e){return new Dp(this.firestore,e,this._path)}}function Np(e,t,...n){if(e=x(e),Ip("collection","path",t),e instanceof Cp){const r=Zs.fromString(t,...n);return Ep(r),new Dp(e,null,r)}{if(!(e instanceof kp||e instanceof Dp))throw new Ls(Ps.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Zs.fromString(t,...n));return Ep(r),new Dp(e.firestore,null,r)}}function xp(e,t,...n){if(e=x(e),1===arguments.length&&(t=Gs.A()),Ip("doc","path",t),e instanceof Cp){const r=Zs.fromString(t,...n);return bp(r),new kp(e,null,new no(r))}{if(!(e instanceof kp||e instanceof Dp))throw new Ls(Ps.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Zs.fromString(t,...n));return bp(r),new kp(e.firestore,e instanceof Dp?e.converter:null,new no(r))}}class Rp{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new $d(this,"async_queue_retry"),this.Xc=()=>{const e=qd();e&&ks("AsyncQueue","Visibility state changed to "+e.visibilityState),this.qo.Mo()};const e=qd();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const t=qd();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise((()=>{}));const t=new Ms;return this.ta((()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Qc.push(e),this.ea())))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!Io(e))throw e;ks("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No((()=>this.ea()))}}ta(e){const t=this.Gc.then((()=>(this.Hc=!0,e().catch((e=>{this.Wc=e,this.Hc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw As("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Hc=!1,e))))));return this.Gc=t,t}enqueueAfterDelay(e,t,n){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);const r=Sf.createAndSchedule(this,e,t,n,(e=>this.na(e)));return this.zc.push(r),r}Zc(){this.Wc&&xs()}verifyOperationInProgress(){}async sa(){let e;do{e=this.Gc,await e}while(e!==this.Gc)}ia(e){for(const t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then((()=>{this.zc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.zc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()}))}oa(e){this.Yc.push(e)}na(e){const t=this.zc.indexOf(e);this.zc.splice(t,1)}}class Op extends Cp{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Rp,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Lp(this),this._firestoreClient.terminate()}}function Pp(e){return e._firestoreClient||Lp(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Lp(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new _a(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,vp(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new dp(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.cache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.cache.kind,_offline:i.cache._offlineComponentProvider,_online:i.cache._onlineComponentProvider})}class Mp{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Mp(ga.fromBase64String(e))}catch(e){throw new Ls(Ps.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Mp(ga.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Fp{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Ls(Ps.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new to(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Vp{constructor(e){this._methodName=e}}class Up{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ls(Ps.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ls(Ps.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Hs(this._lat,e._lat)||Hs(this._long,e._long)}}const Bp=/^__.*__$/;class jp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Du(e,this.data,this.fieldMask,t,this.fieldTransforms):new Au(e,this.data,t,this.fieldTransforms)}}class qp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Du(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function zp(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw xs()}}class $p{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.ua(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new $p(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.fa(e),r}da(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.ua(),r}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return im(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(zp(this.ca)&&Bp.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class Kp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||zd(e)}ya(e,t,n,r=!1){return new $p({ca:e,methodName:t,ga:n,path:to.emptyPath(),la:!1,ma:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Gp(e){const t=e._freezeSettings(),n=zd(e._databaseId);return new Kp(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Hp(e,t,n,r,i,s={}){const o=e.ya(s.merge||s.mergeFields?2:0,t,n,i);em("Data must be an object, but it was:",o,r);const a=Jp(r,o);let c,u;if(s.merge)c=new pa(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=tm(t,r,n);if(!o.contains(i))throw new Ls(Ps.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);sm(e,i)||e.push(i)}c=new pa(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new jp(new Ha(a),c,u)}class Wp extends Vp{_toFieldTransform(e){if(2!==e.ca)throw 1===e.ca?e._a(`${this._methodName}() can only appear at the top level of your update data`):e._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Wp}}class Qp extends Vp{_toFieldTransform(e){return new vu(e.path,new lu)}isEqual(e){return e instanceof Qp}}function Xp(e,t,n,r=!1){return Yp(n,e.ya(r?4:3,t))}function Yp(e,t){if(Zp(e=x(e)))return em("Unsupported field value:",t,e),Jp(e,t);if(e instanceof Vp)return function(e,t){if(!zp(t.ca))throw t._a(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t._a(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.la&&4!==t.ca)throw t._a("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Yp(i,t.wa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=x(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return su(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Xs.fromDate(e);return{timestampValue:ul(t.serializer,n)}}if(e instanceof Xs){const n=new Xs(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ul(t.serializer,n)}}if(e instanceof Up)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Mp)return{bytesValue:ll(t.serializer,e._byteString)};if(e instanceof kp){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t._a(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:fl(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t._a(`Unsupported field value: ${Tp(e)}`)}(e,t)}function Jp(e,t){const n={};return aa(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):oa(e,((e,r)=>{const i=Yp(r,t.ha(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Zp(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Xs||e instanceof Up||e instanceof Mp||e instanceof kp||e instanceof Vp)}function em(e,t,n){if(!Zp(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Tp(n);throw"an object"===r?t._a(e+" a custom object"):t._a(e+" "+r)}}function tm(e,t,n){if((t=x(t))instanceof Fp)return t._internalPath;if("string"==typeof t)return rm(e,t);throw im("Field path arguments must be of type string or ",e,!1,void 0,n)}const nm=new RegExp("[~\\*/\\[\\]]");function rm(e,t,n){if(t.search(nm)>=0)throw im(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Fp(...t.split("."))._internalPath}catch(r){throw im(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function im(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Ls(Ps.INVALID_ARGUMENT,a+e+c)}function sm(e,t){return e.some((e=>e.isEqual(t)))}class om{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new kp(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new am(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(cm("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class am extends om{data(){return super.data()}}function cm(e,t){return"string"==typeof t?rm(e,t):t instanceof Fp?t._internalPath:t._delegate._internalPath}class um{}class lm extends um{}function hm(e,t,...n){let r=[];t instanceof um&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof pm)).length,n=e.filter((e=>e instanceof dm)).length;if(t>1||t>0&&n>0)throw new Ls(Ps.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class dm extends lm{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new dm(e,t,n)}_apply(e){const t=this._parse(e);return bm(e._query,t),new Ap(e.firestore,e.converter,Mc(e._query,t))}_parse(e){const t=Gp(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Ls(Ps.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Im(o,s);const t=[];for(const n of o)t.push(wm(r,e,n));a={arrayValue:{values:t}}}else a=wm(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Im(o,s),a=Xp(n,"where",o,"in"===s||"not-in"===s);return nc.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function fm(e,t,n){const r=t,i=cm("where",e);return dm._create(i,r,n)}class pm extends um{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new pm(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:rc.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)bm(n,e),n=Mc(n,e)}(e._query,t),new Ap(e.firestore,e.converter,Mc(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class mm extends lm{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new mm(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new Ls(Ps.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Ls(Ps.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new Za(t,n);return function(e,t){if(null===xc(e)){const n=Rc(e);null!==n&&Em(0,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new Ap(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Ac(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class gm extends lm{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new gm(e,t,n)}_apply(e){return new Ap(e.firestore,e.converter,Fc(e._query,this._limit,this._limitType))}}function ym(e){return function(e,t){if(t<=0)throw new Ls(Ps.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}("limit",e),gm._create("limit",e,"F")}class vm extends lm{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new vm(e,t,n)}_apply(e){const t=function(e,t,n,r){if(n[0]=x(n[0]),n[0]instanceof om)return function(e,t,n,r,i){if(!r)throw new Ls(Ps.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Pc(e))if(n.field.isKeyField())s.push(La(t,r.key));else{const e=r.data.field(n.field);if(ba(e))throw new Ls(Ps.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new Ls(Ps.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new Xa(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=Gp(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new Ls(Ps.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const c=i[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new Ls(Ps.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Oc(e)&&-1!==c.indexOf("/"))throw new Ls(Ps.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(Zs.fromString(c));if(!no.isDocumentKey(n))throw new Ls(Ps.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new no(n);a.push(La(t,i))}else{const e=Xp(n,r,c);a.push(e)}}return new Xa(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}(e,this.type,this._docOrFields,this._inclusive);return new Ap(e.firestore,e.converter,function(e,t){return new Ac(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}function wm(e,t,n){if("string"==typeof(n=x(n))){if(""===n)throw new Ls(Ps.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Oc(t)&&-1!==n.indexOf("/"))throw new Ls(Ps.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(Zs.fromString(n));if(!no.isDocumentKey(r))throw new Ls(Ps.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return La(e,new no(r))}if(n instanceof kp)return La(e,n._key);throw new Ls(Ps.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Tp(n)}.`)}function Im(e,t){if(!Array.isArray(e)||0===e.length)throw new Ls(Ps.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function bm(e,t){if(t.isInequality()){const n=Rc(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new Ls(Ps.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);const i=xc(e);null!==i&&Em(0,r,i)}const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new Ls(Ps.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Ls(Ps.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function Em(e,t,n){if(!n.isEqual(t))throw new Ls(Ps.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Tm{convertValue(e,t="none"){switch(Aa(e)){case 0:return null;case 1:return e.booleanValue;case 2:return wa(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ia(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw xs()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return oa(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new Up(wa(e.latitude),wa(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ea(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ta(e));default:return null}}convertTimestamp(e){const t=va(e);return new Xs(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Zs.fromString(e);Rs(Ll(n));const r=new Sa(n.get(1),n.get(3)),i=new no(n.popFirst(5));return r.isEqual(t)||As(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function _m(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Sm{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Cm extends om{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new km(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(cm("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class km extends Cm{data(e={}){return super.data(e)}}class Am{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Sm(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new km(this._firestore,this._userDataWriter,n.key,n,new Sm(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Ls(Ps.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new km(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Sm(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new km(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Sm(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Dm(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Dm(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return xs()}}function Nm(e){e=_p(e,kp);const t=_p(e.firestore,Op);return function(e,t,n={}){const r=new Ms;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new hp({next:s=>{t.enqueueAndForget((()=>Of(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new Ls(Ps.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new Ls(Ps.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new Ff(Dc(n.path),s,{includeMetadataChanges:!0,Ku:!0});return Rf(e,o)}(await yp(e),e.asyncQueue,t,n,r))),r.promise}(Pp(t),e._key).then((n=>function(e,t,n){const r=n.docs.get(t._key),i=new xm(e);return new Cm(e,i,t._key,r,new Sm(n.hasPendingWrites,n.fromCache),t.converter)}(t,e,n)))}class xm extends Tm{constructor(e){super(),this.firestore=e}convertBytes(e){return new Mp(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new kp(this.firestore,null,t)}}function Rm(e){e=_p(e,Ap);const t=_p(e.firestore,Op),n=Pp(t),r=new xm(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Ls(Ps.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),function(e,t,n={}){const r=new Ms;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new hp({next:n=>{t.enqueueAndForget((()=>Of(e,o))),n.fromCache&&"server"===r.source?i.reject(new Ls(Ps.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Ff(n,s,{includeMetadataChanges:!0,Ku:!0});return Rf(e,o)}(await yp(e),e.asyncQueue,t,n,r))),r.promise}(n,e._query).then((n=>new Am(t,r,e,n)))}function Om(e,t,n,...r){e=_p(e,kp);const i=_p(e.firestore,Op),s=Gp(i);let o;return o="string"==typeof(t=x(t))||t instanceof Fp?function(e,t,n,r,i,s){const o=e.ya(1,t,n),a=[tm(t,r,n)],c=[i];if(s.length%2!=0)throw new Ls(Ps.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(tm(t,s[e])),c.push(s[e+1]);const u=[],l=Ha.empty();for(let e=a.length-1;e>=0;--e)if(!sm(u,a[e])){const t=a[e];let n=c[e];n=x(n);const r=o.da(t);if(n instanceof Wp)u.push(t);else{const e=Yp(n,r);null!=e&&(u.push(t),l.set(t,e))}}const h=new pa(u);return new qp(l,h,o.fieldTransforms)}(s,"updateDoc",e._key,t,n,r):function(e,t,n,r){const i=e.ya(1,t,n);em("Data must be an object, but it was:",i,r);const s=[],o=Ha.empty();oa(r,((e,r)=>{const a=rm(t,e,n);r=x(r);const c=i.da(a);if(r instanceof Wp)s.push(a);else{const e=Yp(r,c);null!=e&&(s.push(a),o.set(a,e))}}));const a=new pa(s);return new qp(o,a,i.fieldTransforms)}(s,"updateDoc",e._key,t),Lm(i,[o.toMutation(e._key,Iu.exists(!0))])}function Pm(e,t){const n=_p(e.firestore,Op),r=xp(e),i=_m(e.converter,t);return Lm(n,[Hp(Gp(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Iu.exists(!1))]).then((()=>r))}function Lm(e,t){return function(e,t){const n=new Ms;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=ap(e);try{const e=await function(e,t){const n=Os(e),r=Xs.now(),i=t.reduce(((e,t)=>e.add(t.key)),tu());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=Gc(),c=tu();return n.Zi.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=Cu(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Du(e.key,t,Wa(t.value.mapValue),Iu.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Qc(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Tc[e.currentUser.toKey()];r||(r=new ca(Hs)),r=r.insert(t,n),e.Tc[e.currentUser.toKey()]=r}(r,e.batchId,n),await ip(r,e.changes),await ff(r.remoteStore)}catch(e){const t=Cf(e,"Failed to persist write");n.reject(t)}}(await function(e){return gp(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(Pp(e),t)}function Mm(){return new Qp("serverTimestamp")}function Fm(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}!function(e,t=!0){!function(e){_s=e}(qe),Ve(new R("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new Op(new Bs(e.getProvider("auth-internal")),new $s(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Ls(Ps.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Sa(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Ke(Es,"3.13.0",e),Ke(Es,"3.13.0","esm2017")}(),Ke("firebase","9.23.0","app"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const Vm=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Um=new b("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Bm=new q("@firebase/auth");function jm(e,...t){Bm.logLevel<=F.ERROR&&Bm.error(`Auth (${qe}): ${e}`,...t)}function qm(e,...t){throw $m(e,...t)}function zm(e,...t){return $m(e,...t)}function $m(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return Um.create(e,...t)}function Km(e,t,...n){if(!e)throw $m(t,...n)}function Gm(e){const t="INTERNAL ASSERTION FAILED: "+e;throw jm(t),new Error(t)}function Hm(e,t){e||Gm(t)}function Wm(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Qm(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Xm{constructor(e,t){this.shortDelay=e,this.longDelay=t,Hm(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(m())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Qm()||"https:"===Qm()||y()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Ym(e,t){Hm(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Jm{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void Gm("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void Gm("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void Gm("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Zm={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},eg=new Xm(3e4,6e4);function tg(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function ng(e,t,n,r,i={}){return rg(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=S(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),Jm.fetch()(sg(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))}async function rg(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},Zm),t);try{const t=new og(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw ag(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw ag(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw ag(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw ag(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw function(e,t,n){const r=Object.assign(Object.assign({},Vm()),{[t]:n});return new b("auth","Firebase",r).create(t,{appName:e.name})}(e,a,o);qm(e,a)}}catch(t){if(t instanceof I)throw t;qm(e,"network-request-failed",{message:String(t)})}}async function ig(e,t,n,r,i={}){const s=await ng(e,t,n,r,i);return"mfaPendingCredential"in s&&qm(e,"multi-factor-auth-required",{_serverResponse:s}),s}function sg(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?Ym(e.config,i):`${e.config.apiScheme}://${i}`}class og{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(zm(this.auth,"network-request-failed"))),eg.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function ag(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=zm(e,t,r);return i.customData._tokenResponse=n,i}function cg(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function ug(e){return 1e3*Number(e)}function lg(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return jm("JWT malformed, contained fewer than 3 sections"),null;try{const e=a(n);return e?JSON.parse(e):(jm("Failed to decode base64 JWT payload"),null)}catch(e){return jm("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function hg(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof I&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class dg{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class fg{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=cg(this.lastLoginAt),this.creationTime=cg(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function pg(e){var t;const n=e.auth,r=await e.getIdToken(),i=await hg(e,async function(e,t){return ng(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));Km(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=Fm(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new fg(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class mg{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Km(e.idToken,"internal-error"),Km(void 0!==e.idToken,"internal-error"),Km(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=lg(e);return Km(t,"internal-error"),Km(void 0!==t.exp,"internal-error"),Km(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return Km(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await rg(e,{},(async()=>{const n=S({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=sg(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Jm.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new mg;return n&&(Km("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(Km("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(Km("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new mg,this.toJSON())}_performRefresh(){return Gm("not implemented")}}function gg(e,t){Km("string"==typeof e||void 0===e,"internal-error",{appName:t})}class yg{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Fm(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new dg(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new fg(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await hg(this,this.stsTokenManager.getToken(this.auth,e));return Km(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=x(e),r=await n.getIdToken(t),i=lg(r);Km(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:cg(ug(i.auth_time)),issuedAtTime:cg(ug(i.iat)),expirationTime:cg(ug(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=x(e);await pg(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Km(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new yg(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Km(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await pg(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await hg(this,async function(e,t){return ng(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:I,providerData:b,stsTokenManager:E}=t;Km(v&&E,e,"internal-error");const T=mg.fromJSON(this.name,E);Km("string"==typeof v,e,"internal-error"),gg(l,e.name),gg(h,e.name),Km("boolean"==typeof w,e,"internal-error"),Km("boolean"==typeof I,e,"internal-error"),gg(d,e.name),gg(f,e.name),gg(p,e.name),gg(m,e.name),gg(g,e.name),gg(y,e.name);const _=new yg({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:I,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:y});return b&&Array.isArray(b)&&(_.providerData=b.map((e=>Object.assign({},e)))),m&&(_._redirectEventId=m),_}static async _fromIdTokenResponse(e,t,n=!1){const r=new mg;r.updateFromServerResponse(t);const i=new yg({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await pg(i),i}}const vg=new Map;function wg(e){Hm(e instanceof Function,"Expected a class definition");let t=vg.get(e);return t?(Hm(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,vg.set(e,t),t)}class Ig{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ig.type="NONE";const bg=Ig;function Eg(e,t,n){return`firebase:${e}:${t}:${n}`}class Tg{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=Eg(this.userKey,r.apiKey,i),this.fullPersistenceKey=Eg("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?yg._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Tg(wg(bg),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||wg(bg);const s=Eg(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=yg._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new Tg(i,e,n)):new Tg(i,e,n)}}function _g(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Ag(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Sg(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Ng(t))return"Blackberry";if(xg(t))return"Webos";if(Cg(t))return"Safari";if((t.includes("chrome/")||kg(t))&&!t.includes("edge/"))return"Chrome";if(Dg(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Sg(e=m()){return/firefox\//i.test(e)}function Cg(e=m()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function kg(e=m()){return/crios\//i.test(e)}function Ag(e=m()){return/iemobile/i.test(e)}function Dg(e=m()){return/android/i.test(e)}function Ng(e=m()){return/blackberry/i.test(e)}function xg(e=m()){return/webos/i.test(e)}function Rg(e=m()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Og(e=m()){return Rg(e)||Dg(e)||xg(e)||Ng(e)||/windows phone/i.test(e)||Ag(e)}function Pg(e,t=[]){let n;switch(e){case"Browser":n=_g(m());break;case"Worker":n=`${_g(m())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${qe}/${r}`}async function Lg(e,t){return ng(e,"GET","/v2/recaptchaConfig",tg(e,t))}function Mg(e){return void 0!==e&&void 0!==e.enterprise}class Fg{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some((e=>"EMAIL_PASSWORD_PROVIDER"===e.provider&&"OFF"!==e.enforcementState))}}function Vg(e){return new Promise(((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=zm("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)}))}function Ug(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Bg{constructor(e){this.type="recaptcha-enterprise",this.auth=$g(e)}async verify(e="verify",t=!1){function n(t,n,r){const i=window.grecaptcha;Mg(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{Lg(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new Fg(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&Mg(window.grecaptcha))n(i,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));Vg("https://www.google.com/recaptcha/enterprise.js?render="+i).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function jg(e,t,n,r=!1){const i=new Bg(e);let s;try{s=await i.verify(n)}catch(e){s=await i.verify(n,!0)}const o=Object.assign({},t);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}class qg{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class zg{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Kg(this),this.idTokenSubscription=new Kg(this),this.beforeStateQueue=new qg(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Um,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=wg(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await Tg.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Km(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await pg(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?x(e):null;return t&&Km(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Km(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(wg(e))}))}async initializeRecaptchaConfig(){const e=await Lg(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),t=new Fg(e);null==this.tenantId?this._agentRecaptchaConfig=t:this._tenantRecaptchaConfigs[this.tenantId]=t,t.emailPasswordEnabled&&new Bg(this).verify()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new b("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&wg(e)||this._popupRedirectResolver;Km(t,this,"argument-error"),this.redirectPersistenceManager=await Tg.create(this,[wg(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return Km(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Km(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Pg(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Bm.logLevel<=F.WARN&&Bm.warn(`Auth (${qe}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function $g(e){return x(e)}class Kg{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e){const t=new A(e,void 0);return t.subscribe.bind(t)}((e=>this.observer=e))}get next(){return Km(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Gg(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Hg(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Wg{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Gm("not implemented")}_getIdTokenResponse(e){return Gm("not implemented")}_linkToIdToken(e,t){return Gm("not implemented")}_getReauthenticationResolver(e){return Gm("not implemented")}}async function Qg(e,t){return ig(e,"POST","/v1/accounts:signInWithPassword",tg(e,t))}class Xg extends Wg{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Xg(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Xg(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){var t;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null===(t=e._getRecaptchaConfig())||void 0===t?void 0:t.emailPasswordEnabled){const t=await jg(e,n,"signInWithPassword");return Qg(e,t)}return Qg(e,n).catch((async t=>{if("auth/missing-recaptcha-token"===t.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const t=await jg(e,n,"signInWithPassword");return Qg(e,t)}return Promise.reject(t)}));case"emailLink":return async function(e,t){return ig(e,"POST","/v1/accounts:signInWithEmailLink",tg(e,t))}(e,{email:this._email,oobCode:this._password});default:qm(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return async function(e,t){return ng(e,"POST","/v1/accounts:update",t)}(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return ig(e,"POST","/v1/accounts:signInWithEmailLink",tg(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:qm(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Yg(e,t){return ig(e,"POST","/v1/accounts:signInWithIdp",tg(e,t))}class Jg extends Wg{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Jg(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):qm("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=Fm(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new Jg(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return Yg(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Yg(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Yg(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=S(t)}return e}}const Zg={USER_NOT_FOUND:"user-not-found"};class ey extends Wg{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ey({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ey({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return ig(e,"POST","/v1/accounts:signInWithPhoneNumber",tg(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await ig(e,"POST","/v1/accounts:signInWithPhoneNumber",tg(e,t));if(n.temporaryProof)throw ag(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return ig(e,"POST","/v1/accounts:signInWithPhoneNumber",tg(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Zg)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new ey({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class ty{constructor(e){var t,n,r,i,s,o;const a=C(k(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);Km(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=C(k(e)).link,n=t?C(k(t)).deep_link_id:null,r=C(k(e)).deep_link_id;return(r?C(k(r)).link:null)||r||n||t||e}(e);try{return new ty(t)}catch(e){return null}}}class ny{constructor(){this.providerId=ny.PROVIDER_ID}static credential(e,t){return Xg._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=ty.parseLink(t);return Km(n,"argument-error"),Xg._fromEmailAndCode(e,n.code,n.tenantId)}}ny.PROVIDER_ID="password",ny.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ny.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ry{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class iy extends ry{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class sy extends iy{constructor(){super("facebook.com")}static credential(e){return Jg._fromParams({providerId:sy.PROVIDER_ID,signInMethod:sy.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return sy.credentialFromTaggedObject(e)}static credentialFromError(e){return sy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return sy.credential(e.oauthAccessToken)}catch(e){return null}}}sy.FACEBOOK_SIGN_IN_METHOD="facebook.com",sy.PROVIDER_ID="facebook.com";class oy extends iy{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Jg._fromParams({providerId:oy.PROVIDER_ID,signInMethod:oy.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return oy.credentialFromTaggedObject(e)}static credentialFromError(e){return oy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return oy.credential(t,n)}catch(e){return null}}}oy.GOOGLE_SIGN_IN_METHOD="google.com",oy.PROVIDER_ID="google.com";class ay extends iy{constructor(){super("github.com")}static credential(e){return Jg._fromParams({providerId:ay.PROVIDER_ID,signInMethod:ay.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ay.credentialFromTaggedObject(e)}static credentialFromError(e){return ay.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return ay.credential(e.oauthAccessToken)}catch(e){return null}}}ay.GITHUB_SIGN_IN_METHOD="github.com",ay.PROVIDER_ID="github.com";class cy extends iy{constructor(){super("twitter.com")}static credential(e,t){return Jg._fromParams({providerId:cy.PROVIDER_ID,signInMethod:cy.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return cy.credentialFromTaggedObject(e)}static credentialFromError(e){return cy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return cy.credential(t,n)}catch(e){return null}}}cy.TWITTER_SIGN_IN_METHOD="twitter.com",cy.PROVIDER_ID="twitter.com";class uy{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await yg._fromIdTokenResponse(e,n,r),s=ly(n);return new uy({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=ly(n);return new uy({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function ly(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class hy extends I{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,hy.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new hy(e,t,n,r)}}function dy(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw hy._fromErrorAndOperation(e,n,t,r);throw n}))}new WeakMap;const fy="__sak";class py{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(fy,"1"),this.storage.removeItem(fy),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class my extends py{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=m();return Cg(e)||Rg(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Og(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);!function(){const e=m();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||i===e.newValue||e.newValue===e.oldValue?r():setTimeout(r,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}my.type="LOCAL";const gy=my;class yy extends py{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}yy.type="SESSION";const vy=yy;class wy{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new wy(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Iy(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}wy.receivers=[];class by{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=Iy("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function Ey(){return window}function Ty(){return void 0!==Ey().WorkerGlobalScope&&"function"==typeof Ey().importScripts}const _y="firebaseLocalStorageDb",Sy="firebaseLocalStorage",Cy="fbase_key";class ky{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Ay(e,t){return e.transaction([Sy],t?"readwrite":"readonly").objectStore(Sy)}function Dy(){const e=indexedDB.open(_y,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Sy,{keyPath:Cy})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Sy)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(_y);return new ky(e).toPromise()}(),t(await Dy()))}))}))}async function Ny(e,t,n){const r=Ay(e,!0).put({[Cy]:t,value:n});return new ky(r).toPromise()}function xy(e,t){const n=Ay(e,!0).delete(t);return new ky(n).toPromise()}class Ry{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Dy()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ty()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=wy._getInstance(Ty()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new by(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}var t}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Dy();return await Ny(e,fy,"1"),await xy(e,fy),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Ny(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Ay(e,!1).get(t),r=await new ky(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>xy(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Ay(e,!1).getAll();return new ky(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Ry.type="LOCAL";const Oy=Ry;Ug("rcb"),new Xm(3e4,6e4);class Py{constructor(e){this.providerId=Py.PROVIDER_ID,this.auth=$g(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var r;const i=await n.verify();try{let s;if(Km("string"==typeof i,e,"argument-error"),Km("recaptcha"===n.type,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){Km("enroll"===t.type,e,"internal-error");const n=await function(e,t){return ng(e,"POST","/v2/accounts/mfaEnrollment:start",tg(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{Km("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;Km(n,e,"missing-multi-factor-info");const o=await function(e,t){return ng(e,"POST","/v2/accounts/mfaSignIn:start",tg(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return ng(e,"POST","/v1/accounts:sendVerificationCode",tg(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}(this.auth,e,x(t))}static credential(e,t){return ey._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Py.credentialFromTaggedObject(t)}static credentialFromError(e){return Py.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?ey._fromTokenResponse(t,n):null}}Py.PROVIDER_ID="phone",Py.PHONE_SIGN_IN_METHOD="phone";class Ly extends Wg{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Yg(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Yg(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Yg(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function My(e){return async function(e,t,n=!1){const r="signIn",i=await dy(e,r,t),s=await uy._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}(e.auth,new Ly(e),e.bypassAuthState)}function Fy(e){const{auth:t,user:n}=e;return Km(n,t,"internal-error"),async function(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await hg(e,dy(r,i,t,e),n);Km(s.idToken,r,"internal-error");const o=lg(s.idToken);Km(o,r,"internal-error");const{sub:a}=o;return Km(e.uid===a,r,"user-mismatch"),uy._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&qm(r,"user-mismatch"),e}}(n,new Ly(e),e.bypassAuthState)}async function Vy(e){const{auth:t,user:n}=e;return Km(n,t,"internal-error"),async function(e,t,n=!1){const r=await hg(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return uy._forOperation(e,"link",r)}(n,new Ly(e),e.bypassAuthState)}class Uy{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return My;case"linkViaPopup":case"linkViaRedirect":return Vy;case"reauthViaPopup":case"reauthViaRedirect":return Fy;default:qm(this.auth,"internal-error")}}resolve(e){Hm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Hm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const By=new Xm(2e3,1e4);class jy extends Uy{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,jy.currentPopupAction&&jy.currentPopupAction.cancel(),jy.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Km(e,this.auth,"internal-error"),e}async onExecution(){Hm(1===this.filter.length,"Popup operations only handle one event");const e=Iy();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(zm(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(zm(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,jy.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(zm(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,By.get())};e()}}jy.currentPopupAction=null;const qy=new Map;class zy extends Uy{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=qy.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return Eg("pendingRedirect",e.config.apiKey,e.name)}(t),r=function(e){return wg(e._redirectPersistence)}(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}qy.set(this.auth._key(),e)}return this.bypassAuthState||qy.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function $y(e,t){qy.set(e._key(),t)}async function Ky(e,t,n=!1){const r=$g(e),i=function(e,t){return t?wg(t):(Km(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(r,t),s=new zy(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class Gy{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Wy(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Wy(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(zm(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Hy(e))}saveEventToCache(e){this.cachedEventUids.add(Hy(e)),this.lastProcessedEventTime=Date.now()}}function Hy(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Wy({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const Qy=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Xy=/^https?/;function Yy(e){const t=Wm(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Xy.test(n))return!1;if(Qy.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Jy=new Xm(3e4,6e4);function Zy(){const e=Ey().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let ev=null;function tv(e){return ev=ev||function(e){return new Promise(((t,n)=>{var r,i,s;function o(){Zy(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Zy(),n(zm(e,"network-request-failed"))},timeout:Jy.get()})}if(null===(i=null===(r=Ey().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=Ey().gapi)||void 0===s?void 0:s.load)){const t=Ug("iframefcb");return Ey()[t]=()=>{gapi.load?o():n(zm(e,"network-request-failed"))},Vg(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw ev=null,e}))}(e),ev}const nv=new Xm(5e3,15e3),rv={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},iv=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function sv(e){const t=e.config;Km(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Ym(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:qe},i=iv.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${S(r).slice(1)}`}const ov={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class av{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const cv=encodeURIComponent("fac");async function uv(e,t,n,r,i,s){Km(e.config.authDomain,e,"auth-domain-config-required"),Km(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:qe,eventId:i};if(t instanceof ry){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof iy){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),u=c?`#${cv}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?Ym(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${S(a).slice(1)}${u}`}const lv="webStorageSupport",hv=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=vy,this._completeRedirectFn=Ky,this._overrideRedirectResult=$y}async _openPopup(e,t,n,r){var i;return Hm(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},ov),{width:r.toString(),height:i.toString(),top:s,left:o}),u=m().toLowerCase();n&&(a=kg(u)?"_blank":n),Sg(u)&&(t=t||"http://localhost",c.scrollbars="yes");const l=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=m()){var t;return Rg(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new av(null);const h=window.open(t||"",a,l);Km(h,e,"popup-blocked");try{h.focus()}catch(e){}return new av(h)}(e,await uv(e,t,n,Wm(),r),Iy())}async _openRedirect(e,t,n,r){return await this._originValidation(e),i=await uv(e,t,n,Wm(),r),Ey().location.href=i,new Promise((()=>{}));var i}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Hm(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await tv(e),n=Ey().gapi;return Km(n,e,"internal-error"),t.open({where:document.body,url:sv(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:rv,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=zm(e,"network-request-failed"),s=Ey().setTimeout((()=>{r(i)}),nv.get());function o(){Ey().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new Gy(e);return t.register("authEvent",(t=>(Km(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(lv,{type:lv},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[lv];void 0!==i&&t(!!i),qm(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return ng(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(Yy(e))return}catch(e){}qm(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Og()||Cg()||Rg()}};var dv="@firebase/auth",fv="0.23.2";class pv{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Km(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const mv=d("authIdTokenMaxAge")||300;let gv=null;var yv;yv="Browser",Ve(new R("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;Km(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:yv,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Pg(yv)},c=new zg(n,r,i,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(wg);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),Ve(new R("auth-internal",(e=>{return t=$g(e.getProvider("auth").getImmediate()),new pv(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),Ke(dv,fv,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(yv)),Ke(dv,fv,"esm2017");const vv="firebasestorage.googleapis.com",wv="storageBucket";class Iv extends I{constructor(e,t,n=0){super(Tv(e),`Firebase Storage: ${t} (${Tv(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Iv.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Tv(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var bv,Ev;function Tv(e){return"storage/"+e}function _v(){return new Iv(bv.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Sv(e){return new Iv(bv.INVALID_ARGUMENT,e)}function Cv(){return new Iv(bv.APP_DELETED,"The Firebase app was deleted.")}function kv(e,t){return new Iv(bv.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function Av(e){throw new Iv(bv.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(bv||(bv={}));class Dv{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Dv.makeFromUrl(e,t)}catch(t){return new Dv(e,"")}if(""===n.path)return n;throw r=e,new Iv(bv.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)",i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${t===vv?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<a.length;t++){const r=a[t],i=r.regex.exec(e);if(i){const e=i[r.indices.bucket];let t=i[r.indices.path];t||(t=""),n=new Dv(e,t),r.postModify(n);break}}if(null==n)throw function(e){return new Iv(bv.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class Nv{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function xv(e){return"string"==typeof e||e instanceof String}function Rv(e){return Ov()&&e instanceof Blob}function Ov(){return"undefined"!=typeof Blob&&!g()}function Pv(e,t,n,r){if(r<t)throw Sv(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw Sv(`Invalid value for '${e}'. Expected ${n} or less.`)}function Lv(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function Mv(e){const t=encodeURIComponent;let n="?";for(const r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n=n.slice(0,-1),n}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(Ev||(Ev={}));class Fv{constructor(e,t,n,r,i,s,o,a,c,u,l,h=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=l,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(e){r(e)}else if(null!==i){const e=_v();e.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else t.canceled?r(this.appDelete_?Cv():new Iv(bv.CANCELED,"User canceled the upload/download.")):r(new Iv(bv.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?e(0,new Vv(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,o=!1,a=0;function c(){return 2===a}let u=!1;function l(...e){u||(u=!0,t.apply(null,e))}function h(t){i=setTimeout((()=>{i=null,e(f,c())}),t)}function d(){s&&clearTimeout(s)}function f(e,...t){if(u)return void d();if(e)return d(),void l.call(null,e,...t);if(c()||o)return d(),void l.call(null,e,...t);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),h(n)}let p=!1;function m(e){p||(p=!0,d(),u||(null!==i?(e||(a=2),clearTimeout(i),h(0)):e||(a=1)))}return h(0),s=setTimeout((()=>{o=!0,m(!0)}),n),m}(((e,t)=>{if(t)return void e(!1,new Vv(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===Ev.NO_ERROR,i=n.getStatus();if(!t||function(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}(i,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===Ev.ABORT;return void e(!1,new Vv(!1,null,t))}const s=-1!==this.successCodes_.indexOf(i);e(!0,new Vv(s,n))}))}),e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function(e){e(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class Vv{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function Uv(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function Bv(...e){const t=Uv();if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(Ov())return new Blob(e);throw new Iv(bv.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}const jv="base64",qv="base64url",zv="data_url";class $v{constructor(e,t){this.data=e,this.contentType=t||null}}function Kv(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<=127?t.push(r):r<=2047?t.push(192|r>>6,128|63&r):55296==(64512&r)?n<e.length-1&&56320==(64512&e.charCodeAt(n+1))?(r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):t.push(239,191,189):56320==(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function Gv(e,t){switch(e){case jv:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw kv(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case qv:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r)throw kv(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=function(e){if("undefined"==typeof atob)throw new Iv(bv.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw kv(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);return r}class Hv{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw kv(zv,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;var r,i;null!=n&&(this.base64=(i=";base64",(r=n).length>=7&&r.substring(r.length-7)===i),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class Wv{constructor(e,t){let n=0,r="";Rv(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(Rv(this.data_)){const s=(n=this.data_,r=e,i=t,n.webkitSlice?n.webkitSlice(r,i):n.mozSlice?n.mozSlice(r,i):n.slice?n.slice(r,i):null);return null===s?null:new Wv(s)}var n,r,i;{const n=new Uint8Array(this.data_.buffer,e,t-e);return new Wv(n,!0)}}static getBlob(...e){if(Ov()){const t=e.map((e=>e instanceof Wv?e.data_:e));return new Wv(Bv.apply(null,t))}{const t=e.map((e=>xv(e)?function(e,t){switch(e){case"raw":return new $v(Kv(t));case jv:case qv:return new $v(Gv(e,t));case zv:return new $v(function(e){const t=new Hv(e);return t.base64?Gv(jv,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw kv(zv,"Malformed data URL.")}return Kv(t)}(t.rest)}(t),new Hv(t).contentType)}throw _v()}("raw",e).data:e.data_));let n=0;t.forEach((e=>{n+=e.byteLength}));const r=new Uint8Array(n);let i=0;return t.forEach((e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]})),new Wv(r,!0)}}uploadData(){return this.data_}}function Qv(e){let t;try{t=JSON.parse(e)}catch(e){return null}return function(e){return"object"==typeof e&&!Array.isArray(e)}(t)?t:null}function Xv(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function Yv(e,t){return t}class Jv{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||Yv}}let Zv=null;function ew(){if(Zv)return Zv;const e=[];e.push(new Jv("bucket")),e.push(new Jv("generation")),e.push(new Jv("metageneration")),e.push(new Jv("name","fullPath",!0));const t=new Jv("name");t.xform=function(e,t){return function(e){return!xv(e)||e.length<2?e:Xv(e)}(t)},e.push(t);const n=new Jv("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new Jv("timeCreated")),e.push(new Jv("updated")),e.push(new Jv("md5Hash",null,!0)),e.push(new Jv("cacheControl",null,!0)),e.push(new Jv("contentDisposition",null,!0)),e.push(new Jv("contentEncoding",null,!0)),e.push(new Jv("contentLanguage",null,!0)),e.push(new Jv("contentType",null,!0)),e.push(new Jv("metadata","customMetadata",!0)),Zv=e,Zv}function tw(e,t,n){const r=Qv(t);return null===r?null:function(e,t,n){const r={type:"file"},i=n.length;for(let e=0;e<i;e++){const i=n[e];r[i.local]=i.xform(r,t[i.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,i=new Dv(n,r);return t._makeStorageReference(i)}})}(r,e),r}(e,r,n)}class nw{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function rw(e){if(!e)throw _v()}function iw(e){return function(t,n){let r;var i,s;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new Iv(bv.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new Iv(bv.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(s=e.bucket,r=new Iv(bv.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,r=new Iv(bv.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):r=n,r.status=t.getStatus(),r.serverResponse=n.serverResponse,r}}function sw(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const c=function(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return t&&t.type()||"application/octet-stream"}(0,t)),r}(t,r,i),u="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+function(e,t){const n={},r=t.length;for(let i=0;i<r;i++){const r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",l="\r\n--"+a+"--",h=Wv.getBlob(u,r,l);if(null===h)throw new Iv(bv.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.");const d={name:c.fullPath},f=Lv(s,e.host,e._protocol),p=e.maxUploadRetryTime,m=new nw(f,"POST",function(e,t){return function(n,r){const i=tw(e,r,t);return rw(null!==i),i}}(e,n),p);return m.urlParams=d,m.headers=o,m.body=h.uploadData(),m.errorHandler=iw(t),m}class ow{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Ev.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=Ev.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=Ev.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,n,r){if(this.sent_)throw Av("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const e in r)r.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,r[e].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Av("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Av("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw Av("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Av("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class aw extends ow{initXhr(){this.xhr_.responseType="text"}}function cw(){return new aw}class uw{constructor(e,t){this._service=e,this._location=t instanceof Dv?t:Dv.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new uw(e,t)}get root(){const e=new Dv(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Xv(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new Dv(this._location.bucket,e);return new uw(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Iv(bv.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function lw(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=Lv(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,s=new nw(r,"GET",function(e,t){return function(n,r){const i=tw(e,r,t);return rw(null!==i),function(e,t,n,r){const i=Qv(t);if(null===i)return null;if(!xv(i.downloadTokens))return null;const s=i.downloadTokens;if(0===s.length)return null;const o=encodeURIComponent;return s.split(",").map((t=>{const i=e.bucket,s=e.fullPath;return Lv("/b/"+o(i)+"/o/"+o(s),n,r)+Mv({alt:"media",token:t})}))[0]}(i,r,e.host,e._protocol)}}(e,n),i);return s.errorHandler=function(e){const t=iw(e);return function(n,r){let i=t(n,r);var s;return 404===n.getStatus()&&(s=e.path,i=new Iv(bv.OBJECT_NOT_FOUND,"Object '"+s+"' does not exist.")),i.serverResponse=r.serverResponse,i}}(t),s}(e.storage,e._location,ew());return e.storage.makeRequestWithTokens(t,cw).then((e=>{if(null===e)throw new Iv(bv.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e}))}function hw(e,t){if(e instanceof fw){const n=e;if(null==n._bucket)throw new Iv(bv.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+wv+"' property when initializing the app?");const r=new uw(n,n._bucket);return null!=t?hw(r,t):r}return void 0!==t?function(e,t){const n=function(e,t){const n=t.split("/").filter((e=>e.length>0)).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),r=new Dv(e._location.bucket,n);return new uw(e.storage,r)}(e,t):e}function dw(e,t){const n=null==t?void 0:t[wv];return null==n?null:Dv.makeFromBucketSpec(n,e)}class fw{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=vv,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?Dv.makeFromBucketSpec(r,this._host):dw(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=Dv.makeFromBucketSpec(this._url,e):this._bucket=dw(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Pv("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Pv("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new uw(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new Nv(Cv());{const s=function(e,t,n,r,i,s,o=!0){const a=Mv(e.urlParams),c=e.url+a,u=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(u,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(u,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(u,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(u,r),new Fv(c,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,o)}(e,this._appId,n,r,t,this._firebaseVersion,i);return this._requests.add(s),s.getPromise().then((()=>this._requests.delete(s)),(()=>this._requests.delete(s))),s}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const pw="@firebase/storage",mw="0.11.2",gw="storage";let yw,vw;Ve(new R(gw,(function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new fw(n,r,i,t,qe)}),"PUBLIC").setMultipleInstances(!0)),Ke(pw,mw,""),Ke(pw,mw,"esm2017");const ww=new WeakMap,Iw=new WeakMap,bw=new WeakMap,Ew=new WeakMap,Tw=new WeakMap;let _w={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Iw.get(e);if("objectStoreNames"===t)return e.objectStoreNames||bw.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Cw(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Sw(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(vw||(vw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(kw(this),e),Cw(ww.get(this))}:function(...e){return Cw(t.apply(kw(this),e))}:function(e,...n){const r=t.call(kw(this),e,...n);return bw.set(r,e.sort?e.sort():[e]),Cw(r)}:(e instanceof IDBTransaction&&function(e){if(Iw.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));Iw.set(e,t)}(e),n=e,(yw||(yw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,_w):e);var t,n}function Cw(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(Cw(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&ww.set(t,e)})).catch((()=>{})),Tw.set(t,e),t}(e);if(Ew.has(e))return Ew.get(e);const t=Sw(e);return t!==e&&(Ew.set(e,t),Tw.set(t,e)),t}const kw=e=>Tw.get(e),Aw=["get","getKey","getAll","getAllKeys","count"],Dw=["put","add","delete","clear"],Nw=new Map;function xw(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Nw.get(t))return Nw.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=Dw.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Aw.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return Nw.set(t,s),s}_w=(e=>({...e,get:(t,n,r)=>xw(t,n)||e.get(t,n,r),has:(t,n)=>!!xw(t,n)||e.has(t,n)}))(_w);const Rw="@firebase/installations",Ow="0.6.4",Pw=`w:${Ow}`,Lw="FIS_v2",Mw=new b("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Fw(e){return e instanceof I&&e.code.includes("request-failed")}function Vw({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function Uw(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function Bw(e,t){const n=(await t.json()).error;return Mw.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function jw({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function qw(e){const t=await e();return t.status>=500&&t.status<600?e():t}function zw(e){return new Promise((t=>{setTimeout(t,e)}))}const $w=/^[cdef][\w-]{21}$/;function Kw(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return $w.test(t)?t:""}catch(e){return""}}function Gw(e){return`${e.appName}!${e.appId}`}const Hw=new Map;function Ww(e,t){const n=Gw(e);Qw(n,t),function(e,t){const n=(!Xw&&"BroadcastChannel"in self&&(Xw=new BroadcastChannel("[Firebase] FID Change"),Xw.onmessage=e=>{Qw(e.data.key,e.data.fid)}),Xw);n&&n.postMessage({key:e,fid:t}),0===Hw.size&&Xw&&(Xw.close(),Xw=null)}(n,t)}function Qw(e,t){const n=Hw.get(e);if(n)for(const e of n)e(t)}let Xw=null;const Yw="firebase-installations-store";let Jw=null;function Zw(){return Jw||(Jw=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=Cw(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(Cw(o.result),e.oldVersion,e.newVersion,Cw(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),a}("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Yw)}})),Jw}async function eI(e,t){const n=Gw(e),r=(await Zw()).transaction(Yw,"readwrite"),i=r.objectStore(Yw),s=await i.get(n);return await i.put(t,n),await r.done,s&&s.fid===t.fid||Ww(e,t.fid),t}async function tI(e){const t=Gw(e),n=(await Zw()).transaction(Yw,"readwrite");await n.objectStore(Yw).delete(t),await n.done}async function nI(e,t){const n=Gw(e),r=(await Zw()).transaction(Yw,"readwrite"),i=r.objectStore(Yw),s=await i.get(n),o=t(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,!o||s&&s.fid===o.fid||Ww(e,o.fid),o}async function rI(e){let t;const n=await nI(e.appConfig,(n=>{const r=function(e){return oI(e||{fid:Kw(),registrationStatus:0})}(n),i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(Mw.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=Vw(e),i=jw(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={fid:n,authVersion:Lw,appId:e.appId,sdkVersion:Pw},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await qw((()=>fetch(r,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:Uw(e.authToken)}}throw await Bw("Create Installation",c)}(e,t);return eI(e.appConfig,n)}catch(n){throw Fw(n)&&409===n.customData.serverCode?await tI(e.appConfig):await eI(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:iI(e)}:{installationEntry:t}}(e,r);return t=i.registrationPromise,i.installationEntry}));return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function iI(e){let t=await sI(e.appConfig);for(;1===t.registrationStatus;)await zw(100),t=await sI(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await rI(e);return n||t}return t}function sI(e){return nI(e,(e=>{if(!e)throw Mw.create("installation-not-found");return oI(e)}))}function oI(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function aI({appConfig:e,heartbeatServiceProvider:t},n){const r=function(e,{fid:t}){return`${Vw(e)}/${t}/authTokens:generate`}(e,n),i=function(e,{refreshToken:t}){const n=jw(e);return n.append("Authorization",function(e){return`${Lw} ${e}`}(t)),n}(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={installation:{sdkVersion:Pw,appId:e.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await qw((()=>fetch(r,a)));if(c.ok)return Uw(await c.json());throw await Bw("Generate Auth Token",c)}async function cI(e,t=!1){let n;const r=await nI(e.appConfig,(r=>{if(!lI(r))throw Mw.create("not-registered");const i=r.authToken;if(!t&&(2===(s=i).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(s)))return r;var s;if(1===i.requestStatus)return n=async function(e,t){let n=await uI(e.appConfig);for(;1===n.authToken.requestStatus;)await zw(100),n=await uI(e.appConfig);const r=n.authToken;return 0===r.requestStatus?cI(e,t):r}(e,t),r;{if(!navigator.onLine)throw Mw.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(r);return n=async function(e,t){try{const n=await aI(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await eI(e.appConfig,r),n}catch(n){if(!Fw(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await eI(e.appConfig,n)}else await tI(e.appConfig);throw n}}(e,t),t}}));return n?await n:r.authToken}function uI(e){return nI(e,(e=>{if(!lI(e))throw Mw.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function lI(e){return void 0!==e&&2===e.registrationStatus}function hI(e){return Mw.create("missing-app-config-values",{valueName:e})}const dI="installations";Ve(new R(dI,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw hI("App Configuration");if(!e.name)throw hI("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw hI(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:Ue(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),Ve(new R("installations-internal",(e=>{const t=Ue(e.getProvider("app").getImmediate(),dI).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:r}=await rI(t);return r?r.catch(console.error):cI(t).catch(console.error),n.fid}(t),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await rI(e);t&&await t}(n),(await cI(n,t)).token}(t,e)}}),"PRIVATE")),Ke(Rw,Ow),Ke(Rw,Ow,"esm2017");const fI="analytics",pI="https://www.googletagmanager.com/gtag/js",mI=new q("@firebase/analytics"),gI=new b("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function yI(e){if(!e.startsWith(pI)){const t=gI.create("invalid-gtag-resource",{gtagURL:e});return mI.warn(t.message),""}return e}function vI(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}const wI=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function II(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function bI(e,t=wI,n){const{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw gI.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw gI.create("no-api-key")}const o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new TI;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),EI({appId:r,apiKey:i,measurementId:s},o,a,t)}async function EI(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=wI){var s;const{appId:o,measurementId:a}=e;try{await function(e,t){return new Promise(((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener((()=>{clearTimeout(s),r(gI.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(r,t)}catch(e){if(a)return mI.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:a};throw e}try{const t=await async function(e){var t;const{appId:n,apiKey:r}=e,i={method:"GET",headers:II(r)},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(s,i);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw gI.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return i.deleteThrottleMetadata(o),t}catch(t){const c=t;if(!function(e){if(!(e instanceof I&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(c)){if(i.deleteThrottleMetadata(o),a)return mI.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw t}const u=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?N(n,i.intervalMillis,30):N(n,i.intervalMillis),l={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return i.setThrottleMetadata(o,l),mI.debug(`Calling attemptFetch again in ${u} millis`),EI(e,l,r,i)}}class TI{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let _I,SI;async function CI(e,t,n,r,i,s,o){var a;const c=bI(e);c.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&mI.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>mI.error(e))),t.push(c);const u=async function(){if(!v())return mI.warn(gI.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await w()}catch(e){return mI.warn(gI.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?r.getId():void 0)),[l,h]=await Promise.all([c,u]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(pI)&&n.src.includes(e))return n;return null})(s)||function(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",t)),n}(0,{createScriptURL:yI}),r=document.createElement("script"),i=`${pI}?l=${e}&id=${t}`;r.src=n?null==n?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}(s,l.measurementId),SI&&(i("consent","default",SI),SI=void 0),i("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d.origin="firebase",d.update=!0,null!=h&&(d.firebase_id=h),i("config",l.measurementId,d),_I&&(i("set",_I),_I=void 0),l.measurementId}class kI{constructor(e){this.app=e}_delete(){return delete AI[this.app.options.appId],Promise.resolve()}}let AI={},DI=[];const NI={};let xI,RI,OI="dataLayer",PI=!1;function LI(e,t,n){!function(){const e=[];if(y()&&e.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=gI.create("invalid-analytics-context",{errorInfo:t});mI.warn(n.message)}}();const r=e.options.appId;if(!r)throw gI.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw gI.create("no-api-key");mI.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=AI[r])throw gI.create("already-exists",{id:r});if(!PI){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(OI);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,i){let s=function(...e){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=function(e,t,n,r){return async function(i,...s){try{if("event"===i){const[r,i]=s;await async function(e,t,n,r,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const r=await vI(n);for(const n of e){const e=r.find((e=>e.measurementId===n)),i=e&&t[e.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",r,i||{})}catch(e){mI.error(e)}}(e,t,n,r,i)}else if("config"===i){const[i,o]=s;await async function(e,t,n,r,i,s){const o=r[i];try{if(o)await t[o];else{const e=(await vI(n)).find((e=>e.measurementId===i));e&&await t[e.appId]}}catch(e){mI.error(e)}e("config",i,s)}(e,t,n,r,i,o)}else if("consent"===i){const[t]=s;e("consent","update",t)}else if("get"===i){const[t,n,r]=s;e("get",t,n,r)}else if("set"===i){const[t]=s;e("set",t)}else e(i,...s)}catch(e){mI.error(e)}}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(AI,DI,NI,OI,"gtag");RI=e,xI=t,PI=!0}return AI[r]=CI(e,DI,NI,t,xI,OI,n),new kI(e)}const MI="@firebase/analytics",FI="0.10.0";Ve(new R(fI,((e,{options:t})=>LI(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),Ve(new R("analytics-internal",(function(e){try{const t=e.getProvider(fI).getImmediate();return{logEvent:(e,n,r)=>function(e,t,n,r){e=x(e),async function(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=await t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}}(RI,AI[e.app.options.appId],t,n,r).catch((e=>mI.error(e)))}(t,e,n,r)}}catch(e){throw gI.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),Ke(MI,FI),Ke(MI,FI,"esm2017");var VI=ze({apiKey:"AIzaSyAzd4ZozdCWCy6bQK255uyVFdOrbsHoxfQ",authDomain:"fastnetlite.firebaseapp.com",projectId:"fastnetlite",storageBucket:"fastnetlite.firebasestorage.app",messagingSenderId:"539673548783",appId:"1:539673548783:web:a9f7da3299069f0abf081a",measurementId:"G-GSR54JNW8J"}),UI=function(e){const t="string"==typeof e?e:"(default)",n=Ue("object"==typeof e?e:$e(),"firestore").getImmediate({identifier:t});if(!n._initialized){const e=l("firestore");e&&function(e,t,n,r={}){var i;const s=(e=_p(e,Cp))._getSettings(),o=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Ds("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Ts.MOCK_USER;else{t=p(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Ls(Ps.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Ts(s)}e._authCredentials=new Us(new Fs(t,n))}}(n,...e)}return n}(VI),BI=function(e=$e()){const t=Ue(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=Ue(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(T(n.getOptions(),null!=t?t:{}))return e;qm(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:hv,persistence:[Oy,gy,vy]}),r=d("authTokenSyncURL");if(r){const e=(i=r,async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>mv)return;const r=null==t?void 0:t.token;gv!==r&&(gv=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(e,t,n){x(e).beforeAuthStateChanged(t,n)}(n,e,(()=>e(n.currentUser))),function(t){x(t).onIdTokenChanged((t=>e(t)),void 0,void 0)}(n)}var i;const s=u("auth");return s&&function(e,t,n){const r=$g(e);Km(r._canInitEmulator,r,"emulator-config-failed"),Km(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=Gg(t),{host:o,port:a}=function(e){const t=Gg(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Hg(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Hg(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${s}`),n}(VI),jI=function(e=$e(),t){const n=Ue(e=x(e),gw).getImmediate({identifier:t}),r=l("storage");return r&&function(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:i}=r;i&&(e._overrideAuthToken="string"==typeof i?i:p(i,e.app.options.projectId))}(e,t,n,r)}(n,...r),n}(VI);function qI(e,t,n){"string"==typeof e&&(e=document.getElementById(e)),e&&!e.getAttribute("data-".concat(t,"-handler-attached"))&&(e.setAttribute("data-".concat(t,"-handler-attached"),"true"),e.addEventListener(t,n),console.log("Gestionnaire ".concat(t," attaché à ").concat(e.id||"un élément")))}function zI(e){var t=document.getElementById("errorAlert");t.textContent=e,t.classList.remove("d-none"),setTimeout((function(){t.classList.add("d-none")}),1e4)}function $I(e,t,n,r){var i=document.createElement("div");return i.className="payment-method",i.dataset.method=e,i.innerHTML='\n        <div class="payment-method-icon">\n            <i class="fas '.concat(t,'"></i>\n        </div>\n        <div class="payment-method-info">\n            <div class="payment-method-title">').concat(n,'</div>\n            <div class="payment-method-description">').concat(r,"</div>\n        </div>\n    "),i.addEventListener("click",(function(){KI(e)})),i}function KI(e){document.querySelectorAll(".payment-method").forEach((function(e){e.classList.remove("selected")}));var t=document.querySelector('.payment-method[data-method="'.concat(e,'"]'));t&&t.classList.add("selected"),window.selectedPaymentMethod=e,document.getElementById("fedapayContainer").classList.add("d-none"),document.getElementById("cashPaymentContainer").classList.add("d-none"),document.getElementById("mobileMoneyContainer").classList.add("d-none"),"fedapay"===e?document.getElementById("fedapayContainer").classList.remove("d-none"):"cash"===e?document.getElementById("cashPaymentContainer").classList.remove("d-none"):"mobile_money"===e&&document.getElementById("mobileMoneyContainer").classList.remove("d-none")}function GI(e){console.log("Configuration des champs de collecte avec les paramètres:",e),e||(console.warn("advancedSettings est undefined, utilisation des valeurs par défaut"),e={collectClientName:!0,collectClientPhone:!0,requireClientPhone:!0,collectClientEmail:!1,requireClientEmail:!1});var t=document.getElementById("nameFieldContainer");t?!1===e.collectClientName?t.classList.add("d-none"):t.classList.remove("d-none"):console.warn("L'élément nameFieldContainer n'a pas été trouvé");var n=document.getElementById("phoneFieldContainer"),r=document.getElementById("clientPhone");n&&r?!1===e.collectClientPhone?n.classList.add("d-none"):(n.classList.remove("d-none"),!0===e.requireClientPhone?r.required=!0:r.required=!1):console.warn("L'élément phoneFieldContainer ou clientPhone n'a pas été trouvé");var i=document.getElementById("emailFieldContainer"),s=document.getElementById("clientEmail");i&&s?!0===e.collectClientEmail?(i.classList.remove("d-none"),!0===e.requireClientEmail?s.required=!0:s.required=!1):i.classList.add("d-none"):console.warn("L'élément emailFieldContainer ou clientEmail n'a pas été trouvé")}function HI(e){document.querySelectorAll(".step-content").forEach((function(e){e.classList.remove("active")})),document.querySelectorAll(".step").forEach((function(e){e.classList.remove("active"),e.classList.remove("completed")})),document.getElementById("step".concat(e)).classList.add("active"),document.getElementById("step".concat(e,"Content")).classList.add("active");for(var t=1;t<e;t++)document.getElementById("step".concat(t)).classList.add("completed");!function(e){var t=document.getElementById("prevStepBtn"),n=document.getElementById("nextStepBtn");t.disabled=1===e,1!==e||window.selectedProfileId?n.disabled=!1:n.disabled=!0,3===e?n.innerHTML='Payer <i class="fas fa-credit-card ms-1"></i>':4===e?(n.innerHTML='Terminer <i class="fas fa-check ms-1"></i>',n.disabled=!0):n.innerHTML='Suivant <i class="fas fa-arrow-right ms-1"></i>'}(e)}function WI(e,t,n){console.log("SMS envoyé au ".concat(t," avec le code WiFi: ").concat(n.username," / ").concat(n.password));var r=document.getElementById("sendBySmsBtn"),i=r.innerHTML;r.innerHTML='<i class="fas fa-check me-1"></i> SMS envoyé',r.disabled=!0,setTimeout((function(){r.innerHTML=i,r.disabled=!1}),5e3)}!function(e=$e()){const t=Ue(e=x(e),fI);t.isInitialized()?t.getImmediate():function(e,t={}){const n=Ue(e,fI);if(n.isInitialized()){const e=n.getImmediate();if(T(t,n.getOptions()))return e;throw gI.create("already-initialized")}n.initialize({options:t})}(e)}(VI),function(e){!function(e){if(e._initialized||e._terminated)throw new Ls(Ps.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}(e=_p(e,Op));const t=Pp(e);if(t._uninitializedComponentsProvider)throw new Ls(Ps.FAILED_PRECONDITION,"SDK cache is already specified.");Ds("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings(),r=new lp;return function(e,t,n){const r=new Ms;return e.asyncQueue.enqueue((async()=>{try{await fp(e,n),await pp(e,t),r.resolve()}catch(e){const t=e;if(!mp(t))throw t;Ds("Error enabling indexeddb cache. Falling back to memory cache: "+t),r.reject(t)}})).then((()=>r.promise))}(t,r,new up(r,n.cacheSizeBytes,void 0))}(UI).catch((function(e){"failed-precondition"===e.code?console.warn("La persistance des données ne peut pas être activée car plusieurs onglets sont ouverts"):"unimplemented"===e.code&&console.warn("Le navigateur ne prend pas en charge la persistance des données hors ligne")})),window.firebase={auth:function(){return BI},firestore:function(){return{collection:function(e){return Np(UI,e)},doc:function(e){return xp(UI,e)},FieldValue:{serverTimestamp:function(){return Mm()}}}},storage:function(){return jI}},window.db=UI,window.auth=BI,window.storage=jI,window.firestore={collection:Np,doc:xp,setDoc:function(e,t,n){e=_p(e,kp);const r=_p(e.firestore,Op),i=_m(e.converter,t,n);return Lm(r,[Hp(Gp(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Iu.none())])},getDoc:Nm,getDocs:Rm,query:hm,where:fm,orderBy:function(e,t="asc"){const n=t,r=cm("orderBy",e);return mm._create(r,n)},limit:ym,startAfter:function(...e){return vm._create("startAfter",e,!1)},serverTimestamp:Mm},window.storageRef=function(e,t){return function(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof fw)return new uw(e,t);throw Sv("To use ref(service, url), the first argument must be a Storage instance.")}return hw(e,t)}(e=x(e),t)},window.uploadBytes=function(e,t,n){return function(e,t,n){e._throwIfRoot("uploadBytes");const r=sw(e.storage,e._location,ew(),new Wv(t,!0),n);return e.storage.makeRequestWithTokens(r,cw).then((t=>({metadata:t,ref:e})))}(e=x(e),t,n)},window.getDownloadURL=function(e){return lw(e=x(e))},console.log("Configuration Firebase chargée avec SDK moderne"),console.log("Firebase DB importé:",UI),window.buyCodeJsInitialized=window.buyCodeJsInitialized||!1,document.addEventListener("DOMContentLoaded",(function(){if(window.buyCodeJsInitialized)console.log("buy-code.js déjà initialisé, initialisation ignorée");else{window.buyCodeJsInitialized=!0,console.log("Initialisation de buy-code.js");var t=new URLSearchParams(window.location.search),n=t.get("id")||t.get("routerId");if(!n)return zI("ID du routeur manquant. Veuillez accéder à cette page depuis le lien fourni par votre fournisseur WiFi."),void console.error("Paramètre id ou routerId manquant dans l'URL");console.log("ID du routeur récupéré:",n),function(t){(function(e){Nm(xp(UI,"routers",e)).then((function(t){if(t.exists()){var n=t.data();document.title="".concat(n.buyPageTitle||n.name," - Achat de codes WiFi"),document.getElementById("routerName").textContent=n.buyPageTitle||n.name,document.getElementById("routerDescription").textContent=n.buyPageDescription||n.description||"Achetez des codes WiFi pour vous connecter à Internet",function(e){Nm(xp(UI,"routers",e,"settings","appearance")).then((function(e){if(e.exists()&&e.data()){var t=e.data();console.log("Paramètres d'apparence chargés:",t);var n="";t&&t.primaryColor?n+="\n                        :root {\n                            --primary-color: ".concat(t.primaryColor,";\n                        }\n                        .btn-primary {\n                            background-color: ").concat(t.primaryColor,";\n                            border-color: ").concat(t.primaryColor,";\n                        }\n                        .btn-outline-primary {\n                            color: ").concat(t.primaryColor,";\n                            border-color: ").concat(t.primaryColor,";\n                        }\n                        .btn-outline-primary:hover {\n                            background-color: ").concat(t.primaryColor,";\n                            border-color: ").concat(t.primaryColor,";\n                        }\n                        .profile-card-header {\n                            background-color: ").concat(t.primaryColor,";\n                        }\n                    "):n+="\n                        :root {\n                            --primary-color: #007bff;\n                        }\n                    ",t.secondaryColor&&(n+="\n                        :root {\n                            --secondary-color: ".concat(t.secondaryColor,";\n                        }\n                    ")),t.customCss&&(n+=t.customCss),document.getElementById("dynamicStyles").textContent=n}})).catch((function(e){console.error("Erreur lors de la récupération des styles personnalisés:",e)}))}(e)}else zI("Routeur non trouvé. Veuillez vérifier le lien et réessayer.")})).catch((function(e){console.error("Erreur lors de la récupération des informations du routeur:",e),zI("Une erreur est survenue lors du chargement des informations. Veuillez réessayer plus tard.")}))})(t),function(t){if(console.log("Début de loadProfiles avec routerId:",t),!(Np&&hm&&fm&&Rm))return console.error("Fonctions Firebase non disponibles:",{collection:e(Np),query:e(hm),where:e(fm),getDocs:e(Rm)}),zI("Erreur de configuration: les fonctions Firebase ne sont pas disponibles."),document.getElementById("loadingProfiles").classList.add("d-none"),void document.getElementById("noProfilesMessage").classList.remove("d-none");try{console.log("Création de la référence à la collection profiles");var n=Np(UI,"profiles");if(!t)return console.error("routerId est invalide:",t),zI("ID du routeur invalide. Veuillez vérifier l'URL."),document.getElementById("loadingProfiles").classList.add("d-none"),void document.getElementById("noProfilesMessage").classList.remove("d-none");console.log("Création de la requête avec le filtre routerId uniquement");var r=hm(n,fm("routerId","==",t));console.log("Exécution de la requête getDocs pour routerId:",t),Rm(r).then((function(e){if(console.log("Résultat de la requête reçu, nombre de documents:",e.size),document.getElementById("loadingProfiles").classList.add("d-none"),e.empty)return console.log("Aucun profil trouvé pour ce routeur"),void document.getElementById("noProfilesMessage").classList.remove("d-none");var t=document.getElementById("profilesContainer");console.log("Conteneur des profils récupéré:",t);var n=0;e.forEach((function(e){console.log("Traitement du profil avec ID:",e.id);var r=e.data(),i=e.id;console.log("Données du profil:",r);var s=!1!==r.enabled,o=!1!==r.visibleOnBuyPage;if(console.log("Profil ".concat(i," - enabled: ").concat(s,", visibleOnBuyPage: ").concat(o)),s&&o){n++;var a=function(e,t){if(console.log("Création de la carte pour le profil:",e,t),!t)return console.error("Profil invalide:",t),document.createElement("div");var n=t.name||"Forfait sans nom",r=t.price||0,i=t.duration||"Non spécifiée",s=t.description||"Aucune description disponible",o=document.createElement("div");o.className="col-md-4 mb-4";var a=document.createElement("div");a.className="profile-card-buy card h-100",a.dataset.profileId=e;var c=document.createElement("div");c.className="profile-card-header",c.innerHTML='\n        <h5 class="card-title">'.concat(n,'</h5>\n        <div class="profile-card-price">').concat(r," FCFA</div>\n    ");var u=document.createElement("div");u.className="profile-card-body";var l=new URLSearchParams(window.location.search),h=l.get("id")||l.get("routerId");return u.innerHTML='\n        <div class="profile-card-duration">Durée: '.concat(i,'</div>\n        <div class="profile-card-description">').concat(s,'</div>\n        <div class="d-grid gap-2">\n            <a href="profilbuy-code.html?routerId=').concat(h,"&profileId=").concat(e,'" class="btn btn-primary">Acheter directement</a>\n        </div>\n    '),a.appendChild(c),a.appendChild(u),o.appendChild(a),a.addEventListener("click",(function(){!function(e){document.querySelectorAll(".profile-card-buy").forEach((function(e){e.classList.remove("selected")}));var t=document.querySelector('.profile-card-buy[data-profile-id="'.concat(e,'"]'));t&&t.classList.add("selected"),window.selectedProfileId=e,document.getElementById("nextStepBtn").disabled=!1}(e)})),console.log("Carte créée avec succès pour le profil:",e),o}(i,r);t.appendChild(a),console.log("Carte de profil ajoutée au conteneur")}else console.log("Profil ".concat(i," ignoré car non activé ou non visible"))})),0===n?(console.log("Aucun profil valide trouvé (activé et visible)"),document.getElementById("noProfilesMessage").classList.remove("d-none")):console.log("".concat(n," profils valides affichés"))})).catch((function(e){console.error("Erreur lors de la récupération des profils:",e),document.getElementById("loadingProfiles").classList.add("d-none"),document.getElementById("noProfilesMessage").classList.remove("d-none"),zI("Une erreur est survenue lors du chargement des forfaits. Veuillez réessayer plus tard.")}))}catch(e){console.error("Exception lors de la configuration de la requête:",e),document.getElementById("loadingProfiles").classList.add("d-none"),document.getElementById("noProfilesMessage").classList.remove("d-none"),zI("Une erreur est survenue lors de la configuration de la requête. Veuillez réessayer plus tard.")}}(t),function(e){Nm(xp(UI,"routers",e,"settings","payment")).then((function(e){if(e.exists){var t=e.data();window.paymentSettings=t,function(e){var t=document.getElementById("paymentMethodsContainer");if(t.innerHTML="",e.acceptCash){var n=$I("cash","fa-money-bill-wave","Paiement en espèces","Payez lors de la réception de votre code");t.appendChild(n)}if(e.acceptMobileMoney){var r=$I("mobile_money","fa-mobile-alt","Mobile Money","Payez avec MTN Money, Orange Money, etc.");t.appendChild(r)}if(e.acceptFedapay&&e.enableFedapay){var i=$I("fedapay","fa-credit-card","Carte bancaire / Mobile Money","Payez en ligne via FedaPay (sécurisé)");t.appendChild(i)}if(e.acceptBankTransfer){var s=$I("bank_transfer","fa-university","Virement bancaire","Payez par virement bancaire");t.appendChild(s)}e.defaultPaymentMethod&&document.querySelector('.payment-method[data-method="'.concat(e.defaultPaymentMethod,'"]'))&&KI(e.defaultPaymentMethod)}(t),t.enableFedapay&&t.fedapayPublicKey&&function(e,t){var n=document.getElementById("fedapayScriptContainer");window.fedapayPublicKey=e,window.fedapayMode=t||"test";var r=document.createElement("script");r.src="https://cdn.fedapay.com/checkout.js?v=1.1.7",r.async=!0,n.appendChild(r)}(t.fedapayPublicKey,t.fedapayMode)}})).catch((function(e){console.error("Erreur lors de la récupération des paramètres de paiement:",e)}))}(t),function(e){Nm(xp(UI,"routers",e,"settings","advanced")).then((function(e){if(e.exists()&&e.data()){var t=e.data();console.log("Paramètres avancés chargés:",t),window.advancedSettings=t,GI(t)}else{console.log("Document de paramètres avancés non trouvé, utilisation des valeurs par défaut");var n={collectClientName:!0,collectClientPhone:!0,requireClientPhone:!0,collectClientEmail:!1,requireClientEmail:!1};window.advancedSettings=n,GI(n)}})).catch((function(e){console.error("Erreur lors de la récupération des paramètres avancés:",e);var t={collectClientName:!0,collectClientPhone:!0,requireClientPhone:!0,collectClientEmail:!1,requireClientEmail:!1};window.advancedSettings=t,GI(t)}))}(t)}(n),function(e){console.log("Configuration des gestionnaires d'événements pour buy-code.js"),qI("prevStepBtn","click",(function(){var e,t;e=document.querySelector(".step.active").id,t=parseInt(e.replace("step",""))-1,document.getElementById("step".concat(t))&&HI(t)})),qI("nextStepBtn","click",(function(){!function(e){var t=document.querySelector(".step.active").id,n=parseInt(t.replace("step",""));if(function(e){if(1===e)return!!window.selectedProfileId||(zI("Veuillez sélectionner un forfait pour continuer."),!1);if(2===e){var t=document.getElementById("clientInfoForm");return t.checkValidity()?!!document.getElementById("termsAccepted").checked||(zI("Vous devez accepter les conditions d'utilisation pour continuer."),!1):(t.reportValidity(),!1)}return 3!==e||(window.selectedPaymentMethod?!("mobile_money"===window.selectedPaymentMethod&&!document.getElementById("mobileMoneyNumber").value.trim())||(zI("Veuillez entrer votre numéro Mobile Money pour continuer."),!1):(zI("Veuillez sélectionner une méthode de paiement pour continuer."),!1))}(n)){var r=n+1;document.getElementById("step".concat(r))&&(3===r&&function(){Nm(xp(UI,"profiles",window.selectedProfileId)).then((function(e){if(e.exists){var t=e.data();document.getElementById("summaryProfileName").textContent=t.name,document.getElementById("summaryProfileDuration").textContent=t.duration,document.getElementById("summaryTotal").textContent="".concat(t.price," FCFA"),window.selectedProfile=t}}));var e=document.getElementById("clientName").value,t=document.getElementById("clientPhone").value;document.getElementById("summaryClientName").textContent=e||"-",document.getElementById("summaryClientPhone").textContent=t||"-"}(),4===r&&function(e){document.getElementById("nextStepBtn").disabled=!0,document.getElementById("prevStepBtn").disabled=!0;var t=document.getElementById("clientName").value,n=document.getElementById("clientPhone").value,r=document.getElementById("clientEmail").value,i=window.selectedPaymentMethod,s=window.selectedProfileId,o=window.selectedProfile;(function(e,t){return Rm(hm(Np(UI,"wifiCodes"),fm("profileId","==",e),fm("routerId","==",t),fm("status","==","available"),ym(1))).then((function(e){return e.empty?null:e.docs[0]}))})(s,e).then((function(a){return a?function(e,t,n,r){return Rm(hm(Np(UI,"clients"),fm("routerId","==",e),fm("phone","==",n),ym(1))).then((function(i){if(i.empty)return Pm(Np(UI,"clients"),{routerId:e,name:t,phone:n,email:r,createdAt:firebase.firestore.FieldValue.serverTimestamp(),updatedAt:firebase.firestore.FieldValue.serverTimestamp()}).then((function(e){return e.id}));var s=i.docs[0].id;return Om(xp(UI,"clients",s),{name:t||i.docs[0].data().name,email:r||i.docs[0].data().email,updatedAt:Mm()}).then((function(){return s}))}))}(e,t,n,r).then((function(t){return function(e,t,n,r,i){return Pm(Np(UI,"payments"),{routerId:e,clientId:t,profileId:n,amount:r,method:i,status:"cash"===i?"pending":"completed",createdAt:firebase.firestore.FieldValue.serverTimestamp(),updatedAt:firebase.firestore.FieldValue.serverTimestamp()}).then((function(e){return e.id}))}(e,t,s,o.price,i).then((function(e){return function(e,t,n){return Om(xp(UI,"wifiCodes",e),{status:"sold",clientId:t,paymentId:n,soldAt:firebase.firestore.FieldValue.serverTimestamp(),updatedAt:firebase.firestore.FieldValue.serverTimestamp()})}(a.id,t,e).then((function(){!function(e){document.getElementById("wifiUsername").value=e.username,document.getElementById("wifiPassword").value=e.password;var t=new Date;if(window.selectedProfile.duration.includes("jour")){var n=parseInt(window.selectedProfile.duration);t.setDate(t.getDate()+n)}else if(window.selectedProfile.duration.includes("semaine")){var r=parseInt(window.selectedProfile.duration);t.setDate(t.getDate()+7*r)}else if(window.selectedProfile.duration.includes("mois")){var i=parseInt(window.selectedProfile.duration);t.setMonth(t.getMonth()+i)}var s=t.toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"});document.getElementById("wifiExpiry").value=s}(a.data()),n&&window.paymentSettings.sendReceiptBySms&&WI(0,n,a.data())}))}))})):(zI("Aucun code WiFi n'est disponible pour ce forfait. Veuillez en choisir un autre ou contacter le support."),void HI(1))})).catch((function(e){console.error("Erreur lors du traitement de l'achat:",e),zI("Une erreur est survenue lors du traitement de votre achat. Veuillez réessayer plus tard."),HI(3)}))}(e),HI(r))}}(e)})),document.querySelectorAll(".copy-btn").forEach((function(e){e.getAttribute("data-click-handler-attached")||(e.setAttribute("data-click-handler-attached","true"),e.addEventListener("click",(function(){!function(e){document.getElementById(e).select(),document.execCommand("copy");var t=document.querySelector('[data-copy-target="'.concat(e,'"]')),n=t.innerHTML;t.innerHTML='<i class="fas fa-check"></i>',setTimeout((function(){t.innerHTML=n}),2e3)}(this.dataset.copyTarget)})),console.log("Gestionnaire click attaché à un bouton de copie"))})),document.getElementById("printReceiptBtn").addEventListener("click",(function(){var e,t;e='\n        <div style="font-family: Arial, sans-serif; max-width: 400px; margin: 0 auto; padding: 20px; border: 1px solid #ccc;">\n            <div style="text-align: center; margin-bottom: 20px;">\n                <h2 style="margin: 0;">'.concat(document.getElementById("routerName").textContent,"</h2>\n                <p>").concat(document.getElementById("routerDescription").textContent,'</p>\n            </div>\n            \n            <div style="margin-bottom: 20px;">\n                <h3 style="margin: 0 0 10px 0;">Reçu d\'achat de code WiFi</h3>\n                <p><strong>Date:</strong> ').concat((new Date).toLocaleDateString("fr-FR"),"</p>\n                <p><strong>Client:</strong> ").concat(document.getElementById("summaryClientName").textContent,"</p>\n                <p><strong>Téléphone:</strong> ").concat(document.getElementById("summaryClientPhone").textContent,'</p>\n            </div>\n            \n            <div style="margin-bottom: 20px;">\n                <h3 style="margin: 0 0 10px 0;">Détails de l\'achat</h3>\n                <p><strong>Forfait:</strong> ').concat(document.getElementById("summaryProfileName").textContent,"</p>\n                <p><strong>Durée:</strong> ").concat(document.getElementById("summaryProfileDuration").textContent,"</p>\n                <p><strong>Montant:</strong> ").concat(document.getElementById("summaryTotal").textContent,'</p>\n            </div>\n            \n            <div style="margin-bottom: 20px;">\n                <h3 style="margin: 0 0 10px 0;">Identifiants WiFi</h3>\n                <p><strong>Nom d\'utilisateur:</strong> ').concat(document.getElementById("wifiUsername").value,"</p>\n                <p><strong>Mot de passe:</strong> ").concat(document.getElementById("wifiPassword").value,"</p>\n                <p><strong>Valide jusqu'au:</strong> ").concat(document.getElementById("wifiExpiry").value,'</p>\n            </div>\n            \n            <div style="text-align: center; font-size: 12px; margin-top: 30px;">\n                <p>Merci pour votre achat!</p>\n                ').concat(window.paymentSettings&&window.paymentSettings.receiptFooter?"<p>".concat(window.paymentSettings.receiptFooter,"</p>"):"","\n            </div>\n        </div>\n    "),(t=window.open("","_blank")).document.write("\n        <html>\n            <head>\n                <title>Reçu - ".concat(document.getElementById("routerName").textContent,"</title>\n            </head>\n            <body>\n                ").concat(e,"\n                <script>\n                    window.onload = function() {\n                        window.print();\n                        setTimeout(function() { window.close(); }, 500);\n                    };\n                <\/script>\n            </body>\n        </html>\n    ")),t.document.close()})),document.getElementById("sendBySmsBtn").addEventListener("click",(function(){WI()}))}(n)}}))})()})();