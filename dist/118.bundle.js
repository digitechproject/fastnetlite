"use strict";(self.webpackChunkfastnetlite=self.webpackChunkfastnetlite||[]).push([[118],{118:(e,r,t)=>{t.r(r),t.d(r,{checkAndCreateCollection:()=>d,createCompositeIndexes:()=>E,displayIndexError:()=>w,documentExists:()=>x,executeWithIndexErrorHandling:()=>h,handleFirebaseError:()=>y,handleFirebaseIndexError:()=>g,initializeCollections:()=>f});var n=t(467),o=t(848),c=t(756),s=t.n(c),i=t(405);function a(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?a(Object(t),!0).forEach((function(r){(0,n.A)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var u=(0,i.aU)();function d(e){return p.apply(this,arguments)}function p(){return p=(0,o.A)(s().mark((function e(r){var t,n,c,a=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>1&&void 0!==a[1]?a[1]:{},e.prev=1,console.log("Vérification de la collection: ".concat(r)),n=(0,i.H9)((0,i.rJ)(u,r),"dummy_doc"),e.next=6,(0,i.x7)(n);case 6:if(e.sent.exists()){e.next=15;break}return c=l(l({},t),{},{_dummy:!0,createdAt:(0,i.O5)()}),e.next=11,(0,i.BN)(n,c);case 11:console.log("Collection ".concat(r," créée avec document factice")),setTimeout((0,o.A)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,i.kd)(n);case 3:console.log("Document factice supprimé de ".concat(r)),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.error("Erreur lors de la suppression du document factice: ".concat(e.t0));case 9:case"end":return e.stop()}}),e,null,[[0,6]])}))),2e3),e.next=16;break;case 15:console.log("Collection ".concat(r," existe déjà"));case 16:return e.abrupt("return",!0);case 19:return e.prev=19,e.t0=e.catch(1),console.error("Erreur lors de la vérification/création de la collection ".concat(r,":"),e.t0),e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e,null,[[1,19]])}))),p.apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return m=(0,o.A)(s().mark((function e(r){var t,n=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>1&&void 0!==n[1]?n[1]:null,e.prev=1,console.log("Initialisation des collections..."),e.next=5,d("routers",{userId:r});case 5:if(!t){e.next=14;break}return e.next=8,d("profiles",{routerId:t});case 8:return e.next=10,d("wifiCodes",{routerId:t});case 10:return e.next=12,d("clients",{routerId:t});case 12:return e.next=14,d("payments",{routerId:t});case 14:return console.log("Toutes les collections ont été vérifiées et initialisées si nécessaire"),e.abrupt("return",!0);case 18:return e.prev=18,e.t0=e.catch(1),console.error("Erreur lors de l'initialisation des collections:",e.t0),e.abrupt("return",!1);case 22:case"end":return e.stop()}}),e,null,[[1,18]])}))),m.apply(this,arguments)}function x(e,r){return v.apply(this,arguments)}function v(){return(v=(0,o.A)(s().mark((function e(r,t){var n,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=(0,i.H9)(u,r,t),e.next=4,(0,i.x7)(n);case 4:return o=e.sent,e.abrupt("return",o.exists());case 8:return e.prev=8,e.t0=e.catch(0),console.error("Erreur lors de la vérification de l'existence du document ".concat(t," dans ").concat(r,":"),e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function g(e){var r,t=e.message&&e.message.includes("index");return{isIndexError:t,indexUrl:t&&(null===(r=e.message.match(/https:\/\/console\.firebase\.google\.com[^\s]+/))||void 0===r?void 0:r[0])||null,message:e.message,originalError:e}}function h(e,r,t,n){return b.apply(this,arguments)}function b(){return(b=(0,o.A)(s().mark((function e(r,t,n,o){var c,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r();case 3:return c=e.sent,e.abrupt("return",t(c));case 7:if(e.prev=7,e.t0=e.catch(0),!(i=g(e.t0)).isIndexError){e.next=15;break}return console.warn("Erreur d'index Firebase détectée:",i.message),e.abrupt("return",n(i));case 15:return console.error("Erreur lors de l'exécution de la requête:",e.t0),e.abrupt("return",o(e.t0));case 17:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function y(e){var r={isIndexError:!1,indexUrl:null,collection:null,fields:[],message:e.message,originalError:e};if(e.message&&e.message.includes("index")){r.isIndexError=!0;var t=e.message.match(/https:\/\/console\.firebase\.google\.com[^\s"']+/);t&&(r.indexUrl=t[0]);var n=e.message.match(/collection ([a-zA-Z0-9_-]+)/);n&&(r.collection=n[1]);var o=e.message.match(/\[([^\]]+)\]/);o&&(r.fields=o[1].split(", ").map((function(e){return e.trim()}))),console.warn("Erreur d'index Firebase détectée pour la collection ".concat(r.collection||"inconnue")),r.indexUrl&&console.info("Créez l'index en visitant: ".concat(r.indexUrl))}return r}function w(e,r){var t=document.getElementById(e);t&&(t.classList.remove("d-none"),t.innerHTML='\n        <div class="alert alert-warning">\n            <p><strong>Erreur d\'index Firebase :</strong> Cette requête nécessite un index composé.</p>\n            '.concat(r.collection?"<p>Collection concernée: <code>".concat(r.collection,"</code></p>"):"","\n            ").concat(r.fields.length>0?"<p>Champs: <code>".concat(r.fields.join("</code>, <code>"),"</code></p>"):"","\n            ").concat(r.indexUrl?'<p>Cliquez sur <a href="'.concat(r.indexUrl,'" target="_blank">ce lien</a> pour créer l\'index nécessaire.</p>'):"",'\n            <p class="mb-0">Après avoir créé l\'index, actualisez la page.</p>\n        </div>\n    '))}function E(e){return I.apply(this,arguments)}function I(){return(I=(0,o.A)(s().mark((function e(r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Création des index composites..."),[{collection:"payments",fields:["routerId","createdAt"],description:"Paiements par routeur et date de création"},{collection:"wifiCodes",fields:["routerId","profileId","status"],description:"Codes par routeur, profil et statut"},{collection:"clients",fields:["routerId","createdAt"],description:"Clients par routeur et date de création"},{collection:"routers",fields:["userId","name"],description:"Routeurs par utilisateur et nom"}].forEach((function(e){console.log("Index requis pour ".concat(e.collection,": ").concat(e.fields.join(", ")," - ").concat(e.description))})),console.log("Note: Les index composites doivent être créés manuellement dans la console Firebase"),console.log("Vous pouvez créer les index nécessaires en suivant les liens dans les messages d'erreur");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}}]);